"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{3291:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){let r,n,e,t,o,i,s,a,c,u,l,d,p,f,m,h,y,g,x,b,w,S,P,_,v,r1,e1,t1,o1,i1,s1,a1,c1,u1,l1,d1,p1,f1,m1,h1,y1,g1,x1,e2,e3,t2,o2,i2,s2,a2,c2,u2,l2,e4,e5,t3,o3,i3,s3,e6,t4,o4,i4,s4,e7,t5;__webpack_require__.d(__webpack_exports__,{Z:function(){return Uu}});var ac,i0,Bo,three__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9477),three_examples_jsm_utils_BufferGeometryUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(140),three_examples_jsm_loaders_DRACOLoader_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2854),process=__webpack_require__(3454),Buffer=__webpack_require__(1876).Buffer,H0=Object.create,vc=Object.defineProperty,W0=Object.getOwnPropertyDescriptor,q0=Object.getOwnPropertyNames,$0=Object.getPrototypeOf,Y0=Object.prototype.hasOwnProperty,ia=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),K0=(n,r,e,t)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let o of q0(r))Y0.call(n,o)||o===e||vc(n,o,{get:()=>r[o],enumerable:!(t=W0(r,o))||t.enumerable});return n},sa=(n,r,e)=>(e=null!=n?H0($0(n)):{},K0(!r&&n&&n.__esModule?e:vc(e,"default",{value:n,enumerable:!0}),n)),wh=ia((ed,Sh)=>{var n,r;n=ed,r=function(){return n.importState=function(e){var t=new n;return t.importState(e),t},n;function n(){return function(e){var e1,t,t1=0,o=0,i=0,s=1;0==e.length&&(e=[+new Date]);var a=(e1=4022871197,(t=function(o){o=o.toString();for(var i=0;i<o.length;i++){var s=.02519603282416938*(e1+=o.charCodeAt(i));e1=s>>>0,s-=e1,s*=e1,e1=s>>>0,s-=e1,e1+=4294967296*s}return(e1>>>0)*23283064365386963e-26}).version="Mash 0.9",t);t1=a(" "),o=a(" "),i=a(" ");for(var c=0;c<e.length;c++)(t1-=a(e[c]))<0&&(t1+=1),(o-=a(e[c]))<0&&(o+=1),(i-=a(e[c]))<0&&(i+=1);a=null;var u=function(){var l=2091639*t1+23283064365386963e-26*s;return t1=o,o=i,i=l-(s=0|l)};return u.next=u,u.uint32=function(){return 4294967296*u()},u.fract53=function(){return u()+(2097152*u()|0)*11102230246251565e-32},u.version="Alea 0.9",u.args=e,u.exportState=function(){return[t1,o,i,s]},u.importState=function(l){t1=+l[0]||0,o=+l[1]||0,i=+l[2]||0,s=+l[3]||0},u}(Array.prototype.slice.call(arguments))}},"object"==typeof ed?Sh.exports=r():"function"==typeof define&&define.amd?define(r):n.Alea=r()}),Ah=ia((yl,Oh)=>{var n,r;n=yl,r=function(n){n.SVD=function(r,e,t,o,i){if(e=void 0===e||e,t=void 0===t||t,i=1e-64/(o=o||2220446049250313e-31),!r)throw TypeError("Matrix a is not defined");var s,a,c,u,l,d,p,f,m,h,y,g,x=r[0].length,b=r.length;if(b<x)throw TypeError("Invalid matrix: m < n");for(var w=[],S=[],P=[],_="f"===e?b:x,v=h=p=0;v<b;v++)S[v]=Array(_).fill(0);for(v=0;v<x;v++)P[v]=Array(x).fill(0);var N,T=Array(x).fill(0);for(v=0;v<b;v++)for(s=0;s<x;s++)S[v][s]=r[v][s];for(v=0;v<x;v++){for(w[v]=p,m=0,c=v+1,s=v;s<b;s++)m+=Math.pow(S[s][v],2);if(m<i)p=0;else for(f=(d=S[v][v])*(p=d<0?Math.sqrt(m):-Math.sqrt(m))-m,S[v][v]=d-p,s=c;s<x;s++){for(m=0,a=v;a<b;a++)m+=S[a][v]*S[a][s];for(d=m/f,a=v;a<b;a++)S[a][s]=S[a][s]+d*S[a][v]}for(T[v]=p,m=0,s=c;s<x;s++)m+=Math.pow(S[v][s],2);if(m<i)p=0;else{for(f=(d=S[v][v+1])*(p=d<0?Math.sqrt(m):-Math.sqrt(m))-m,S[v][v+1]=d-p,s=c;s<x;s++)w[s]=S[v][s]/f;for(s=c;s<b;s++){for(m=0,a=c;a<x;a++)m+=S[s][a]*S[v][a];for(a=c;a<x;a++)S[s][a]=S[s][a]+m*w[a]}}h<(y=Math.abs(T[v])+Math.abs(w[v]))&&(h=y)}if(t)for(v=x-1;0<=v;v--){if(0!==p){for(f=S[v][v+1]*p,s=c;s<x;s++)P[s][v]=S[v][s]/f;for(s=c;s<x;s++){for(m=0,a=c;a<x;a++)m+=S[v][a]*P[a][s];for(a=c;a<x;a++)P[a][s]=P[a][s]+m*P[a][v]}}for(s=c;s<x;s++)P[v][s]=0,P[s][v]=0;P[v][v]=1,p=w[v],c=v}if(e){if("f"===e)for(v=x;v<b;v++){for(s=x;s<b;s++)S[v][s]=0;S[v][v]=1}for(v=x-1;0<=v;v--){for(c=v+1,p=T[v],s=c;s<_;s++)S[v][s]=0;if(0!==p){for(f=S[v][v]*p,s=c;s<_;s++){for(m=0,a=c;a<b;a++)m+=S[a][v]*S[a][s];for(d=m/f,a=v;a<b;a++)S[a][s]=S[a][s]+d*S[a][v]}for(s=v;s<b;s++)S[s][v]=S[s][v]/p}else for(s=v;s<b;s++)S[s][v]=0;S[v][v]=S[v][v]+1}}for(o*=h,a=x-1;0<=a;a--)for(var C=0;C<50;C++){for(N=!1,c=a;0<=c;c--){if(Math.abs(w[c])<=o){N=!0;break}if(Math.abs(T[c-1])<=o)break}if(!N){for(l=0,u=c-(m=1),v=c;v<a+1&&(d=m*w[v],w[v]=l*w[v],!(Math.abs(d)<=o));v++)if(p=T[v],T[v]=Math.sqrt(d*d+p*p),l=p/(f=T[v]),m=-d/f,e)for(s=0;s<b;s++)y=S[s][u],g=S[s][v],S[s][u]=y*l+g*m,S[s][v]=-y*m+g*l}if(g=T[a],c===a){if(g<0&&(T[a]=-g,t))for(s=0;s<x;s++)P[s][a]=-P[s][a];break}for(h=T[c],p=Math.sqrt((d=(((y=T[a-1])-g)*(y+g)+((p=w[a-1])-(f=w[a]))*(p+f))/(2*f*y))*d+1),d=((h-g)*(h+g)+f*(y/(d<0?d-p:d+p)-f))/h,v=c+(m=l=1);v<a+1;v++){if(p=w[v],y=T[v],f=m*p,p*=l,g=Math.sqrt(d*d+f*f),d=h*(l=d/(w[v-1]=g))+p*(m=f/g),p=-h*m+p*l,f=y*m,y*=l,t)for(s=0;s<x;s++)h=P[s][v-1],g=P[s][v],P[s][v-1]=h*l+g*m,P[s][v]=-h*m+g*l;if(g=Math.sqrt(d*d+f*f),d=(l=d/(T[v-1]=g))*p+(m=f/g)*y,h=-m*p+l*y,e)for(s=0;s<b;s++)y=S[s][v-1],g=S[s][v],S[s][v-1]=y*l+g*m,S[s][v]=-y*m+g*l}w[c]=0,w[a]=d,T[a]=h}for(v=0;v<x;v++)T[v]<o&&(T[v]=0);return{u:S,q:T,v:P}},n.VERSION="1.1.1",Object.defineProperty(n,"__esModule",{value:!0})},"object"==typeof yl&&"u">typeof Oh?r(yl):"function"==typeof define&&define.amd?define(["exports"],r):r((n="u">typeof globalThis?globalThis:n||self).SVDJS={})}),xg=ia(Zl=>{var n,r,e,t,o,i,s,a,c,u,r1,r2,r3,n1;(n=function(){this.init()}).prototype={init:function(){var l=this||r;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator="u">typeof window&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var d=this||r;if(l=parseFloat(l),d.ctx||u(),"u">typeof l&&l>=0&&l<=1){if(d._volume=l,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(l,r.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),m=0;m<f.length;m++){var h=d._howls[p]._soundById(f[m]);h&&h._node&&(h._node.volume=h._volume*l)}return d}return d._volume},mute:function(l){var d=this||r;d.ctx||u(),d._muted=l,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(l?0:d._volume,r.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),m=0;m<f.length;m++){var h=d._howls[p]._soundById(f[m]);h&&h._node&&(h._node.muted=!!l||h._muted)}return d},stop:function(){for(var l=this||r,d=0;d<l._howls.length;d++)l._howls[d].stop();return l},unload:function(){for(var l=this||r,d=l._howls.length-1;d>=0;d--)l._howls[d].unload();return l.usingWebAudio&&l.ctx&&"u">typeof l.ctx.close&&(l.ctx.close(),l.ctx=null,u()),l},codecs:function(l){return(this||r)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||r;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio){if("u">typeof Audio)try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0}try{var d=new Audio;d.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||r,d=null;try{d="u">typeof Audio?new Audio:null}catch{return l}if(!d||"function"!=typeof d.canPlayType)return l;var p=d.canPlayType("audio/mpeg;").replace(/^no$/,""),f=l._navigator?l._navigator.userAgent:"",m=f.match(/OPR\/([0-6].)/g),h=m&&33>parseInt(m[0].split("/")[1],10),y=-1!==f.indexOf("Safari")&&-1===f.indexOf("Chrome"),g=f.match(/Version\/(.*?) /),x=y&&g&&15>parseInt(g[1],10);return l._codecs={mp3:!!(!h&&(p||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||r;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,l._mobileUnloaded||44100===l.ctx.sampleRate||(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var d=function(p){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,l._releaseHtml5Audio(f)}catch{l.noAudio=!0;break}for(var m=0;m<l._howls.length;m++)if(!l._howls[m]._webAudio)for(var h=l._howls[m]._getSoundIds(),y=0;y<h.length;y++){var g=l._howls[m]._soundById(h[y]);g&&g._node&&!g._node._unlocked&&(g._node._unlocked=!0,g._node.load())}l._autoResume();var x=l.ctx.createBufferSource();x.buffer=l._scratchBuffer,x.connect(l.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),"function"==typeof l.ctx.resume&&l.ctx.resume(),x.onended=function(){x.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var b=0;b<l._howls.length;b++)l._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),l}},_obtainHtml5Audio:function(){var l=this||r;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var d=new Audio().play();return d&&"u">typeof Promise&&(d instanceof Promise||"function"==typeof d.then)&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var d=this||r;return l._unlocked&&d._html5AudioPool.push(l),d},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend>"u"||!r.usingWebAudio)){for(var d=0;d<l._howls.length;d++)if(l._howls[d]._webAudio){for(var p=0;p<l._howls[d]._sounds.length;p++)if(!l._howls[d]._sounds[p]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var f=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(f,f)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume>"u"||!r.usingWebAudio))return"running"===l.state&&"interrupted"!==l.ctx.state&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):"suspended"===l.state||"running"===l.state&&"interrupted"===l.ctx.state?(l.ctx.resume().then(function(){l.state="running";for(var d=0;d<l._howls.length;d++)l._howls[d]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):"suspending"===l.state&&(l._resumeAfterSuspend=!0),l}},r=new n,(e=function(l){if(!l.src||0===l.src.length){console.error("An array of source files must be passed with any new Howl.");return}this.init(l)}).prototype={init:function(l){var d=this;return r.ctx||u(),d._autoplay=l.autoplay||!1,d._format="string"!=typeof l.format?l.format:[l.format],d._html5=l.html5||!1,d._muted=l.mute||!1,d._loop=l.loop||!1,d._pool=l.pool||5,d._preload="boolean"!=typeof l.preload&&"metadata"!==l.preload||l.preload,d._rate=l.rate||1,d._sprite=l.sprite||{},d._src="string"!=typeof l.src?l.src:[l.src],d._volume=void 0!==l.volume?l.volume:1,d._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:!!l.xhr&&!!l.xhr.withCredentials&&l.xhr.withCredentials},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=l.onend?[{fn:l.onend}]:[],d._onfade=l.onfade?[{fn:l.onfade}]:[],d._onload=l.onload?[{fn:l.onload}]:[],d._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],d._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],d._onpause=l.onpause?[{fn:l.onpause}]:[],d._onplay=l.onplay?[{fn:l.onplay}]:[],d._onstop=l.onstop?[{fn:l.onstop}]:[],d._onmute=l.onmute?[{fn:l.onmute}]:[],d._onvolume=l.onvolume?[{fn:l.onvolume}]:[],d._onrate=l.onrate?[{fn:l.onrate}]:[],d._onseek=l.onseek?[{fn:l.onseek}]:[],d._onunlock=l.onunlock?[{fn:l.onunlock}]:[],d._onresume=[],d._webAudio=r.usingWebAudio&&!d._html5,"u">typeof r.ctx&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&"none"!==d._preload&&d.load(),d},load:function(){var f,m,l=this,d=null;if(r.noAudio){l._emit("loaderror",null,"No audio support.");return}"string"==typeof l._src&&(l._src=[l._src]);for(var p=0;p<l._src.length;p++){if(l._format&&l._format[p])f=l._format[p];else{if("string"!=typeof(m=l._src[p])){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(f=/^data:audio\/([^;,]+);/i.exec(m))||(f=/\.([^.]+)$/.exec(m.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&r.codecs(f)){d=l._src[p];break}}if(!d){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=d,l._state="loading","https:"===window.location.protocol&&"http:"===d.slice(0,5)&&(l._html5=!0,l._webAudio=!1),new t(l),l._webAudio&&i(l),l},play:function(l,d){var p=this,f=null;if("number"==typeof l)f=l,l=null;else{if("string"==typeof l&&"loaded"===p._state&&!p._sprite[l])return null;if(typeof l>"u"&&(l="__default",!p._playLock)){for(var m=0,h=0;h<p._sounds.length;h++)p._sounds[h]._paused&&!p._sounds[h]._ended&&(m++,f=p._sounds[h]._id);1===m?l=null:f=null}}var y=f?p._soundById(f):p._inactiveSound();if(!y)return null;if(f&&!l&&(l=y._sprite||"__default"),"loaded"!==p._state){y._sprite=l,y._ended=!1;var g=y._id;return p._queue.push({event:"play",action:function(){p.play(g)}}),g}if(f&&!y._paused)return d||p._loadQueue("play"),y._id;p._webAudio&&r._autoResume();var x=Math.max(0,y._seek>0?y._seek:p._sprite[l][0]/1e3),b=Math.max(0,(p._sprite[l][0]+p._sprite[l][1])/1e3-x),w=1e3*b/Math.abs(y._rate),S=p._sprite[l][0]/1e3,P=(p._sprite[l][0]+p._sprite[l][1])/1e3;y._sprite=l,y._ended=!1;var _=function(){y._paused=!1,y._seek=x,y._start=S,y._stop=P,y._loop=!!(y._loop||p._sprite[l][2])};if(x>=P){p._ended(y);return}var v=y._node;if(p._webAudio){var N=function(){p._playLock=!1,_(),p._refreshBuffer(y);var A=y._muted||p._muted?0:y._volume;v.gain.setValueAtTime(A,r.ctx.currentTime),y._playStart=r.ctx.currentTime,typeof v.bufferSource.start>"u"?y._loop?v.bufferSource.noteGrainOn(0,x,86400):v.bufferSource.noteGrainOn(0,x,b):y._loop?v.bufferSource.start(0,x,86400):v.bufferSource.start(0,x,b),w!==1/0&&(p._endTimers[y._id]=setTimeout(p._ended.bind(p,y),w)),d||setTimeout(function(){p._emit("play",y._id),p._loadQueue()},0)};"running"===r.state&&"interrupted"!==r.ctx.state?N():(p._playLock=!0,p.once("resume",N),p._clearTimer(y._id))}else{var T=function(){v.currentTime=x,v.muted=y._muted||p._muted||r._muted||v.muted,v.volume=y._volume*r.volume(),v.playbackRate=y._rate;try{var A=v.play();if(A&&"u">typeof Promise&&(A instanceof Promise||"function"==typeof A.then)?(p._playLock=!0,_(),A.then(function(){p._playLock=!1,v._unlocked=!0,d?p._loadQueue():p._emit("play",y._id)}).catch(function(){p._playLock=!1,p._emit("playerror",y._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),y._ended=!0,y._paused=!0})):d||(p._playLock=!1,_(),p._emit("play",y._id)),v.playbackRate=y._rate,v.paused){p._emit("playerror",y._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}"__default"!==l||y._loop?p._endTimers[y._id]=setTimeout(p._ended.bind(p,y),w):(p._endTimers[y._id]=function(){p._ended(y),v.removeEventListener("ended",p._endTimers[y._id],!1)},v.addEventListener("ended",p._endTimers[y._id],!1))}catch(R){p._emit("playerror",y._id,R)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===v.src&&(v.src=p._src,v.load());var C=window&&window.ejecta||!v.readyState&&r._navigator.isCocoonJS;if(v.readyState>=3||C)T();else{p._playLock=!0,p._state="loading";var O=function(){p._state="loaded",T(),v.removeEventListener(r._canPlayEvent,O,!1)};v.addEventListener(r._canPlayEvent,O,!1),p._clearTimer(y._id)}}return y._id},pause:function(l){var d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(l)}}),d;for(var p=d._getSoundIds(l),f=0;f<p.length;f++){d._clearTimer(p[f]);var m=d._soundById(p[f]);if(m&&!m._paused&&(m._seek=d.seek(p[f]),m._rateSeek=0,m._paused=!0,d._stopFade(p[f]),m._node)){if(d._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)}else isNaN(m._node.duration)&&m._node.duration!==1/0||m._node.pause()}arguments[1]||d._emit("pause",m?m._id:null)}return d},stop:function(l,d){var p=this;if("loaded"!==p._state||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(l)}}),p;for(var f=p._getSoundIds(l),m=0;m<f.length;m++){p._clearTimer(f[m]);var h=p._soundById(f[m]);h&&(h._seek=h._start||0,h._rateSeek=0,h._paused=!0,h._ended=!0,p._stopFade(f[m]),h._node&&(p._webAudio?h._node.bufferSource&&(typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),p._cleanBuffer(h._node)):isNaN(h._node.duration)&&h._node.duration!==1/0||(h._node.currentTime=h._start||0,h._node.pause(),h._node.duration===1/0&&p._clearSound(h._node))),d||p._emit("stop",h._id))}return p},mute:function(l,d){var p=this;if("loaded"!==p._state||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(l,d)}}),p;if(typeof d>"u"){if("boolean"!=typeof l)return p._muted;p._muted=l}for(var f=p._getSoundIds(d),m=0;m<f.length;m++){var h=p._soundById(f[m]);h&&(h._muted=l,h._interval&&p._stopFade(h._id),p._webAudio&&h._node?h._node.gain.setValueAtTime(l?0:h._volume,r.ctx.currentTime):h._node&&(h._node.muted=!!r._muted||l),p._emit("mute",h._id))}return p},volume:function(){var y,p,f,l=this,d=arguments;if(0===d.length)return l._volume;if(1===d.length||2===d.length&&typeof d[1]>"u"?l._getSoundIds().indexOf(d[0])>=0?f=parseInt(d[0],10):p=parseFloat(d[0]):d.length>=2&&(p=parseFloat(d[0]),f=parseInt(d[1],10)),!("u">typeof p)||!(p>=0)||!(p<=1))return(y=f?l._soundById(f):l._sounds[0])?y._volume:0;if("loaded"!==l._state||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,d)}}),l;typeof f>"u"&&(l._volume=p),f=l._getSoundIds(f);for(var g=0;g<f.length;g++)(y=l._soundById(f[g]))&&(y._volume=p,d[2]||l._stopFade(f[g]),l._webAudio&&y._node&&!y._muted?y._node.gain.setValueAtTime(p,r.ctx.currentTime):y._node&&!y._muted&&(y._node.volume=p*r.volume()),l._emit("volume",y._id));return l},fade:function(l,d,p,f){var m=this;if("loaded"!==m._state||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(l,d,p,f)}}),m;l=Math.min(Math.max(0,parseFloat(l)),1),d=Math.min(Math.max(0,parseFloat(d)),1),p=parseFloat(p),m.volume(l,f);for(var h=m._getSoundIds(f),y=0;y<h.length;y++){var g=m._soundById(h[y]);if(g){if(f||m._stopFade(h[y]),m._webAudio&&!g._muted){var x=r.ctx.currentTime,b=x+p/1e3;g._volume=l,g._node.gain.setValueAtTime(l,x),g._node.gain.linearRampToValueAtTime(d,b)}m._startFadeInterval(g,l,d,p,h[y],typeof f>"u")}}return m},_startFadeInterval:function(l,d,p,f,m,h){var y=this,g=d,x=p-d,b=Math.abs(x/.01),S=Date.now();l._fadeTo=p,l._interval=setInterval(function(){var P=(Date.now()-S)/f;S=Date.now(),g+=x*P,g=Math.round(100*g)/100,g=x<0?Math.max(p,g):Math.min(p,g),y._webAudio?l._volume=g:y.volume(g,l._id,!0),h&&(y._volume=g),(p<d&&g<=p||p>d&&g>=p)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,y.volume(p,l._id),y._emit("fade",l._id))},Math.max(4,b>0?f/b:f))},_stopFade:function(l){var p=this._soundById(l);return p&&p._interval&&(this._webAudio&&p._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(p._interval),p._interval=null,this.volume(p._fadeTo,l),p._fadeTo=null,this._emit("fade",l)),this},loop:function(){var p,f,m,l=this,d=arguments;if(0===d.length)return l._loop;if(1===d.length){if("boolean"!=typeof d[0])return!!(m=l._soundById(parseInt(d[0],10)))&&m._loop;p=d[0],l._loop=p}else 2===d.length&&(p=d[0],f=parseInt(d[1],10));for(var h=l._getSoundIds(f),y=0;y<h.length;y++)(m=l._soundById(h[y]))&&(m._loop=p,l._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=p,p&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,l.playing(h[y])&&(l.pause(h[y],!0),l.play(h[y],!0)))));return l},rate:function(){var y,p,f,l=this,d=arguments;if(0===d.length?f=l._sounds[0]._id:1===d.length?l._getSoundIds().indexOf(d[0])>=0?f=parseInt(d[0],10):p=parseFloat(d[0]):2===d.length&&(p=parseFloat(d[0]),f=parseInt(d[1],10)),"number"!=typeof p)return(y=l._soundById(f))?y._rate:l._rate;if("loaded"!==l._state||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,d)}}),l;typeof f>"u"&&(l._rate=p),f=l._getSoundIds(f);for(var g=0;g<f.length;g++)if(y=l._soundById(f[g])){l.playing(f[g])&&(y._rateSeek=l.seek(f[g]),y._playStart=l._webAudio?r.ctx.currentTime:y._playStart),y._rate=p,l._webAudio&&y._node&&y._node.bufferSource?y._node.bufferSource.playbackRate.setValueAtTime(p,r.ctx.currentTime):y._node&&(y._node.playbackRate=p);var x=l.seek(f[g]),w=1e3*((l._sprite[y._sprite][0]+l._sprite[y._sprite][1])/1e3-x)/Math.abs(y._rate);(l._endTimers[f[g]]||!y._paused)&&(l._clearTimer(f[g]),l._endTimers[f[g]]=setTimeout(l._ended.bind(l,y),w)),l._emit("rate",y._id)}return l},seek:function(){var p,f,l=this,d=arguments;if(0===d.length?l._sounds.length&&(f=l._sounds[0]._id):1===d.length?l._getSoundIds().indexOf(d[0])>=0?f=parseInt(d[0],10):l._sounds.length&&(f=l._sounds[0]._id,p=parseFloat(d[0])):2===d.length&&(p=parseFloat(d[0]),f=parseInt(d[1],10)),typeof f>"u")return 0;if("number"==typeof p&&("loaded"!==l._state||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,d)}}),l;var y=l._soundById(f);if(y){if("number"==typeof p&&p>=0){var g=l.playing(f);g&&l.pause(f,!0),y._seek=p,y._ended=!1,l._clearTimer(f),l._webAudio||!y._node||isNaN(y._node.duration)||(y._node.currentTime=p);var x=function(){g&&l.play(f,!0),l._emit("seek",f)};if(g&&!l._webAudio){var b=function(){l._playLock?setTimeout(b,0):x()};setTimeout(b,0)}else x()}else{if(!l._webAudio)return y._node.currentTime;var w=l.playing(f)?r.ctx.currentTime-y._playStart:0,S=y._rateSeek?y._rateSeek-y._seek:0;return y._seek+(S+w*Math.abs(y._rate))}}return l},playing:function(l){if("number"==typeof l){var p=this._soundById(l);return!!p&&!p._paused}for(var f=0;f<this._sounds.length;f++)if(!this._sounds[f]._paused)return!0;return!1},duration:function(l){var p=this._duration,f=this._soundById(l);return f&&(p=this._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var l=this,d=l._sounds,p=0;p<d.length;p++)d[p]._paused||l.stop(d[p]._id),l._webAudio||(l._clearSound(d[p]._node),d[p]._node.removeEventListener("error",d[p]._errorFn,!1),d[p]._node.removeEventListener(r._canPlayEvent,d[p]._loadFn,!1),d[p]._node.removeEventListener("ended",d[p]._endFn,!1),r._releaseHtml5Audio(d[p]._node)),delete d[p]._node,l._clearTimer(d[p]._id);var f=r._howls.indexOf(l);f>=0&&r._howls.splice(f,1);var m=!0;for(p=0;p<r._howls.length;p++)if(r._howls[p]._src===l._src||l._src.indexOf(r._howls[p]._src)>=0){m=!1;break}return o&&m&&delete o[l._src],r.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,d,p,f){var h=this["_on"+l];return"function"==typeof d&&h.push(f?{id:p,fn:d,once:f}:{id:p,fn:d}),this},off:function(l,d,p){var f=this,m=f["_on"+l],h=0;if("number"==typeof d&&(p=d,d=null),d||p)for(h=0;h<m.length;h++){var y=p===m[h].id;if(d===m[h].fn&&y||!d&&y){m.splice(h,1);break}}else if(l)f["_on"+l]=[];else{var g=Object.keys(f);for(h=0;h<g.length;h++)0===g[h].indexOf("_on")&&Array.isArray(f[g[h]])&&(f[g[h]]=[])}return f},once:function(l,d,p){return this.on(l,d,p,1),this},_emit:function(l,d,p){for(var m=this["_on"+l],h=m.length-1;h>=0;h--)(!m[h].id||m[h].id===d||"load"===l)&&(setTimeout((function(y){y.call(this,d,p)}).bind(this,m[h].fn),0),m[h].once&&this.off(l,m[h].fn,m[h].id));return this._loadQueue(l),this},_loadQueue:function(l){if(this._queue.length>0){var p=this._queue[0];p.event===l&&(this._queue.shift(),this._loadQueue()),l||p.action()}return this},_ended:function(l){var d=this,p=l._sprite;if(!d._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(d._ended.bind(d,l),100),d;var f=!!(l._loop||d._sprite[p][2]);if(d._emit("end",l._id),!d._webAudio&&f&&d.stop(l._id,!0).play(l._id),d._webAudio&&f){d._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=r.ctx.currentTime;var m=(l._stop-l._start)*1e3/Math.abs(l._rate);d._endTimers[l._id]=setTimeout(d._ended.bind(d,l),m)}return d._webAudio&&!f&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,d._clearTimer(l._id),d._cleanBuffer(l._node),r._autoSuspend()),d._webAudio||f||d.stop(l._id,!0),d},_clearTimer:function(l){if(this._endTimers[l]){if("function"!=typeof this._endTimers[l])clearTimeout(this._endTimers[l]);else{var p=this._soundById(l);p&&p._node&&p._node.removeEventListener("ended",this._endTimers[l],!1)}delete this._endTimers[l]}return this},_soundById:function(l){for(var p=0;p<this._sounds.length;p++)if(l===this._sounds[p]._id)return this._sounds[p];return null},_inactiveSound:function(){this._drain();for(var d=0;d<this._sounds.length;d++)if(this._sounds[d]._ended)return this._sounds[d].reset();return new t(this)},_drain:function(){var d=this._pool,p=0,f=0;if(!(this._sounds.length<d)){for(f=0;f<this._sounds.length;f++)this._sounds[f]._ended&&p++;for(f=this._sounds.length-1;f>=0;f--){if(p<=d)return;this._sounds[f]._ended&&(this._webAudio&&this._sounds[f]._node&&this._sounds[f]._node.disconnect(0),this._sounds.splice(f,1),p--)}}},_getSoundIds:function(l){if(!(typeof l>"u"))return[l];for(var p=[],f=0;f<this._sounds.length;f++)p.push(this._sounds[f]._id);return p},_refreshBuffer:function(l){return l._node.bufferSource=r.ctx.createBufferSource(),l._node.bufferSource.buffer=o[this._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,r.ctx.currentTime),this},_cleanBuffer:function(l){var p=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),p))try{l.bufferSource.buffer=r._scratchBuffer}catch{}return l.bufferSource=null,this},_clearSound:function(l){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}},(t=function(l){this._parent=l,this.init()}).prototype={init:function(){var l=this,d=l._parent;return l._muted=d._muted,l._loop=d._loop,l._volume=d._volume,l._rate=d._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++r._counter,d._sounds.push(l),l.create(),l},create:function(){var l=this,d=l._parent,p=r._muted||l._muted||l._parent._muted?0:l._volume;return d._webAudio?(l._node=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),l._node.gain.setValueAtTime(p,r.ctx.currentTime),l._node.paused=!0,l._node.connect(r.masterGain)):r.noAudio||(l._node=r._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(r._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=d._src,l._node.preload=!0===d._preload?"auto":d._preload,l._node.volume=p*r.volume(),l._node.load()),l},reset:function(){var l=this,d=l._parent;return l._muted=d._muted,l._loop=d._loop,l._volume=d._volume,l._rate=d._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++r._counter,l},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var d=this._parent;d._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(d._sprite).length&&(d._sprite={__default:[0,1e3*d._duration]}),"loaded"!==d._state&&(d._state="loaded",d._emit("load"),d._loadQueue()),this._node.removeEventListener(r._canPlayEvent,this._loadFn,!1)},_endListener:function(){var d=this._parent;d._duration===1/0&&(d._duration=Math.ceil(10*this._node.duration)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=1e3*d._duration),d._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}},o={},i=function(l){var d=l._src;if(o[d]){l._duration=o[d].duration,c(l);return}if(/^data:[^;]+;base64,/.test(d)){for(var p=atob(d.split(",")[1]),f=new Uint8Array(p.length),m=0;m<p.length;++m)f[m]=p.charCodeAt(m);a(f.buffer,l)}else{var h=new XMLHttpRequest;h.open(l._xhr.method,d,!0),h.withCredentials=l._xhr.withCredentials,h.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(y){h.setRequestHeader(y,l._xhr.headers[y])}),h.onload=function(){var y=(h.status+"")[0];if("0"!==y&&"2"!==y&&"3"!==y){l._emit("loaderror",null,"Failed loading audio file with status: "+h.status+".");return}a(h.response,l)},h.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete o[d],l.load())},s(h)}},s=function(l){try{l.send()}catch{l.onerror()}},a=function(l,d){var p=function(){d._emit("loaderror",null,"Decoding audio data failed.")},f=function(m){m&&d._sounds.length>0?(o[d._src]=m,c(d,m)):p()};"u">typeof Promise&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(l).then(f).catch(p):r.ctx.decodeAudioData(l,f,p)},c=function(l,d){d&&!l._duration&&(l._duration=d.duration),0===Object.keys(l._sprite).length&&(l._sprite={__default:[0,1e3*l._duration]}),"loaded"!==l._state&&(l._state="loaded",l._emit("load"),l._loadQueue())},u=function(){if(r.usingWebAudio){try{"u">typeof AudioContext?r.ctx=new AudioContext:"u">typeof webkitAudioContext?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch{r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),d=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=d?parseInt(d[1],10):null;if(l&&p&&p<9){var f=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!f&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}},"function"==typeof define&&define.amd&&define([],function(){return{Howler:r,Howl:e}}),"u">typeof Zl&&(Zl.Howler=r,Zl.Howl=e),"u">typeof global?(global.HowlerGlobal=n,global.Howler=r,global.Howl=e,global.Sound=t):"u">typeof window&&(window.HowlerGlobal=n,window.Howler=r,window.Howl=e,window.Sound=t),HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(r){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(r);return this},HowlerGlobal.prototype.pos=function(r,e,t){var o=this;return o.ctx&&o.ctx.listener?(e="number"!=typeof e?o._pos[1]:e,t="number"!=typeof t?o._pos[2]:t,"number"!=typeof r)?o._pos:(o._pos=[r,e,t],"u">typeof o.ctx.listener.positionX?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]),o):o},HowlerGlobal.prototype.orientation=function(r,e,t,o,i,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;var c=a._orientation;return(e="number"!=typeof e?c[1]:e,t="number"!=typeof t?c[2]:t,o="number"!=typeof o?c[3]:o,i="number"!=typeof i?c[4]:i,s="number"!=typeof s?c[5]:s,"number"!=typeof r)?c:(a._orientation=[r,e,t,o,i,s],"u">typeof a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(s,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(r,e,t,o,i,s),a)},Howl.prototype.init=(r1=Howl.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:"u">typeof e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:"u">typeof e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:"u">typeof e.coneOuterGain?e.coneOuterGain:0,distanceModel:"u">typeof e.distanceModel?e.distanceModel:"inverse",maxDistance:"u">typeof e.maxDistance?e.maxDistance:1e4,panningModel:"u">typeof e.panningModel?e.panningModel:"HRTF",refDistance:"u">typeof e.refDistance?e.refDistance:1,rolloffFactor:"u">typeof e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],r1.call(this,e)}),Howl.prototype.stereo=function(r,e){var t=this;if(!t._webAudio)return t;if("loaded"!==t._state)return t._queue.push({event:"stereo",action:function(){t.stereo(r,e)}}),t;var o=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof e>"u"){if("number"!=typeof r)return t._stereo;t._stereo=r,t._pos=[r,0,0]}for(var i=t._getSoundIds(e),s=0;s<i.length;s++){var a=t._soundById(i[s]);if(a){if("number"!=typeof r)return a._stereo;a._stereo=r,a._pos=[r,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||n1(a,o),"spatial"===o?"u">typeof a._panner.positionX?(a._panner.positionX.setValueAtTime(r,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(r,0,0):a._panner.pan.setValueAtTime(r,Howler.ctx.currentTime)),t._emit("stereo",a._id)}}return t},Howl.prototype.pos=function(r,e,t,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(r,e,t,o)}}),i;if(e="number"!=typeof e?0:e,t="number"!=typeof t?-.5:t,typeof o>"u"){if("number"!=typeof r)return i._pos;i._pos=[r,e,t]}for(var s=i._getSoundIds(o),a=0;a<s.length;a++){var c=i._soundById(s[a]);if(c){if("number"!=typeof r)return c._pos;c._pos=[r,e,t],c._node&&((!c._panner||c._panner.pan)&&n1(c,"spatial"),"u">typeof c._panner.positionX?(c._panner.positionX.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(t,Howler.ctx.currentTime)):c._panner.setPosition(r,e,t)),i._emit("pos",c._id)}}return i},Howl.prototype.orientation=function(r,e,t,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(r,e,t,o)}}),i;if(e="number"!=typeof e?i._orientation[1]:e,t="number"!=typeof t?i._orientation[2]:t,typeof o>"u"){if("number"!=typeof r)return i._orientation;i._orientation=[r,e,t]}for(var s=i._getSoundIds(o),a=0;a<s.length;a++){var c=i._soundById(s[a]);if(c){if("number"!=typeof r)return c._orientation;c._orientation=[r,e,t],c._node&&(c._panner||(c._pos||(c._pos=i._pos||[0,0,-.5]),n1(c,"spatial")),"u">typeof c._panner.orientationX?(c._panner.orientationX.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(e,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(t,Howler.ctx.currentTime)):c._panner.setOrientation(r,e,t)),i._emit("orientation",c._id)}}return i},Howl.prototype.pannerAttr=function(){var t,o,i,r=this,e=arguments;if(!r._webAudio)return r;if(0===e.length)return r._pannerAttr;if(1===e.length){if("object"!=typeof e[0])return(i=r._soundById(parseInt(e[0],10)))?i._pannerAttr:r._pannerAttr;t=e[0],typeof o>"u"&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),r._pannerAttr={coneInnerAngle:"u">typeof t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:"u">typeof t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:"u">typeof t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:"u">typeof t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:r._distanceModel,maxDistance:"u">typeof t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:r._maxDistance,refDistance:"u">typeof t.pannerAttr.refDistance?t.pannerAttr.refDistance:r._refDistance,rolloffFactor:"u">typeof t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:"u">typeof t.pannerAttr.panningModel?t.pannerAttr.panningModel:r._panningModel})}else 2===e.length&&(t=e[0],o=parseInt(e[1],10));for(var s=r._getSoundIds(o),a=0;a<s.length;a++)if(i=r._soundById(s[a])){var c=i._pannerAttr;c={coneInnerAngle:"u">typeof t.coneInnerAngle?t.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:"u">typeof t.coneOuterAngle?t.coneOuterAngle:c.coneOuterAngle,coneOuterGain:"u">typeof t.coneOuterGain?t.coneOuterGain:c.coneOuterGain,distanceModel:"u">typeof t.distanceModel?t.distanceModel:c.distanceModel,maxDistance:"u">typeof t.maxDistance?t.maxDistance:c.maxDistance,refDistance:"u">typeof t.refDistance?t.refDistance:c.refDistance,rolloffFactor:"u">typeof t.rolloffFactor?t.rolloffFactor:c.rolloffFactor,panningModel:"u">typeof t.panningModel?t.panningModel:c.panningModel};var u=i._panner;u?(u.coneInnerAngle=c.coneInnerAngle,u.coneOuterAngle=c.coneOuterAngle,u.coneOuterGain=c.coneOuterGain,u.distanceModel=c.distanceModel,u.maxDistance=c.maxDistance,u.refDistance=c.refDistance,u.rolloffFactor=c.rolloffFactor,u.panningModel=c.panningModel):(i._pos||(i._pos=r._pos||[0,0,-.5]),n1(i,"spatial"))}return r},Sound.prototype.init=(r2=Sound.prototype.init,function(){var e=this,t=e._parent;e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,r2.call(this),e._stereo?t.stereo(e._stereo):e._pos&&t.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}),Sound.prototype.reset=(r3=Sound.prototype.reset,function(){var e=this,t=e._parent;return e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,e._stereo?t.stereo(e._stereo):e._pos?t.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,t._refreshBuffer(e)),r3.call(this)}),n1=function(r,e){"spatial"===(e=e||"spatial")?(r._panner=Howler.ctx.createPanner(),r._panner.coneInnerAngle=r._pannerAttr.coneInnerAngle,r._panner.coneOuterAngle=r._pannerAttr.coneOuterAngle,r._panner.coneOuterGain=r._pannerAttr.coneOuterGain,r._panner.distanceModel=r._pannerAttr.distanceModel,r._panner.maxDistance=r._pannerAttr.maxDistance,r._panner.refDistance=r._pannerAttr.refDistance,r._panner.rolloffFactor=r._pannerAttr.rolloffFactor,r._panner.panningModel=r._pannerAttr.panningModel,"u">typeof r._panner.positionX?(r._panner.positionX.setValueAtTime(r._pos[0],Howler.ctx.currentTime),r._panner.positionY.setValueAtTime(r._pos[1],Howler.ctx.currentTime),r._panner.positionZ.setValueAtTime(r._pos[2],Howler.ctx.currentTime)):r._panner.setPosition(r._pos[0],r._pos[1],r._pos[2]),"u">typeof r._panner.orientationX?(r._panner.orientationX.setValueAtTime(r._orientation[0],Howler.ctx.currentTime),r._panner.orientationY.setValueAtTime(r._orientation[1],Howler.ctx.currentTime),r._panner.orientationZ.setValueAtTime(r._orientation[2],Howler.ctx.currentTime)):r._panner.setOrientation(r._orientation[0],r._orientation[1],r._orientation[2])):(r._panner=Howler.ctx.createStereoPanner(),r._panner.pan.setValueAtTime(r._stereo,Howler.ctx.currentTime)),r._panner.connect(r._node),r._paused||r._parent.pause(r._id,!0).play(r._id,!0)}}),L0=ia((HJ,E0)=>{E0.exports=function(r,e){for(var t=r.split("."),o=e.split("."),i=0;i<3;i++){var s=Number(t[i]),a=Number(o[i]);if(s>a)return 1;if(a>s)return -1;if(!isNaN(s)&&isNaN(a))return 1;if(isNaN(s)&&!isNaN(a))return -1}return 0}});function er(n,r){return Object.setPrototypeOf(n,r),n}function aa(n){return Array.isArray(n)?n:[n]}var Z0="object"==typeof global&&global&&global.Object===Object&&global,Q0="object"==typeof self&&self&&self.Object===Object&&self,J0=Z0||Q0||Function("return this")(),ex=J0.Symbol,$u=Object.prototype,tx=$u.hasOwnProperty,rx=$u.toString,Ji=ex?ex.toStringTag:void 0,Yu=function(n){var r=tx.call(n,Ji),e=n[Ji];try{n[Ji]=void 0;var t=!0}catch{}var o=rx.call(n);return t&&(r?n[Ji]=e:delete n[Ji]),o},ix=Object.prototype.toString,Ku=ex?ex.toStringTag:void 0,Vt=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":Ku&&Ku in Object(n)?Yu(n):ix.call(n)},ct=function(n){return null!=n&&"object"==typeof n},pn=function(n){return"symbol"==typeof n||ct(n)&&"[object Symbol]"==Vt(n)},ca=function(n,r){for(var e=-1,t=null==n?0:n.length,o=Array(t);++e<t;)o[e]=r(n[e],e,n);return o},mx=Array.isArray,hx=1/0,Zu=ex?ex.prototype:void 0,Qu=Zu?Zu.toString:void 0,ep=function Ju(n){if("string"==typeof n)return n;if(mx(n))return ca(n,Ju)+"";if(pn(n))return Qu?Qu.call(n):"";var r=n+"";return"0"==r&&1/n==-hx?"-0":r},zt=function(n){var r=typeof n;return null!=n&&("object"==r||"function"==r)},da=function(n){if(!zt(n))return!1;var r=Vt(n);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r},_x=J0["__core-js_shared__"],rp=(n1=/[^.]+$/.exec(_x&&_x.keys&&_x.keys.IE_PROTO||""))?"Symbol(src)_1."+n1:"",Ox=Function.prototype.toString,kr=function(n){if(null!=n){try{return Ox.call(n)}catch{}try{return n+""}catch{}}return""},Nx=/^\[object .+?Constructor\]$/,Mx=Object.prototype,Ex=Function.prototype.toString,Lx=Mx.hasOwnProperty,Dx=RegExp("^"+Ex.call(Lx).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ct=function(n,r){var n1,e=n?.[r];return zt(n1=e)&&(!rp||!(rp in n1))&&(da(n1)?Dx:Nx).test(kr(n1))?e:void 0},Vx=Ct(J0,"WeakMap"),sp=Object.create,zx=function(){function n(){}return function(r){if(!zt(r))return{};if(sp)return sp(r);n.prototype=r;var e=new n;return n.prototype=void 0,e}}(),lp=function(n,r,e){switch(e.length){case 0:return n.call(r);case 1:return n.call(r,e[0]);case 2:return n.call(r,e[0],e[1]);case 3:return n.call(r,e[0],e[1],e[2])}return n.apply(r,e)},cp=function(n,r){var e=-1,t=n.length;for(r||(r=Array(t));++e<t;)r[e]=n[e];return r},Hx=Date.now,$x=function(){try{var n=Ct(Object,"defineProperty");return n({},"",{}),n}catch{}}(),Xx=(n2=$x?function(n,r){return $x(n,"toString",{configurable:!0,enumerable:!1,value:function(){return r},writable:!0})}:function(n){return n},r2=0,e8=0,function(){var t=Hx(),o=16-(t-e8);if(e8=t,o>0){if(++r2>=800)return arguments[0]}else r2=0;return n2.apply(void 0,arguments)}),mp=function(n,r){for(var e=-1,t=null==n?0:n.length;++e<t&&!1!==r(n[e],e,n););return n},Qx=/^(?:0|[1-9]\d*)$/,mn=function(n,r){var e=typeof n;return!!(r=r??9007199254740991)&&("number"==e||"symbol"!=e&&Qx.test(n))&&n>-1&&n%1==0&&n<r},fa=function(n,r,e){"__proto__"==r&&$x?$x(n,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):n[r]=e},hn=function(n,r){return n===r||n!=n&&r!=r},ov=Object.prototype.hasOwnProperty,yn=function(n,r,e){var t=n[r];ov.call(n,r)&&hn(t,e)&&(void 0!==e||r in n)||fa(n,r,e)},yr=function(n,r,e,t){var o=!e;e||(e={});for(var i=-1,s=r.length;++i<s;){var a=r[i],c=t?t(e[a],n[a],a,e,n):void 0;void 0===c&&(c=n[a]),o?fa(e,a,c):yn(e,a,c)}return e},hp=Math.max,gn=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991},ma=function(n){return null!=n&&gn(n.length)&&!da(n)},dv=Object.prototype,xn=function(n){var r=n&&n.constructor,e="function"==typeof r&&r.prototype||dv;return n===e},gp=function(n,r){for(var e=-1,t=Array(n);++e<n;)t[e]=r(e);return t},bc=function(n){return ct(n)&&"[object Arguments]"==Vt(n)},xp=Object.prototype,hv=xp.hasOwnProperty,yv=xp.propertyIsEnumerable,gv=bc(function(){return arguments}())?bc:function(n){return ct(n)&&hv.call(n,"callee")&&!yv.call(n,"callee")},wp="object"==typeof exports&&exports&&!exports.nodeType&&exports,bp=wp&&"object"==typeof module&&module&&!module.nodeType&&module,Sp=bp&&bp.exports===wp?J0.Buffer:void 0,Ro=(Sp?Sp.isBuffer:void 0)||function(){return!1},Le={};Le["[object Float32Array]"]=Le["[object Float64Array]"]=Le["[object Int8Array]"]=Le["[object Int16Array]"]=Le["[object Int32Array]"]=Le["[object Uint8Array]"]=Le["[object Uint8ClampedArray]"]=Le["[object Uint16Array]"]=Le["[object Uint32Array]"]=!0,Le["[object Arguments]"]=Le["[object Array]"]=Le["[object ArrayBuffer]"]=Le["[object Boolean]"]=Le["[object DataView]"]=Le["[object Date]"]=Le["[object Error]"]=Le["[object Function]"]=Le["[object Map]"]=Le["[object Number]"]=Le["[object Object]"]=Le["[object RegExp]"]=Le["[object Set]"]=Le["[object String]"]=Le["[object WeakMap]"]=!1;var bn=function(n){return function(r){return n(r)}},Pp="object"==typeof exports&&exports&&!exports.nodeType&&exports,es=Pp&&"object"==typeof module&&module&&!module.nodeType&&module,Sc=es&&es.exports===Pp&&Z0.process,Xv=function(){try{return es&&es.require&&es.require("util").types||Sc&&Sc.binding&&Sc.binding("util")}catch{}}(),Tp=Xv&&Xv.isTypedArray,Kv=Tp?bn(Tp):function(n){return ct(n)&&gn(n.length)&&!!Le[Vt(n)]},Qv=Object.prototype.hasOwnProperty,ya=function(n,r){var e=mx(n),t=!e&&gv(n),o=!e&&!t&&Ro(n),i=!e&&!t&&!o&&Kv(n),s=e||t||o||i,a=s?gp(n.length,String):[],c=a.length;for(var u in n)(r||Qv.call(n,u))&&!(s&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||mn(u,c)))&&a.push(u);return a},ga=function(n,r){return function(e){return n(r(e))}},tb=ga(Object.keys,Object),ob=Object.prototype.hasOwnProperty,Ap=function(n){if(!xn(n))return tb(n);var r=[];for(var e in Object(n))ob.call(n,e)&&"constructor"!=e&&r.push(e);return r},Sn=function(n){return ma(n)?ya(n):Ap(n)},Cp=function(n){var r=[];if(null!=n)for(var e in Object(n))r.push(e);return r},lb=Object.prototype.hasOwnProperty,Np=function(n){if(!zt(n))return Cp(n);var r=xn(n),e=[];for(var t in n)"constructor"==t&&(r||!lb.call(n,t))||e.push(t);return e},wn=function(n){return ma(n)?ya(n,!0):Np(n)},ub=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pb=/^\w*$/,Ip=function(n,r){if(mx(n))return!1;var e=typeof n;return!!("number"==e||"symbol"==e||"boolean"==e||null==n||pn(n))||pb.test(n)||!ub.test(n)||null!=r&&n in Object(r)},mb=Ct(Object,"create"),vb=Object.prototype.hasOwnProperty,wb=Object.prototype.hasOwnProperty;function _n(n){var r=-1,e=null==n?0:n.length;for(this.clear();++r<e;){var t=n[r];this.set(t[0],t[1])}}_n.prototype.clear=function(){this.__data__=mb?mb(null):{},this.size=0},_n.prototype.delete=function(n){var r=this.has(n)&&delete this.__data__[n];return this.size-=r?1:0,r},_n.prototype.get=function(n){var r=this.__data__;if(mb){var e=r[n];return"__lodash_hash_undefined__"===e?void 0:e}return vb.call(r,n)?r[n]:void 0},_n.prototype.has=function(n){var r=this.__data__;return mb?void 0!==r[n]:wb.call(r,n)},_n.prototype.set=function(n,r){var e=this.__data__;return this.size+=this.has(n)?0:1,e[n]=mb&&void 0===r?"__lodash_hash_undefined__":r,this};var ao=function(n,r){for(var e=n.length;e--;)if(hn(n[e][0],r))return e;return -1},Nb=Array.prototype.splice;function Pn(n){var r=-1,e=null==n?0:n.length;for(this.clear();++r<e;){var t=n[r];this.set(t[0],t[1])}}Pn.prototype.clear=function(){this.__data__=[],this.size=0},Pn.prototype.delete=function(n){var r=this.__data__,e=ao(r,n);return!(e<0)&&(e==r.length-1?r.pop():Nb.call(r,e,1),--this.size,!0)},Pn.prototype.get=function(n){var r=this.__data__,e=ao(r,n);return e<0?void 0:r[e][1]},Pn.prototype.has=function(n){return ao(this.__data__,n)>-1},Pn.prototype.set=function(n,r){var e=this.__data__,t=ao(e,n);return t<0?(++this.size,e.push([n,r])):e[t][1]=r,this};var Db=Ct(J0,"Map"),kp=function(n){var r=typeof n;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n},uo=function(n,r){var e=n.__data__;return kp(r)?e["string"==typeof r?"string":"hash"]:e.map};function Tn(n){var r=-1,e=null==n?0:n.length;for(this.clear();++r<e;){var t=n[r];this.set(t[0],t[1])}}function _c(n,r){if("function"!=typeof n||null!=r&&"function"!=typeof r)throw TypeError("Expected a function");var e=function(){var t=arguments,o=r?r.apply(this,t):t[0],i=e.cache;if(i.has(o))return i.get(o);var s=n.apply(this,t);return e.cache=i.set(o,s)||i,s};return e.cache=new(_c.Cache||Tn),e}Tn.prototype.clear=function(){this.size=0,this.__data__={hash:new _n,map:new(Db||Pn),string:new _n}},Tn.prototype.delete=function(n){var r=uo(this,n).delete(n);return this.size-=r?1:0,r},Tn.prototype.get=function(n){return uo(this,n).get(n)},Tn.prototype.has=function(n){return uo(this,n).has(n)},Tn.prototype.set=function(n,r){var e=uo(this,n),t=e.size;return e.set(n,r),this.size+=e.size==t?0:1,this},_c.Cache=Tn;var Wb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qb=/\\(\\)?/g,$b=(e9=(r3=_c(function(n){var r=[];return 46===n.charCodeAt(0)&&r.push(""),n.replace(Wb,function(e,t,o,i){r.push(o?i.replace(qb,"$1"):t||e)}),r},function(t){return 500===e9.size&&e9.clear(),t})).cache,r3),qt=function(n,r){return mx(n)?n:Ip(n,r)?[n]:$b(null==n?"":ep(n))},Kb=1/0,po=function(n){if("string"==typeof n||pn(n))return n;var r=n+"";return"0"==r&&1/n==-Kb?"-0":r},xa=function(n,r){r=qt(r,n);for(var e=0,t=r.length;null!=n&&e<t;)n=n[po(r[e++])];return e&&e==t?n:void 0},On=function(n,r){for(var e=-1,t=r.length,o=n.length;++e<t;)n[o+e]=r[e];return n},Zp=ex?ex.isConcatSpreadable:void 0,Qp=function(n){return mx(n)||gv(n)||!!(Zp&&n&&n[Zp])},ef=function Jp(n,r,e,t,o){var i=-1,s=n.length;for(e||(e=Qp),o||(o=[]);++i<s;){var a=n[i];r>0&&e(a)?r>1?Jp(a,r-1,e,t,o):On(o,a):t||(o[o.length]=a)}return o},va=function(n){var r;return Xx((r=hp((r=void 0,n.length-1),0),function(){for(var n1,t=arguments,o=-1,i=hp(t.length-r,0),s=Array(i);++o<i;)s[o]=t[r+o];o=-1;for(var a=Array(r+1);++o<r;)a[o]=t[o];return a[r]=(null==(n1=s)?0:n1.length)?ef(n1,1):[],lp(n,this,a)}),n+"")},oS=ga(Object.getPrototypeOf,Object),sS=Object.prototype,rf=Function.prototype.toString,aS=sS.hasOwnProperty,lS=rf.call(Object),of=function(n){if(!ct(n)||"[object Object]"!=Vt(n))return!1;var r=oS(n);if(null===r)return!0;var e=aS.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&rf.call(e)==lS},nf=function(n,r,e){var t=-1,o=n.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var i=Array(o);++t<o;)i[t]=n[t+r];return i};function Cn(n){var r=this.__data__=new Pn(n);this.size=r.size}Cn.prototype.clear=function(){this.__data__=new Pn,this.size=0},Cn.prototype.delete=function(n){var r=this.__data__,e=r.delete(n);return this.size=r.size,e},Cn.prototype.get=function(n){return this.__data__.get(n)},Cn.prototype.has=function(n){return this.__data__.has(n)},Cn.prototype.set=function(n,r){var e=this.__data__;if(e instanceof Pn){var t=e.__data__;if(!Db||t.length<199)return t.push([n,r]),this.size=++e.size,this;e=this.__data__=new Tn(t)}return e.set(n,r),this.size=e.size,this};var yf="object"==typeof exports&&exports&&!exports.nodeType&&exports,ff=yf&&"object"==typeof module&&module&&!module.nodeType&&module,mf=ff&&ff.exports===yf?J0.Buffer:void 0,hf=mf?mf.allocUnsafe:void 0,gf=function(n,r){if(r)return n.slice();var e=n.length,t=hf?hf(e):new n.constructor(e);return n.copy(t),t},xf=function(n,r){for(var e=-1,t=null==n?0:n.length,o=0,i=[];++e<t;){var s=n[e];r(s,e,n)&&(i[o++]=s)}return i},ba=function(){return[]},PS=Object.prototype.propertyIsEnumerable,vf=Object.getOwnPropertySymbols,TS=vf?function(n){return null==n?[]:xf(vf(n=Object(n)),function(r){return PS.call(n,r)})}:ba,CS=Object.getOwnPropertySymbols?function(n){for(var r=[];n;)On(r,TS(n)),n=oS(n);return r}:ba,wa=function(n,r,e){var t=r(n);return mx(n)?t:On(t,e(n))},ts=function(n){return wa(n,Sn,TS)},_a=function(n){return wa(n,wn,CS)},LS=Ct(J0,"DataView"),DS=Ct(J0,"Promise"),BS=Ct(J0,"Set"),wf="[object Map]",_f="[object Promise]",Pf="[object Set]",Tf="[object WeakMap]",Of="[object DataView]",GS=kr(LS),VS=kr(Db),zS=kr(DS),jS=kr(BS),FS=kr(Vx),Vo=Vt;(LS&&Vo(new LS(new ArrayBuffer(1)))!=Of||Db&&Vo(new Db)!=wf||DS&&Vo(DS.resolve())!=_f||BS&&Vo(new BS)!=Pf||Vx&&Vo(new Vx)!=Tf)&&(Vo=function(n){var r=Vt(n),e="[object Object]"==r?n.constructor:void 0,t=e?kr(e):"";if(t)switch(t){case GS:return Of;case VS:return wf;case zS:return _f;case jS:return Pf;case FS:return Tf}return r});var Wr=Vo,US=Object.prototype.hasOwnProperty,Af=function(n){var r=n.length,e=new n.constructor(r);return r&&"string"==typeof n[0]&&US.call(n,"index")&&(e.index=n.index,e.input=n.input),e},WS=J0.Uint8Array,En=function(n){var r=new n.constructor(n.byteLength);return new WS(r).set(new WS(n)),r},Cf=function(n,r){var e=r?En(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)},YS=/\w*$/,Nf=function(n){var r=new n.constructor(n.source,YS.exec(n));return r.lastIndex=n.lastIndex,r},If=ex?ex.prototype:void 0,Mf=If?If.valueOf:void 0,Lf=function(n,r){var e=r?En(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)},Df=function(n,r,e){var t=n.constructor;switch(r){case"[object ArrayBuffer]":return En(n);case"[object Boolean]":case"[object Date]":return new t(+n);case"[object DataView]":return Cf(n,e);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Lf(n,e);case"[object Map]":case"[object Set]":return new t;case"[object Number]":case"[object String]":return new t(n);case"[object RegExp]":return Nf(n);case"[object Symbol]":return Mf?Object(Mf.call(n)):{}}},Gf=Xv&&Xv.isMap,Sw=Gf?bn(Gf):function(n){return ct(n)&&"[object Map]"==Wr(n)},jf=Xv&&Xv.isSet,Pw=jf?bn(jf):function(n){return ct(n)&&"[object Set]"==Wr(n)},kf="[object Arguments]",Uf="[object Function]",Hf="[object Object]",Ee={};Ee[kf]=Ee["[object Array]"]=Ee["[object ArrayBuffer]"]=Ee["[object DataView]"]=Ee["[object Boolean]"]=Ee["[object Date]"]=Ee["[object Float32Array]"]=Ee["[object Float64Array]"]=Ee["[object Int8Array]"]=Ee["[object Int16Array]"]=Ee["[object Int32Array]"]=Ee["[object Map]"]=Ee["[object Number]"]=Ee[Hf]=Ee["[object RegExp]"]=Ee["[object Set]"]=Ee["[object String]"]=Ee["[object Symbol]"]=Ee["[object Uint8Array]"]=Ee["[object Uint8ClampedArray]"]=Ee["[object Uint16Array]"]=Ee["[object Uint32Array]"]=!0,Ee["[object Error]"]=Ee[Uf]=Ee["[object WeakMap]"]=!1;var Ca=function Aa(n,r,e,t,o,i){var s,a=1&r,c=2&r;if(e&&(s=o?e(n,t,o,i):e(n)),void 0!==s)return s;if(!zt(n))return n;var l=mx(n);if(l){if(s=Af(n),!a)return cp(n,s)}else{var n1,r1,n2,r2,d=Wr(n),p=d==Uf||"[object GeneratorFunction]"==d;if(Ro(n))return gf(n,a);if(d==Hf||d==kf||p&&!o){if(s=c||p?{}:"function"!=typeof n.constructor||xn(n)?{}:zx(oS(n)),!a)return c?(r1=(n1=s)&&yr(n,wn(n),n1),yr(n,CS(n),r1)):(r2=(n2=s)&&yr(n,Sn(n),n2),yr(n,TS(n),r2))}else{if(!Ee[d])return o?n:{};s=Df(n,d,a)}}i||(i=new Cn);var f=i.get(n);if(f)return f;i.set(n,s),Pw(n)?n.forEach(function(y){s.add(Aa(y,r,e,y,n,i))}):Sw(n)&&n.forEach(function(y,g){s.set(g,Aa(y,r,e,g,n,i))});var h=l?void 0:(4&r?c?_a:ts:c?wn:Sn)(n);return mp(h||n,function(y,g){h&&(y=n[g=y]),yn(s,g,Aa(y,r,e,g,n,i))}),s},qr=function(n){return Ca(n,5)};function Na(n){var r=-1,e=null==n?0:n.length;for(this.__data__=new Tn;++r<e;)this.add(n[r])}Na.prototype.add=Na.prototype.push=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this},Na.prototype.has=function(n){return this.__data__.has(n)};var Yf=function(n,r){for(var e=-1,t=null==n?0:n.length;++e<t;)if(r(n[e],e,n))return!0;return!1},Ia=function(n,r,e,t,o,i){var s=1&e,a=n.length,c=r.length;if(a!=c&&!(s&&c>a))return!1;var u=i.get(n),l=i.get(r);if(u&&l)return u==r&&l==n;var d=-1,p=!0,f=2&e?new Na:void 0;for(i.set(n,r),i.set(r,n);++d<a;){var m=n[d],h=r[d];if(t)var y=s?t(h,m,d,r,n,i):t(m,h,d,n,r,i);if(void 0!==y){if(y)continue;p=!1;break}if(f){if(!Yf(r,function(g,x){if(!f.has(x)&&(m===g||o(m,g,e,t,i)))return f.push(x)})){p=!1;break}}else if(!(m===h||o(m,h,e,t,i))){p=!1;break}}return i.delete(n),i.delete(r),p},Kf=function(n){var r=-1,e=Array(n.size);return n.forEach(function(t,o){e[++r]=[o,t]}),e},Zf=function(n){var r=-1,e=Array(n.size);return n.forEach(function(t){e[++r]=t}),e},Qf=ex?ex.prototype:void 0,Pc=Qf?Qf.valueOf:void 0,Jf=function(n,r,e,t,o,i,s){switch(e){case"[object DataView]":if(n.byteLength!=r.byteLength||n.byteOffset!=r.byteOffset)break;n=n.buffer,r=r.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=r.byteLength||!i(new WS(n),new WS(r)));case"[object Boolean]":case"[object Date]":case"[object Number]":return hn(+n,+r);case"[object Error]":return n.name==r.name&&n.message==r.message;case"[object RegExp]":case"[object String]":return n==r+"";case"[object Map]":var a=Kf;case"[object Set]":var c=1&t;if(a||(a=Zf),n.size!=r.size&&!c)break;var u=s.get(n);if(u)return u==r;t|=2,s.set(n,r);var l=Ia(a(n),a(r),t,o,i,s);return s.delete(n),l;case"[object Symbol]":if(Pc)return Pc.call(n)==Pc.call(r)}return!1},O1=Object.prototype.hasOwnProperty,em=function(n,r,e,t,o,i){var s=1&e,a=ts(n),c=a.length;if(c!=ts(r).length&&!s)return!1;for(var d=c;d--;){var p=a[d];if(!(s?p in r:O1.call(r,p)))return!1}var f=i.get(n),m=i.get(r);if(f&&m)return f==r&&m==n;var h=!0;i.set(n,r),i.set(r,n);for(var y=s;++d<c;){var g=n[p=a[d]],x=r[p];if(t)var b=s?t(x,g,p,r,n,i):t(g,x,p,n,r,i);if(!(void 0===b?g===x||o(g,x,e,t,i):b)){h=!1;break}y||(y="constructor"==p)}if(h&&!y){var w=n.constructor,S=r.constructor;w!=S&&"constructor"in n&&"constructor"in r&&!("function"==typeof w&&w instanceof w&&"function"==typeof S&&S instanceof S)&&(h=!1)}return i.delete(n),i.delete(r),h},tm="[object Arguments]",rm="[object Array]",Ma="[object Object]",om=Object.prototype.hasOwnProperty,nm=function(n,r,e,t,o,i){var s=mx(n),a=mx(r),c=s?rm:Wr(n),u=a?rm:Wr(r);c=c==tm?Ma:c,u=u==tm?Ma:u;var l=c==Ma,d=u==Ma,p=c==u;if(p&&Ro(n)){if(!Ro(r))return!1;s=!0,l=!1}if(p&&!l)return i||(i=new Cn),s||Kv(n)?Ia(n,r,e,t,o,i):Jf(n,r,c,e,t,o,i);if(!(1&e)){var f=l&&om.call(n,"__wrapped__"),m=d&&om.call(r,"__wrapped__");if(f||m){var h=f?n.value():n,y=m?r.value():r;return i||(i=new Cn),o(h,y,e,t,i)}}return!!p&&(i||(i=new Cn),em(n,r,e,t,o,i))},am=function(n,r){return null!=n&&r in Object(n)},lm=function(n,r,e){r=qt(r,n);for(var t=-1,o=r.length,i=!1;++t<o;){var s=po(r[t]);if(!(i=null!=n&&e(n,s)))break;n=n[s]}return i||++t!=o?i:!!(o=null==n?0:n.length)&&gn(o)&&mn(s,o)&&(mx(n)||gv(n))},dm=function(n){var r=null==n?0:n.length;return r?n[r-1]:void 0},rs=function(n,r){return function im(n,r,e,t,o){return n===r||(null!=n&&null!=r&&(ct(n)||ct(r))?nm(n,r,e,t,im,o):n!=n&&r!=r)}(n,r)},pm=function(n,r){var n1,r1;return r=qt(r,n),n1=n,null==(n=(r1=r).length<2?n1:xa(n1,nf(r1,0,-1)))||delete n[po(dm(r))]},fm=function(n){return of(n)?void 0:n},k1=va(function(n,r){var e={};if(null==n)return e;var t=!1;r=ca(r,function(i){return i=qt(i,n),t||(t=i.length>1),i}),yr(n,_a(n),e),t&&(e=Ca(e,7,fm));for(var o=r.length;o--;)pm(e,r[o]);return e}),mm=function(n,r,e,t){if(!zt(n))return n;r=qt(r,n);for(var o=-1,i=r.length,s=i-1,a=n;null!=a&&++o<i;){var c=po(r[o]),u=e;if("__proto__"===c||"constructor"===c||"prototype"===c)break;if(o!=s){var l=a[c];void 0===(u=t?t(l,c,a):void 0)&&(u=zt(l)?l:mn(r[o+1])?[]:{})}yn(a,c,u),a=a[c]}return n},hm=function(n,r,e){for(var t=-1,o=r.length,i={};++t<o;){var s=r[t],a=xa(n,s);e(a,s)&&mm(i,qt(s,n),a)}return i},q1=va(function(n,r){return null==n?{}:hm(n,r,function(e,t){return null!=n&&lm(n,t,am)})}),Me=class{modifyById(r,e){if(void 0===this[r])throw Error("not expected");{let i={...this,[r]:e};return Object.setPrototypeOf(i,Me.prototype),i}}add(r,e){return this.runOp({type:1,id:r,data:e})?.data??this}runOp(r){if(1===r.type){let t=this[r.id],o;o=void 0===t?{type:2,id:r.id}:{type:1,id:r.id,data:t};let{id:i,data:s}=r,a={...this,[i]:s};return Object.setPrototypeOf(a,Me.prototype),{data:a,actual:r,reverse:o}}if(2===r.type){let{id:t1}=r,o1=this[t1];if(void 0===o1)return null;{let i1={...this};return Object.setPrototypeOf(i1,Me.prototype),delete i1[t1],{data:i1,actual:r,reverse:{type:1,id:t1,data:o1}}}}return null}};function os(n){if(void 0!==n.deepFreeze){n.deepFreeze(n);return}for(let e of Object.getOwnPropertyNames(n)){let t=n[e];t&&"object"==typeof t&&os(t)}return Object.freeze(n)}var Dn=class extends Error{};function Ea(n){let r={...n};return Object.setPrototypeOf(r,Object.getPrototypeOf(n)),r}function gr(n,r,e){if(void 0===n?void 0===r?(n=0,r=10):n=r-10:void 0===r&&(r=n+10),n>r){let i=n;n=r,r=i}let t=[],o=1/(e+1);for(let i1=0;i1<e;i1++){let s=n+(r-n)*(i1+.75+.5*Math.random())*o;t.push(s)}return t}function Bn(n){return n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array}var Be=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Be.prototype)}deepFreeze(){let e=0;for(;e<this.length;)os(this[e]),e++}fillCaches0(e,t){for(let o of(this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t),e.children))this.fillCaches0(o,e.id)}fillCaches(){if(void 0===this.objCaches)for(let e of(this.objCaches=new Map,this.parentCaches=new Map,this))this.fillCaches0(e,null)}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let o=this.parent(e);if(o===t)return!0;e=o}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else break}return e}isDescendantOf(e,t){for(;e;){let o=this.parent(e);if(o===t)return!0;e=o}return!1}data(e){return this.get(e)?.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){return null===e?this:this.get(e)?.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let o=this.get(e);o&&function bm(n,r){if(!0!==r(n.id,n.data))for(let e of n.children)bm(e,r)}(o,t)}}traverse(e){!function vm(n,r){for(let e of n)!0!==r(e.id,e.data)&&vm(e.children,r)}(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw Error("not expected");{let i=this.parent(e),s=this.childrenArray(i),a=s.findIndex(l=>l.id===e);if(a<0)throw Error("not expected");let c=s[a];return(s=[...s])[a]={...c,data:t},this.modifyArrayBy(i,s)}}modifyArrayBy(e,t){let o=e,i=t;for(;null!==o;){let a=i,c=o;if(void 0===(o=this.parent(o)))throw Error();let u=(i=this.childrenArray(o)).findIndex(l=>l.id===c);if(u<0)throw Error();(i=[...i])[u]={...i[u],children:a}}Object.setPrototypeOf(i,Be.prototype);let s=i;return s.fillCaches(),s}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(void 0!==this.get(e))return!0;for(let o of t)if(this.checkDuplicatedIdRec(o))return!0;return!1}addOp(e){let{parent:t,fi:o,id:i,data:s,children:a}=e;if(null!==t&&void 0===this.get(t)||this.checkDuplicatedIdRec(e))return null;{let u=this.childrenArray(t),l={fi:o,id:i,data:s,children:a};return(u=[...u,l]).sort((p,f)=>p.fi-f.fi),e.localIndex=u.indexOf(l),{data:this.modifyArrayBy(t,u),actual:e,reverse:{type:8,id:i}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let o=this.parent(t);if(void 0===o)return null;let i=this.childrenArray(o),s=i.findIndex(u=>u.id===t);e.localIndex=s;let a=(i=[...i]).splice(s,1)[0];return{data:this.modifyArrayBy(o,i),actual:e,reverse:{type:7,...a,parent:o}}}}moveOp(e){let{parent:t,fi:o,id:i}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:i});if(null!==t){let f=t;for(;null!==f;){if(void 0===f)throw Error();if(f===i)throw new Dn("cyclic tree");f=this.parent(f)}}let s=this.parent(i);if(void 0===s)return null;let a=s,c=this.childrenArray(s),u=c.findIndex(f=>f.id===i),l=(c=[...c]).splice(u,1)[0],d=this.modifyArrayBy(s,c);s=t,c=d.childrenArray(s);let p=l.fi;return(c=[...c,l={...l,fi:o}]).sort((f,m)=>f.fi-m.fi),e.localIndex=c.indexOf(l),{data:d=d.modifyArrayBy(s,c),actual:e,reverse:{type:9,parent:a,fi:p,id:i}}}previous(e,t){if(null===t){let i=this.childrenArray(e);return 0===i.length?null:i[i.length-1].id}let o=null;for(let i1 of this.childrenArray(e)){if(i1.id===t)return o;o=i1.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let o=this.childrenArray(t),i=o.findIndex(s=>s.id===e)+1;if(i<o.length)return o[i].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let o=this.childrenArray(t),i=o.findIndex(s=>s.id===e)-1;return i>=0?this.traverseSortPrevious(o[i].id):t}}getAllSorted(e){let t=[];for(let o of e){let i=this.getWithSortKey(o.id);void 0!==i&&t.push({...o,...i})}for(let o1 of(t.sort((o,i)=>(function(n,r){let e=0;for(;e<n.length&&e<r.length;){if(n[e]<r[e])return -1;if(n[e]>r[e])return 1;e+=1}return e!==r.length?-1:e!==n.length?1:0})(o.sortKey,i.sortKey)),t))delete o1.sortKey;return t}getWithSortKey(e){var t=e;let o=[],i=this.get(t),s=i;if(void 0!==i){for(;t;)o.splice(0,0,i.fi),null!==(t=this.parent(t))&&(i=this.get(t));return{...s,sortKey:o}}}insertBeforeHelper(e,t,o){return this.insertAfterHelper(e,this.previous(e,t),o)}insertAfterHelper(e,t,o){let i=this.childrenArray(e);if(null===t){if(0===i.length)return gr(0,o,o);{let s=i[0].fi;return gr(s-o,s,o)}}{let s1=this.get(t);if(void 0===s1||this.parent(t)!==e)throw Error("illegal args");let a=i.find(c=>c.fi>s1.fi);if(void 0!==a)return gr(s1.fi,a.fi,o);{let c=i[i.length-1].fi;return gr(c,c+o,o)}}}};(Rn||(Rn={})).runOp=function(e,t){if(0!==t.type)return null;if(Array.isArray(e)){let o=t.props,i={},s=[...e],a=!1;if(o)for(let c of Object.keys(o)){let u=parseInt(c);if(isNaN(u))throw Error("wrong index");i[c]=s[u],s[u]=o[c],a=!0}return a?{data:s,actual:t,reverse:{type:0,props:i}}:null}{let o1=t.props,i1={},s1={...e},a1=!1;if(o1)for(let c1 of Object.keys(o1)){i1[c1]=s1[c1];let u1=o1[c1];void 0===u1?delete s1[c1]:s1[c1]=u1,a1=!0}return a1?{data:s1,actual:t,reverse:{type:0,props:i1}}:null}};var me=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,me.prototype)}deepFreeze(){let e=0;for(;e<this.length;)os(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches)for(let e of(this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1,this))this.fillCaches0(e)}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){return this.get(e)?.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw Error("not expected");{let i=this,s=i.findIndex(u=>u.id===e);if(s<0)throw Error("not expected");let a=i[s];return(i=[...i])[s]={...a,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){return Object.setPrototypeOf(e,me.prototype),"u">typeof process||e.fillCaches(),e}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:o,data:i}=e,s=this,a={fi:t,id:o,data:i};return(s=[...s,a]).sort((u,l)=>u.fi-l.fi),e.localIndex=s.indexOf(a),{data:this.modifyArrayBy(s),actual:e,reverse:{type:5,id:o}}}deleteOp(e){let{id:t}=e,o=this,i=o.findIndex(c=>c.id===t);if(-1===i)return null;e.localIndex=i;let s=(o=[...o]).splice(i,1)[0];return{data:this.modifyArrayBy(o),actual:e,reverse:{type:4,...s}}}moveOp(e){let{fi:t,id:o}=e,i=this,s=(i=[...i]).findIndex(l=>l.id===o);if(-1===s)return null;let a=i[s].fi,c={...i[s],fi:t};return i[s]=c,i.sort((l,d)=>l.fi-d.fi),e.localIndex=i.indexOf(c),{data:this.modifyArrayBy(i),actual:e,reverse:{type:6,fi:a,id:o}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let o of this){if(o.id===e)return t;t=o.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){if(null===e){if(0===this.length)return gr(0,t,t);{let i=this[0].fi;return gr(i-t,i,t)}}{let i1=this.get(e);if(void 0===i1)throw Error("illegal args");let s=this.find(a=>a.fi>i1.fi);if(void 0!==s)return gr(i1.fi,s.fi,t);{let a=this[this.length-1].fi;return gr(a,a+t,t)}}}};function Gn(n){return n&&"object"==typeof n&&n instanceof Re}var n1,n2,r2,e8,r3,e9,Rn,xr,Re=class{unusedFunOverridesTable(r){}runOp(r){let e=[],t=this,o=0,i={};for(;o<r.path.length;){if(e.push(t),void 0!==(t=void 0===t?void 0:t[r.path[o]])&&!Gn(t))return null;o+=1}for(let[c,u]of(t=t?Ea(t):new Re,Object.entries(r.props))){let l=t[c];i[c]=l,void 0===u?delete t[c]:t[c]=u}for(;o>0;){if(0===Object.keys(t).length){let c1=e[o-1];c1&&delete(t=Ea(c1))[r.path[o-1]]}else{let c2=e[o-1];if(c2){let u1=Ea(c2);u1[r.path[o-1]]=t,t=u1}else{let u2=new Re;u2[r.path[o-1]]=t,t=u2}}o-=1}let s=Object.setPrototypeOf(t,Re.prototype),a={...r,props:i};return{data:s,actual:r,reverse:a}}};function Tc(n,r){if(void 0===r)return;let e=!1,t=n.map(o=>{let i=o.id,s=ns(o.data,r[i]);if(e=e||void 0!==s,void 0===s&&(s=o.data),!o.children)return{...o,id:i,data:s};{let a=Tc(o.children,r);return void 0!==a?e=!0:a=o.children,{...o,id:i,data:s,children:a}}});if(e)return t}function ns(n,r){if(!Gn(r))return r;if(n instanceof Be){let e=Tc(n,r);return void 0!==e&&Object.setPrototypeOf(e,Object.getPrototypeOf(n)),e}if(n instanceof me)return function(n,r){if(void 0===r)return;let e=!1,t=n.map(o=>{let i=o.id,s=ns(o.data,r[i]);return e=e||void 0!==s,void 0===s&&(s=o.data),{...o,id:i,data:s}});if(e)return Object.setPrototypeOf(t,Object.getPrototypeOf(n)),t}(n,r);if(Array.isArray(n)){let e1=!1,t=n.map((o,i)=>{let s=ns(o,r[i]);return e1=e1||void 0!==s,void 0===s&&(s=o),s});return e1?(Object.setPrototypeOf(t,Object.getPrototypeOf(n)),t):void 0}if(n instanceof Re)return Oc(n,r);if(n&&"object"==typeof n){let e2={},t1=!1;for(let[o,i]of Object.entries(n)){let s=ns(i,r[o]);t1=t1||void 0!==s,void 0===s&&(s=i),e2[o]=s}return t1?(Object.setPrototypeOf(e2,Object.getPrototypeOf(n)),e2):void 0}}function Oc(n,r){if(void 0===n)return r;if(void 0===r)return n;if(!Gn(r))return r;if(!Gn(n))return xr.apply(n,r);let e=new Set;for(let o of Object.keys(n))e.add(o);for(let o1 of Object.keys(r))e.add(o1);let t=new Re;for(let o2 of e){let i=Oc(void 0===n?void 0:n[o2],void 0===r?void 0:r[o2]);t[o2]=i}return t}function La(n,r){return null===n?null:(n.cur[n.len]=r,n.len+=1,n)}function Da(n){n&&(n.len-=1)}(t6=xr||(xr={})).apply=function(o,i){return ns(o,i)??o},t6.merge=function(o,i){return Oc(o,i)},t6.filterOp=function(o,i){let s=0,a=i.path,c=o;for(;s<a.length&&void 0!==c;){if(void 0===(c=vt.zoomOnce(c,a[s])))return i;if(!Gn(c))return;s+=1}if(void 0===c)return i;if(Gn(c)){if(0===i.type){let u={...i.props};for(let l of Object.keys(c))delete u[l];return{...i,props:u}}{if(1!==i.type&&4!==i.type&&7!==i.type)return i;let u1=Tc([i],c);return u1?(console.log(u1),u1):i}}},(Ba||(Ba={})).replaceProps=function(e,t){let o=vt.zoom(t,e.path);if("object"!=typeof o)return{...e,props:{}};{let i={};for(let s of Object.keys(e.props))i[s]=o[s];return{...e,props:i}}},(a=>{function e(c,u){let l=u.path;for(var d=[];;){let p;if(c instanceof Re&&0===u.type&&null===(p=c.runOp({...u,path:l.slice(d.length)}))&&(p=void 0),void 0===p&&d.length===l.length&&(p=c instanceof Be||c instanceof me||c instanceof Me?c.runOp(u):Rn.runOp(c,u)),void 0!==p){if(null===p)return null;{let h=p.data;for(let y=d.length-1;y>=0;y--){let g=l[y],x=d[y];if(x instanceof Be){if("number"==typeof g)throw Error("illegal arg");h=x.modifyById(g,h)}else if(x instanceof me){if("number"==typeof g)throw Error("illegal arg");h=x.modifyById(g,h)}else if(x instanceof Me){if("number"==typeof g)throw Error("illegal arg");h=x.modifyById(g,h)}else if(x instanceof Re)h=Object.setPrototypeOf({...x,[g]:h},Re.prototype);else if("object"!=typeof x)return null;else if(Array.isArray(x)){if("string"==typeof g&&isNaN(g=parseInt(g)))throw Error("Invalid path");let b=h;(h=[...x])[g]=b}else h={...x,[g]:h}}return{data:h,actual:{...p.actual,path:l},reverse:{...p.reverse,path:l}}}}let f=l[d.length],m;if(c instanceof Be){if("number"==typeof f)throw Error("");m=c.get(f)?.data}else if(c instanceof me){if("number"==typeof f)throw Error("");m=c.get(f)?.data}else null!==c&&(m=c[f]);if(void 0===m)return null;d.push(c),c=m}}function t(c,u){for(let l=0;l<c.length&&l<u.length;l++)if(c[l]!==u[l])return!0;return!1}function o(c,u){if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++)if(c[l]!==u[l])return!1;return!0}a.drop=function(c,u){return{...c,path:c.path.slice(u)}},a.applySimple=function(c,u){return e(c,u)?.data??c},a.apply=e,a.pathDisjoint=t,a.pathEq=o,a.commutative=function(c,u){return t(c.path,u.path)},a.subsumed=function(c,u){return!!(0===c.type&&0===u.type&&o(c.path,u.path))&&Object.keys(c.props).every(l=>void 0!==u.props[l])}})(dt||(dt={})),(c=>{function a(u,l){var d=u;let p=[],f=[];for(let m of l)try{if(3===m.type){let h=vt.zoom(d,[...m.path,m.id]),y=dt.apply(d,{...m,type:2});if(null!==y){d=y.data;let[g,x]=function(n,r){let e={cur:[],result:[],len:0};return[n=function is(n,r,e){if(n instanceof Be){let t=function wm(n,r,e){let t=!1,o=n.map(i=>{let s=i.id,a=r[s];if(void 0!==a&&"string"==typeof a&&(t=!0,s=a,null!==e))throw Error("not supported");let c=is(i.data,r,La(e,s));Da(e),t=t||void 0!==c,void 0===c&&(c=i.data);let u=wm(i.children,r,e);return void 0!==u?t=!0:u=i.children,{...i,id:s,data:c,children:u}});if(t)return o}(n,r,e);return void 0!==t&&Object.setPrototypeOf(t,Object.getPrototypeOf(n)),t}if(n instanceof me)return function(n,r,e){let t=!1,o=n.map(i=>{let s=i.id,a=r[s];if(void 0!==a&&"string"==typeof a&&(t=!0,s=a,null!==e))throw Error("not supported");let c=is(i.data,r,La(e,s));return Da(e),t=t||void 0!==c,void 0===c&&(c=i.data),{...i,id:s,data:c}});if(t)return Object.setPrototypeOf(o,Object.getPrototypeOf(n)),o}(n,r,e);if(Array.isArray(n)){let t1=!1,o=n.map((i,s)=>{let a=is(i,r,La(e,s));return Da(e),t1=t1||void 0!==a,void 0===a&&(a=i),a});return t1?(Object.setPrototypeOf(o,Object.getPrototypeOf(n)),o):void 0}if(n&&"object"==typeof n&&!Bn(n)){let t2={},o1=!1;for(let[i,s]of Object.entries(n))if("name"!==i&&"text"!==i){let a=r[i];if("string"==typeof a){if(null!==e)throw Error("not supported");o1=!0,i=a}let c=is(s,r,La(e,i));Da(e),o1=o1||void 0!==c,void 0===c&&(c=s),t2[i]=c}else t2[i]=s;return o1?(Object.setPrototypeOf(t2,Object.getPrototypeOf(n)),t2):void 0}{if("string"!=typeof n)return;let t3=r[n];if(void 0!==t3){var n1;if(36!==n.length)throw Error("for now you should only call this method when the key is a uuid");n1=e,null!==n1&&n1.result.push(n1.cur.slice(0,n1.len))}return t3}}(n,r,e)??n,e.result]}(d,{[m.id]:h});for(let b of(d=g,x)){let w=b[b.length-1];b.splice(b.length-1,1),p.push({type:0,path:b,props:{[w]:h}}),f.push({type:0,path:b,props:{[w]:m.id}})}f.push(y.reverse),p.push(y.actual)}}else{let h1=dt.apply(d,m);null!==h1&&(p.push(h1.actual),d=h1.data,f.push(h1.reverse))}}catch(h2){if(h2 instanceof Dn)return null;throw h2}return{data:d,actual:p,reverse:f.reverse()}}c.empty=function(){return[]},c.removePrefix=function(u,l){let d=[];for(let p of u){let[f,...m]=p.path;f===l&&d.push({...p,path:m})}return d},c.addPrefix=function(u,l){return u.map(d=>({...d,path:[l,...d.path]}))},c.concat=function(u,l){return[...u,...l]},c.compress=function(u,l){return[...u.filter(p=>!l.some(f=>dt.subsumed(p,f))),...l]},c.commutative=function(u,l){return u.every(d=>l.every(p=>dt.commutative(d,p)))},c.applyAll=function(u,l){for(let d of l){let p=a(u,d);null!==p&&(u=p.data)}return u},c.apply=a})(Ac||(Ac={}));var _m=Symbol(),K1=Symbol(),Ga=Symbol(),zo=class{reportOp(r,e,t=[]){let o=this;if(null!==e){for(o._current=e.data;!(o instanceof Ra);){let s=o._path,a=o._current;if(""!==s&&t.splice(0,0,s),null===(o=o._parent))return;o.update(s,a)}o.push(t,r,e.actual,e.reverse)}}deleteChildren(r){if(this._children){let e=this._children[r];if(e){let t=e[Ga];t&&t(),delete this._children[r]}}}},Nc=class extends zo{constructor(r,e,t){super(),this._parent=r,this._path=e,this._current=t}update(r,e){if(Array.isArray(this._current)){if("string"==typeof r&&isNaN(r=parseInt(r)))throw Error("Invalid path");this._current=[...this._current],this._current[r]=e}else this._current={...this._current,[r]:e}}runOp(r){this.reportOp(r,Rn.runOp(this._current,r),r.path)}},Ic=class extends zo{constructor(r,e,t){super(),this._parent=r,this._path=e,this._current=t}update(r,e){this._current={...this._current,[r]:e},Object.setPrototypeOf(this._current,Me.prototype)}runOp(r){this.reportOp(r,this._current.runOp(r))}},Pm={get(n,r){if(r===Ga)return()=>{n._parent=null};if(r===_m)return n._current;if(r===K1)return n;let{_current:e,_children:t}=n;if("push"===r&&Array.isArray(e))throw Error("not supported to expand array");let o=void 0===t?void 0:t[r];if(void 0!==o)return o;let i=e[r],s=Va(n,r,i);return s!==i?(void 0===t&&(t={},n._children=t),t[r]=s,s):i},has:(n,r)=>r in n._current,ownKeys:n=>Reflect.ownKeys(n._current),defineProperty(){throw Error("not supported")},getPrototypeOf:n=>Object.getPrototypeOf(n._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(n,r){let e=n._current,t=Reflect.getOwnPropertyDescriptor(e,r);return t&&{writable:!0,configurable:!0,enumerable:t.enumerable,value:e[r]}}},Z1={...Pm,set(n,r,e){let t={type:0,props:{[r]:Ye(e)??e}};return n.deleteChildren(r),n.runOp(t),!0},deleteProperty:(n,r)=>(n.deleteChildren(r),n.runOp({type:0,props:{[r]:void 0}}),!0)},Q1={...Pm,set(n,r,e){return void 0===e?this.deleteProperty(n,r):(n.deleteChildren(r),n.runOp({type:1,id:r,data:e})),!0},deleteProperty:(n,r)=>(n.runOp({type:2,id:r}),!0)},Vn=class extends zo{constructor(r,e,t){super(),this._children={},this._parent=r,this._path=e,this._current=t,this[Ga]=()=>{this._parent=null}}unproxy(){return this._current}update(r,e){this._current=this._current.modifyById(r,e)}runOp(r){this.reportOp(r,this._current.runOp(r))}randomId(){return this._current.randomId()}isDescendantOf(r,e){return this._current.isDescendantOf(r,e)}childrenOf(r){return this._current.childrenOf(r)}traverse(r){return this._current.traverse(r)}get(r){return this._current.get(r)}parent(r){return this._current.parent(r)}traverse(r){this._current.traverse((e,t)=>{r(e,this.data(e))})}data(r){let{_current:e,_children:t}=this,o=void 0===t?void 0:t[r];if(void 0!==o)return o;let i=e.get(r)?.data,s=Va(this,r,i);return s!==i?(void 0===t&&(t={},this._children=t),t[r]=s,s):i}add(r,e,t,o,i){this.runOp({type:7,parent:r,fi:e,id:t,data:o,children:i})}move(r,e,t){this.runOp({type:9,parent:r,fi:e,id:t})}insertAfter(r,e,t){let o=this._current.insertAfterHelper(r,e,t.length);for(let i=0;i<t.length;i++){let s=t[i];this.add(r,o[i],s.id,s.data,s.children)}}insertBefore(r,e,t){let o=this._current.insertBeforeHelper(r,e,t.length);for(let i=0;i<t.length;i++){let s=t[i];this.add(r,o[i],s.id,s.data,s.children)}}moveAfter(r,e,t){let o=this._current.insertAfterHelper(r,e,t.length);for(let i=0;i<t.length;i++){let s=t[i];this.move(r,o[i],s)}}moveBefore(r,e,t){let o=this._current.insertBeforeHelper(r,e,t.length);for(let i=0;i<t.length;i++){let s=t[i];this.move(r,o[i],s)}}delete(r){this.deleteChildren(r),this.runOp({type:8,id:r})}sortNext(r){return this._current.sortNext(r)}sortPrevious(r){return this._current.sortPrevious(r)}getAllSorted(r){return this._current.getAllSorted(r)}},zn=class extends zo{constructor(r,e,t){super(),this._children={},this._parent=r,this._path=e,this._current=t,this[Ga]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(r){let e=this.length;for(let t=0;t<e;t++){let o=this._current[t].id,i=this._current[t].fi;r(this.data(this._current[t].id),o,i)}}find(r){let e=this.length;for(let t=0;t<e;t++){let o=this._current[t].id;if(r(this.data(o),o))return this.get(o)}}update(r,e){this._current=this._current.modifyById(r,e)}randomId(){return this._current.randomId()}get(r){return{...this._current.get(r),data:this.data(r)}}data(r){let{_current:e,_children:t}=this,o=void 0===t?void 0:t[r];if(void 0!==o)return o;let i=e.get(r)?.data,s=Va(this,r,i);return s!==i?(void 0===t&&(t={},this._children=t),t[r]=s,s):i}runOp(r){this.reportOp(r,this._current.runOp(r))}add(r,e,t){this.runOp({type:4,fi:r,id:e,data:t})}move(r,e){this.runOp({type:6,fi:r,id:e})}insertAfter(r,e){let t=this._current.insertAfterHelper(r,e.length);for(let o=0;o<e.length;o++){let i=e[o];this.add(t[o],i.id,i.data)}}insertBefore(r,e){let t=this._current.insertBeforeHelper(r,e.length);for(let o=0;o<e.length;o++){let i=e[o];this.add(t[o],i.id,i.data)}}moveAfter(r,e){let t=this._current.insertAfterHelper(r,e.length);for(let o=0;o<e.length;o++){let i=e[o];this.move(t[o],i)}}moveBefore(r,e){let t=this._current.insertBeforeHelper(r,e.length);for(let o=0;o<e.length;o++){let i=e[o];this.move(t[o],i)}}delete(r){this.deleteChildren(r),this.runOp({type:5,id:r})}};function Cc(n,r,e){if(n.length>0){let t=n[n.length-1];if(0===t.type&&0===r.type&&vt.equal(t.path,e)){Object.assign(t.props,r.props);return}}n.push({...r,path:e})}var Ra=class extends zo{constructor(r){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=r}update(r,e){if(""!==r)throw Error("");this._current=e}push(r,e,t,o){Cc(this.ts,e,r),Cc(this.actual,t,r),Cc(this.reverse,o,r)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function Va(n,r,e){return e instanceof Be?new Vn(n,r,e):e instanceof me?new zn(n,r,e):e instanceof Me?new Proxy(new Ic(n,r,e),Q1):null!==e&&"object"==typeof e?Bn(e)?e:new Proxy(new Nc(n,r,e),Z1):e}function Mc(n){let r=new Ra(n);return[Va(r,"",n),r]}function jn(n,r){let[e,t]=Mc(n);return r(e),t.result()}function Ye(n){return n instanceof Vn||n instanceof zn?n._current:null!==n&&"object"==typeof n?n[_m]:n}function yt(n,r){let e=[];if(!(r.length<=n.length))return null;for(var t=0;t<r.length;){if("*"===r[t])e.push(n[t]);else if(n[t]!==r[t])return null;t+=1}return e}(o=>{function e(i,s){return(i instanceof Be||i instanceof Vn)&&"string"==typeof s||(i instanceof me||i instanceof zn)&&"string"==typeof s?i.data(s):"number"==typeof s&&Array.isArray(i)||"string"==typeof s&&"object"==typeof i&&null!==i?i[s]:void 0}function t(i,s,a=0){for(;a<s.length&&void 0!==i;)i=e(i,s[a]),a+=1;return i}o.equal=function(i,s){if(s.length!==i.length)return!1;for(var a=0;a<i.length;){if(i[a]!==s[a])return!1;a+=1}return!0},o.removeOverridden=function(i,s,a){let c=t(a,i);if(void 0===c||"object"!=typeof c||null===c)return s;{let u={...s};return Object.keys(c).forEach(l=>{delete u[l]}),u}},o.zoomOnce=e,o.zoom=t})(vt||(vt={}));var za=class{},ss=class extends za{constructor(e){super(),this.id=e}},as=class extends za{constructor(e){super(),this.data=e}};try{Lc=new TextDecoder}catch{}var t6,Ba,dt,Ac,vt,Lc,ne,mo,Te,fo,jt,Yr,Ce,I=0,Lm=[],Dc=Lm,Bc=0,Nt={},$t=0,vr=0,bt=[],Om={useRecords:!1,mapsAsObjects:!0},ls=class{},Gc=new ls;Gc.name="MessagePack 0xC1";var Fn=!1,br=class{constructor(r){r&&(!1===r.useRecords&&void 0===r.mapsAsObjects&&(r.mapsAsObjects=!0),r.structures?r.structures.sharedLength=r.structures.length:r.getStructures&&((r.structures=[]).uninitialized=!0,r.structures.sharedLength=0)),Object.assign(this,r)}unpack(r,e){if(ne)return Vm(()=>(Fa(),this?this.unpack(r,e):br.prototype.unpack.call(Om,r,e)));mo=e>-1?e:r.length,I=0,Bc=0,vr=0,fo=null,Dc=Lm,jt=null,ne=r;try{Ce=r.dataView||(r.dataView=new DataView(r.buffer,r.byteOffset,r.byteLength))}catch(t){throw ne=null,r instanceof Uint8Array?t:Error("Source must be a Uint8Array or Buffer but was a "+(r&&"object"==typeof r?r.constructor.name:typeof r))}if(this instanceof br){if(Nt=this,this.structures)return Te=this.structures,ja();(!Te||Te.length>0)&&(Te=[])}else Nt=Om,(!Te||Te.length>0)&&(Te=[]);return ja()}unpackMultiple(r,e){let t,o=0;try{Fn=!0;let i=r.length,s=this?this.unpack(r,i):Ha.unpack(r,i);if(e){for(e(s);I<i;)if(o=I,!1===e(ja()))return}else{for(t=[s];I<i;)o=I,t.push(ja());return t}}catch(i1){throw i1.lastPosition=o,i1.values=t,i1}finally{Fn=!1,Fa()}}_mergeStructures(r,e){r=r||[];for(let t=0,o=r.length;t<o;t++){let i=r[t];i&&(i.isShared=!0,t>=32&&(i.highByte=t-32>>5))}for(let t1 in r.sharedLength=r.length,e||[])if(t1>=0){let o1=r[t1],i1=e[t1];i1&&(o1&&((r.restoreStructures||(r.restoreStructures=[]))[t1]=o1),r[t1]=i1)}return this.structures=r}decode(r,e){return this.unpack(r,e)}};function ja(){try{if(!Nt.trusted&&!Fn){let r=Te.sharedLength||0;r<Te.length&&(Te.length=r)}let n=Fe();if(I==mo)Te.restoreStructures&&Am(),Te=null,ne=null,Yr&&(Yr=null);else if(I>mo){let r1=Error("Unexpected end of MessagePack data");throw r1.incomplete=!0,r1}else if(!Fn)throw Error("Data read, but end of buffer not reached");return n}catch(n1){throw Te.restoreStructures&&Am(),Fa(),(n1 instanceof RangeError||n1.message.startsWith("Unexpected end of buffer"))&&(n1.incomplete=!0),n1}}function Am(){for(let n in Te.restoreStructures)Te[n]=Te.restoreStructures[n];Te.restoreStructures=null}function Fe(){let n=ne[I++];if(n<160){if(n<128){if(n<64)return n;{let r=Te[63&n]||Nt.getStructures&&Dm()[63&n];return r?(r.read||(r.read=Vc(r,63&n)),r.read()):n}}if(n<144){if(n-=128,Nt.mapsAsObjects){let r1={};for(let e=0;e<n;e++)r1[Rm()]=Fe();return r1}{let r2=new Map;for(let e1=0;e1<n;e1++)r2.set(Fe(),Fe());return r2}}{let r3=Array(n-=144);for(let e2=0;e2<n;e2++)r3[e2]=Fe();return r3}}if(n<192){let r4=n-160;if(vr>=I)return fo.slice(I-$t,(I+=r4)-$t);if(0==vr&&mo<140){let e3=r4<16?zc(r4):Bm(r4);if(null!=e3)return e3}return Rc(r4)}{let r5;switch(n){case 192:return null;case 193:return jt?(r5=Fe())>0?jt[1].slice(jt.position1,jt.position1+=r5):jt[0].slice(jt.position0,jt.position0-=r5):Gc;case 194:return!1;case 195:return!0;case 196:return Ec(ne[I++]);case 197:return r5=Ce.getUint16(I),I+=2,Ec(r5);case 198:return r5=Ce.getUint32(I),I+=4,Ec(r5);case 199:return jo(ne[I++]);case 200:return r5=Ce.getUint16(I),I+=2,jo(r5);case 201:return r5=Ce.getUint32(I),I+=4,jo(r5);case 202:if(r5=Ce.getFloat32(I),Nt.useFloat32>2){let e4=Ua[(127&ne[I])<<1|ne[I+1]>>7];return I+=4,(e4*r5+(r5>0?.5:-.5)>>0)/e4}return I+=4,r5;case 203:return r5=Ce.getFloat64(I),I+=8,r5;case 204:return ne[I++];case 205:return r5=Ce.getUint16(I),I+=2,r5;case 206:return r5=Ce.getUint32(I),I+=4,r5;case 207:return r5=Nt.int64AsNumber?4294967296*Ce.getUint32(I)+Ce.getUint32(I+4):Ce.getBigUint64(I),I+=8,r5;case 208:return Ce.getInt8(I++);case 209:return r5=Ce.getInt16(I),I+=2,r5;case 210:return r5=Ce.getInt32(I),I+=4,r5;case 211:return r5=Nt.int64AsNumber?4294967296*Ce.getInt32(I)+Ce.getUint32(I+4):Ce.getBigInt64(I),I+=8,r5;case 212:if(114==(r5=ne[I++]))return Em(63&ne[I++]);{let e5=bt[r5];if(e5)return e5.read?(I++,e5.read(Fe())):e5.noBuffer?(I++,e5()):e5(ne.subarray(I,++I));throw Error("Unknown extension "+r5)}case 213:return 114==(r5=ne[I])?(I++,Em(63&ne[I++],ne[I++])):jo(2);case 214:return jo(4);case 215:return jo(8);case 216:return jo(16);case 217:return r5=ne[I++],vr>=I?fo.slice(I-$t,(I+=r5)-$t):e_(r5);case 218:return r5=Ce.getUint16(I),vr>=(I+=2)?fo.slice(I-$t,(I+=r5)-$t):t_(r5);case 219:return r5=Ce.getUint32(I),vr>=(I+=4)?fo.slice(I-$t,(I+=r5)-$t):r_(r5);case 220:return r5=Ce.getUint16(I),I+=2,Nm(r5);case 221:return r5=Ce.getUint32(I),I+=4,Nm(r5);case 222:return r5=Ce.getUint16(I),I+=2,Im(r5);case 223:return r5=Ce.getUint32(I),I+=4,Im(r5);default:if(n>=224)return n-256;if(void 0===n){let e6=Error("Unexpected end of MessagePack data");throw e6.incomplete=!0,e6}throw Error("Unknown MessagePack token "+n)}}}var J1=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Vc(n,r){function e(){if(e.count++>2){let o=n.read=Function("r","return function(){return {"+n.map(i=>J1.test(i)?i+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"}}")(Fe);return 0===n.highByte&&(n.read=Cm(r,n.read)),o()}let t={};for(let o1=0,i=n.length;o1<i;o1++)t[n[o1]]=Fe();return t}return e.count=0,0===n.highByte?Cm(r,e):e}var Cm=(n,r)=>function(){let e=ne[I++];if(0===e)return r();let t=n<32?-(n+(e<<5)):n+(e<<5),o=Te[t]||Dm()[t];if(!o)throw Error("Record id is not defined for "+t);return o.read||(o.read=Vc(o,n)),o.read()};function Dm(){let n=Vm(()=>(ne=null,Nt.getStructures()));return Te=Nt._mergeStructures(n,Te)}var Rc=ka,e_=ka,t_=ka,r_=ka;function ka(n){let r;if(n<16&&(r=zc(n)))return r;if(n>64&&Lc)return Lc.decode(ne.subarray(I,I+=n));let e=I+n,t=[];for(r="";I<e;){let o=ne[I++];if((128&o)==0)t.push(o);else if((224&o)==192){let i=63&ne[I++];t.push((31&o)<<6|i)}else if((240&o)==224){let i1=63&ne[I++],s=63&ne[I++];t.push((31&o)<<12|i1<<6|s)}else if((248&o)==240){let c=(7&o)<<18|(63&ne[I++])<<12|(63&ne[I++])<<6|63&ne[I++];c>65535&&(c-=65536,t.push(c>>>10&1023|55296),c=56320|1023&c),t.push(c)}else t.push(o);t.length>=4096&&(r+=tt.apply(String,t),t.length=0)}return t.length>0&&(r+=tt.apply(String,t)),r}function Nm(n){let r=Array(n);for(let e=0;e<n;e++)r[e]=Fe();return r}function Im(n){if(Nt.mapsAsObjects){let r={};for(let e=0;e<n;e++)r[Rm()]=Fe();return r}{let r1=new Map;for(let e1=0;e1<n;e1++)r1.set(Fe(),Fe());return r1}}var tt=String.fromCharCode;function Bm(n){let r=I,e=Array(n);for(let t=0;t<n;t++){let o=ne[I++];if((128&o)>0){I=r;return}e[t]=o}return tt.apply(String,e)}function zc(n){if(n<4){if(n<2){if(0===n)return"";{let r=ne[I++];if((128&r)>1){I-=1;return}return tt(r)}}{let r1=ne[I++],e=ne[I++];if((128&r1)>0||(128&e)>0){I-=2;return}if(n<3)return tt(r1,e);let t=ne[I++];if((128&t)>0){I-=3;return}return tt(r1,e,t)}}{let r2=ne[I++],e1=ne[I++],t1=ne[I++],o=ne[I++];if((128&r2)>0||(128&e1)>0||(128&t1)>0||(128&o)>0){I-=4;return}if(n<6){if(4===n)return tt(r2,e1,t1,o);{let i=ne[I++];if((128&i)>0){I-=5;return}return tt(r2,e1,t1,o,i)}}if(n<8){let i1=ne[I++],s=ne[I++];if((128&i1)>0||(128&s)>0){I-=6;return}if(n<7)return tt(r2,e1,t1,o,i1,s);let a=ne[I++];if((128&a)>0){I-=7;return}return tt(r2,e1,t1,o,i1,s,a)}{let i2=ne[I++],s1=ne[I++],a1=ne[I++],c=ne[I++];if((128&i2)>0||(128&s1)>0||(128&a1)>0||(128&c)>0){I-=8;return}if(n<10){if(8===n)return tt(r2,e1,t1,o,i2,s1,a1,c);{let u=ne[I++];if((128&u)>0){I-=9;return}return tt(r2,e1,t1,o,i2,s1,a1,c,u)}}if(n<12){let u1=ne[I++],l=ne[I++];if((128&u1)>0||(128&l)>0){I-=10;return}if(n<11)return tt(r2,e1,t1,o,i2,s1,a1,c,u1,l);let d=ne[I++];if((128&d)>0){I-=11;return}return tt(r2,e1,t1,o,i2,s1,a1,c,u1,l,d)}{let u2=ne[I++],l1=ne[I++],d1=ne[I++],p=ne[I++];if((128&u2)>0||(128&l1)>0||(128&d1)>0||(128&p)>0){I-=12;return}if(n<14){if(12===n)return tt(r2,e1,t1,o,i2,s1,a1,c,u2,l1,d1,p);{let f=ne[I++];if((128&f)>0){I-=13;return}return tt(r2,e1,t1,o,i2,s1,a1,c,u2,l1,d1,p,f)}}{let f1=ne[I++],m=ne[I++];if((128&f1)>0||(128&m)>0){I-=14;return}if(n<15)return tt(r2,e1,t1,o,i2,s1,a1,c,u2,l1,d1,p,f1,m);let h=ne[I++];if((128&h)>0){I-=15;return}return tt(r2,e1,t1,o,i2,s1,a1,c,u2,l1,d1,p,f1,m,h)}}}}}function Ec(n){return Nt.copyBuffers?Uint8Array.prototype.slice.call(ne,I,I+=n):ne.subarray(I,I+=n)}function jo(n){let r=ne[I++];if(bt[r])return bt[r](ne.subarray(I,I+=n));throw Error("Unknown extension type "+r)}var Mm=Array(4096);function Rm(){let n=ne[I++];if(!(n>=160)||!(n<192))return I--,Fe();if(n-=160,vr>=I)return fo.slice(I-$t,(I+=n)-$t);if(!(0==vr&&mo<180))return Rc(n);let r=(n<<5^(n>1?Ce.getUint16(I):n>0?ne[I]:0))&4095,e=Mm[r],t=I,o=I+n-3,i,s=0;if(e&&e.bytes==n){for(;t<o;){if((i=Ce.getUint32(t))!=e[s++]){t=1879048192;break}t+=4}for(o+=3;t<o;)if((i=ne[t++])!=e[s++]){t=1879048192;break}if(t===o)return I=t,e.string;o-=3,t=I}for(e=[],Mm[r]=e,e.bytes=n;t<o;)i=Ce.getUint32(t),e.push(i),t+=4;for(o+=3;t<o;)i=ne[t++],e.push(i);let a=n<16?zc(n):Bm(n);return null!=a?e.string=a:e.string=Rc(n)}var Em=(n,r)=>{var e=Fe();let t=n;void 0!==r&&(n=n<32?-((r<<5)+n):(r<<5)+n,e.highByte=r);let o=Te[n];return o&&o.isShared&&((Te.restoreStructures||(Te.restoreStructures=[]))[n]=o),Te[n]=e,e.read=Vc(e,t),e.read()},Gm="object"==typeof self?self:global;bt[0]=()=>{},bt[0].noBuffer=!0,bt[101]=()=>{let n=Fe();return(Gm[n[0]]||Error)(n[1])},bt[105]=n=>{let r=Ce.getUint32(I-4);Yr||(Yr=new Map);let e=ne[I],t,o={target:t=e>=144&&e<160||220==e||221==e?[]:{}};Yr.set(r,o);let i=Fe();return o.used?Object.assign(t,i):(o.target=i,i)},bt[112]=n=>{let r=Ce.getUint32(I-4),e=Yr.get(r);return e.used=!0,e.target},bt[115]=()=>new Set(Fe());var jc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");function Vm(n){let r=mo,e=I,t=Bc,o=$t,i=vr,s=fo,a=Dc,c=Yr,u=jt,l=new Uint8Array(ne.slice(0,mo)),d=Te,p=Te.slice(0,Te.length),f=Nt,m=Fn,h=n();return mo=r,I=e,Bc=t,$t=o,vr=i,fo=s,Dc=a,Yr=c,jt=u,ne=l,Fn=m,(Te=d).splice(0,Te.length,...p),Nt=f,Ce=new DataView(ne.buffer,ne.byteOffset,ne.byteLength),h}function Fa(){ne=null,Yr=null,Te=null}bt[116]=n=>{let r=n[0],e=jc[r];if(!e)throw Error("Could not find typed array for code "+r);return new Gm[e](Uint8Array.prototype.slice.call(n,1).buffer)},bt[120]=()=>{let n=Fe();return RegExp(n[0],n[1])},bt[98]=n=>{let r=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],e=I;I+=r-4,(jt=[Fe(),Fe()]).position0=0,jt.position1=0;let t=I;I=e;try{return Fe()}finally{I=t}},bt[255]=n=>new Date(4==n.length?(16777216*n[0]+(n[1]<<16)+(n[2]<<8)+n[3])*1e3:8==n.length?((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((3&n[3])*4294967296+16777216*n[4]+(n[5]<<16)+(n[6]<<8)+n[7])*1e3:12==n.length?((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((128&n[4]?-281474976710656:0)+1099511627776*n[6]+4294967296*n[7]+16777216*n[8]+(n[9]<<16)+(n[10]<<8)+n[11])*1e3:"invalid");var Ua=Array(147);for(let n3=0;n3<256;n3++)Ua[n3]=+("1e"+Math.floor(45.15-.30103*n3));var Ha=new br({useRecords:!1}),s_=(Ha.unpack,Ha.unpackMultiple,Ha.unpack,new Float32Array(1));new Uint8Array(s_.buffer,0,4);try{qa=new TextEncoder}catch{}var qa,$a,kc,z,He,Sr,Ya="u">typeof Buffer,Fc=Ya?Buffer.allocUnsafeSlow:Uint8Array,Um=Ya?Buffer:Uint8Array,jm=Ya?4294967296:2144337920,E=0,wr=null,a_=/[\u0080-\uFFFF]/,cs=Symbol("record-id"),Fo=class extends br{constructor(r){super(r),this.offset=0;let t,o,i,s,a,c=0,u=Um.prototype.utf8Write?function(v,N,T){return z.utf8Write(v,N,T)}:!!qa&&!!qa.encodeInto&&function(v,N){return qa.encodeInto(v,z.subarray(N)).written},l=this;r||(r={});let d=r&&r.sequential,p=r.structures||r.saveStructures,f=r.maxSharedStructures;if(null==f&&(f=p?32:0),f>8160)throw Error("Maximum maxSharedStructure is 8160");let m=r.maxOwnStructures;null==m&&(m=p?32:64),d&&!r.saveStructures&&(this.structures=[]);let h=f>32||m+f>64,y=f+64,g=f+m+64;if(g>8256)throw Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let x=[],b=0,w=0;this.pack=this.encode=function(v,N){if(z||(z=new Fc(8192),He=new DataView(z.buffer,0,8192),E=0),(Sr=z.length-10)-E<2048?(z=new Fc(z.length),He=new DataView(z.buffer,0,z.length),Sr=z.length-10,E=0):E=E+7&2147483640,t=E,a=l.structuredClone?new Map:null,l.bundleStrings?(wr=["",""],z[E++]=214,z[E++]=98,wr.position=E-t,E+=4):wr=null,o=l.structures){o.uninitialized&&(o=l._mergeStructures(l.getStructures()));let T=o.sharedLength||0;if(T>f)throw Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+o.sharedLength);if(!o.transitions){o.transitions=Object.create(null);for(let C=0;C<T;C++){let O=o[C];if(!O)continue;let A,R=o.transitions;for(let U=0,$=O.length;U<$;U++){let ee=O[U];(A=R[ee])||(A=R[ee]=Object.create(null)),R=A}R[cs]=C+64}c=T}d||(o.nextId=T+64)}i&&(i=!1),s=o||[];try{if(S(v),wr){He.setUint32(wr.position+t,E-wr.position-t);let T1=wr;wr=null,S(T1[0]),S(T1[1])}if(l.offset=E,a&&a.idsToInsert){(E+=6*a.idsToInsert.length)>Sr&&_(E),l.offset=E;let T2=function(n,r){let e,t=6*r.length,o=n.length-t;for(r.sort((i,s)=>i.offset>s.offset?1:-1);e=r.pop();){let i=e.offset,s=e.id;n.copyWithin(i+t,i,o);let a=i+(t-=6);n[a++]=214,n[a++]=105,n[a++]=s>>24,n[a++]=s>>16&255,n[a++]=s>>8&255,n[a++]=255&s,o=i}return n}(z.subarray(t,E),a.idsToInsert);return a=null,T2}return N&Wm?(z.start=t,z.end=E,z):z.subarray(t,E)}finally{if(o){if(w<10&&w++,b>1e4)o.transitions=null,w=0,b=0,x.length>0&&(x=[]);else if(x.length>0&&!d){for(let T3=0,C1=x.length;T3<C1;T3++)x[T3][cs]=0;x=[]}if(i&&l.saveStructures){let T4=o.sharedLength||f;o.length>T4&&(o=o.slice(0,T4));let C2=z.subarray(t,E);return!1===l.saveStructures(o,c)?(l._mergeStructures(l.getStructures()),l.pack(v)):(c=T4,C2)}}N&y_&&(E=t)}};let S=v=>{E>Sr&&(z=_(E));var T,N=typeof v;if("string"===N){let O,C=v.length;if(wr&&C>=8&&C<4096){let R=a_.test(v);wr[R?0:1]+=v,z[E++]=193,S(R?-C:C);return}O=C<32?1:C<256?2:C<65536?3:5;let A=3*C;if(E+A>Sr&&(z=_(E+A)),C<64||!u){let R1,U,$,ee=E+O;for(R1=0;R1<C;R1++)(U=v.charCodeAt(R1))<128?z[ee++]=U:U<2048?(z[ee++]=U>>6|192,z[ee++]=63&U|128):(64512&U)==55296&&(64512&($=v.charCodeAt(R1+1)))==56320?(U=65536+((1023&U)<<10)+(1023&$),R1++,z[ee++]=U>>18|240,z[ee++]=U>>12&63|128,z[ee++]=U>>6&63|128,z[ee++]=63&U|128):(z[ee++]=U>>12|224,z[ee++]=U>>6&63|128,z[ee++]=63&U|128);T=ee-E-O}else T=u(v,E+O,A);T<32?z[E++]=160|T:T<256?(O<2&&z.copyWithin(E+2,E+1,E+1+T),z[E++]=217,z[E++]=T):T<65536?(O<3&&z.copyWithin(E+3,E+2,E+2+T),z[E++]=218,z[E++]=T>>8,z[E++]=255&T):(O<5&&z.copyWithin(E+5,E+3,E+3+T),z[E++]=219,He.setUint32(E,T),E+=4),E+=T}else if("number"===N){if(v>>>0===v)v<64?z[E++]=v:v<256?(z[E++]=204,z[E++]=v):v<65536?(z[E++]=205,z[E++]=v>>8,z[E++]=255&v):(z[E++]=206,He.setUint32(E,v),E+=4);else if(v>>0===v)v>=-32?z[E++]=256+v:v>=-128?(z[E++]=208,z[E++]=v+256):v>=-32768?(z[E++]=209,He.setInt16(E,v),E+=2):(z[E++]=210,He.setInt32(E,v),E+=4);else{let C1;if((C1=this.useFloat32)>0&&v<4294967296&&v>=-2147483648){let O1;if(z[E++]=202,He.setFloat32(E,v),C1<4||(O1=v*Ua[(127&z[E])<<1|z[E+1]>>7])>>0===O1){E+=4;return}E--}z[E++]=203,He.setFloat64(E,v),E+=8}}else if("object"===N){if(v){if(a){let O2=a.get(v);if(O2){if(!O2.id){let A1=a.idsToInsert||(a.idsToInsert=[]);O2.id=A1.push(O2)}z[E++]=214,z[E++]=112,He.setUint32(E,O2.id),E+=4;return}a.set(v,{offset:E-t})}let C2=v.constructor;if(C2===Object)P(v,!0);else if(C2===Array){(T=v.length)<16?z[E++]=144|T:T<65536?(z[E++]=220,z[E++]=T>>8,z[E++]=255&T):(z[E++]=221,He.setUint32(E,T),E+=4);for(let O3=0;O3<T;O3++)S(v[O3])}else if(C2===Map)for(let[O4,A2]of((T=v.size)<16?z[E++]=128|T:T<65536?(z[E++]=222,z[E++]=T>>8,z[E++]=255&T):(z[E++]=223,He.setUint32(E,T),E+=4),v))S(O4),S(A2);else{for(let O5=0,A3=$a.length;O5<A3;O5++)if(v instanceof kc[O5]){let q,U1=$a[O5];if(U1.write){U1.type&&(z[E++]=212,z[E++]=U1.type,z[E++]=0),S(U1.write.call(this,v));return}let $1=z,ee1=He,X=E;z=null;try{q=U1.pack.call(this,v,H=>(z=$1,$1=null,(E+=H)>Sr&&_(E),{target:z,targetView:He,position:E-H}),S)}finally{$1&&(z=$1,He=ee1,E=X,Sr=z.length-10)}q&&(q.length+E>Sr&&_(q.length+E),E=function(n,r,e,t){let o=n.length;switch(o){case 1:r[e++]=212;break;case 2:r[e++]=213;break;case 4:r[e++]=214;break;case 8:r[e++]=215;break;case 16:r[e++]=216;break;default:o<256?(r[e++]=199,r[e++]=o):o<65536?(r[e++]=200,r[e++]=o>>8,r[e++]=255&o):(r[e++]=201,r[e++]=o>>24,r[e++]=o>>16&255,r[e++]=o>>8&255,r[e++]=255&o)}return r[e++]=t,r.set(n,e),e+=o}(q,z,E,U1.type));return}P(v,!v.hasOwnProperty)}}else z[E++]=192}else if("boolean"===N)z[E++]=v?195:194;else if("bigint"===N){if(v<BigInt(1)<<BigInt(63)&&v>=-(BigInt(1)<<BigInt(63)))z[E++]=211,He.setBigInt64(E,v);else if(v<BigInt(1)<<BigInt(64)&&v>0)z[E++]=207,He.setBigUint64(E,v);else if(this.largeBigIntToFloat)z[E++]=203,He.setFloat64(E,Number(v));else throw RangeError(v+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");E+=8}else if("undefined"===N)this.encodeUndefinedAsNil?z[E++]=192:(z[E++]=212,z[E++]=0,z[E++]=0);else if("function"===N)S(this.writeFunction&&this.writeFunction());else throw Error("Unknown type: "+N)},P=!1===this.useRecords?this.variableMapSize?v=>{let C,N=Object.keys(v),T=N.length;T<16?z[E++]=128|T:T<65536?(z[E++]=222,z[E++]=T>>8,z[E++]=255&T):(z[E++]=223,He.setUint32(E,T),E+=4);for(let O=0;O<T;O++)S(C=N[O]),S(v[C])}:(v,N)=>{z[E++]=222;let T=E-t;E+=2;let C=0;for(let O in v)(N||v.hasOwnProperty(O))&&(S(O),S(v[O]),C++);z[T+++t]=C>>8,z[T+t]=255&C}:v=>{let N=Object.keys(v),T,C=s.transitions||(s.transitions=Object.create(null)),O=0;for(let R=0,U=N.length;R<U;R++){let $=N[R];(T=C[$])||(T=C[$]=Object.create(null),O++),C=T}let A=C[cs];if(A)A>=96&&h?(z[E++]=(31&(A-=96))+96,z[E++]=A>>5):z[E++]=A;else{(A=s.nextId)||(A=64),A<y&&this.shouldShareStructure&&!this.shouldShareStructure(N)?((A=s.nextOwnId)<g||(A=y),s.nextOwnId=A+1):(A>=g&&(A=y),s.nextId=A+1);let R1=N.highByte=A>=96&&h?A-96>>5:-1;C[cs]=A,s[A-64]=N,A<y?(N.isShared=!0,s.sharedLength=A-63,i=!0,R1>=0?(z[E++]=(31&A)+96,z[E++]=R1):z[E++]=A):(R1>=0?(z[E++]=213,z[E++]=114,z[E++]=(31&A)+96,z[E++]=R1):(z[E++]=212,z[E++]=114,z[E++]=A),O&&(b+=w*O),x.length>=m&&(x.shift()[cs]=0),x.push(C),S(N))}for(let R2=0,U1=N.length;R2<U1;R2++)S(v[N[R2]])},_=v=>{let N;if(v>16777216){if(v-t>jm)throw Error("Packed buffer would be larger than maximum buffer size");N=Math.min(jm,4096*Math.round(Math.max((v-t)*(v>67108864?1.25:2),4194304)/4096))}else N=(Math.max(v-t<<2,z.length-1)>>12)+1<<12;let T=new Fc(N);return He=new DataView(T.buffer,0,N),z.copy?z.copy(T,0,t,v):T.set(z.slice(t,v)),E-=t,t=0,Sr=T.length-10,z=T}}useBuffer(r){z=r,He=new DataView(z.buffer,z.byteOffset,z.byteLength),E=0}};function Fm(n,r,e,t){let o=n.byteLength;if(o+1<256){var{target:i,position:s}=e(4+o);i[s++]=199,i[s++]=o+1}else if(o+1<65536){var{target:i,position:s}=e(5+o);i[s++]=200,i[s++]=o+1>>8,i[s++]=o+1&255}else{var{target:i,position:s,targetView:a}=e(7+o);i[s++]=201,a.setUint32(s,o+1),s+=4}i[s++]=116,i[s++]=r,i.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s)}function km(n,r){let e=n.byteLength;if(e<256){var t,o,{target:t,position:o}=r(e+2);t[o++]=196,t[o++]=e}else if(e<65536){var{target:t,position:o}=r(e+3);t[o++]=197,t[o++]=e>>8,t[o++]=255&e}else{var{target:t,position:o,targetView:i}=r(e+5);t[o++]=198,i.setUint32(o,e),o+=4}t.set(n,o)}function ho(n){var n1;if(n.Class){if(!n.pack&&!n.write)throw Error("Extension has no pack or write function");if(n.pack&&!n.type)throw Error("Extension has no type (numeric code to identify the extension)");kc.unshift(n.Class),$a.unshift(n)}(n1=n).unpack?bt[n1.type]=n1.unpack:bt[n1.type]=n1}kc=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,ls],$a=[{pack(n,r,e){let t=n.getTime()/1e3;if((this.useTimestamp32||0===n.getMilliseconds())&&t>=0&&t<4294967296){let{target:o,targetView:i,position:s}=r(6);o[s++]=214,o[s++]=255,i.setUint32(s,t)}else if(t>0&&t<17179869184){let{target:o1,targetView:i1,position:s1}=r(10);o1[s1++]=215,o1[s1++]=255,i1.setUint32(s1,4e6*n.getMilliseconds()+(t/1e3/4294967296>>0)),i1.setUint32(s1+4,t)}else if(isNaN(t)){if(this.onInvalidDate)return r(0),e(this.onInvalidDate());let{target:o2,targetView:i2,position:s2}=r(3);o2[s2++]=212,o2[s2++]=255,o2[s2++]=255}else{let{target:o3,targetView:i3,position:s3}=r(15);o3[s3++]=199,o3[s3++]=12,o3[s3++]=255,i3.setUint32(s3,1e6*n.getMilliseconds()),i3.setBigInt64(s3+4,BigInt(Math.floor(t)))}}},{pack(n,r,e){let t=Array.from(n),{target:o,position:i}=r(this.structuredClone?3:0);this.structuredClone&&(o[i++]=212,o[i++]=115,o[i++]=0),e(t)}},{pack(n,r,e){let{target:t,position:o}=r(this.structuredClone?3:0);this.structuredClone&&(t[o++]=212,t[o++]=101,t[o++]=0),e([n.name,n.message])}},{pack(n,r,e){let{target:t,position:o}=r(this.structuredClone?3:0);this.structuredClone&&(t[o++]=212,t[o++]=120,t[o++]=0),e([n.source,n.flags])}},{pack(n,r){this.structuredClone?Fm(n,16,r):km(Ya?Buffer.from(n):new Uint8Array(n),r)}},{pack(n,r){let e=n.constructor;e!==Um&&this.structuredClone?Fm(n,jc.indexOf(e.name),r):km(n,r)}},{pack(n,r){let{target:e,position:t}=r(1);e[t]=193}}];var Hm=new Fo({useRecords:!1});Hm.pack,Hm.pack;var{NEVER:p_,ALWAYS:f_,DECIMAL_ROUND:m_,DECIMAL_FIT:h_}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},Wm=512,y_=1024,qm=new Fo({structuredClone:!0});ho({Class:Me.prototype.constructor,type:1,write:n=>({...n}),read:n=>(Object.setPrototypeOf(n,Me.prototype),n)}),ho({Class:me.prototype.constructor,type:2,write:n=>[...n],read:n=>(Object.setPrototypeOf(n,me.prototype),n)}),ho({Class:Be.prototype.constructor,type:3,write:n=>[...n],read:n=>(Object.setPrototypeOf(n,Be.prototype),n)}),ho({Class:ss.prototype.constructor,type:4,write:n=>n.id,read:n=>new ss(n)}),ho({Class:as.prototype.constructor,type:5,write:n=>n.data,read:n=>new as(n)}),ho({Class:Re.prototype.constructor,type:6,write:n=>({...n}),read:n=>(Object.setPrototypeOf(n,Re.prototype),n)}),(t=>{function n(o){return qm.pack(o)}t.serialize=n,t.deserialize=function(o){return qm.unpack(o)},t.checksum=function(o){return(function(n){var r=0;if(0===n.length)return r;for(let e=0;e<n.length;e++)r=(r<<5)-r+n[e],r&=r;return r})(n(function Uc(n){if(Bn(n))return n;if(Array.isArray(n))return n.map(Uc);if("object"!=typeof n||null===n)return n;{let r={};for(let e of Object.keys(n).sort())r[e]=Uc(n[e]);return Object.setPrototypeOf(r,Object.getPrototypeOf(n)),r}}(o))).toString()}})(Xa||(Xa={}));var xo="personal camera",vo="a218fcc3-276b-49b9-b485-49037fd14f5f";(e10=$m||($m={})).isEqual=function(t,o){return t[0]===o[0]&&t[1]===o[1]},e10.lerp=function(t,o,i){return[t[0]+(o[0]-t[0])*i,t[1]+(o[1]-t[1])*i]},(a3=yo||(yo={})).isEqual=function(c,u){return c[0]===u[0]&&c[1]===u[1]&&c[2]===u[2]},a3.add=function(c,u){return[c[0]+u[0],c[1]+u[1],c[2]+u[2]]},a3.sub=function(c,u){return[c[0]-u[0],c[1]-u[1],c[2]-u[2]]},a3.div=function(c,u){return[c[0]/u[0],c[1]/u[1],c[2]/u[2]]},a3.mul=function(c,u){return[c[0]*u[0],c[1]*u[1],c[2]*u[2]]},a3.dist=function(c,u){return Math.hypot(c[0]-u[0],c[1]-u[1],c[2]-u[2])},a3.lerp=function(c,u,l){return[c[0]+(u[0]-c[0])*l,c[1]+(u[1]-c[1])*l,c[2]+(u[2]-c[2])*l]},(e11=Ym||(Ym={})).isEqual=function(t,o){return t[0]===o[0]&&t[1]===o[1]&&t[2]===o[2]&&t[3]===o[3]},e11.lerp=function(t,o,i){return[t[0]+(o[0]-t[0])*i,t[1]+(o[1]-t[1])*i,t[2]+(o[2]-t[2])*i,t[3]+(o[3]-t[3])*i]},(o5=go||(go={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o5.isEqual=function(i,s){for(let a=0;a<16;a++)if(i[a]!==s[a])return!1;return!0},o5.simplify=function(i){return i??o5.identity},o5.applyMatrix4=function(i,s){let a=s.slice(0);for(var c=0,u=s.length;c<u;c+=3){let l=i[3]*s[c]+i[7]*s[c+1]+i[11]*s[c+2]+i[15];a[c]=(i[0]*s[c]+i[4]*s[c+1]+i[8]*s[c+2]+i[12])/l,a[c+1]=(i[1]*s[c]+i[5]*s[c+1]+i[9]*s[c+2]+i[13])/l,a[c+2]=(i[2]*s[c]+i[6]*s[c+1]+i[10]*s[c+2]+i[14])/l}return a},(l3=rt||(rt={})).isRGB=function(d){return"object"==typeof d&&"number"==typeof d.r&&"number"==typeof d.g&&"number"==typeof d.b},l3.white={r:1,g:1,b:1},l3.red={r:1,g:0,b:0},l3.black={r:0,g:0,b:0},l3.toRgb255a1=function(d){return{r:Math.round(255*d.r),g:Math.round(255*d.g),b:Math.round(255*d.b),a:1}},l3.clone=function(d){return{r:d.r,g:d.g,b:d.b}},l3.fromHex=function(d){return{r:((d=Math.floor(d))>>16&255)/255,g:(d>>8&255)/255,b:(255&d)/255}},l3.toHex=function(d){return 65536*Math.round(255*d.r)+256*Math.round(255*d.g)+Math.round(255*d.b)},l3.equals=function(d,p){return d.r===p.r&&d.g===p.g&&d.b===p.b},l3.lerp=function(d,p,f){return{r:d.r+(p.r-d.r)*f,g:d.g+(p.g-d.g)*f,b:d.b+(p.b-d.b)*f}},(a4=St||(St={})).white={...rt.white,a:1},a4.transparent={...rt.white,a:0},a4.from0to1=function(c){return{r:c[0],g:c[1],b:c[2],a:c[3]}},a4.fromHexAndA=function(c,u){return{...rt.fromHex(c),a:u}},a4.toRgb255a1=function(c){return{r:Math.round(255*c.r),g:Math.round(255*c.g),b:Math.round(255*c.b),a:c.a}},a4.equals=function(c,u){return rt.equals(c,u)&&c.a===u.a},a4.lerp=function(c,u,l){return{r:c.r+(u.r-c.r)*l,g:c.g+(u.g-c.g)*l,b:c.b+(u.b-c.b)*l,a:c.a+(u.a-c.a)*l}},(Ka||(Ka={})).identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},(Xm||(Xm={})).defaultData={mass:1,stiffness:80,damping:10,velocity:0},(Km||(Km={})).defaultData={control1:[.5,0],control2:[.5,1]},(i5=Zm||(Zm={})).linear=[0,0,1,1],i5.ease=[.25,.1,.25,1],i5.easeIn=[.42,0,1,1],i5.easeOut=[0,0,.58,1],i5.easeInOut=[.42,0,.58,1],(e12=tr||(tr={})).all=["PerspectiveCamera","OrthographicCamera"],e12.is=function(t){return e12.all.includes(t)},(o6=bo||(bo={})).DefaultUp=[0,1,0],o6.DefaultTargetOffset=1e3,o6.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:o6.DefaultUp,isUpVectorFlipped:!1,targetOffset:o6.DefaultTargetOffset},o6.getZoom=function(i){return"PerspectiveCamera"===i.type?i.perspective.zoom:i.orthographic.zoom},(e13=_r||(_r={})).defaultData=function(t,o=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(t[0],t[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[t[0]+t[0]*o,0,0]},grid:{count:[2,2,2],size:t.map(i=>i*(1+o)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e13.merge=function(t,o){let i={...t};if(x_.forEach(s=>{Object.assign(i,{[s]:o[s]??t[s]})}),i.radial={...t.radial},o.radial){let s=t.radial,a=o.radial;v_.forEach(c=>{Object.assign(i.radial,{[c]:a[c]??s[c]})})}if(i.linear={...t.linear},o.linear){let s1=t.linear,a1=o.linear;b_.forEach(c=>{Object.assign(i.linear,{[c]:a1[c]??s1[c]})})}if(i.grid={...t.grid},o.grid){let s2=t.grid,a2=o.grid;S_.forEach(c=>{Object.assign(i.grid,{[c]:a2[c]??s2[c]})})}if(i.toObject={...t.toObject},o.toObject){let s3=t.toObject,a3=o.toObject;w_.forEach(c=>{Object.assign(i.toObject,{[c]:a3[c]??s3[c]})})}if(i.randomnessObject={...t.randomnessObject},o.randomnessObject){let s4=t.randomnessObject,a4=o.randomnessObject;__.forEach(c=>{Object.assign(i.randomnessObject,{[c]:a4[c]??s4[c]})})}return i},(t7=Za||(Za={})).defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}},r=["radial","linear","grid","toObject","randomnessObject"],t7.toOps=function(o,i){let s=[];for(let a of(void 0!==o.count&&s.push({type:0,path:i,props:{count:o.count}}),r)){let c=o[a];c&&Object.keys(c).length>0&&s.push({type:0,path:[...i,a],props:c})}return s};var x_=["count"],v_=["radius","start","end","position","scale","rotation"],b_=["position","scale","rotation"],S_=["count","size"],w_=["count","position","scale","rotation"],__=["strength","scale","rotation","position","movement","seed","freqScale"];(e14=Qa||(Qa={})).all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e14.is=function(t){return e14.all.includes(t)},(Ja||(Ja={})).defaultData=function(t){return function(t){if("PointLight"===t)return{type:t,color:St.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===t)return{type:t,color:St.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===t)return{type:t,color:St.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw Error("not implemented")}(t)},(So||(So={})).defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]},(e15=Hc||(Hc={})).defaultData={castShadow:!0,receiveShadow:!0},e15.equals=function(t,o){return t.castShadow===o.castShadow&&t.receiveShadow===o.receiveShadow},(e16=Wc||(Wc={})).defaultData={flatShading:!1,wireframe:!1,side:0},e16.equals=function(t,o){return t.flatShading===o.flatShading&&t.side===o.side&&t.wireframe===o.wireframe},(el||(el={})).defaultData={...Wc.defaultData,...Hc.defaultData},(e17=kn||(kn={})).defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e17.maxSize=3e7,(Jm||(Jm={})).is=function(e){return"texture"===e||"video"===e||"color"===e||"depth"===e||"normal"===e||"gradient"===e||"noise"===e||"fresnel"===e||"rainbow"===e||"toon"===e||"outline"===e||"transmission"===e||"matcap"===e||"displace"===e||"pattern"===e||"light"===e},(eh||(eh={})).is=function(e){return"phong"===e||"toon"===e||"lambert"===e||"physical"===e};var e10,a3,e11,o5,l3,a4,i5,e12,o6,e13,t7,e14,e15,e16,e17,Xa,$m,yo,Ym,go,rt,St,Ka,Xm,Km,Zm,tr,bo,_r,Za,Qa,Ja,So,Hc,Wc,el,kn,Jm,eh,wt,rh=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],oh=["wrapping","image","video","name"];(o7=wt||(wt={})).patch=function(i,s){let{texture:a,...c}=s;if(Object.assign(i,c),a){let u=i.texture;u&&Object.assign(u,a)}},o7.defaultData=function(i,s){return"light"===i&&s?function(i){let s={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(i){case"phong":return{...s,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...s,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...s,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...s,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(s):function(i){let s={alpha:1,mode:0,isMask:!1,visible:!0};switch(i){case"texture":return{...s,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...s,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:kn.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...s,type:"color",color:rt.fromHex(5526619)};case"depth":return{...s,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...s,type:"normal",cnormal:[1,1,1]};case"gradient":return{...s,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...s,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...rt.fromHex(6710886),a:1},colorB:{...rt.fromHex(6710886),a:1},colorC:{...rt.fromHex(16777215),a:1},colorD:{...rt.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...s,type:"fresnel",color:St.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...s,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...s,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:St.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...s,type:"outline",outlineColor:St.fromHexAndA(0,1),contourColor:St.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...s,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...s,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...s,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...rt.fromHex(0),a:1},colorB:{...rt.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(i)},(c=>{function i(u,l="layer1",d="layer2"){let p=new me;return p.push({fi:0,data:wt.defaultData("light",u),id:l}),p.push({fi:1,data:wt.defaultData("color"),id:d}),{layers:p}}c.isMergable=function(u){return!u.layers.some(d=>"texture"===d.data.type&&0!==d.data.projection||"depth"===d.data.type&&!d.data.isWorldSpace||"noise"===d.data.type||"displace"===d.data.type)},c.getHash=function(u){let l="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,f])=>{l+=`${p}${f}`,Array.isArray(f)?f.forEach(m=>l+=`${m}`):"object"==typeof f?Object.values(f).forEach(m=>{"number"==typeof m?l+=`${m.toFixed(4)}`:l+=`${m}`}):l+=`${f}`})}),l},c.defaultEmptyData=function(){return{layers:new me}},c.defaultData=function(u="layer1",l="layer2"){return i("phong",u,l)},c.withName=function(u,l){return{...u,name:l}},c.defaultTwoLayerData=i,c.defaultTwoLayerTextureData=function(u,l="phong",d="layer1",p="layer2"){let f=wt.defaultData("texture");Object.assign(f.texture,{image:u});let m=new me;return m.push({fi:0,data:f,id:d}),m.push({fi:1,data:wt.defaultData("light",l),id:p}),{layers:m}},c.defaultTwoLayerVideoTextureData=function(u,l="phong",d="layer1",p="layer2"){let f=wt.defaultData("video");Object.assign(f.texture,{video:u});let m=new me;return m.push({fi:0,data:f,id:d}),m.push({fi:1,data:wt.defaultData("light",l),id:p}),{layers:m}}})(It||(It={})),(Un||(Un={})).defaultData=function(){return{points:new me,roundness:0,shapeHoles:[],isClosed:!1}},(Hn||(Hn={})).defaultData=function(){return{points:new me,lastInsertionPlane:null,subdivisions:12,isClosed:!1}};var qc={type:"Ellipse",width:100,height:100,spikes:64,angle:360,innerRadius:0};(tl||(tl={})).merge=function(e,t){let o={...e};return P_.forEach(i=>{Object.assign(o,{[i]:t[i]??e[i]})}),o};var rl={shape:qc,depth:1,offset:0,bevel:0,bevelSides:1,angle:0,twist:0,startScale:1,endScale:1},P_=["depth","offset","angle","twist","startScale","endScale"];function lh(n){n.layers.forEach(r=>{if("depth"===r.type&&void 0!==r.colorA){let e=r.colorA,t=r.colorB,o=[[e.r,e.g,e.b,e.a],[t.r,t.g,t.b,t.a]],i=[0,1];for(let a=2;a<10;a++)o.push(o[1]),i.push(1);let s={...q1(Ye(r),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,r.near),far:Math.max(0,r.far),colors:o,steps:i,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(r,s)}else if("depth"===r.type&&1===r.gradientType&&(r.near<0||r.far<0)){let e1={...Ye(r),near:Math.max(r.near,0),far:Math.max(r.far,0)};Object.assign(r,e1)}})}function Zr(n,r){Object.values(n.shared.materials).forEach(e=>r(e))}function Qr(n,r){n.scene.objects.traverse((e,t)=>{"materials"in t?t.materials.forEach(o=>{"string"!=typeof o&&r(o)}):"material"in t&&"string"!=typeof t.material&&r(t.material),"overrides"in t&&Object.values(t.overrides).forEach(o=>{o.material&&"string"!=typeof o.material&&r(o.material)})})}function ch(n){void 0===n.layers&&Object.assign(n,It.defaultTwoLayerData("lambert"))}function Jc(n){n.layers&&n.layers.forEach(r=>{if("depth"===r.type&&10===r.colors.length){let e=[...r.colors];e.push(r.colors[9]);let t=[...r.steps];t.push(r.steps[9]);let o={...Ye(r),colors:e,steps:t};Object.assign(r,o)}})}function dh(n){n.scene.objects.traverse((r,e)=>{"materials"in e?e.materials.forEach(t=>{"string"!=typeof t&&Jc(t)}):"material"in e&&"string"!=typeof e.material&&Jc(e.material)}),Object.values(n.shared.materials).forEach(r=>Jc(r))}function uh(n){n.layers&&n.layers.forEach(r=>{"depth"===r.type&&void 0!==r.num&&(r.colors=r.colors.slice(0,r.num),r.steps=r.steps.slice(0,r.num),delete r.num)})}function ph(n){n.layers&&n.layers.forEach(r=>{"displace"!==r.type&&void 0===r.isMask&&(r.isMask=!1),("texture"===r.type||"video"===r.type)&&void 0===r.blending&&(r.blending=0),("noise"===r.type||"displace"===r.type&&"noise"===r.displacementType)&&(void 0===r.voronoiStyle&&(r.voronoiStyle=0),void 0===r.highCut&&(r.highCut=1),void 0===r.lowCut&&(r.lowCut=0),void 0===r.smoothness&&(r.smoothness=.3),void 0===r.seed&&(r.seed=0),void 0===r.quality&&(r.quality=1))})}function fh(n){let r=n.layers.find(e=>"light"===e.type)?.data;if(r?.category==="basic"){let e=wt.defaultData("light","phong"),t=r;Object.assign(t,e),t.visible=!1}}function mh(n){Zr(n,fh),Qr(n,fh)}function hh(n){n.layers.forEach(r=>{"light"===r.type&&"toon"!==r.category&&void 0===r.occlusion&&(r.occlusion=!0)})}function yh(n){n.layers&&n.layers.forEach(r=>{"light"===r.type&&void 0===r.bumpMapIntensity&&(r.bumpMapIntensity=5)})}function xh(n){n.layers&&n.layers.forEach(r=>{"light"===r.type&&void 0===r.alphaOverride&&(r.alphaOverride=1)})}(e18=ds||(ds={})).is2DParametricMesh=function(t){return"PolygonGeometry"===t||"RectangleGeometry"===t||"StarGeometry"===t||"TriangleGeometry"===t||"EllipseGeometry"===t},e18.isParametricMesh=function(t){return"PolygonGeometry"===t||"PolygonGeometry"===t||"RectangleGeometry"===t||"StarGeometry"===t||"TriangleGeometry"===t||"EllipseGeometry"===t||"PathGeometry"===t||"VectorGeometry"===t||"ConeGeometry"===t||"CubeGeometry"===t||"CylinderGeometry"===t||"DodecahedronGeometry"===t||"HelixGeometry"===t||"IcosahedronGeometry"===t||"LatheGeometry"===t||"PyramidGeometry"===t||"SphereGeometry"===t||"PlaneGeometry"===t||"BackdropGeometry"===t||"TorusGeometry"===t||"TorusKnotGeometry"===t||"BooleanGeometry"===t||"TextGeometry"===t},(ol||(ol={})).merge=function(e,t){let o={...e};return Object.assign(o,t),"PathGeometry"===o.type&&"extrusion"in t&&t.extrusion&&(o.extrusion={...e.extrusion},Object.assign(o.extrusion,tl.merge(o.extrusion,t.extrusion))),o},(wo||(wo={})).defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("PathGeometry"===e)return{type:e,width:1,height:1,depth:1,path:Hn.defaultData(),extrusion:rl};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:Un.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===e)return{type:e,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if("SphereGeometry"===e)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI};throw Error("not implemented")},(nl||(nl={})).defaultData={enabled:!1,useBackgroundColor:!1,color:rt.white,near:.1,far:2e3},n={opacity:1,blendFunction:13,enabled:!1},(il||(il={})).defaultData={enabled:!1,pixelation:{...n,blendFunction:16,granularity:15},bloom:{...n,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...n,offset:[2,2]},vignette:{...n,darkness:1,offset:0},hueSaturation:{...n,hue:3,saturation:0},brightnessContrast:{...n,brightness:.25,contrast:0},depthOfField:{...n,focalLength:2,focusDistance:2,bokehScale:2},noise:{...n,blendFunction:16}},($c||($c={})).defaultData={softShadowQuality:"low"},(Yc||(Yc={})).defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75},(Xc||(Xc={})).defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}},(us||(us={})).defaultData={usePhysics:!1,gravity:-10},(Kc||(Kc={})).defaultData={playCamera:xo,gameControlObject:null},(sl||(sl={})).defaultData={backgroundColor:St.fromHexAndA(2960946,1),postprocessing:il.defaultData,fog:nl.defaultData,globalPhysics:us.defaultData,ambient:Yc.defaultData,ao:Xc.defaultData,shadow:$c.defaultData,publish:Kc.defaultData},(e19=nh||(nh={})).isComponentRelated=function(t){return"Component"===t||"Instance"===t},e19.isEmptyOrComponent=function(t){return"Empty"===t||"Instance"===t},(o8=Wn||(Wn={})).identity={...Ka.identity,hiddenMatrix:go.identity},o8.fromObject=function(i){return{position:i.position,rotation:i.rotation,scale:i.scale,hiddenMatrix:i.hiddenMatrix}},o8.merge=function(i,s){return{position:s?.position||i.position,rotation:s?.rotation||i.rotation,scale:s?.scale||i.scale,hiddenMatrix:s?.hiddenMatrix||i.hiddenMatrix}},o8.diff=function(i,s){return function(n){for(let r of Object.keys(n))void 0===n[r]&&delete n[r];return n}({position:yo.isEqual(i.position,s.position)?void 0:s.position,rotation:yo.isEqual(i.rotation,s.rotation)?void 0:s.rotation,scale:yo.isEqual(i.scale,s.scale)?null:s.scale,hiddenMatrix:go.isEqual(i.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})},(gt||(gt={})).defaultData={states:new me,events:new me,visible:!0,raycastLock:!1,physics:So.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...Wn.identity,cloner:null},(ih||(ih={})).defaultData={type:"Empty",...gt.defaultData},(sh||(sh={})).defaultData={type:"Component",...gt.defaultData},(ko||(ko={})).defaultData={type:"Mesh",...gt.defaultData,...el.defaultData},(Uo||(Uo={})).defaultData={...gt.defaultData,...Wn.identity,position:[0,0,bo.DefaultTargetOffset],...bo.defaultData},(e20=al||(al={})).defaultData=function(t){return{...gt.defaultData,...Ja.defaultData(t)}},e20.defaultDirectionalLightData={...e20.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7},(e=>{function n(t,o,i=0){for(;i<o.length;){let s=t?t[o[i]]:void 0;if(o.length===i+1)return s;if(!s)return;t=s.descendants,i+=1}}e.resolveWithDes=n,e.resolve=function(t,o,i=0){let s=n(t,o,i);if(s){let a=Object.keys(s);if(1===a.length&&"descendants"===a[0])return}return s}})(qn||(qn={})),(i=>{function t(s,a){return{...gt.defaultData,...a,component:s,overrides:new Re,physics:void 0,events:void 0,type:"Instance"}}i.rootOverrideProps=["physics","events"],i.compositeNonOptionalOverrideProps=["geometry"],i.compositeEntireOverrideOverrideProps=["material"],i.ofComponent=t,i.fromComponentData=function(s){let a=Wn.fromObject(s.data);return t(s.id,a)}})(Xr||(Xr={})),(Kr||(Kr={})).defaultData={type:"Page",...gt.defaultData,physics:{...So.defaultData,fusedBody:!1},...sl.defaultData,camera:Uo.defaultData},(i6=ll||(ll={})).defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:go.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:So.defaultData,states:new me,events:new me,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...bo.defaultData},i6.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},i6.defaultMeshObject={name:"Rectangle",...gt.defaultData,...ko.defaultData,geometry:wo.defaultData("RectangleGeometry"),material:It.defaultTwoLayerData("phong","layer1","layer2")},i6.defaultBooleanObject={name:"Boolean",...gt.defaultData,...ko.defaultData,geometry:wo.defaultData("BooleanGeometry"),material:It.defaultTwoLayerData("phong","layer1","layer2")},i6.defaultTextObject={name:"Text",...gt.defaultData,...ko.defaultData,geometry:wo.defaultData("TextGeometry"),material:It.defaultTwoLayerData("phong","layer1","layer2")},(o9=Ho||(Ho={})).newEmpty=function(i,s){let a={name:s};return"Mesh"===i.type?(a.geometry={},"material"in i&&(a.material={layers:new Re}),"materials"in i&&(a.materials=i.materials.map(c=>({layers:new Re})))):tr.is(i.type)&&(a.perspective={},a.orthographic={}),a},o9.toOps=function(i,s){let a,c=[],u={orthographic:0,perspective:0,geometry:0};function l(d,p){for(let[f,m]of Object.entries(p.layers)){let{texture:h,...y}=m;if(void 0!==h&&Object.keys(h).length>0){let g={path:[...d,"layers",f,"texture"],props:h,type:0};c.push(g)}if(Object.keys(y).length>0){let g1={path:[...d,"layers",f],props:y,type:0};c.push(g1)}}}for(let[d,p]of Object.entries(s))if("name"!==d){if("cloner"===d)c.push(...Za.toOps(p,["cloner"]));else if("pathSnapping"===d)c.push({path:[d],props:{slide:p.slide,offset:p.offset},type:0});else if("material"===d)l(["material"],p);else if("materials"===d)for(let[f,m]of Object.entries(p))l(["materials",f],m);else if(0===u[d]){if("geometry"===d&&void 0!==p.extrusion){let f1={path:[d,"extrusion"],props:p.extrusion,type:0};c.push(f1),delete(p={...p}).extrusion}if(Object.keys(p).length>0){let f2={path:[d],props:p,type:0};c.push(f2)}}else void 0===a&&(a={path:[],props:{},type:0},c.push(a)),a.props[d]=p}return c},o9.patch=function(i,s){if(void 0===s)return i;let a={...i};return(Object.assign(a,Wn.merge(a,s)),Object.assign(a,{pathSnapping:Object.assign({},a.pathSnapping,{slide:s.pathSnapping?.slide??a.pathSnapping?.slide??0,offset:s.pathSnapping?.offset??a.pathSnapping?.offset??0})}),tr.is(i.type))?(a.orthographic={...a.orthographic},a.perspective={...a.perspective},s.orthographic?.zoom!==void 0&&(a.orthographic.zoom=s.orthographic.zoom),s.perspective?.zoom!==void 0&&(a.perspective.zoom=s.perspective.zoom),void 0!==s.isUpVectorFlipped&&(a.isUpVectorFlipped=s.isUpVectorFlipped),void 0!==s.targetOffset&&(a.targetOffset=s.targetOffset)):"Mesh"===i.type?("geometry"in s&&Object.assign(a,{geometry:ol.merge(a.geometry,s.geometry)}),(s.material||s.materials)&&(a=function(i,s){if(void 0===s)return i;let a={...i};return"material"in a&&"material"in s&&s.material&&(a.material=jn(a.material,c=>{if("string"!=typeof c)for(let[u,l]of Object.entries(s.material.layers)){let d=c.layers.data(u);d&&wt.patch(d,l)}}).data),a.materials&&s.materials&&(a.materials=jn(a.materials,c=>{for(let u=0;u<a.materials.length;u++){let l=s.materials[u];if("string"!=typeof l)for(let[d,p]of Object.entries(l.layers)){let f=c[u]?.layers?.data(d);f&&wt.patch(f,p)}}}).data),a}(a,s)),a.cloner&&"cloner"in s&&Object.assign(a,{cloner:_r.merge(a.cloner,s.cloner)})):"Empty"===i.type?a.cloner&&"cloner"in s&&Object.assign(a,{cloner:_r.merge(a.cloner,s.cloner)}):Qa.is(i.type)&&(void 0!==s.intensity&&(a.intensity=s.intensity),void 0!==s.color&&("string"==typeof s.color?a.color=s.color:a.color=rt.clone(s.color))),a},($n||($n={})).defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0},(Pr||(Pr={})).defaultData={orbitControls:$n.defaultData,playPage:vo,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((e,t)=>{let o=0,i=0;return t<5?i=-30:t<10&&(i=30),0===t||10===t||5===t?o=30:(4===t||11===t||9===t)&&(o=-30),[120,[o,i],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,"u">typeof window?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1},(Zc||(Zc={})).defaultData={id:"basic",label:"Basic",style:"None",prompt:""},(Qc||(Qc={})).defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0},(e21=_o||(_o={})).defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...Zc.defaultData},isRandomSeed:!0,seed:e21.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:Qc.defaultData}),e21.generateSeed=()=>Math.round(1e5*Math.random()),(e22=ah||(ah={})).physicsEnabled=function(t){return void 0!==t.find(o=>"Page"===o.data.type&&o.data.globalPhysics.usePhysics)},e22.traverseModuleInstances=function(t,o,i){t.traverseFrom(o,(s,a)=>{if("Instance"===a.type){let c=t.data(a.component);c&&i(s,a,c.events)}else i(s,a,a.events)})},(a=>{function r(c={withLight:!0,withSquare:!0}){let u=[],l=ll.defaultMeshObject;!0===c.withLight&&u.push({fi:-1,data:al.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),!0===c.withSquare&&u.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:l,children:[]});let d=new Be;return d.push({fi:1,id:vo,data:{...Kr.defaultData,name:"Scene 1"},children:u}),d}function i(c){return{...a.defaultData,objects:er(c,Be.prototype)}}a.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",a.defaultData={objects:r(),publish:Pr.defaultData,styles:_o.defaultData()},a.emptyDataWithoutPage=function(){return{objects:new Be,publish:Pr.defaultData,styles:_o.defaultData()}},a.emptyDataWithPage=function(c){return{objects:r(c),publish:Pr.defaultData,styles:_o.defaultData()}},a.withObjs=i,a.withObj=function(c,u){return i([{id:c,data:u,children:[],fi:0}])}})(cl||(cl={})),(Yn||(Yn={})).emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"},(t8=dl||(dl={})).defaultColors=function(){let o={};return o["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},er(o,Me.prototype)},t8.defaultImages=function(o){let i={};return o?.withAITexture&&(i["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...Yn.emptyImage,name:"AI generated image"}),er(i,Me.prototype)},t8.emptyData=function(){return{materials:new Me,images:new Me,videos:new Me,colors:new Me,audios:new Me,fonts:new Me}},(ul||(ul={})).list=["idle","move","jump","run"],(e23=pl||(pl={})).defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e23.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e23.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new me,move:new me,jump:new me,run:new me},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:St.fromHexAndA(3728051,1)}};var Ui=sa(wh()),aP=.5*(Math.sqrt(3)-1),fs=(3-Math.sqrt(3))/6,lP=1/3,Tr=1/6,ms=n=>0|Math.floor(n),_h=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),td=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function ml(n=Math.random){let r=Th(n),e=new Float64Array(r).map(o=>_h[o%12*2]),t=new Float64Array(r).map(o=>_h[o%12*2+1]);return function(i,s){let a=0,c=0,u=0,l=(i+s)*aP,d=ms(i+l),p=ms(s+l),f=(d+p)*fs,y=i-(d-f),g=s-(p-f),x,b;y>g?(x=1,b=0):(x=0,b=1);let w=y-x+fs,S=g-b+fs,P=y-1+2*fs,_=g-1+2*fs,v=255&d,N=255&p,T=.5-y*y-g*g;if(T>=0){let A=v+r[N],R=e[A],U=t[A];T*=T,a=T*T*(R*y+U*g)}let C=.5-w*w-S*S;if(C>=0){let A1=v+x+r[N+b],R1=e[A1],U1=t[A1];C*=C,c=C*C*(R1*w+U1*S)}let O=.5-P*P-_*_;if(O>=0){let A2=v+1+r[N+1],R2=e[A2],U2=t[A2];O*=O,u=O*O*(R2*P+U2*_)}return 70*(a+c+u)}}function Th(n){let e=new Uint8Array(512);for(let t=0;t<256;t++)e[t]=t;for(let t1=0;t1<255;t1++){let o=t1+~~(n()*(256-t1)),i=e[t1];e[t1]=e[o],e[o]=i}for(let t2=256;t2<512;t2++)e[t2]=e[t2-256];return e}var o7,e18,e19,o8,e20,i6,o9,e21,e22,t8,e23,It,Un,Hn,tl,ds,ol,wo,nl,il,$c,Yc,Xc,us,Kc,sl,nh,Wn,gt,ih,sh,ko,Uo,al,qn,Xr,Kr,ll,Ho,$n,Pr,Zc,Qc,_o,ah,cl,Yn,dl,ul,pl,Xn,rr=new three__WEBPACK_IMPORTED_MODULE_0__.CJI,hl=class{constructor(r){this.weightAttribute=null;let e=r.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let r=this.positionAttribute,e=new Float32Array(r.count/3);for(let o=0;o<r.count;o+=3){let i=1;rr.a.fromBufferAttribute(r,o),rr.b.fromBufferAttribute(r,o+1),rr.c.fromBufferAttribute(r,o+2),i*=rr.getArea(),e[o/3]=i}this.distribution=new Float32Array(r.count/3);let t=0;for(let o1=0;o1<e.length;o1++)t+=e[o1],this.distribution[o1]=t;return this}setRandomGenerator(r){return this.randomFunction=r,this}sample(r,e){if(this.distribution){let t=this.distribution[this.distribution.length-1],o=this.binarySearch(this.randomFunction()*t);return this.sampleFace(o,r,e)}}binarySearch(r){if(!this.distribution)return 0;let e=this.distribution,t=0,o=e.length-1,i=-1;for(;t<=o;){let s=Math.ceil((t+o)/2);if(0===s||e[s-1]<=r&&e[s]>r){i=s;break}r<e[s]?o=s-1:t=s+1}return i}sampleFace(r,e,t){let o=this.randomFunction(),i=this.randomFunction();return o+i>1&&(o=1-o,i=1-i),rr.a.fromBufferAttribute(this.positionAttribute,3*r),rr.b.fromBufferAttribute(this.positionAttribute,3*r+1),rr.c.fromBufferAttribute(this.positionAttribute,3*r+2),e.set(0,0,0).addScaledVector(rr.a,o).addScaledVector(rr.b,i).addScaledVector(rr.c,1-(o+i)),rr.getNormal(t),this}},Ch=sa(Ah()),uP=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,pP=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,fP=new three__WEBPACK_IMPORTED_MODULE_0__.yGw;(Xn||(Xn={})).is=function(e){return e&&e.__isSPEObject};var Kn=n=>class extends n{constructor(){super(...arguments),this.previousModelViewMatrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.copyPreviousMatrix=!0,this.hiddenMatrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.matrixWorldRigid=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.shearScale=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.shearScaleInv=new three__WEBPACK_IMPORTED_MODULE_0__.yGw}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof three__WEBPACK_IMPORTED_MODULE_0__.Tme&&(t=t.uuid);let o=this;for(;o.parent;){if(o.parent.uuid===t)return!0;o=o.parent}return!1}updateMatrixWorld(t){for(let o of(this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0),this.children))o.updateMatrixWorld(t)}updateWorldMatrix(t,o){let i=this.parent;if(t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),o)for(let s of this.children)s.updateWorldMatrix(!1,!0)}traverseChildren(t,o=0){for(let i of this.children)Xn.is(i)&&i.traverseObject(t,o+1)}traverseObject(t,o=0){if(!0!==t(this,o))for(let s of this.children)Xn.is(s)&&s.traverseObject(t,o+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,o=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:i,v:s,q:a}=(0,Ch.SVD)(o),c=uP.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),u=pP.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),l=fP.copy(u).transpose();this.shearScale.makeScale(a[0],a[1],a[2]).multiply(l).premultiply(u),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(c,l).copyPosition(this.matrixWorld),a.every(d=>.01>Math.abs(a[0]-d))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,o){this.updateWorldMatrix(!0,!1);let i=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().copy(this.matrixWorld).invert();return null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),i.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof three__WEBPACK_IMPORTED_MODULE_0__.yGw?t.hiddenMatrix.premultiply(i):t.applyMatrix4(i),t.updateWorldMatrix(!1,!1),this.add(t),void 0!==o&&(this.children.pop(),this.children.splice(o,0,t)),this}copy(t,o=!1){return super.copy(t,o),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,o,i,s,a,c){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},rd=class extends Kn(three__WEBPACK_IMPORTED_MODULE_0__.Tme){},hP=n=>"Mesh"===n.type,Jr=class extends rd{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let o=this.children[e];o?.object!==t&&(o&&this.remove(o),o=new Jr(t),this.add(o),this.children.splice(e,0,this.children.pop()),o.matrixWorldNeedsUpdate=!0,o.matrixAutoUpdate=!1,o.matrix=t.matrix,o.hiddenMatrix=t.hiddenMatrix),o.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&this.object.dataPatched.cloner?.hideBase===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return hP(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Wo=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,qo=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Zn=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Ih=[new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-1,1,1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-1,-1,1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,-1,1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,1,1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-1,1,-1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-1,-1,-1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,-1,-1),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,1,-1)],xP=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],vP=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Nh=(n,r,e)=>{n.updateEntityBoxSize(Wo,qo),Zn.copy(r).multiply(n.matrixWorld),0===qo.x&&0===qo.y&&0===qo.z?e.push(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(Wo.x,Wo.y,Wo.z).applyMatrix4(Zn)):Ih.forEach(t=>{e.push(t.clone().multiply(qo).add(Wo).applyMatrix4(Zn))})},hs=class extends three__WEBPACK_IMPORTED_MODULE_0__.ZzF{constructor(){super(...arguments),this.matrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let o=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,o,t)}expandByObjectSize(e,t,o=!1){let i=[];return!0===o?e.traverseEntity(s=>{if(s.visible||s.cloner&&s.data.visible){if(!("geometry"in s)){i.push(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4);return}Nh(s,t,i)}}):Nh(e,t,i),this.setFromPoints(i)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4(Zn.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(qo).multiplyScalar(.5),this.getCenter(Wo),Zn.copy(this.matrix).setPosition(Wo),this.vertices=Ih.map(e=>e.clone().multiply(qo).applyMatrix4(Zn))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=xP.map(([e,t])=>new three__WEBPACK_IMPORTED_MODULE_0__.Zzh(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=vP.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},or={Cloner(){},changeEntityProptotype(){},createEntity(){}},sd=class extends three__WEBPACK_IMPORTED_MODULE_0__.Wqd{constructor(){super()}getPoints(r=12){let e=[],t,o=this.getCurveLengths(),s=o[o.length-1]/o.length;for(let a=0,c=this.curves;a<c.length;a++){let u=c[a],d=Math.ceil(r*(0===a?o[a]:o[a]-o[a-1])/s),p=u.getPoints(d);for(let f=0;f<p.length;f++){let m=p[f];t&&t.equals(m)||(e.push(m),t=m)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}};function ld(n,r,e){return .001>=r.clone().sub(n).cross(r.clone().sub(e)).length()}function id(n,r){let e=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.position),t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.controlNext.position),o=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...r.controlPrevious.position),i=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...r.position);return ld(e,t,i)&&ld(e,o,i)}function gl(n){let r=n.points.map(l=>new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...l.data.position)),e=[n.points[0]],t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...e[0].data.position);for(let l=0;l<n.points.length-1;l++)ld(t,r[l],r[l+1])||(e.push(n.points[l]),t=r[l]);e.push(n.points[n.points.length-1]);let o=n.isClosed,i=e.length-(o?0:1),s=e.length,a=[];for(let l1=0;l1<s;l1++){let d=e[l1].data,p=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...d.position),f=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...d.controlPrevious.position),m=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...d.controlNext.position),h={position:p,baseRoundness:d.roundness,controlPrevious:f,controlNext:m};if(0===d.roundness||!n.isClosed&&(0===l1||l1===s-1)){a[l1]={...h,removedLength:0};continue}let y=o&&0==l1?s-1:l1-1,g=o&&l1==s-1?0:l1+1,x=e[y].data,b=e[g].data,w=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...x.position),S=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...b.position),P=w.clone().sub(p).normalize(),_=S.clone().sub(p).normalize();Object.assign(h,{prevDir:P,nextDir:_});let v=id(x,d),N=id(d,b);if(v&&N){let T=P.clone().add(_).normalize(),C=T.clone().cross(P).length()/P.dot(T);a[l1]={...h,tan:C,removedLength:d.roundness/C}}else a[l1]={...h,removedLength:0}}for(let l2=0;l2<i;l2++){let d1=l2,p1=o&&l2===s-1?0:l2+1,f1=a[d1],m1=a[p1];if(0!==f1.removedLength||0!==m1.removedLength){let h1=f1.position.distanceTo(m1.position);f1.removedLength=Math.min(f1.removedLength,h1/2),m1.removedLength=Math.min(m1.removedLength,h1/2)}}let c=[];for(let l3=0;l3<i;l3++){let d2=l3,p2=o&&l3===s-1?0:l3+1,f2=a[d2],m2=a[p2],h2=null;if(id(e[d2].data,e[p2].data)){let y1=f2.position.clone(),g1=m2.position.clone();(0!==f2.removedLength||0!==m2.removedLength)&&(f2.nextDir&&y1.add(f2.nextDir.clone().setLength(f2.removedLength)),m2.prevDir&&g1.add(m2.prevDir.clone().setLength(m2.removedLength))),y1.distanceTo(g1)>.001&&(h2=new three__WEBPACK_IMPORTED_MODULE_0__.yj7(y1,y1.clone().lerp(g1,.3),g1.clone().lerp(y1,.3),g1))}else f2.position.distanceTo(m2.position)>.001&&(h2=new three__WEBPACK_IMPORTED_MODULE_0__.yj7(f2.position,f2.controlNext,m2.controlPrevious,m2.position));c[2*l3+1]=h2}for(let l4=0;l4<s;l4++){let d3=a[l4];if(0===d3.removedLength){c[2*l4]=null;continue}let p3=d3.position,f3=d3.prevDir.clone().multiplyScalar(d3.removedLength).add(p3),m3=d3.nextDir.clone().multiplyScalar(d3.removedLength).add(p3),h3=d3.tan*d3.removedLength,y2=d3.prevDir.clone().add(d3.nextDir).normalize(),g2=f3.clone().lerp(m3,.5),x1=f3.distanceTo(m3)/2,b1=y2.clone().multiplyScalar(Math.sqrt(Math.pow(h3,2)-Math.pow(x1,2))).add(g2),w1=y2.clone().multiplyScalar(-h3).add(b1),S1=p3.distanceTo(w1)/p3.distanceTo(g2),P1=d3.prevDir.clone().multiplyScalar(S1*p3.distanceTo(f3)).add(p3),_1=P1.clone().lerp(w1,2),v1=f3.clone().lerp(P1,4/3),N1=m3.clone().lerp(_1,4/3);c[2*l4]=new three__WEBPACK_IMPORTED_MODULE_0__.yj7(f3,v1,N1,m3)}let u=new sd;return c.forEach(l=>{l&&u.add(l)}),u}(Se||(Se={})).is=function(e){return e&&e.__isEntity};var Qn=n=>Se.is(n),_P={type:"completeState",isfromEntity:!0},Jn=n=>class extends Kn(n){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new hs,this._recursiveBBox=new hs,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let o=this.children[t];if(Se.is(o))return o}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Se.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let t=this;for(;"Instance"!==t.data.type;){let o=t.parent;if(!Se.is(o))return;t=o}return t}forInstancesRec(t){this.instances.forEach(o=>{o.disposed||t(o),o.forInstancesRec(t)})}super_Entity(t,o){"string"==typeof t&&(this.uuid=t),this.identity=t,this.data=o,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,o,i=!1){if(!(0===this.data.states.length&&!i)){for(let s of this.data.states)Ho.toOps(this.data,s.data).forEach(c=>{let u=Ba.replaceProps(c,this.data);this.dataPatched=this.data,this.updateByPatchedOp(u,this.data,o)});if(null!==t){let s1=this.data.states.data(t);s1&&(this.dataPatched=Ho.patch(this.data,s1),Ho.toOps(this.data,s1).forEach(c=>{this.updateByPatchedOp(c,this.dataPatched,o)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,o){t.setScalar(0),o.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Qn(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let o;return this.traverseEntity(i=>{i.uuid===t&&(o=i)}),o}traverseSortNextHelper(){let t=this.parent;if(t){let o=t.children,i=o.indexOf(this)+1;if(Se.is(o[i]))return o[i];if(Se.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Se.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let o=this;for(;t>0&&null!==o;)o=o.parent,t-=1;return o}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let o=this.parent;for(;o;){if(t===o)return!0;o=o.parent}return!1}countToAccestor(t){let o=0,i=this;for(;i!==t;){if(null===i)return -1;i=i.parent,o+=1}return o}forEachEntity(t){for(let o of this.children)Qn(o)&&t(o)}traverseEntityAncestors(t){this.traverseAncestors(o=>{Se.is(o)&&t(o)})}traverseConcreteEntity(t,o=0){if(!0!==t(this,o))for(let s of this.children)Qn(s)&&s.isConcreteEntity&&s.traverseEntity(t,o+1)}traverseEntity(t,o=0){if(!0!==t(this,o))for(let s of this.children)Qn(s)&&s.traverseEntity(t,o+1)}traverseVisibleEntity(t){for(let o of(t(this),this.children))Qn(o)&&o.visible&&o.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}copy(t,o=!1){return super.copy(t,o),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Qn(t))}isAncestorOf(t){if(this.uuid===t)return!1;let o=!1;return this.traverseEntity(i=>{i.uuid===t&&(o=!0)}),o}toObjectTransformState(t=[]){return this.updateWorldMatrix(!0,!1),k1({position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()},t)}updateTransformState(t){let o=!1;return t.position&&(this.position.fromArray(t.position),o=!0),t.rotation&&(this.rotation.fromArray(t.rotation),o=!0),t.scale&&(o=!0,this.scale.fromArray(t.scale)),void 0!==t.hiddenMatrix&&(o=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??go.identity)),o&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&void 0!==t.hiddenMatrix&&this.updateWorldMatrix(!1,!0),o}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Se.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Se.is(t)&&t.disposeRecursively()})}toState(t=[]){return k1({name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)},t)}updateByObjUpdateOp(t,o){this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},o,!1)}updateByOp(t,o,i,s){let a=this.data;this.data=o;let c=t,u=yt(t.path,["states","*"]);if(null!==u){if(0===t.type){let[l]=u;if(this?.stateSelection===l){let d={...t.props};if(Object.values(t.props).some(p=>void 0===p)){let p=this.data;if(void 0!==p){let f=vt.zoom(p,t.path.slice(2));if(f)for(let m in t.props)void 0===t.props[m]&&m in f&&(d[m]=f[m])}}c={...t,props:d,path:t.path.slice(2)}}}}else if(0===t.type){let l1=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==l1){if(void 0!==t.props.name&&l1.name){let{name:p1,...f1}=l1;l1=f1}if(void 0!==t.props.material&&"material"in l1){let{material:p2,...f2}=l1;l1=f2}let d1=vt.removeOverridden(t.path,t.props,l1);c={...t,props:d1}}}if(this.updateByPatchedOpBase(c,Ho.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i),yt(t.path,["overrides"])){let l2=[],d2=[...t.path];for(l2.push(d2[1]),d2.splice(0,2);d2.length>0&&"descendants"===d2[0];)l2.push(d2[1]),d2.splice(0,2);if(void 0===l2[l2.length-1]){if(0===t.type)for(let p3 of Object.keys(t.props)){l2[l2.length-1]=p3;let f3=i.scene.findInstance([this.uuid,...l2]);f3&&(f3.overrideData=t.props[p3],f3.updateState(xr.apply(f3.component.data,f3.overrideData),i))}}else{let p4=i.scene.findInstance([this.uuid,...l2]);if(p4){let f4=vt.zoom(p4.component.data,d2);if(0===(t={...t,path:d2}).type){let m1=t.props;if(f4)for(let[h,y]of Object.entries(t.props))void 0===y&&(m1===t.props&&(m1={...t.props}),m1[h]=f4[h]);t={...t,props:m1}}p4.overrideData=qn.resolve(o.overrides,l2),p4.updateByOp(t,dt.applySimple(p4.data,t),i,!1)}}}else if(this.instances.length>0){let l3;if(0===t.path.length&&0===t.type){let d3;for(let p5 of Xr.rootOverrideProps)p5 in t.props&&(void 0===d3&&(d3={}),d3[p5]=t.props[p5]);d3&&(l3={...t,props:d3})}else for(let d4 of Xr.rootOverrideProps)if(yt(t.path,[d4])){l3=t;break}void 0!==l3&&this.instances.forEach(d=>{if(d.isInstanceRoot){let p=xr.filterOp(d.overrideData,l3);p&&d.updateByOp(p,dt.applySimple(d.data,p),i,!0)}}),this.instances.forEach(d=>{if(!d.isInstanceRoot){let p=xr.filterOp(d.overrideData,t);if(p){let f;f=a===d.data&&t===p?o:dt.applySimple(d.data,p),d.updateByOp(p,f,i,!0)}}})}}updateByPatchedOpBase(t,o,i){if(this.dataPatched=o,0===t.path.length&&0===t.type)void 0===t.props.type||tr.is(t.props.type)||or.changeEntityProptotype(this,o,i);else if(1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&"type"in t.props)for(let s of(or.changeEntityProptotype(this,o,i),this.children))Se.is(s)&&s.updateVisible();this.updateByPatchedOp(t,o,i)}updateByPatchedOp(t,o,i){if(0===t.path.length&&0===t.type&&this.updateState(t.props,i),null!==yt(t.path,["pathSnapping"])&&this.updatePathSnapping(o.pathSnapping),null!==yt(t.path,["cloner"])){let s=dt.drop(t,1);0===s.path.length&&0===s.type&&!0===s.props.disabled?this.setFromClonerState(null,i):this.cloner?this.cloner.updateState(o.cloner,i.scene):(this.setFromClonerState(o.cloner,i),this.expandCloner(i.scene)),this.updateVisible()}}updatePathSnapping(t){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let o=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,i=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,s=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset,a=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===o)return;let c=t.find(o);if(!c||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let u=c.data;if(u.geometry.path.points.length<=1)return;let l=gl(u.geometry.path),d=(i+s)%1;i+s===1&&0===d&&(d=1);let p=l.getPointAt(d),f=this.parent?this.parent?.matrixWorld:new three__WEBPACK_IMPORTED_MODULE_0__.yGw;c.updateMatrixWorld();let m=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().multiplyMatrices(f.clone().invert(),c.matrixWorld);p.applyMatrix4(m);let h={position:p.toArray(),rotation:u.rotation};if("tangential"===a){let y=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().extractRotation(c.matrixWorld),g=l.getTangentAt(d).applyMatrix4(y).add(p),x=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().lookAt(p,g,new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0)),b=new three__WEBPACK_IMPORTED_MODULE_0__.USm().setFromRotationMatrix(x);h={...h,rotation:[b.x,b.y,b.z]}}this.updateTransformState(h),this.traverseEntity(y=>{y._cameraType&&y.dispatchEvent(_P)})}updateVisible(){this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||this.dataPatched.cloner?.hideBase!==!0)}updateState_Entity(t,o){void 0!==t.name&&(this.name=t.name),void 0!==t.raycastLock&&(this.raycastLock=t.raycastLock),void 0!==t.visible&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),o&&"cloner"in t&&void 0!==t.cloner&&(this.setFromClonerState(t.cloner,o),this.updateVisible()),this.updateTransformState(t)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof or.Cloner&&"toObject"===t.parameters.type)}setFromClonerState(t,o){this.disposed||(null===t||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new or.Cloner(this,t),o.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,o.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}},Eh=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},n.parameters),t=e.width/2,o=e.radiusTop??t,i=e.radiusBottom??t;return o===i?(o=t,i=t):o>i?(o=t,i=i*t/o):(o=o*t/i,i=t),{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width),radiusTop:o,radiusBottom:i})}}static build(n){let{width:r,depth:e,height:t,radialSegments:o,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:c,radiusTop:u,radiusBottom:l,cornerRadius:d,cornerSegments:p,hollow:f}=n.parameters,m;return(m=d||f?new ys(u,l,t,o,i,s,a,c*Math.PI/180,d,d,p,f):new three__WEBPACK_IMPORTED_MODULE_0__.fHI(u,l,t,o,i,s,a,c*Math.PI/180)).scale(1,1,e/r),Object.assign(m,{userData:{...n,type:"CylinderGeometry"}})}};function Po(n,r,e){e.x=n.x*r.x,e.y=n.y,e.z=n.x*r.y}function Mh(n){return new three__WEBPACK_IMPORTED_MODULE_0__.FM8(n.y,-n.x)}var ys=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(r,e,t,o,i,s,a,c,u,l,d,p,f=!1){super(),this.type="RoundedCylinderBufferGeometry",r=void 0!==r?r:1,e=void 0!==e?e:1,t=t||1,o=Math.floor(o)||8,i=Math.floor(i)||1,s=void 0!==s&&s,a=void 0!==a?a:0,c=void 0!==c?c:2*Math.PI,s&&(u=0,l=0);let m=[],h=[],y=[],g=[],x=0,b=t/2,w=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,S=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;f&&0==r&&(r=u),f&&0==e&&(e=l);let P=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(r,b),_=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(e,-b),v=null,N=null,T=null,C=null,O=P.clone().sub(_),A=0,R=0,U=0;p>0&&(A=Math.min(r,e)*(1-p),R=r-A,U=e-A);let $=P.clone();$.x-=A;let ee=Math.PI-O.angle(),X=O.angle(),q=Math.tan(X/2),H=Math.tan(ee/2),V=q+H;if(u=Math.min(u,(r-R)/(p?V:H),O.length()/V),l=Math.min(l,(e-U)/(p?V:q),O.length()/V),u>0){let F=u/q;v=P.clone().sub(new three__WEBPACK_IMPORTED_MODULE_0__.FM8(F,u)),p&&(T=v.clone(),T.x-=A-V*u),P.sub(O.clone().setLength(F))}if(l>0){let F1=l/H;N=_.clone().sub(new three__WEBPACK_IMPORTED_MODULE_0__.FM8(F1,-l)),_.add(O.clone().setLength(F1)),p&&(C=N.clone(),C.x-=A-V*l,$.sub(O.clone().setLength(F1)))}let L=.5>(O=P.clone().sub(_)).length(),B=[];for(let F2=0;F2<=o;F2++){let M=[],Q=F2/o,re=Q*c+a,oe=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(re),Math.cos(re));if(C&&N?(K(M,Q,oe,ee,l,C,-1,!0),K(M,Q,oe,X,l,N,-1,!1)):N?(W(M,oe,N.x,0,-1),K(M,Q,oe,X,l,N,-1,!1)):s||W(M,oe,e,U,-1),Po(Mh(O).normalize(),oe,w),!L)for(let te=0;te<=i;te++){let J=te/i;Po(O.clone().multiplyScalar(J).add(_),oe,S),h.push(S.x,S.y,S.z),y.push(w.x,w.y,w.z),g.push(Q,.5+S.y/t),M.push(x++)}if(T&&v?(K(M,Q,oe,ee,u,v,1,!1),K(M,Q,oe,X,u,T,1,!0)):v?(K(M,Q,oe,ee,u,v,1,!1),W(M,oe,v.x,0,1)):s||W(M,oe,r,R,1),p&&!L){Po(Mh(O).multiplyScalar(-1).normalize(),oe,w);for(let J1=0;J1<=i;J1++){let ie=J1/i;Po(O.clone().multiplyScalar(-ie).add($),oe,S),h.push(S.x,S.y,S.z),y.push(w.x,w.y,w.z),g.push(Q,.5+S.y/t),M.push(x++)}}p&&!s&&M.push(M[0]),B.push(M)}for(let F3=0;F3<B.length-1;F3++)for(let M1=0;M1<B[0].length-1;M1++){if(s&&p&&M1==i)continue;let Q1=B[F3][M1],re1=B[F3+1][M1],oe1=B[F3+1][M1+1],Z=B[F3][M1+1],te1=h[3*oe1+0],J2=h[3*oe1+2];m.push(Q1,re1,Z),(0!=te1||0!=J2)&&m.push(re1,oe1,Z)}function K(F,M,Q,re,oe,Z,te,J){for(let ie=0;ie<d+1;ie++){let ce=ie/d,se=te<0?ce:1-ce;J&&(se-=1),se*=re;let fe=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(se),Math.cos(se)*te);Po(fe.clone().multiplyScalar(oe).add(Z),Q,S),h.push(S.x,S.y,S.z),Po(fe,Q,w),y.push(w.x,w.y,w.z),g.push(M,.5+S.y/t),F.push(x++)}}function W(F,M,Q,re,oe){let Z=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,te=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,J=[Q,re];for(let ie of(oe<0&&J.reverse(),J))te.set(ie,b*oe),Po(te,M,Z),h.push(Z.x,Z.y,Z.z),y.push(0,oe,0),g.push(.5,.5),F.push(x++)}function j(F,M,Q){let re=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(Q),Math.cos(Q)),oe=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(-Math.cos(Q),Math.sin(Q)),Z=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,te=F<0?(ce,se,fe)=>m.push(ce,se,fe):(ce,se,fe)=>m.push(ce,fe,se);Po(new three__WEBPACK_IMPORTED_MODULE_0__.FM8((r+e+R+U)/4,0),re,Z),h.push(Z.x,Z.y,Z.z),y.push(oe.x,0,oe.y),g.push(.5,.5);let ie=x++;for(let ce of M){let se=h.slice(3*ce,3*ce+3);h.push(...se),y.push(oe.x,0,oe.y);let fe=g.slice(2*ce,2*ce+2);g.push(...fe),x++}for(let ce1=ie+1;ce1<x-1;ce1++)te(ie,ce1,ce1+1);te(ie,x-1,ie+1)}c<2*Math.PI&&(j(-1,B[0],a),j(1,B[B.length-1],a+c)),this.setIndex(m),this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(h,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(y,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(g,2))}},Lh=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r,depth:e,height:t,radialSegments:o,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:c,cornerRadiusTop:u,cornerRadiusBottom:l,cornerSegments:d}=n.parameters,p;return(p=u>0||l>0||c<360?new ys(0,r/2,t,o,i,s,a,c*Math.PI/180,u,l,d,0,!0):new three__WEBPACK_IMPORTED_MODULE_0__.b_z(r/2,t,o,i,s)).scale(1,1,e/r),Object.assign(p,{userData:{...n,type:"ConeGeometry"}})}},Dh=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r,height:e,depth:t,widthSegments:o,heightSegments:i,depthSegments:s,cornerRadius:a,cornerSegments:c}=n.parameters;return Object.assign(0==a?new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(r,e,t,o,i,s):new pd(r,e,t,o,i,s,a,c),{userData:{...n,type:"CubeGeometry"}})}},ud=Math.PI/2,pd=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(r=1,e=1,t=1,o=1,i=1,s=1,a=0,c=4){super(),this.type="BoxGeometry";let u=this;o=Math.floor(o),i=Math.floor(i),s=Math.floor(s),c=Math.floor(c),a=Math.min(a,r/2,e/2,t/2);let l=[],d=[],p=[],f=[],m=0,h=0;function y(b,w,S,P,_,v,N,T,C,O,A){let R=(v-2*a)/C,U=(N-2*a)/O,$=v/2-a,ee=N/2-a,X=T/2,q=C+1,H=O+1,V=0,G=0,D=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let L=0;L<H;L++){let B=L*U-ee;for(let K=0;K<q;K++){let W=K*R-$;D[b]=W*P,D[w]=B*_,D[S]=X,d.push(D.x,D.y,D.z),D[b]=0,D[w]=0,D[S]=T>0?1:-1,p.push(D.x,D.y,D.z),f.push(K/C),f.push(1-L/O),V+=1}}for(let L1=0;L1<O;L1++)for(let B1=0;B1<C;B1++){let K1=m+B1+q*L1,W1=m+B1+q*(L1+1),j=m+(B1+1)+q*(L1+1),F=m+(B1+1)+q*L1;l.push(K1,W1,F),l.push(W1,j,F),G+=6}u.addGroup(h,G,A),h+=G,m+=V}function g(b,w,S,P,_,v,N,T,C,O,A){let R=(N-2*a)/O,U=N/2-a,$=T/2-a,ee=C/2,X=O+1,q=0,H=0,V=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,G=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let D=0;D<c+1;D++){let L=D/c*ud,B=Math.sin(L)*a,K=(1-Math.cos(L))*a,W=Math.sin(L),j=Math.cos(L);V[w]=($+B)*_,V[S]=(ee-K)*v,G[b]=0,G[w]=W*Math.sign(V[w]),G[S]=j*Math.sign(V[S]);for(let F=0;F<X;F++){let M=F*R-U;V[b]=M*P,d.push(V.x,V.y,V.z),p.push(G.x,G.y,G.z),f.push(F/O),f.push(0),q+=1}}for(let D1=0;D1<c;D1++)for(let L1=0;L1<O;L1++){let B1=m+L1+X*D1,K1=m+L1+X*(D1+1),W1=m+(L1+1)+X*(D1+1),j1=m+(L1+1)+X*D1;l.push(B1,K1,j1),l.push(K1,W1,j1),H+=6}u.addGroup(h,H,A),h+=H,m+=q}function x(b,w,S){let P=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,_=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(r/2,e/2,t/2);_.subScalar(a);let v=[],N=b*w*S>0?(C,O,A)=>l.push(C,O,A):(C,O,A)=>l.push(C,A,O);for(let C=0;C<=c;C++){let O=[],A=ud*(1-C/c),R=Math.cos(A),U=Math.sin(A),$=0;for(let ee=0;ee<=C;ee++){let X=Math.cos($),q=Math.sin($);P.x=R*X,P.y=U,P.z=R*q;let H=_.clone().addScaledVector(P,a);d.push(b*H.x,w*H.y,S*H.z),p.push(b*P.x,w*P.y,S*P.z),f.push(0,0),O.push(m++),$+=ud/C}v.push(O)}let T=v.length-1;for(let C1=0;C1<T;C1++){let O1=v[C1],A1=v[C1+1],R1=O1.length-1;N(O1[0],A1[1],A1[0]);for(let U1=1;U1<=R1;U1++)N(O1[U1-1],O1[U1],A1[U1]),N(O1[U1],A1[U1+1],A1[U1])}}y("z","y","x",-1,-1,t,e,r,s,i,0),y("z","y","x",1,-1,t,e,-r,s,i,1),y("x","z","y",1,1,r,t,e,o,s,2),y("x","z","y",1,-1,r,t,-e,o,s,3),y("x","y","z",1,-1,r,e,t,o,i,4),y("x","y","z",-1,-1,r,e,-t,o,i,5),a>0&&(g("z","y","x",-1,-1,1,t,e,r,s,0),g("z","y","x",1,-1,-1,t,e,r,s,1),g("z","y","x",-1,1,-1,t,e,r,s,1),g("z","y","x",1,1,1,t,e,r,s,0),g("x","y","z",-1,-1,-1,r,e,t,o,0),g("x","y","z",1,-1,1,r,e,t,o,1),g("x","y","z",-1,1,1,r,e,t,o,0),g("x","y","z",1,1,-1,r,e,t,o,1),g("y","x","z",-1,-1,1,e,r,t,i,0),g("y","x","z",1,-1,-1,e,r,t,i,1),g("y","x","z",1,1,1,e,r,t,i,1),g("y","x","z",-1,1,-1,e,r,t,i,0),x(1,1,1),x(-1,1,1),x(1,-1,1),x(-1,-1,1),x(1,1,-1),x(-1,1,-1),x(1,-1,-1),x(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(d,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(p,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(f,2))}},To=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(r=[],e=[],t="",o=1,i=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],c=[],u=[];(function(){0==(i=Math.min(1-1e-5,i))&&(s=0);let f={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[t],m=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,h=m.clone(),y=new three__WEBPACK_IMPORTED_MODULE_0__.CJI,g=i*o,x=o-g,b=s+1,w=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,S=(q,H)=>w.subVectors(q,H).normalize(),P=(q,H)=>Array(q).fill(void 0).map(H),_=P(r.length/3,(q,H)=>new three__WEBPACK_IMPORTED_MODULE_0__.Pa4().fromArray(r,3*H).setLength(o)),v=[];for(let q=0;q<_.length;q++){let H=_[q],V=[],G,D,L,B=1e10,K=-1;for(;-1!=(K=e.indexOf(q,K+1));){let M=K-K%3;G=e[M+(K+1)%3],D=e[M+(K+2)%3],B=Math.min(B,L=H.distanceToSquared(_[G])),V.push([G,D,L])}B+=1e-6;let W=[],j=0,F=V.length;for(let M1=0;M1<F;M1++){[G,D,L]=V[j];let Q=!0==v[G]?.includes(q);L<=B&&W.push(G+1e6*+Q),j=V.findIndex(re=>re[0]==D)}v.push(W)}let T=[];{let q1=0,H1=0,V1,G1,D1=3==f;for(let L1=0;L1<=s;L1++){V1=L1*(L1+1)/2,G1=(L1+1)*(L1+2)/2;for(let B1=0;B1<s-L1;B1++)[q1,H1]=[V1+B1+L1+2,G1+B1+L1+3],T.push(V1,G1,...D1?[H1,V1]:[q1,G1],H1,q1),[V1,G1]=[q1,H1];T.push(V1,G1,V1+s+2)}}let C=m.clone(),O=m.clone(),A=m.clone(),R=m.clone(),U=m.clone(),$=[],ee=P(_.length,()=>P(f,()=>m.clone()));for(let q2=0;q2<_.length;q2++){m.copy(_[q2]).normalize(),C.copy(m).multiplyScalar(x);let H2=v[q2];for(let W1=0;W1<H2.length;W1++){let j1=H2[W1],F1=H2[(W1+1)%f];y.setFromPointsAndIndices(_,q2,j1%1e6,F1%1e6),y.b.sub(y.a).setLength(1e10).add(y.a),y.c.sub(y.a).setLength(1e10).add(y.a),y.closestPointToPoint(C,ee[q2][W1])}let V2=[],G2=[],D2=[],L2=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;0==s&&[...ee[q2]].reduce((W,j)=>W.add(j),L2).multiplyScalar(1/f);for(let W2=0;W2<f;W2++){let j2=[],F2=(W2-1+f)%f,M2=ee[q2][F2],Q1=ee[q2][W2];m.copy(M2).sub(C),h.copy(Q1).sub(C);let re=C.angleTo(m),oe=m.angleTo(h),Z=Math.cos(re)*g;0==s?O.copy(L2):O.copy(C).setLength(x+Z),G2.push(Z);let te=[O,M2,Q1];for(let J=0;J<2;J++){let ie=te[J],ce=te[J+1];R.subVectors(ie,C),U.subVectors(ce,C),A.crossVectors(R,U).normalize();for(let se=0;se<b;se++){let fe=[re,oe][J]*se/b;m.copy(R).applyAxisAngle(A,fe).add(C),V2.push(m.clone()),J&&(S(m,C),j2.push([0==se?ie:m.clone(),w.clone()]))}J&&(S(ce,C),j2.push([ce,w.clone()]))}D2.push(j2)}$.push(D2);let B2=2*b;for(let W3=0;W3<f;W3++){let j3=B2*W3,F3=B2*((W3+1)%f),M3=[V2[j3]];for(let re1=1;re1<b;re1++){R=V2[j3+re1],U=V2[F3+re1],M3.push(R);for(let oe1=1,Z1=re1-2+1;oe1<=Z1;oe1++)m.lerpVectors(R,U,oe1/(Z1+1)),m.sub(C).setLength(G2[W3]).add(C),M3.push(m.clone());M3.push(U)}for(let re2=0;re2<b;re2++)M3.push(V2[re2+b+j3]);M3.push(V2[F3+b]);let Q2=T.map(re=>M3[re]);a.push(...Q2.map(re=>[re.x,re.y,re.z]).flat()),u.push(...Q2.map(re=>(S(re,C),[w.x,w.y,w.z])).flat())}}let X=[];for(let q3=0;q3<v.length;q3++)for(let H3=0;H3<f;H3++){let V3=v[q3][H3];if(V3<1e6){let G3=v[V3].findIndex(B=>B%1e6==q3),D3=$[q3][H3],L3=$[V3][G3];for(let B3=0;B3<b;B3++){let K1=D3[B3],W4=L3[b-B3],j4=D3[B3+1];[K1,W4,j4,j4,W4,L3[b-(B3+1)]].forEach(M=>{a.push(M[0].x,M[0].y,M[0].z),u.push(M[1].x,M[1].y,M[1].z)})}X.push(D3[0][0],L3[b][0],D3[b][0],L3[0][0])}}for(;X.length;){let q4,H4,V4,G4;[q4,H4]=X.splice(0,2);let D4=[q4];for(;q4!=H4;)D4.push(H4),G4=(V4=X.indexOf(H4))%2,H4=X.splice(V4-G4,2)[1-G4];w.subVectors(D4[0],D4[1]).cross(m.subVectors(D4[0],D4[2])).normalize();let L4=0>w.dot(D4[0]);L4&&w.negate();for(let B4=1;B4<=D4.length-2;B4++)[D4[B4+ +L4],D4[B4+1-+L4],D4[0]].forEach(K=>{a.push(K.x,K.y,K.z),u.push(w.x,w.y,w.z)})}})(),function(){let p=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let _=0;_<a.length;_+=3){p.x=a[_+0],p.y=a[_+1],p.z=a[_+2];let v=S(p)/2/Math.PI+.5,N=Math.atan2(-p.y,Math.sqrt(p.x*p.x+p.z*p.z))/Math.PI+.5;c.push(v,1-N)}let f=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,m=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,h=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,y=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,g=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,x=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,b=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,w=(_,v,N,T)=>{T<0&&1===_.x&&(c[v]=_.x-1),0===N.x&&0===N.z&&(c[v]=T/2/Math.PI+.5)};for(let _1=0,v1=0;_1<a.length;_1+=9,v1+=6){f.set(a[_1+0],a[_1+1],a[_1+2]),m.set(a[_1+3],a[_1+4],a[_1+5]),h.set(a[_1+6],a[_1+7],a[_1+8]),g.set(c[v1+0],c[v1+1]),x.set(c[v1+2],c[v1+3]),b.set(c[v1+4],c[v1+5]),y.copy(f).add(m).add(h).divideScalar(3);let N1=S(y);w(g,v1+0,f,N1),w(x,v1+2,m,N1),w(b,v1+4,h,N1)}for(let _2=0;_2<c.length;_2+=6){let v2=c[_2+0],N2=c[_2+2],T=c[_2+4],C=Math.max(v2,N2,T),O=Math.min(v2,N2,T);C>.9&&O<.1&&(v2<.2&&(c[_2+0]+=1),N2<.2&&(c[_2+2]+=1),T<.2&&(c[_2+4]+=1))}function S(_){return Math.atan2(_.z,-_.x)}}(),this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(a,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(u,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(c,2))}static fromJSON(r){return new To(r.vertices,r.indices,r.radius,r.corner,r.cornerSides)}},Bh=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,detail:0,corner:0,cornerSides:4},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r,height:e,depth:t,detail:o,corner:i,cornerSides:s}=n.parameters,a=0===o&&0!==i?new xs(.5*r,i,s):new three__WEBPACK_IMPORTED_MODULE_0__.Kgo(.5*r,o);return a.scale(1,e/r,t/r),Object.assign(a,{userData:{...n,type:"DodecahedronGeometry"}})}},xs=class extends To{constructor(r=1,e=.2,t=4){let o=(1+Math.sqrt(5))/2,i=1/o,c="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-o,0,-i,o,0,i,-o,0,i,o,-i,-o,0,-i,o,0,i,-o,0,i,o,0,-o,0,-i,o,0,-i,-o,0,i,o,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],c,r,e,t),this.type=c}static fromJSON(r){return new xs(r.radius,r.corner,r.cornerSides)}},ei=class{constructor(r){this.position=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,this.startPosition=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,this.uuid=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),this.position=r.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(r){this.position.copy(this.startPosition).add(r)}copy(r){return this.position.copy(r.position),this.startPosition.copy(r.startPosition),this}clone(){return new ei(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},ti=class extends ei{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new ti(this.parent).copy(this)}},sr=class extends ei{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new ti(this),new ti(this))}static create(e,t){let o=new sr(e,new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...t.position));return o.controls[0].position.set(...t.controlPrevious.position),o.controls[1].position.set(...t.controlNext.position),o.roundness=t.roundness,o.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,o}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let o=0,i=this.controls.length;o<i;o++){let s=this.controls[o];this.position.distanceTo(s.position)<=t?s.position.copy(this.position):s.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new sr(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){return[this.curveBefore?.getTangentAt(1),this.curveAfter?.getTangentAt(0)]}computeNormals(e=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,t=new three__WEBPACK_IMPORTED_MODULE_0__.FM8){let[o,i]=this.computeTangents();return o&&i&&(Rh(o,e),Rh(i,t)),[e,t]}computeTangent(e=new three__WEBPACK_IMPORTED_MODULE_0__.FM8){let[t,o]=this.computeTangents();return t&&o&&e.copy(t).add(o).normalize(),e}computeNormal(e=new three__WEBPACK_IMPORTED_MODULE_0__.FM8){let[t,o]=this.computeNormals();return e.copy(t).add(o).normalize(),e}};function Rh(n,r=new three__WEBPACK_IMPORTED_MODULE_0__.FM8){let e=n.length();return r.set(-n.y/e,n.x/e)}var gd=n=>n,ri=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,wl=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,RP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,GP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,VP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,zP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,zh=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,jh=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;function bs(n,r,e=Number.EPSILON){return Math.abs(n-r)<e}function xd(n,r,e){let t=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)),o=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)),i=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));return Math.acos((o*o+t*t-i*i)/(2*o*t))}function hd(n,r,e){return 0===ri.copy(r).sub(n).cross(wl.copy(e).sub(n))}function vd(n,r){return n.position.equals(n.controls[1].position)&&r.position.equals(r.controls[0].position)}function Gh(n,r){return hd(n.position,n.controls[1].position,r.position)&&hd(n.position,r.controls[0].position,r.position)}function bd(n,r=12,e=!1){let t=[];for(let o=0,i=n.length;o<i;o++){let s=n[o],a=0;if(e&&void 0!==s.roundedCurveCorner){let c=.5*Oo(s.roundedCurveCorner,r);o>0&&(t[o-1]+=c),a+=c}void 0!==s.curveAfter&&(a+=Oo(s.curveAfter,r)),t.push(a)}return n.length>0&&e&&void 0!==n[0].roundedCurveCorner&&(t[n.length-1]+=.5*Oo(n[0].roundedCurveCorner,r)),t}function Oo(n,r=12){return n&&n instanceof three__WEBPACK_IMPORTED_MODULE_0__.Ny0?2*r:n&&(n instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z||n instanceof three__WEBPACK_IMPORTED_MODULE_0__.U7)?1:n&&n instanceof three__WEBPACK_IMPORTED_MODULE_0__.gti?r*n.points.length:r}var _d=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,HP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,WP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,qP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,$P=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,YP=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,_e=class extends three__WEBPACK_IMPORTED_MODULE_0__.bnF{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new three__WEBPACK_IMPORTED_MODULE_0__.JOQ(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,o){let i=new _e;return i.isClosed=e.isClosed,i.points=e.points.map(s=>sr.create(s.id,s.data)),"number"==typeof e.roundness&&(i.roundness=e.roundness),i.shapeHoles=e.shapeHoles.map(s=>_e.createFromState(s)),void 0!==t&&void 0!==o&&i.applySize(t,o),i.update(),i}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,o=this.points.length;t<o;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,o=this.points.findIndex(i=>i.uuid===e);if(o<0){let i=t;for(let s=0,a=this.shapeHoles.length;s<a;s++){let c=this.shapeHoles[s],u=c.points.length,l=c.getPointIndexById(e);if(!(l<0))return l+i;i+=u}}return o}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let o=0,i=this.shapeHoles.length;o<i;o++){let s=this.shapeHoles[o],a=e-t;if(a<=s.points.length-1)return s.points[a];t+=s.points.length}}throw Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let o=0,i=this.shapeHoles.length;o<i;o++){let s=this.shapeHoles[o],a=s.points.indexOf(e);if(a>=0)return t+a;t+=s.points.length}return -1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let o=_d.set(e,t);for(let i=0,s=this.points.length;i<s;i++){let a=this.points[i];a.position.multiply(o),a.controls[0].position.multiply(o),a.controls[1].position.multiply(o)}for(let i1=0,s1=this.shapeHoles.length;i1<s1;i1++)this.shapeHoles[i1].applyScale(e,t);this._update()}createPoint(e,t=0,o=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID()){let i;i=e instanceof three__WEBPACK_IMPORTED_MODULE_0__.FM8?e:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(e,t);let s=new sr(o,i);return s.roundness=this.roundness,s}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,o=this.points.length;t<o;t++){let i=this.points[t];if(i.uuid===e)return i}for(let t1=0,o1=this.shapeHoles.length;t1<o1;t1++){let s=this.shapeHoles[t1].getPointByUuid(e);if(s)return s}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(o=>o.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,o=!1){this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let i=o?this.roundedCurveDivisions:this.curveDivisions;return function(n,r,e=12,t=!0){let o=jh.set(0,0,0),i,s=0,a=[];for(let c=0;c<r.length;c++){let u=gd(r[c]),d=Oo(u,e);a.push(d);for(let p=0;p<=d;p++)if(u instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT||u instanceof three__WEBPACK_IMPORTED_MODULE_0__.ZQ6||u instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z){if(u.getPoint(p/d,ri),o.set(ri.x,ri.y,0),void 0!==i&&function(n,r,e=Number.EPSILON){return n.distanceTo(r)<e}(i,o))continue;void 0===i&&(i=zh),i.copy(o),n.setXYZ(s,o.x,o.y,o.z),s++}}t&&s>1&&!(n.getX(s-1)===n.getX(0)&&n.getY(s-1)===n.getY(0)&&n.getZ(s-1)===n.getZ(0))&&(n.setXYZ(s,n.getX(0),n.getY(0),n.getZ(0)),s++)}(e,o?this.roundedCurves:this.curves,t,this.autoClose),i.reduce((s,a)=>s+a,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=bd(this.points,e,!1),this.roundedCurveDivisions=bd(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,o=12){return 2*(function(n,r,e,t=12,o=!0){let i=jh.set(0,0,0),s=0,a=[];for(let c=0;c<r.length;c++){if(!1===e[c])continue;let u,l=gd(r[c]),p=Oo(l,t);a.push(p);for(let f=0;f<=p;f++)if(l instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT||l instanceof three__WEBPACK_IMPORTED_MODULE_0__.ZQ6||l instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z){if(l.getPoint(f/p,ri),i.set(ri.x,ri.y,0),u?.equals(i))continue;void 0===u?u=zh:(n.setXYZ(s,u.x,u.y,u.z),s++,n.setXYZ(s,i.x,i.y,i.z),s++),u.copy(i)}}return o&&s>1&&!(n.getX(s-1)===n.getX(0)&&n.getY(s-1)===n.getY(0)&&n.getZ(s-1)===n.getZ(0))&&(n.setXYZ(s,n.getX(0),n.getY(0),n.getZ(0)),s++),a})(e,this.curves,t,o,this.autoClose).reduce((s,a)=>s+a,0)}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function(n,r,e=12,t=!0){let o,i=0;for(let s=0;s<r.length;s++){let a=gd(r[s]),c=Oo(a,e);for(let l=0;l<=c;l++)if(a instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT||a instanceof three__WEBPACK_IMPORTED_MODULE_0__.ZQ6||a instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z){if(a.getPoint(l/c,ri),void 0!==o&&function(n,r,e=Number.EPSILON){return n.distanceTo(r)<e}(o,ri,1e-12))continue;void 0===o&&(o=wl),o.copy(ri),n.push(ri.x,ri.y),i++}}return bs(n[0],n[n.length-2],1e-12)&&bs(n[1],n[n.length-1],1e-12)&&(n.pop(),n.pop()),t&&i>1&&!(bs(n[i-1],n[1],1e-12)&&bs(n[i-2],n[0],1e-12))&&(n.push(n[0],n[1]),i++),n}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let o=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let i=t?this.roundedCurveDivisions:this.curveDivisions,s=0;t&&void 0!==this.points[0].roundedCurveCorner&&(s=.5*Oo(this.points[0].roundedCurveCorner,this.subdivision));let a=e-s;a<0&&(a+=i.reduce((c,u)=>c+u,0));for(let c=0,u=i.length;c<u;c++){let l=i[c];if(a<o+l)return[c,(a-o+1)/l];o+=l}return[0,1]}getCurveT(e,t,o){let i=this.points[e],s=this.points[e>=this.points.length-1?0:e+1],a=this.curveDivisions,c=a[e];if(vd(i,s)){let d=i.position.distanceTo(s.position);return i.position.distanceTo(_d.set(o.x,o.y))/d}let u=0;for(let d1=0;d1<e;d1++)u+=a[d1];return(t-u)/c}dispose(){}_applyCurveForPoint(e,t){vd(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let o=this.curves[this.curves.length-1];e.curveBefore=o,t.curveAfter=o;let i=o.clone();e.roundedCurveBefore=i,t.roundedCurveAfter=i,e.roundedCurveCorner=void 0,this.roundedCurves.push(i)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,o=this.points.length;t<o;t++){let i=this.points[t];if(0===t)this.moveTo(i.position.x,i.position.y);else{let s=this.points[t-1];this._applyCurveForPoint(i,s)}}let e=this.getLastPoint();if(e?.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t1=this.points[0],o1=this.points[this.points.length-1];this._applyCurveForPoint(t1,o1)}if(this.points.length>2){let t2=0;for(let o2=0,i1=this.points.length;o2<i1;o2++){var e1;let s1=this.points[o2],a=this.points[o2-1]??this.points[this.points.length-1],c=this.points[o2+1]??this.points[0],u=s1.roundness,l=a&&c&&Gh(a,s1)&&Gh(s1,c)&&hd(a.position,s1.position,c.position);if(!s1.controlsMoved()&&u>0&&!l){let v,d=s1.curveBefore,p=s1.curveAfter;if(void 0===d||void 0===p)continue;let f=s1.roundedCurveBefore,m=s1.roundedCurveAfter,h=d.getLength(),y=p.getLength(),b=Math.min(Math.min(u,.499*h),Math.min(u,.499*y)),w=1-b/h,S=b/y,P=d.getPointAt(w,_d),_=p.getPointAt(S,HP);if(this._subSplitCurve(d,f,w,P,void 0),this._subSplitCurve(p,m,S,void 0,_),this.useCubicForRoundedCorners){let T=Math.tan(xd(P,s1.position,_)/2)*P.distanceTo(s1.position),[C,O]=function(n,r,e,t,o){let i=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)),s=(n.y+r.y)/2,a=(n.x+r.x)/2,c=Math.sqrt(Math.pow(e,2)-Math.pow(i/2,2))*(n.y-r.y)/i,u=Math.sqrt(Math.pow(e,2)-Math.pow(i/2,2))*(r.x-n.x)/i;return t.set(a+c,s+u),o.set(a-c,s-u),[t,o]}(P,_,T,WP,qP),[R,U]=function(n,r,e,t,o,i){let s=r.x-n.x,a=r.y-n.y,c=e.x-n.x,u=e.y-n.y,l=Math.sqrt((s+c)*(s+c)+(a+u)*(a+u)),d;return xd(r,n,e)>Math.PI&&(l*=-1),d=bs(u,a)?(a+u)*(t/l-.5)*8/3/(s-c):(s+c)*(t/l-.5)*8/3/(u-a),o.set(r.x-d*a,r.y+d*s),i.set(e.x+d*u,e.y-d*c),[o,i]}((e1=s1.position,C.distanceTo(e1)<O.distanceTo(e1)?O:C),P,_,T,$P,YP);v=new three__WEBPACK_IMPORTED_MODULE_0__.AXT(P.clone(),R.clone(),U.clone(),_.clone())}else v=new three__WEBPACK_IMPORTED_MODULE_0__.ZQ6(P.clone(),s1.position.clone(),_.clone());s1.roundedCurveCorner=v,this.roundedCurves.splice(o2+t2,0,v),t2++}}}}_subSplitCurve(e,t,o,i,s){if(e instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z)void 0!==i&&t.v2.copy(i),void 0!==s&&t.v1.copy(s);else{let u=e.getUtoTmapping(o,0),l=function(n,r,e,t,o=.5){let i=ri.subVectors(r,n).multiplyScalar(o).add(n),s=wl.subVectors(e,r).multiplyScalar(o).add(r),a=RP.subVectors(t,e).multiplyScalar(o).add(e),u=GP.subVectors(s,i).multiplyScalar(o).add(i),l=VP.subVectors(a,s).multiplyScalar(o).add(s),p=zP.subVectors(l,u).multiplyScalar(o).add(u);return[n.x,n.y,i.x,i.y,u.x,u.y,p.x,p.y,l.x,l.y,a.x,a.y,t.x,t.y]}(e.v0,e.v1,e.v2,e.v3,u);return void 0!==i&&(t.v0.set(l[0],l[1]),t.v1.set(l[2],l[3]),t.v2.set(l[4],l[5]),t.v3.set(l[6],l[7])),void 0!==s&&(t.v0.set(l[6],l[7]),t.v1.set(l[8],l[9]),t.v2.set(l[10],l[11]),t.v3.set(l[12],l[13])),t}return t}clone(){let e=new _e(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let o=0;o<t;o++){let i=7*o,s=e.points[i+0],a=e.points[i+1],c=e.points[i+2],u=e.points[i+3],l=e.points[i+4],d=e.points[i+5],p=e.points[i+6],f=new sr(three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),new three__WEBPACK_IMPORTED_MODULE_0__.FM8(s,a));f.controls[0].position.set(c,u),f.controls[1].position.set(l,d),f.roundness=p,this.points.push(f)}return this.shapeHoles=e.shapeHoles?.length?e.shapeHoles.map(o=>{let i=new _e;return i.fromJSON(o),i}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(i,s)=>{s instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT&&s.v3.equals(i.position)&&i.controls[0].position.copy(s.v2)};return this.points=(i=>{let s=[],a,c;for(a=0,c=i.length;a<c;a++)i[a]instanceof three__WEBPACK_IMPORTED_MODULE_0__.ZQ6&&(i[a]=function(n){let r=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;r.addVectors(n.v0,ri.subVectors(n.v1,n.v0).multiplyScalar(2/3));let e=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;return e.addVectors(n.v2,wl.subVectors(n.v1,n.v2).multiplyScalar(2/3)),new three__WEBPACK_IMPORTED_MODULE_0__.AXT(n.v0,r,e,n.v2)}(i[a]));for(a=0,c=i.length;a<c;a++){let d=i[a],p=a>0?i[a-1]:null,f;d instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT?(f=this.createPoint(d.v0)).controls[1].position.copy(d.v1):d instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z&&(f=this.createPoint(d.v1)),void 0!==f&&(null!==p&&t(f,p),s.push(f))}let u=i[i.length-1],l=!1;return u instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT?u.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(u.v2),l=!0):u instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z&&u.v2.equals(s[0].position)&&(l=!0),this.isClosed=l,s})(e.curves),e instanceof three__WEBPACK_IMPORTED_MODULE_0__.bnF&&(this.shapeHoles=e.holes.map(i=>{let s=new _e;return s.fromShape(i),s})),this.update(),this}updatePoint(e,t){let o=this.getPointByUuid(e);o&&(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.roundness&&(o.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(o.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){let i=this.getPointByUuid(e)?.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){let i=this.getPointByUuid(e)?.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},Td=2*Math.PI;function Pd({x:n,y:r},e,t,o,i){return{x:n*e+o,y:r*t+i}}function Qh(n,r,e,t){return(n*t-r*e<0?-1:1)*Math.acos(Math.min(1,Math.max(-1,n*e+r*t)))}function ue(n,r){if(!n)throw r||"Assertion Failed!"}(n4=be||(be={}))[n4.ODD=0]="ODD",n4[n4.NONZERO=1]="NONZERO",n4[n4.POSITIVE=2]="POSITIVE",n4[n4.NEGATIVE=3]="NEGATIVE",n4[n4.ABS_GEQ_TWO=4]="ABS_GEQ_TWO",(n5=Ge||(Ge={}))[n5.POLYGONS=0]="POLYGONS",n5[n5.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",n5[n5.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS";var le=function(){function n(){}return n.vertEq=function(r,e){return r.s===e.s&&r.t===e.t},n.vertLeq=function(r,e){return r.s<e.s||r.s===e.s&&r.t<=e.t},n.transLeq=function(r,e){return r.t<e.t||r.t===e.t&&r.s<=e.s},n.edgeGoesLeft=function(r){return n.vertLeq(r.Dst,r.Org)},n.edgeGoesRight=function(r){return n.vertLeq(r.Org,r.Dst)},n.vertL1dist=function(r,e){return Math.abs(r.s-e.s)+Math.abs(r.t-e.t)},n.edgeEval=function(r,e,t){ue(n.vertLeq(r,e)&&n.vertLeq(e,t));var o=e.s-r.s,i=t.s-e.s;return o+i>0?o<i?e.t-r.t+(r.t-t.t)*(o/(o+i)):e.t-t.t+(t.t-r.t)*(i/(o+i)):0},n.edgeSign=function(r,e,t){ue(n.vertLeq(r,e)&&n.vertLeq(e,t));var o=e.s-r.s,i=t.s-e.s;return o+i>0?(e.t-t.t)*o+(e.t-r.t)*i:0},n.transEval=function(r,e,t){ue(n.transLeq(r,e)&&n.transLeq(e,t));var o=e.t-r.t,i=t.t-e.t;return o+i>0?o<i?e.s-r.s+(r.s-t.s)*(o/(o+i)):e.s-t.s+(t.s-r.s)*(i/(o+i)):0},n.transSign=function(r,e,t){ue(n.transLeq(r,e)&&n.transLeq(e,t));var o=e.t-r.t,i=t.t-e.t;return o+i>0?(e.s-t.s)*o+(e.s-r.s)*i:0},n.vertCCW=function(r,e,t){return r.s*(e.t-t.t)+e.s*(t.t-r.t)+t.s*(r.t-e.t)>=0},n.interpolate=function(r,e,t,o){return(r=r<0?0:r)<=(t=t<0?0:t)?0===t?(e+o)/2:e+(o-e)*(r/(r+t)):o+(e-o)*(t/(r+t))},n.intersect=function(r,e,t,o,i){var s,a,c;n.vertLeq(r,e)||(c=r,r=e,e=c),n.vertLeq(t,o)||(c=t,t=o,o=c),n.vertLeq(r,t)||(c=r,r=t,t=c,c=e,e=o,o=c),n.vertLeq(t,e)?n.vertLeq(e,o)?((s=n.edgeEval(r,t,e))+(a=n.edgeEval(t,e,o))<0&&(s=-s,a=-a),i.s=n.interpolate(s,t.s,a,e.s)):((s=n.edgeSign(r,t,e))+(a=-n.edgeSign(r,o,e))<0&&(s=-s,a=-a),i.s=n.interpolate(s,t.s,a,o.s)):i.s=(t.s+e.s)/2,n.transLeq(r,e)||(c=r,r=e,e=c),n.transLeq(t,o)||(c=t,t=o,o=c),n.transLeq(r,t)||(c=r,r=t,t=c,c=e,e=o,o=c),n.transLeq(t,e)?n.transLeq(e,o)?((s=n.transEval(r,t,e))+(a=n.transEval(t,e,o))<0&&(s=-s,a=-a),i.t=n.interpolate(s,t.t,a,e.t)):((s=n.transSign(r,t,e))+(a=-n.transSign(r,o,e))<0&&(s=-s,a=-a),i.t=n.interpolate(s,t.t,a,o.t)):i.t=(t.t+e.t)/2},n}(),Ss=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},Pl=function(){function n(r){this.side=r,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(n.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(r){this.Sym.Lface=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(r){this.Sym.Org=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(r){this.Sym.Lnext=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(r){this.Onext.Sym=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(r){this.Lnext.Sym=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(r){this.Sym.Onext=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(r){this.Sym.Onext.Sym=r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(r){this.Sym.Lnext.Sym=r},enumerable:!0,configurable:!0}),n}(),oi=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},ey=function(){function n(){var r=new oi,e=new Ss,t=new Pl(0),o=new Pl(1);r.next=r.prev=r,r.anEdge=null,e.next=e.prev=e,t.next=t,t.Sym=o,o.next=o,o.Sym=t,this.vHead=r,this.fHead=e,this.eHead=t,this.eHeadSym=o}return n.prototype.makeEdge_=function(r){var e=new Pl(0),t=new Pl(1);r.Sym.side<r.side&&(r=r.Sym);var o=r.Sym.next;return t.next=o,o.Sym.next=e,e.next=r,r.Sym.next=t,e.Sym=t,e.Onext=e,e.Lnext=t,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,t.Sym=e,t.Onext=t,t.Lnext=e,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,e},n.prototype.splice_=function(r,e){var t=r.Onext,o=e.Onext;t.Sym.Lnext=e,o.Sym.Lnext=r,r.Onext=o,e.Onext=t},n.prototype.makeVertex_=function(r,e,t){var o=r;ue(o,"Vertex can't be null!");var i=t.prev;o.prev=i,i.next=o,o.next=t,t.prev=o,o.anEdge=e;var s=e;do s.Org=o,s=s.Onext;while(s!==e)},n.prototype.makeFace_=function(r,e,t){var o=r;ue(o,"Face can't be null");var i=t.prev;o.prev=i,i.next=o,o.next=t,t.prev=o,o.anEdge=e,o.trail=null,o.marked=!1,o.inside=t.inside;var s=e;do s.Lface=o,s=s.Lnext;while(s!==e)},n.prototype.killEdge_=function(r){r.Sym.side<r.side&&(r=r.Sym);var e=r.next,t=r.Sym.next;e.Sym.next=t,t.Sym.next=e},n.prototype.killVertex_=function(r,e){var t=r.anEdge,o=t;do o.Org=e,o=o.Onext;while(o!==t);var i=r.prev,s=r.next;s.prev=i,i.next=s},n.prototype.killFace_=function(r,e){var t=r.anEdge,o=t;do o.Lface=e,o=o.Lnext;while(o!==t);var i=r.prev,s=r.next;s.prev=i,i.next=s},n.prototype.makeEdge=function(){var r=new oi,e=new oi,t=new Ss,o=this.makeEdge_(this.eHead);return this.makeVertex_(r,o,this.vHead),this.makeVertex_(e,o.Sym,this.vHead),this.makeFace_(t,o,this.fHead),o},n.prototype.splice=function(r,e){var t=!1,o=!1;if(r!==e){if(e.Org!==r.Org&&(o=!0,this.killVertex_(e.Org,r.Org)),e.Lface!==r.Lface&&(t=!0,this.killFace_(e.Lface,r.Lface)),this.splice_(e,r),!o){var i=new oi;this.makeVertex_(i,e,r.Org),r.Org.anEdge=r}if(!t){var s=new Ss;this.makeFace_(s,e,r.Lface),r.Lface.anEdge=r}}},n.prototype.delete=function(r){var e=r.Sym,t=!1;if(r.Lface!==r.Rface&&(t=!0,this.killFace_(r.Lface,r.Rface)),r.Onext===r)this.killVertex_(r.Org,null);else if(r.Rface.anEdge=r.Oprev,r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev),!t){var o=new Ss;this.makeFace_(o,r,r.Lface)}e.Onext===e?(this.killVertex_(e.Org,null),this.killFace_(e.Lface,null)):(r.Lface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(r)},n.prototype.addEdgeVertex=function(r){var e=this.makeEdge_(r),t=e.Sym;this.splice_(e,r.Lnext),e.Org=r.Dst;var o=new oi;return this.makeVertex_(o,t,e.Org),e.Lface=t.Lface=r.Lface,e},n.prototype.splitEdge=function(r){var t=this.addEdgeVertex(r).Sym;return this.splice_(r.Sym,r.Sym.Oprev),this.splice_(r.Sym,t),r.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=r.Rface,t.winding=r.winding,t.Sym.winding=r.Sym.winding,t.idx=r.idx,t.Sym.idx=r.Sym.idx,t},n.prototype.connect=function(r,e){var t=!1,o=this.makeEdge_(r),i=o.Sym;if(e.Lface!==r.Lface&&(t=!0,this.killFace_(e.Lface,r.Lface)),this.splice_(o,r.Lnext),this.splice_(i,e),o.Org=r.Dst,i.Org=e.Org,o.Lface=i.Lface=r.Lface,r.Lface.anEdge=i,!t){var s=new Ss;this.makeFace_(s,o,r.Lface)}return o},n.prototype.zapFace=function(r){var t,o,i,s,a,e=r.anEdge;o=e.Lnext;do o=(t=o).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(i=t.Sym).Onext===i?this.killVertex_(i.Org,null):(i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t));while(t!=e);s=r.prev,(a=r.next).prev=s,s.next=a},n.prototype.countFaceVerts_=function(r){var e=r.anEdge,t=0;do t++,e=e.Lnext;while(e!==r.anEdge);return t},n.prototype.mergeConvexFaces=function(r){var e,t,o,i,s;for(e=this.fHead.next;e!==this.fHead;e=e.next)if(e.inside)for(s=(t=e.anEdge).Org;o=t.Lnext,(i=t.Sym)&&i.Lface&&i.Lface.inside&&this.countFaceVerts_(e)+this.countFaceVerts_(i.Lface)-2<=r&&le.vertCCW(t.Lprev.Org,t.Org,i.Lnext.Lnext.Org)&&le.vertCCW(i.Lprev.Org,i.Org,t.Lnext.Lnext.Org)&&(o=i.Lnext,this.delete(i),t=null,i=null),!(t&&t.Lnext.Org===s);)t=o;return!0},n.prototype.check=function(){var o,i,s,a,c,u,r=this.fHead,e=this.vHead,t=this.eHead;for(i=r,i=r;(o=i.next)!==r;i=o){ue(o.prev===i),c=o.anEdge;do ue(c.Sym!==c),ue(c.Sym.Sym===c),ue(c.Lnext.Onext.Sym===c),ue(c.Onext.Sym.Lnext===c),ue(c.Lface===o),c=c.Lnext;while(c!==o.anEdge)}for(ue(o.prev===i&&null===o.anEdge),a=e,a=e;(s=a.next)!==e;a=s){ue(s.prev===a),c=s.anEdge;do ue(c.Sym!==c),ue(c.Sym.Sym===c),ue(c.Lnext.Onext.Sym===c),ue(c.Onext.Sym.Lnext===c),ue(c.Org===s),c=c.Onext;while(c!==s.anEdge)}for(ue(s.prev===a&&null===s.anEdge),u=t,u=t;(c=u.next)!==t;u=c)ue(c.Sym.next===u.Sym),ue(c.Sym!==c),ue(c.Sym.Sym===c),ue(null!==c.Org),ue(null!==c.Dst),ue(c.Lnext.Onext.Sym===c),ue(c.Onext.Sym.Lnext===c);ue(c.Sym.next===u.Sym&&c.Sym===this.eHeadSym&&c.Sym.Sym===c&&null===c.Org&&null===c.Dst&&null===c.Lface&&null===c.Rface)},n}(),ty=function(){this.handle=null},ry=function(){this.key=null,this.node=0},ZP=function(){function n(r,e){this.leq=e,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=r,this.nodes=[],this.handles=[];for(var t=0;t<r+1;t++)this.nodes[t]=new ty,this.handles[t]=new ry;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return n.prototype.floatDown_=function(r){var o,i,s,e=this.nodes,t=this.handles;for(o=e[r].handle;;){if((s=r<<1)<this.size&&this.leq(t[e[s+1].handle].key,t[e[s].handle].key)&&++s,ue(s<=this.max),i=e[s].handle,s>this.size||this.leq(t[o].key,t[i].key)){e[r].handle=o,t[o].node=r;break}e[r].handle=i,t[i].node=r,r=s}},n.prototype.floatUp_=function(r){var o,i,s,e=this.nodes,t=this.handles;for(o=e[r].handle;;){if(i=e[s=r>>1].handle,0===s||this.leq(t[i].key,t[o].key)){e[r].handle=o,t[o].node=r;break}e[r].handle=i,t[i].node=r,r=s}},n.prototype.init=function(){for(var r=this.size;r>=1;--r)this.floatDown_(r);this.initialized=!0},n.prototype.min=function(){return this.handles[this.nodes[1].handle].key},n.prototype.insert=function(r){var e,t,o,i;if(2*(e=++this.size)>this.max){for(this.max*=2,i=this.nodes.length,this.nodes.length=this.max+1,o=i;o<this.nodes.length;o++)this.nodes[o]=new ty;for(i=this.handles.length,this.handles.length=this.max+1,o=i;o<this.handles.length;o++)this.handles[o]=new ry}return 0===this.freeList?t=e:(t=this.freeList,this.freeList=this.handles[t].node),this.nodes[e].handle=t,this.handles[t].node=e,this.handles[t].key=r,this.initialized&&this.floatUp_(e),t},n.prototype.extractMin=function(){var r=this.nodes,e=this.handles,t=r[1].handle,o=e[t].key;return this.size>0&&(r[1].handle=r[this.size].handle,e[r[1].handle].node=1,e[t].key=null,e[t].node=this.freeList,this.freeList=t,--this.size,this.size>0&&this.floatDown_(1)),o},n.prototype.delete=function(r){var o,e=this.nodes,t=this.handles;ue(r>=1&&r<=this.max&&null!==t[r].key),e[o=t[r].node].handle=e[this.size].handle,t[e[o].handle].node=o,--this.size,o<=this.size&&(o<=1||this.leq(t[e[o>>1].handle].key,t[e[o].handle].key)?this.floatDown_(o):this.floatUp_(o)),t[r].key=null,t[r].node=this.freeList,this.freeList=r},n}(),Od=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},oy=function(){this.key=null,this.next=null,this.prev=null},QP=function(){function n(r,e){this.frame=r,this.leq=e,this.head=new oy,this.head.next=this.head,this.head.prev=this.head}return n.prototype.min=function(){return this.head.next},n.prototype.max=function(){return this.head.prev},n.prototype.insert=function(r){return this.insertBefore(this.head,r)},n.prototype.search=function(r){var e=this.head;do e=e.next;while(null!==e.key&&!this.leq(this.frame,r,e.key));return e},n.prototype.insertBefore=function(r,e){do r=r.prev;while(null!==r.key&&!this.leq(this.frame,r.key,e));var t=new oy;return t.key=e,t.next=r.next,r.next.prev=t,t.prev=r,r.next=t,t},n.prototype.delete=function(r){r.next.prev=r.prev,r.prev.next=r.next},n}(),JP=function(){function n(){}return n.regionBelow=function(r){return r.nodeUp.prev.key},n.regionAbove=function(r){return r.nodeUp.next.key},n.debugEvent=function(r){},n.addWinding=function(r,e){r.winding+=e.winding,r.Sym.winding+=e.Sym.winding},n.edgeLeq=function(r,e,t){var o=r.event,i=e.eUp,s=t.eUp;return i.Dst===o?s.Dst===o?le.vertLeq(i.Org,s.Org)?0>=le.edgeSign(s.Dst,i.Org,s.Org):le.edgeSign(i.Dst,s.Org,i.Org)>=0:0>=le.edgeSign(s.Dst,o,s.Org):s.Dst===o?le.edgeSign(i.Dst,o,i.Org)>=0:le.edgeEval(i.Dst,o,i.Org)>=le.edgeEval(s.Dst,o,s.Org)},n.deleteRegion=function(r,e){e.fixUpperEdge&&ue(0===e.eUp.winding),e.eUp.activeRegion=null,r.dict.delete(e.nodeUp)},n.fixUpperEdge=function(r,e,t){ue(e.fixUpperEdge),r.mesh.delete(e.eUp),e.fixUpperEdge=!1,e.eUp=t,t.activeRegion=e},n.topLeftRegion=function(r,e){var o,t=e.eUp.Org;do e=n.regionAbove(e);while(e.eUp.Org===t);if(e.fixUpperEdge){if(null===(o=r.mesh.connect(n.regionBelow(e).eUp.Sym,e.eUp.Lnext)))return null;n.fixUpperEdge(r,e,o),e=n.regionAbove(e)}return e},n.topRightRegion=function(r){var e=r.eUp.Dst;do r=n.regionAbove(r);while(r.eUp.Dst===e);return r},n.addRegionBelow=function(r,e,t){var o=new Od;return o.eUp=t,o.nodeUp=r.dict.insertBefore(e.nodeUp,o),o.fixUpperEdge=!1,o.sentinel=!1,o.dirty=!1,t.activeRegion=o,o},n.isWindingInside=function(r,e){switch(r.windingRule){case be.ODD:return(1&e)!=0;case be.NONZERO:return 0!==e;case be.POSITIVE:return e>0;case be.NEGATIVE:return e<0;case be.ABS_GEQ_TWO:return e>=2||e<=-2}throw Error("Invalid winding rulle")},n.computeWinding=function(r,e){e.windingNumber=n.regionAbove(e).windingNumber+e.eUp.winding,e.inside=n.isWindingInside(r,e.windingNumber)},n.finishRegion=function(r,e){var t=e.eUp,o=t.Lface;o.inside=e.inside,o.anEdge=t,n.deleteRegion(r,e)},n.finishLeftRegions=function(r,e,t){for(var o,i=null,s=e,a=e.eUp;s!==t;){if(s.fixUpperEdge=!1,(o=(i=n.regionBelow(s)).eUp).Org!=a.Org){if(!i.fixUpperEdge){n.finishRegion(r,s);break}o=r.mesh.connect(a.Lprev,o.Sym),n.fixUpperEdge(r,i,o)}a.Onext!==o&&(r.mesh.splice(o.Oprev,o),r.mesh.splice(a,o)),n.finishRegion(r,s),a=i.eUp,s=i}return a},n.addRightEdges=function(r,e,t,o,i,s){var a,c,u,l,d=!0;u=t;do ue(le.vertLeq(u.Org,u.Dst)),n.addRegionBelow(r,e,u.Sym),u=u.Onext;while(u!==o);for(null===i&&(i=n.regionBelow(e).eUp.Rprev),c=e,l=i;(u=(a=n.regionBelow(c)).eUp.Sym).Org===l.Org;)u.Onext!==l&&(r.mesh.splice(u.Oprev,u),r.mesh.splice(l.Oprev,u)),a.windingNumber=c.windingNumber-u.winding,a.inside=n.isWindingInside(r,a.windingNumber),c.dirty=!0,!d&&n.checkForRightSplice(r,c)&&(n.addWinding(u,l),n.deleteRegion(r,c),r.mesh.delete(l)),d=!1,c=a,l=u;c.dirty=!0,ue(c.windingNumber-u.winding===a.windingNumber),s&&n.walkDirtyRegions(r,c)},n.spliceMergeVertices=function(r,e,t){r.mesh.splice(e,t)},n.vertexWeights=function(r,e,t){var o=le.vertL1dist(e,r),i=le.vertL1dist(t,r),s=.5*i/(o+i),a=.5*o/(o+i);r.coords[0]+=s*e.coords[0]+a*t.coords[0],r.coords[1]+=s*e.coords[1]+a*t.coords[1],r.coords[2]+=s*e.coords[2]+a*t.coords[2]},n.getIntersectData=function(r,e,t,o,i,s){e.coords[0]=e.coords[1]=e.coords[2]=0,e.idx=-1,n.vertexWeights(e,t,o),n.vertexWeights(e,i,s)},n.checkForRightSplice=function(r,e){var t=n.regionBelow(e),o=e.eUp,i=t.eUp;if(le.vertLeq(o.Org,i.Org)){if(le.edgeSign(i.Dst,o.Org,i.Org)>0)return!1;le.vertEq(o.Org,i.Org)?o.Org!==i.Org&&(r.pq.delete(o.Org.pqHandle),n.spliceMergeVertices(r,i.Oprev,o)):(r.mesh.splitEdge(i.Sym),r.mesh.splice(o,i.Oprev),e.dirty=t.dirty=!0)}else{if(0>le.edgeSign(o.Dst,i.Org,o.Org))return!1;n.regionAbove(e).dirty=e.dirty=!0,r.mesh.splitEdge(o.Sym),r.mesh.splice(i.Oprev,o)}return!0},n.checkForLeftSplice=function(r,e){var s,t=n.regionBelow(e),o=e.eUp,i=t.eUp;if(ue(!le.vertEq(o.Dst,i.Dst)),le.vertLeq(o.Dst,i.Dst)){if(0>le.edgeSign(o.Dst,i.Dst,o.Org))return!1;n.regionAbove(e).dirty=e.dirty=!0,s=r.mesh.splitEdge(o),r.mesh.splice(i.Sym,s),s.Lface.inside=e.inside}else{if(le.edgeSign(i.Dst,o.Dst,i.Org)>0)return!1;e.dirty=t.dirty=!0,s=r.mesh.splitEdge(i),r.mesh.splice(o.Lnext,i.Sym),s.Rface.inside=e.inside}return!0},n.checkForIntersect=function(r,e){var f,m,t=n.regionBelow(e),o=e.eUp,i=t.eUp,s=o.Org,a=i.Org,c=o.Dst,u=i.Dst,p=new oi;if(ue(!le.vertEq(u,c)),ue(0>=le.edgeSign(c,r.event,s)),ue(le.edgeSign(u,r.event,a)>=0),ue(s!==r.event&&a!==r.event),ue(!e.fixUpperEdge&&!t.fixUpperEdge),s===a||Math.min(s.t,c.t)>Math.max(a.t,u.t))return!1;if(le.vertLeq(s,a)){if(le.edgeSign(u,s,a)>0)return!1}else if(0>le.edgeSign(c,a,s))return!1;return n.debugEvent(r),le.intersect(c,s,u,a,p),ue(Math.min(s.t,c.t)<=p.t),ue(p.t<=Math.max(a.t,u.t)),ue(Math.min(u.s,c.s)<=p.s),ue(p.s<=Math.max(a.s,s.s)),le.vertLeq(p,r.event)&&(p.s=r.event.s,p.t=r.event.t),f=le.vertLeq(s,a)?s:a,le.vertLeq(f,p)&&(p.s=f.s,p.t=f.t),le.vertEq(p,s)||le.vertEq(p,a)?(n.checkForRightSplice(r,e),!1):!le.vertEq(c,r.event)&&le.edgeSign(c,r.event,p)>=0||!le.vertEq(u,r.event)&&0>=le.edgeSign(u,r.event,p)?u===r.event?(r.mesh.splitEdge(o.Sym),r.mesh.splice(i.Sym,o),e=n.topLeftRegion(r,e),o=n.regionBelow(e).eUp,n.finishLeftRegions(r,n.regionBelow(e),t),n.addRightEdges(r,e,o.Oprev,o,o,!0),!0):c===r.event?(r.mesh.splitEdge(i.Sym),r.mesh.splice(o.Lnext,i.Oprev),t=e,e=n.topRightRegion(e),m=n.regionBelow(e).eUp.Rprev,t.eUp=i.Oprev,i=n.finishLeftRegions(r,t,null),n.addRightEdges(r,e,i.Onext,o.Rprev,m,!0),!0):(le.edgeSign(c,r.event,p)>=0&&(n.regionAbove(e).dirty=e.dirty=!0,r.mesh.splitEdge(o.Sym),o.Org.s=r.event.s,o.Org.t=r.event.t),0>=le.edgeSign(u,r.event,p)&&(e.dirty=t.dirty=!0,r.mesh.splitEdge(i.Sym),i.Org.s=r.event.s,i.Org.t=r.event.t),!1):(r.mesh.splitEdge(o.Sym),r.mesh.splitEdge(i.Sym),r.mesh.splice(i.Oprev,o),o.Org.s=p.s,o.Org.t=p.t,o.Org.pqHandle=r.pq.insert(o.Org),n.getIntersectData(r,o.Org,s,c,a,u),n.regionAbove(e).dirty=e.dirty=t.dirty=!0,!1)},n.walkDirtyRegions=function(r,e){for(var o,i,t=n.regionBelow(e);;){for(;t.dirty;)e=t,t=n.regionBelow(t);if(!e.dirty&&(t=e,null===(e=n.regionAbove(e))||!e.dirty))return;if(e.dirty=!1,o=e.eUp,i=t.eUp,o.Dst!==i.Dst&&n.checkForLeftSplice(r,e)&&(t.fixUpperEdge?(n.deleteRegion(r,t),r.mesh.delete(i),i=(t=n.regionBelow(e)).eUp):e.fixUpperEdge&&(n.deleteRegion(r,e),r.mesh.delete(o),o=(e=n.regionAbove(t)).eUp)),o.Org!==i.Org){if(o.Dst===i.Dst||e.fixUpperEdge||t.fixUpperEdge||o.Dst!==r.event&&i.Dst!==r.event)n.checkForRightSplice(r,e);else if(n.checkForIntersect(r,e))return}o.Org===i.Org&&o.Dst===i.Dst&&(n.addWinding(i,o),n.deleteRegion(r,e),r.mesh.delete(o),e=n.regionAbove(t))}},n.connectRightVertex=function(r,e,t){var o,i=t.Onext,s=n.regionBelow(e),a=e.eUp,c=s.eUp,u=!1;if(a.Dst!==c.Dst&&n.checkForIntersect(r,e),le.vertEq(a.Org,r.event)&&(r.mesh.splice(i.Oprev,a),e=n.topLeftRegion(r,e),i=n.regionBelow(e).eUp,n.finishLeftRegions(r,n.regionBelow(e),s),u=!0),le.vertEq(c.Org,r.event)&&(r.mesh.splice(t,c.Oprev),t=n.finishLeftRegions(r,s,null),u=!0),u){n.addRightEdges(r,e,t.Onext,i,i,!0);return}o=le.vertLeq(c.Org,a.Org)?c.Oprev:a,o=r.mesh.connect(t.Lprev,o),n.addRightEdges(r,e,o,o.Onext,o.Onext,!1),o.Sym.activeRegion.fixUpperEdge=!0,n.walkDirtyRegions(r,e)},n.connectLeftDegenerate=function(r,e,t){var o,i,s,a,c;if(o=e.eUp,le.vertEq(o.Org,t)){ue(!1),n.spliceMergeVertices(r,o,t.anEdge);return}if(!le.vertEq(o.Dst,t)){r.mesh.splitEdge(o.Sym),e.fixUpperEdge&&(r.mesh.delete(o.Onext),e.fixUpperEdge=!1),r.mesh.splice(t.anEdge,o),n.sweepEvent(r,t);return}ue(!1),e=n.topRightRegion(e),i=a=(s=(c=n.regionBelow(e)).eUp.Sym).Onext,c.fixUpperEdge&&(ue(i!==s),n.deleteRegion(r,c),r.mesh.delete(s),s=i.Oprev),r.mesh.splice(t.anEdge,s),le.edgeGoesLeft(i)||(i=null),n.addRightEdges(r,e,s.Onext,a,i,!0)},n.connectLeftVertex=function(r,e){var t,o,i,s,a,c,u=new Od;if(u.eUp=e.anEdge.Sym,t=r.dict.search(u).key,o=n.regionBelow(t)){if(s=t.eUp,a=o.eUp,0===le.edgeSign(s.Dst,e,s.Org)){n.connectLeftDegenerate(r,t,e);return}(i=le.vertLeq(a.Dst,s.Dst)?t:o,t.inside||i.fixUpperEdge)?(c=i===t?r.mesh.connect(e.anEdge.Sym,s.Lnext):r.mesh.connect(a.Dnext,e.anEdge).Sym,i.fixUpperEdge?n.fixUpperEdge(r,i,c):n.computeWinding(r,n.addRegionBelow(r,t,c)),n.sweepEvent(r,e)):n.addRightEdges(r,t,e.anEdge,e.anEdge,null,!0)}},n.sweepEvent=function(r,e){r.event=e,n.debugEvent(r);for(var t=e.anEdge;null===t.activeRegion;)if((t=t.Onext)===e.anEdge){n.connectLeftVertex(r,e);return}var o=n.topLeftRegion(r,t.activeRegion);ue(null!==o);var i=n.regionBelow(o),s=i.eUp,a=n.finishLeftRegions(r,i,null);a.Onext===s?n.connectRightVertex(r,o,a):n.addRightEdges(r,o,a.Onext,s,s,!0)},n.addSentinel=function(r,e,t,o){var i=new Od,s=r.mesh.makeEdge();s.Org.s=t,s.Org.t=o,s.Dst.s=e,s.Dst.t=o,r.event=s.Dst,i.eUp=s,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=r.dict.insert(i)},n.initEdgeDict=function(r){r.dict=new QP(r,n.edgeLeq);var e=r.bmax[0]-r.bmin[0],t=r.bmax[1]-r.bmin[1],o=r.bmin[0]-e,i=r.bmax[0]+e,s=r.bmin[1]-t,a=r.bmax[1]+t;n.addSentinel(r,o,i,s),n.addSentinel(r,o,i,a)},n.doneEdgeDict=function(r){for(var e,t=0;null!==(e=r.dict.min().key);)e.sentinel||(ue(e.fixUpperEdge),ue(1==++t)),ue(0===e.windingNumber),n.deleteRegion(r,e)},n.removeDegenerateEdges=function(r){var e,t,o,i=r.mesh.eHead;for(e=i.next;e!==i;e=t)t=e.next,o=e.Lnext,le.vertEq(e.Org,e.Dst)&&e.Lnext.Lnext!==e&&(n.spliceMergeVertices(r,o,e),r.mesh.delete(e),o=(e=o).Lnext),o.Lnext===e&&(o!==e&&((o===t||o===t.Sym)&&(t=t.next),r.mesh.delete(o)),(e===t||e===t.Sym)&&(t=t.next),r.mesh.delete(e))},n.initPriorityQ=function(r){var e,t,o,i=0;for(t=(o=r.mesh.vHead).next;t!==o;t=t.next)i++;for(i+=8,e=r.pq=new ZP(i,le.vertLeq),t=(o=r.mesh.vHead).next;t!==o;t=t.next)t.pqHandle=e.insert(t);return t===o&&(e.init(),!0)},n.donePriorityQ=function(r){r.pq=null},n.removeDegenerateFaces=function(r,e){var t,o,i;for(t=e.fHead.next;t!==e.fHead;t=o)o=t.next,ue((i=t.anEdge).Lnext!==i),i.Lnext.Lnext===i&&(n.addWinding(i.Onext,i),r.mesh.delete(i));return!0},n.computeInterior=function(r,e){var t,o;if(void 0===e&&(e=!0),n.removeDegenerateEdges(r),!n.initPriorityQ(r))return!1;for(n.initEdgeDict(r);null!==(t=r.pq.extractMin());){for(;!(null===(o=r.pq.min())||!le.vertEq(o,t));)o=r.pq.extractMin(),n.spliceMergeVertices(r,t.anEdge,o.anEdge);n.sweepEvent(r,t)}return r.event=r.dict.min().key.eUp.Org,n.debugEvent(r),n.doneEdgeDict(r),n.donePriorityQ(r),!!n.removeDegenerateFaces(r,r.mesh)&&(e&&r.mesh.check(),!0)},n}(),eT=function(){function n(){this.mesh=new ey,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=be.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return n.prototype.dot_=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},n.prototype.normalize_=function(r){var e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2];if(!e)throw"Zero-size vector!";e=Math.sqrt(e),r[0]/=e,r[1]/=e,r[2]/=e},n.prototype.longAxis_=function(r){var e=0;return Math.abs(r[1])>Math.abs(r[0])&&(e=1),Math.abs(r[2])>Math.abs(r[e])&&(e=2),e},n.prototype.computeNormal_=function(r){var e,t,o,i,s,a,c=[0,0,0],u=[0,0,0],l=[0,0,0],d=[0,0,0],p=[0,0,0],f=[null,null,null],m=[null,null,null],h=this.mesh.vHead;e=h.next;for(var y=0;y<3;++y)i=e.coords[y],u[y]=i,m[y]=e,c[y]=i,f[y]=e;for(e=h.next;e!==h;e=e.next)for(var g=0;g<3;++g)(i=e.coords[g])<u[g]&&(u[g]=i,m[g]=e),i>c[g]&&(c[g]=i,f[g]=e);var x=0;if(c[1]-u[1]>c[0]-u[0]&&(x=1),c[2]-u[2]>c[x]-u[x]&&(x=2),u[x]>=c[x]){r[0]=0,r[1]=0,r[2]=1;return}for(a=0,t=m[x],o=f[x],l[0]=t.coords[0]-o.coords[0],l[1]=t.coords[1]-o.coords[1],l[2]=t.coords[2]-o.coords[2],e=h.next;e!==h;e=e.next)d[0]=e.coords[0]-o.coords[0],d[1]=e.coords[1]-o.coords[1],d[2]=e.coords[2]-o.coords[2],p[0]=l[1]*d[2]-l[2]*d[1],p[1]=l[2]*d[0]-l[0]*d[2],p[2]=l[0]*d[1]-l[1]*d[0],(s=p[0]*p[0]+p[1]*p[1]+p[2]*p[2])>a&&(a=s,r[0]=p[0],r[1]=p[1],r[2]=p[2]);a<=0&&(r[0]=r[1]=r[2]=0,r[this.longAxis_(l)]=1)},n.prototype.checkOrientation_=function(){for(var e,o,r=this.mesh.fHead,t=this.mesh.vHead,i=0,s=r.next;s!==r;s=s.next)if(!((o=s.anEdge).winding<=0))do i+=(o.Org.s-o.Dst.s)*(o.Org.t+o.Dst.t),o=o.Lnext;while(o!==s.anEdge);if(i<0){for(e=t.next;e!==t;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},n.prototype.projectPolygon_=function(){var t,o,r=this.mesh.vHead,e=[0,0,0],i=!1;e[0]=this.normal[0],e[1]=this.normal[1],e[2]=this.normal[2],e[0]||e[1]||e[2]||(this.computeNormal_(e),i=!0),t=this.sUnit,o=this.tUnit;var s=this.longAxis_(e);t[s]=0,t[(s+1)%3]=1,t[(s+2)%3]=0,o[s]=0,o[(s+1)%3]=0,o[(s+2)%3]=e[s]>0?1:-1;for(var a=r.next;a!==r;a=a.next)a.s=this.dot_(a.coords,t),a.t=this.dot_(a.coords,o);i&&this.checkOrientation_();for(var c=!0,u=r.next;u!==r;u=u.next)c?(this.bmin[0]=this.bmax[0]=u.s,this.bmin[1]=this.bmax[1]=u.t,c=!1):(u.s<this.bmin[0]&&(this.bmin[0]=u.s),u.s>this.bmax[0]&&(this.bmax[0]=u.s),u.t<this.bmin[1]&&(this.bmin[1]=u.t),u.t>this.bmax[1]&&(this.bmax[1]=u.t))},n.prototype.addWinding_=function(r,e){r.winding+=e.winding,r.Sym.winding+=e.Sym.winding},n.prototype.tessellateMonoRegion_=function(r,e){var t,o;if(!((t=e.anEdge).Lnext!==t&&t.Lnext.Lnext!==t))throw"Mono region invalid";for(;le.vertLeq(t.Dst,t.Org);t=t.Lprev);for(;le.vertLeq(t.Org,t.Dst);t=t.Lnext);for(o=t.Lprev;t.Lnext!==o;)if(le.vertLeq(t.Dst,o.Org)){for(;o.Lnext!==t&&(le.edgeGoesLeft(o.Lnext)||0>=le.edgeSign(o.Org,o.Dst,o.Lnext.Dst));)o=r.connect(o.Lnext,o).Sym;o=o.Lprev}else{for(;o.Lnext!==t&&(le.edgeGoesRight(t.Lprev)||le.edgeSign(t.Dst,t.Org,t.Lprev.Org)>=0);)t=r.connect(t,t.Lprev).Sym;t=t.Lnext}if(o.Lnext===t)throw"Mono region invalid";for(;o.Lnext.Lnext!==t;)o=r.connect(o.Lnext,o).Sym;return!0},n.prototype.tessellateInterior_=function(r){for(var e,t=r.fHead.next;t!==r.fHead;t=e)if(e=t.next,t.inside&&!this.tessellateMonoRegion_(r,t))return!1;return!0},n.prototype.discardExterior_=function(r){for(var e,t=r.fHead.next;t!==r.fHead;t=e)e=t.next,t.inside||r.zapFace(t)},n.prototype.setWindingNumber_=function(r,e,t){for(var o,i=r.eHead.next;i!==r.eHead;i=o)o=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?e:-e:t?r.delete(i):i.winding=0},n.prototype.getNeighbourFace_=function(r){return r.Rface&&r.Rface.inside?r.Rface.n:-1},n.prototype.outputPolymesh_=function(r,e,t,o){var i,c,s=0,a=0;t>3&&r.mergeConvexFaces(t);for(var u=r.vHead.next;u!==r.vHead;u=u.next)u.n=-1;for(var l=r.fHead.next;l!==r.fHead;l=l.next)if(l.n=-1,l.inside){i=l.anEdge,c=0;do{var u=i.Org;-1===u.n&&(u.n=a,a++),c++,i=i.Lnext}while(i!==l.anEdge);if(c>t)throw"Face vertex greater that support polygon";l.n=s,++s}this.elementCount=s,e===Ge.CONNECTED_POLYGONS&&(s*=2),this.elements=[],this.elements.length=s*t,this.vertexCount=a,this.vertices=[],this.vertices.length=a*o,this.vertexIndices=[],this.vertexIndices.length=a;for(var u=r.vHead.next;u!==r.vHead;u=u.next)if(-1!==u.n){var d=u.n*o;this.vertices[d+0]=u.coords[0],this.vertices[d+1]=u.coords[1],o>2&&(this.vertices[d+2]=u.coords[2]),this.vertexIndices[u.n]=u.idx}for(var p=0,l=r.fHead.next;l!==r.fHead;l=l.next)if(l.inside){i=l.anEdge,c=0;do{var u=i.Org;this.elements[p++]=u.n,c++,i=i.Lnext}while(i!==l.anEdge);for(var f=c;f<t;++f)this.elements[p++]=-1;if(e===Ge.CONNECTED_POLYGONS){i=l.anEdge;do this.elements[p++]=this.getNeighbourFace_(i),i=i.Lnext;while(i!==l.anEdge);for(var m=c;m<t;++m)this.elements[p++]=-1}}},n.prototype.outputContours_=function(r,e){var t,o,i=0,s=0;this.vertexCount=0,this.elementCount=0;for(var a=r.fHead.next;a!==r.fHead;a=a.next)if(a.inside){o=t=a.anEdge;do this.vertexCount++,t=t.Lnext;while(t!==o);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*e,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var c=0,u=0,l=0;i=0;for(var a=r.fHead.next;a!==r.fHead;a=a.next)if(a.inside){s=0,o=t=a.anEdge;do this.vertices[c++]=t.Org.coords[0],this.vertices[c++]=t.Org.coords[1],e>2&&(this.vertices[c++]=t.Org.coords[2]),this.vertexIndices[u++]=this.vertexIdCallback?this.vertexIdCallback(t):t.Org.idx,s++,t=t.Lnext;while(t!==o);this.elements[l++]=i,this.elements[l++]=s,i+=s}},n.prototype.addContour=function(r,e){null===this.mesh&&(this.mesh=new ey),r<2&&(r=2),r>3&&(r=3);for(var t=null,o=0;o<e.length;o+=r)null===t?(t=this.mesh.makeEdge(),this.mesh.splice(t,t.Sym)):(this.mesh.splitEdge(t),t=t.Lnext),t.Org.coords[0]=e[o+0],t.Org.coords[1]=e[o+1],r>2?t.Org.coords[2]=e[o+2]:t.Org.coords[2]=0,t.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(t),t.winding=1,t.Sym.winding=-1},n.prototype.tesselate=function(r,e,t,o,i,s){if(void 0===r&&(r=be.ODD),void 0===e&&(e=Ge.POLYGONS),void 0===s&&(s=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=r,o<2&&(o=2),o>3&&(o=3),!this.mesh)return!1;this.projectPolygon_(),JP.computeInterior(this,s);var a=this.mesh;return e===Ge.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),s&&a.check(),e===Ge.BOUNDARY_CONTOURS?this.outputContours_(a,o):this.outputPolymesh_(a,e,t,o),!0},n}();function ar(n){var r=n.windingRule,e=void 0===r?be.ODD:r,t=n.elementType,o=void 0===t?Ge.POLYGONS:t,i=n.polySize,a=n.vertexSize,c=void 0===a?2:a,u=n.normal,d=n.contours,p=void 0===d?[]:d,f=n.strict,m=void 0===f||f,h=n.debug;if(!p&&m)throw Error("Contours can't be empty");if(p){var g=new eT;n.edgeCreateCallback&&(g.edgeCreateCallback=n.edgeCreateCallback),n.vertexIdCallback&&(g.vertexIdCallback=n.vertexIdCallback);for(var x=0;x<p.length;x++)g.addContour(c||2,p[x]);return g.tesselate(e,o,void 0===i?3:i,c,void 0===u?[0,0,1]:u,m),{vertices:g.vertices,vertexIndices:g.vertexIndices,vertexCount:g.vertexCount,elements:g.elements,elementCount:g.elementCount,mesh:void 0!==h&&h?g.mesh:void 0}}}be.ODD,be.NONZERO,be.POSITIVE,be.NEGATIVE,be.ABS_GEQ_TWO,Ge.POLYGONS,Ge.CONNECTED_POLYGONS,Ge.BOUNDARY_CONTOURS;var Tl=class{constructor(r=256,e=!1){this.capacity=r,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${r}`);let t=r*Tl.eSize;this.buffer=new ArrayBuffer(t);let o=Float32Array.BYTES_PER_ELEMENT,i=0;this.positions=new Float32Array(this.buffer,i*o,3*r),i+=3*r,this.normals=new Float32Array(this.buffer,i*o,3*r),i+=3*r,this.uvs=new Float32Array(this.buffer,i*o,2*r)}realloc(r,e=!1){if(r<this.size)throw Error("cannot shrink buffer");if(r<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${r}`);let t=r*Tl.eSize,o=new ArrayBuffer(t),i=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(o,s*i,3*r);s+=3*r;let c=new Float32Array(o,s*i,3*r);s+=3*r;let u=new Float32Array(o,s*i,2*r);a.set(this.positions.slice(0,3*this.size)),c.set(this.normals.slice(0,3*this.size)),u.set(this.uvs.slice(0,2*this.size)),this.buffer=o,this.positions=a,this.normals=c,this.uvs=u,this.capacity=r}get(r=1){let e=this.size+r;if(e>this.capacity){let o=this.capacity;for(;e>o;)o*=2;this.realloc(o)}let t=this.size;return this.size=e,t}reserve(r){let e=this.size+r;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},ws=Tl;ws.eSize=8*Float32Array.BYTES_PER_ELEMENT;var _s={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},Cd={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},Nd={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},Ad=(n,r)=>([e,t])=>(t<e&&(t+=r),(n>=e?n:n+r)<=t),ni=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(e,t,o=0,i=12,s=3,a=be.ODD){let d;super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._bevel=o,this._curveSegments=i,this._bevelSegmentsInput=s,o<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(o,t/2-1e-12),this._bevelSegments=Math.floor(s));let c=this._shape.extractShapePointsToFlatArray([],i),u=this._shape.shapeHoles.map(_=>{let v=_.extractShapePointsToFlatArray([],i),N=[];for(let T=v.length-1;T>=1;T-=2){let C=v[T-1],O=v[T-0];N.push(C,O)}return N}),l;try{l=ar({windingRule:a,elementType:Ge.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[c]})}catch{l=_s}try{d=ar({windingRule:be.ODD,elementType:Ge.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...u]})}catch{d=Cd}if(!l)throw Error("error generating geometry");let p=l.elementCount;if(d){l.elementCount+=d.elementCount;for(let _=0;_<d.elements.length;_++){let v=d.elements[_],N=_%2==0?l.vertexCount:0;l.elements.push(v+N)}for(let _1=0;_1<d.vertexIndices.length;_1++){let v1=d.vertexIndices[_1],N1=l.vertexCount;l.vertexIndices.push(v1+N1)}for(let _2=0;_2<d.vertices.length;_2++){let v2=d.vertices[_2];l.vertices.push(v2)}}let f=1/0,m=-1/0,h=1/0,y=-1/0;for(let _3=0,v3=l.vertexCount;_3<v3;_3++){let N2=2*_3,T=l.vertices[N2+0],C=l.vertices[N2+1];T<f&&(f=T),T>m&&(m=T),C<h&&(h=C),C>y&&(y=C)}this._minX=f,this._minY=h,this._width=m-f,this._height=y-h,this._buffer=new ws(this._computeBufferEstimatedSize(l));let g=[],x=[];for(let _4=l.elementCount-1;_4>=0;_4--){let v4=_4>=p,N3=2*_4,T1=l.elements[N3+0],C1=l.elements[N3+1],O=T1+C1,A={start:T1,count:C1,normals:[],continuous:[],concave:[]},R=T1,U=O-1,$=T1+1,ee=this._shape.roundedCurves.length;do{let V=R-T1,G=l.vertices[2*U+0],D=l.vertices[2*U+1],L=l.vertices[2*R+0],B=l.vertices[2*R+1],K=l.vertices[2*$+0],W=l.vertices[2*$+1],j=L-G,F=B-D,M=Math.sqrt(j*j+F*F);j/=M,F/=M;let Q=L-K,re=B-W,oe=Math.sqrt(Q*Q+re*re);Q/=oe,re/=oe,A.normals[2*V+0]=-re,A.normals[2*V+1]=Q,A.concave[V]=j*re-F*Q>0;let Z=l.vertexIndices[R];if(Array.isArray(Z))A.continuous[V]=!1;else{let[te,J]=this._shape.getCurveIndexFromVertexId(Z-1,!0);if(J>0&&J<1)A.continuous[V]=!0;else{let ie=1===J?te+1:te-1;ie=(ie+ee)%ee;let ce=1===J?0:1,se=this._shape.roundedCurves[te].getTangent(J),fe=this._shape.roundedCurves[ie].getTangent(ce);A.continuous[V]=se.dot(fe)>.95}}v4&&(A.normals[2*V+0]*=-1,A.normals[2*V+1]*=-1),[U,R,$]=[R,$,$+1],$>=O&&($-=C1)}while($!==T1+1);let X=[];X.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(2*T1,2*O),vertexCount:C1,vertexIndices:Array(C1).fill(!0).map((V,G)=>[G,G]),elements:[0,C1],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(2*T1,2*O)});for(let V1=1;V1<=this._bevelSegments;V1++){let G1=V1/this._bevelSegments*Math.PI/2,D1=(1-Math.cos(G1))*this._bevelSize,L1=[],B1=[],K1=[],W1=[],j1=0;for(let M1=0;M1<C1;M1++){let Q1=2*M1,re1=(M1-1+C1)%C1*2,oe1=l.vertices[2*A.start+Q1+0],Z1=l.vertices[2*A.start+Q1+1],te1=-A.normals[re1+0]*D1,J1=-A.normals[re1+1]*D1,ie1=-A.normals[Q1+0]*D1,ce1=-A.normals[Q1+1]*D1;if(A.concave[M1]||!A.concave[M1]&&v4){let se1=Math.atan2(J1,te1),fe1=Math.atan2(ce1,ie1);fe1>se1&&(fe1-=2*Math.PI);let ze=fe1-se1;if(A.continuous[M1]||v4){let ge=se1+ze/2,qe=Math.cos(ge)*D1,Oe=Math.sin(ge)*D1;L1[2*j1+0]=oe1+qe*(v4?-1:1),L1[2*j1+1]=Z1+Oe*(v4?-1:1),W1[j1]=M1,j1++}else{let ge1=Math.max(1,Math.floor(i/4*Math.abs(ze)/Math.PI));for(let qe1=0;qe1<=ge1;qe1++){let Oe1=se1+ze*(qe1/ge1),Ot=Math.cos(Oe1)*D1,Wt=Math.sin(Oe1)*D1;L1[2*j1+0]=oe1+Ot,L1[2*j1+1]=Z1+Wt,W1[j1]=M1,j1++}}}else L1[2*j1+0]=oe1+te1,L1[2*j1+1]=Z1+J1,W1[j1]=M1,B1[M1]=j1,L1[2*++j1+0]=oe1,L1[2*j1+1]=Z1,W1[j1]=M1,L1[2*++j1+0]=oe1+ie1,L1[2*j1+1]=Z1+ce1,W1[j1]=M1,K1[M1]=j1,j1++}let F1=ar({windingRule:be.POSITIVE,elementType:Ge.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[L1],edgeCreateCallback(M){let re=M.Org.idx,oe=W1[re],Z=W1[(re+1)%W1.length];M.idx=[oe,Z],M.Sym.idx=[Z,oe]},vertexIdCallback(M){let Q=M.Lprev.idx;return[Q?Q[1]:0,M.idx?M.idx[0]:0]}});if(!F1)throw console.log("Error"),Error(`error generating bevel geometry for ${V1}'th loop`);if(!F1.vertexCount)break;for(let M2=0;M2<F1.vertexIndices.length;M2++){let[Q2,re2]=F1.vertexIndices[M2];if(Q2===re2)continue;let oe2=re2;re2<Q2&&(oe2+=C1);for(let Z2=Q2;Z2<oe2;Z2++){let te2=Z2%C1,J2=(Z2+1)%C1;if(!A.continuous[te2]||!A.continuous[J2]){F1.vertexIndices[M2]=[Q2,te2],F1.vertexIndices.splice(M2+1,0,[J2,re2]),F1.vertices.splice((M2+1)*2,0,F1.vertices[2*M2],F1.vertices[2*M2+1]);break}}}X.push({bevelI:V1,angle:G1,size:D1,boundary:F1,reverseMap:W1,insetPoints:L1})}let q=(V,G,D)=>{let L=0,B=V.boundary.vertexIndices.length;for(;L<B&&D(V.boundary.vertexIndices[G]);)G=(G+1)%B,L++;return L},H=g.length;for(let V2=1;V2<X.length;V2++){let G2=X[V2-1],D2=X[V2],L2=G2.boundary.vertexIndices.length,B2=D2.boundary.vertexIndices.length;if(!L2||!B2)break;let K2=A.concave.length,W2=0,j2=Ad(0,C1);for(;!G2.boundary.vertexIndices.filter(j2).length||!D2.boundary.vertexIndices.filter(j2).length;)j2=Ad(++W2,C1);let F2=G2.boundary.vertexIndices.findIndex(j2),M3=D2.boundary.vertexIndices.findIndex(j2);do F2=(F2+1)%L2;while(j2(G2.boundary.vertexIndices[F2]));do M3=(M3+1)%B2;while(j2(D2.boundary.vertexIndices[M3]));let Q3=W2=(W2+1)%C1,re3=this._buildBevelVert(A,G2,(F2-1+L2)%L2),oe3=this._buildBevelVert(A,D2,(M3-1+B2)%B2),Z3=re3,te3=oe3,J3,ie2,ce2=!1;do{let se2=q(G2,F2,j2=Ad(W2,C1)),fe2=q(D2,M3,j2),ze1=ce2;if(ce2=!1,se2&&!fe2){for(let ge2=0;ge2<se2;ge2++)J3=this._buildBevelVert(A,G2,(F2+ge2)%L2,ge2/(se2-1)),g.push(Z3.topN,J3.topP,te3.topN),g.push(J3.bottomP,Z3.bottomN,te3.bottomN),Z3=J3;ce2=!0}else if(!se2&&fe2)for(let ge3=0;ge3<fe2;ge3++)ie2=this._buildBevelVert(A,D2,(M3+ge3)%B2,ge3/(fe2-1)),g.push(te3.topN,Z3.topP,ie2.topP),g.push(Z3.bottomP,te3.bottomN,ie2.bottomP),te3=ie2;else if(se2&&fe2){if(J3=this._buildBevelVert(A,G2,F2,0),ie2=this._buildBevelVert(A,D2,M3,0),ze1?(g.push(Z3.topN,ie2.topP,te3.topN),g.push(Z3.topN,J3.topP,ie2.topP),g.push(ie2.bottomP,Z3.bottomN,te3.bottomN),g.push(ie2.bottomP,J3.bottomP,Z3.bottomN)):(g.push(te3.topN,Z3.topN,J3.topP),g.push(te3.topN,J3.topP,ie2.topP),g.push(J3.bottomP,Z3.bottomN,te3.bottomN),g.push(J3.bottomP,te3.bottomN,ie2.bottomP)),Z3=J3,te3=ie2,se2===fe2)for(let ge4=1;ge4<se2;ge4++)J3=this._buildBevelVert(A,G2,(F2+ge4)%L2,ge4/(se2-1)),ie2=this._buildBevelVert(A,D2,(M3+ge4)%B2,ge4/(fe2-1)),g.push(Z3.topN,J3.topP,te3.topN),g.push(te3.topN,J3.topP,ie2.topP),g.push(J3.bottomP,Z3.bottomN,te3.bottomN),g.push(J3.bottomP,te3.bottomN,ie2.bottomP),Z3=J3,te3=ie2;else if(se2>fe2){let ge5=se2/fe2,qe2=0;for(let Oe2=1;Oe2<se2;Oe2++)J3=this._buildBevelVert(A,G2,(F2+Oe2)%L2,Oe2/(se2-1)),g.push(Z3.topN,J3.topP,te3.topN),g.push(J3.bottomP,Z3.bottomN,te3.bottomN),Z3=J3,Oe2>(qe2+1)*ge5&&(qe2++,ie2=this._buildBevelVert(A,D2,(M3+qe2)%B2,qe2/(fe2-1)),g.push(te3.topN,J3.topP,ie2.topP),g.push(J3.bottomP,te3.bottomN,ie2.bottomP),te3=ie2)}else{let ge6=fe2/se2,qe3=0;for(let Oe3=1;Oe3<fe2;Oe3++)ie2=this._buildBevelVert(A,D2,(M3+Oe3)%B2,Oe3/(fe2-1)),g.push(te3.topN,J3.topP,ie2.topP),g.push(J3.bottomP,te3.bottomN,ie2.bottomP),te3=ie2,Oe3>(qe3+1)*ge6&&(qe3++,J3=this._buildBevelVert(A,G2,(F2+qe3)%L2,qe3/(se2-1)),g.push(Z3.topN,J3.topP,te3.topN),g.push(J3.bottomP,Z3.bottomN,te3.bottomN),Z3=J3)}}F2=(F2+se2)%L2,M3=(M3+fe2)%B2,W2=(W2+1)%K2}while(W2!==Q3)}if(this._depth>2*this._bevel&&this._buildWall(X,A,g),v4){let V3=[];for(let G3=g.length-1;G3>=H+2;G3-=3){let D3=g[G3-2],L3=g[G3-1],B3=g[G3-0];V3.push(B3,L3,D3)}g.splice(H,g.length-H,...V3)}if(v4){let V4=[];for(let G4=X[X.length-1].boundary.vertices.length-1;G4>=1;G4-=2){let D4=X[X.length-1].boundary.vertices[G4-1],L4=X[X.length-1].boundary.vertices[G4-0];V4.push(D4,L4)}x.push(V4)}if(!v4){let V5=X[X.length-1],G5;try{G5=ar({windingRule:X.length>1?be.POSITIVE:be.ODD,elementType:Ge.POLYGONS,vertexSize:2,strict:!0,contours:[V5.insetPoints,...x]})}catch{G5=Nd}if(!G5)throw Error("Error generating geometry for surface");0===u.length&&Object.assign(this,{capStartIndex:g.length});for(let D5=0;D5<3*G5.elementCount;D5+=3){let L5=this._buildSurfaceVert(G5,G5.elements[D5+0]),B4=this._buildSurfaceVert(G5,G5.elements[D5+1]),K3=this._buildSurfaceVert(G5,G5.elements[D5+2]);g.push(L5.top,B4.top,K3.top),g.push(K3.bottom,B4.bottom,L5.bottom)}}this.vertexCache={}}this._buffer.shrink();let b=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(Uint32Array.from(g),1),w=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(this._buffer.positions,3),S=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(this._buffer.normals,3),P=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(this._buffer.uvs,2);w.needsUpdate=!0,S.needsUpdate=!0,P.needsUpdate=!0,b.needsUpdate=!0,this.setAttribute("position",w),this.setAttribute("normal",S),this.setAttribute("uv",P),this.setIndex(b)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,o){let i=e[0];for(let s=0,a=i.boundary.vertexCount;s<a;s++){let c=this._buildBevelVert(t,i,s),u=this._buildBevelVert(t,i,(s+1)%a);o.push(u.topP,c.topN,c.bottomN),o.push(u.topP,c.bottomN,u.bottomP)}}_buildSurfaceVert(e,t){let o=t.toString();if(o in this.vertexCache)return this.vertexCache[o];let i=e.vertices[2*t+0],s=e.vertices[2*t+1],a=(i-this._minX)/this._width,c=(s-this._minY)/this._height,u=this._buffer.get(2),l=3*u,d=2*u,p={top:u+0,bottom:u+1};return this._buffer.positions[l+0]=i,this._buffer.positions[l+1]=s,this._buffer.positions[l+2]=this._depth,this._buffer.normals[l+0]=0,this._buffer.normals[l+1]=0,this._buffer.normals[l+2]=1,this._buffer.uvs[d+0]=a,this._buffer.uvs[d+1]=c,this._buffer.positions[l+3]=i,this._buffer.positions[l+4]=s,this._buffer.positions[l+5]=0,this._buffer.normals[l+3]=0,this._buffer.normals[l+4]=0,this._buffer.normals[l+5]=-1,this._buffer.uvs[d+2]=a,this._buffer.uvs[d+3]=c,this.vertexCache[o]=p,p}_buildBevelVert(e,t,o,i=1){let s=`${t.bevelI}:${o}`;if(s in this.vertexCache)return this.vertexCache[s];let[a,c]=t.boundary.vertexIndices[o],u,l,d,p;a!==c?(l=a,u=c,p=!1,d=e.continuous[l]&&e.continuous[u]):(l=((u=a)-1+e.count)%e.count,p=e.concave[u]&&t.bevelI>0,d=e.continuous[u]||p);let f=Math.cos(t.angle),m=Math.sin(t.angle),h=2*o,y=2*u,g=2*l,x=t.boundary.vertices[h+0],b=t.boundary.vertices[h+1],w=(1-m)*this._bevelSize,S=(x-this._minX)/this._width,P=(b-this._minY)/this._height,_=e.normals[y+0],v=e.normals[y+1],N=e.normals[g+0],T=e.normals[g+1];if(p){let U=N-_,$=T-v,ee=Math.sqrt((_+=U*(1-i))*_+(v+=$*(1-i))*v);_/=ee,v/=ee}let C=this._buffer.get(d?2:4),O=3*C,A=2*C,R={i:o,fi:u,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1};return this._buffer.positions[O+0]=x,this._buffer.positions[O+1]=b,this._buffer.positions[O+2]=this._depth-w,this._buffer.normals[O+0]=_*f,this._buffer.normals[O+1]=v*f,this._buffer.normals[O+2]=m,this._buffer.uvs[A+0]=S,this._buffer.uvs[A+1]=P,this._buffer.positions[O+3]=x,this._buffer.positions[O+4]=b,this._buffer.positions[O+5]=w,this._buffer.normals[O+3]=_*f,this._buffer.normals[O+4]=v*f,this._buffer.normals[O+5]=-m,this._buffer.uvs[A+2]=P,this._buffer.uvs[A+3]=S,d||(C+=2,O+=6,A+=4,R.topP=C+0,R.bottomP=C+1,this._buffer.positions[O+0]=x,this._buffer.positions[O+1]=b,this._buffer.positions[O+2]=this._depth-w,this._buffer.normals[O+0]=N*f,this._buffer.normals[O+1]=T*f,this._buffer.normals[O+2]=m,this._buffer.uvs[A+0]=S,this._buffer.uvs[A+1]=P,this._buffer.positions[O+3]=x,this._buffer.positions[O+4]=b,this._buffer.positions[O+5]=w,this._buffer.normals[O+3]=N*f,this._buffer.normals[O+4]=T*f,this._buffer.normals[O+5]=-m,this._buffer.uvs[A+2]=P,this._buffer.uvs[A+3]=S),this.vertexCache[s]=R,R}clone(){let e=new ni(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=qr(this.userData),e}},ii=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(e,t=12,o={}){super(),this.type="ShapeGeometry",this.windingRule=be.ODD,this.elementType=Ge.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:be.ODD,elementType:Ge.POLYGONS,polySize:3,vertexSize:2,strict:!0},o);let i=this._shape.extractShapePointsToFlatArray([],this._curveSegments),s=this._shape.shapeHoles.map(m=>m.extractShapePointsToFlatArray([],this._curveSegments)),a,c=!0,u=!0,l,d;for(let m=0,h=i.length/2;m<h;m++){let y=2*m,g=i[y+0],x=i[y+1];if(void 0!==l&&g!==l&&(c=!1),void 0!==d&&x!==d&&(u=!1),l=g,d=x,!c&&!u)break}if(!c&&!u)try{a=ar({contours:[i,...s],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{a=_s}let p=a?.vertexCount??1,f=a?.elementCount??1;if(this._positionAttribute=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(new Float32Array(3*p),3),this._normalAttribute=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(new Float32Array(3*p),3),this._uvAttribute=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(new Float32Array(2*p),2),this._indexAttribute=new three__WEBPACK_IMPORTED_MODULE_0__.TlE(new Uint32Array(3*f),1),a){let m1=1/0,h1=-1/0,y1=1/0,g1=-1/0;for(let w=0;w<p;w++){let P=2*w,_=a.vertices[P+0],v=a.vertices[P+1];_<m1&&(m1=_),_>h1&&(h1=_),v<y1&&(y1=v),v>g1&&(g1=v)}let x1=h1-m1,b=g1-y1;for(let w1=0;w1<p;w1++){let P1=2*w1,_1=a.vertices[P1+0],v1=a.vertices[P1+1],N=(_1-m1)/x1,T=(v1-y1)/b;this._positionAttribute.setXYZ(w1,_1,v1,0),this._normalAttribute.setXYZ(w1,0,0,1),this._uvAttribute.setXY(w1,N,T)}for(let w2=0;w2<f;w2++){let P2=3*w2,_2=a.elements[P2+0],v2=a.elements[P2+1],N1=a.elements[P2+2];this._indexAttribute.setX(P2+0,_2),this._indexAttribute.setX(P2+1,v2),this._indexAttribute.setX(P2+2,N1)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(a?.elementCount??1)*3)}clone(){let e=new ii(this._shape,this._curveSegments);return e.userData=qr(this.userData),e}},si=class extends ni{constructor(e,t,o=0,i=12,s=3,a=be.ODD){super(e,t,o,i,s,a),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,o){let i=e[0];for(let s=0,a=i.boundary.vertexCount;s<a;s++){let c=this._buildBevelVert(t,i,s),u=this._buildBevelVert(t,i,(s+1)%a);o.push(u.topP,c.topN,c.bottomN),o.push(u.topP,c.bottomN,u.bottomP)}}clone(){let e=new si(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=qr(this.userData),e}},Mt=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:be.ODD},n.parameters),t=Math.abs(e.width),o=Math.abs(e.height??e.width),i=Math.abs(e.depth??0),s=n.shape??r?.shape,a=s?.roundness??e.roundness;void 0!==s&&(s instanceof _e?(s.width!==t||s.height!==o)&&s.applySize(t,o):s=new _e(t,o).fromJSON(s),n.parameters?.roundness!==void 0&&n.parameters?.roundness>0&&s.update());let c=s??new _e(t,o);return{parameters:Object.assign(e,{width:t,height:o,depth:i,roundness:a}),shape:c}}static build(n){let{depth:r,extrudeBevelSize:e,extrudeBevelSegments:t,subdivisions:o,roundness:i,windingRule:s}=n.parameters;return n.shape.roundness=i,Object.assign(r<=0?new ii(n.shape,o,{windingRule:s}):new si(n.shape,r,e,o,t,s),{userData:{...n,type:"VectorGeometry"}})}},ay=2*Math.PI,li=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},n.parameters);return{shape:n.shape&&n.shape instanceof _e?n.shape:new _e,parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??0)})}}static build(n){let{width:r,height:e,spikes:t,angle:o,innerRadius:i,depth:s,extrudeBevelSize:a,extrudeBevelSegments:c}=n.parameters,u=n.shape,p=function(n,r,e,t,o,i){if(t>=ay)return o>30||o%4==0?(function(n,r,e,t=0,o=0,i=0){let a=.5522847498*r,c=.5522847498*e;n.addPoint(Cl(o-r,i,o-r,i-c,o-r,i+c)),n.addPoint(Cl(o,i+e,o-a,i+e,o+a,i+e)),n.addPoint(Cl(o+r,i,o+r,i+c,o+r,i-c)),n.addPoint(Cl(o,i-e,o+a,i-e,o-a,i-e)),t>0&&cy(n,r,e,t)}(n,r,e,i),Math.round(o/4)):ny(n,t,o,r,e,i);let s={x:0,y:e},a=(t=Math.max(t,.001))+.5*Math.PI,c={x:Math.cos(a)*r,y:Math.sin(a)*e},u=function({px:n,py:r,cx:e,cy:t,rx:o,ry:i,largeArcFlag:s,sweepFlag:a}){var o1,i1;let l,d,p,f,m,h,y,b,w,_,v,c=[];if(0===o||0===i)return[];let u=(n-e)/2,l1=(r-t)/2;if(0===u&&0===l1)return[];let d1=Math.pow(u,2)/Math.pow(o=Math.abs(o),2)+Math.pow(l1,2)/Math.pow(i=Math.abs(i),2);d1>1&&(o*=Math.sqrt(d1),i*=Math.sqrt(d1));let p1=(o1=o,i1=i,l=Math.pow(o1,2),d=Math.pow(i1,2),p=Math.pow(u,2),(m=l*d-l*(f=Math.pow(l1,2))-d*p)<0&&(m=0),m/=l*f+d*p,h=(m=Math.sqrt(m)*(s===a?-1:1))*o1/i1*l1,y=-(m*i1)/o1*u,_=Qh(1,0,b=(u-h)/o1,w=(l1-y)/i1),v=Qh(b,w,(-u-h)/o1,(-l1-y)/i1),!a&&v>0&&(v-=Td),a&&v<0&&(v+=Td),{centerx:h+(n+e)/2,centery:y+(r+t)/2,ang1:_,ang2:v}),{ang1:f1,ang2:m1}=p1,{centerx:h1,centery:y1}=p1,g=Math.abs(m1)/(Td/4);1e-7>Math.abs(1-g)&&(g=1);let x=Math.max(Math.ceil(g),1);m1/=x;for(let b1=0;b1<x;b1++)c.push(function(n,r){let e=1.5707963267948966===r?.551915024494:-1.5707963267948966===r?-.551915024494:1.3333333333333333*Math.tan(r/4),t=Math.cos(n),o=Math.sin(n),i=Math.cos(n+r),s=Math.sin(n+r);return[{x:t-o*e,y:o+t*e},{x:i+s*e,y:s-i*e},{x:i,y:s}]}(f1,m1)),f1+=m1;return c.map(b=>{let{x:w,y:S}=Pd(b[0],o,i,h1,y1),{x:P,y:_}=Pd(b[1],o,i,h1,y1),{x:v,y:N}=Pd(b[2],o,i,h1,y1);return{x1:w,y1:S,x2:P,y2:_,x:v,y:N}})}({px:s.x,py:s.y,cx:c.x,cy:c.y,rx:r,ry:e,largeArcFlag:t>Math.PI,sweepFlag:!0});return o>30||o%u.length==0?function(n,r,e,t,o,i,s,a){let c=Math.round(o/t.length);n.addPoint(ai(r,e));for(let u=0,l=t.length;u<l;u++){let d=t[u],p=n.points[u],f=ai(d.x,d.y);p.controls[1].position.set(d.x1,d.y1),f.controls[0].position.set(d.x2,d.y2),n.addPoint(f)}return a>0?ly(n,i,s,a):n.addPoint(ai(0,0)),c}(n,s.x,s.y,u,o,r,e,i):ny(n,t,o,r,e,i)}(u,.5*r,.5*e,o*Math.PI/180,t,i);return u.isClosed=!0,u.update(),Object.assign(Mt.create({shape:u,parameters:{subdivisions:p,depth:s,extrudeBevelSize:a,extrudeBevelSegments:c}}),{userData:{...n,type:"EllipseGeometry"}})}};function ny(n,r,e,t,o,i){let s=-r/e;for(let a=0;a<=e;a++){let c=s*a,u=Math.sin(c)*t,l=Math.cos(c)*o;n.addPoint(ai(u,l))}return r<ay?i>0?ly(n,t,o,i):n.addPoint(ai(0,0)):(n.removePoint(n.points[n.points.length-1]),i>0&&cy(n,t,o,i)),1}function ai(n,r){return new sr(three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),new three__WEBPACK_IMPORTED_MODULE_0__.FM8(n,r))}function Cl(n,r,e,t,o,i){let s=ai(n,r);return s.controls[0].position.set(e,t),s.controls[1].position.set(o,i),s}function ly(n,r,e,t){dy(n,r,e,t).forEach(i=>n.addPoint(i))}function cy(n,r,e,t){let o=dy(n,r,e,t),i=new _e;o.forEach(s=>i.addPoint(s)),i.isClosed=!0,n.shapeHoles.push(i)}function dy(n,r,e,t){let o=t*r/100,s=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(o/r,o*(Math.abs(e)/Math.abs(r))/e),a=n.points.map(c=>{let u=c.clone();return u.uuid=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),u}).reverse();return a.forEach(c=>{c.position.multiply(s);let u=c.controls[0].position.clone().multiply(s),l=c.controls[1].position.clone().multiply(s);c.controls[0].position.copy(l),c.controls[1].position.copy(u)}),a}var py=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},n.parameters),t=Math.abs(e.width),o=Math.abs(e.height??t),i=Math.abs(e.depth??t);return{parameters:Object.assign(e,{width:t,height:o,depth:i,radius:Math.abs(Math.min(t,i))/2,segments:Math.round(e.segments),pathSegments:Math.round(e.pathSegments),cornerSegments:Math.round(e.cornerSegments)})}}static build(n){let{width:r,height:e,depth:t,radius:o,revolutions:i,segments:s,pathRadius:a,pathType:c,pathSegments:u,cornerRadius:l,cornerSegments:d}=n.parameters;return Object.assign(new Ps(!1,r,e,t,o,i,s,a,c,u,l,d),{userData:{...n,type:"HelixGeometry"}})}},Md=new three__WEBPACK_IMPORTED_MODULE_0__.lCJ([0,0,0],1),Ps=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(r=!0,e=1,t=1,o=1,i=1,s=1,a=1,c=1,u=1,l=1,d=1,p=1){if(super(),0===s)return;let f=r&&1===s;f&&(p=0),d>100&&(d=100),0===d&&(p=0);let m=()=>new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,h=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,y=m(),g=m(),x=m(),b,w,S,P,_,v,N,T,C=m(),O=m(),A=m(),R=m(),U=m(),$=m(),ee=m(),X=m(),q=t-2*c+.001,H=q/s,V=Math.ceil(a*s),G=V+1,D=q/V,L=-q/2,B=l+1,K=2*Math.PI/l,W=Math.PI/2/p,F=Math.min((1-d/100)*c,c-.01),M=c-F,Q=0,oe=2*p+2,Z=B*oe/2,te=Z+B*G,J=B*(G+oe),[ie,ce,se]=[3,3,2].map(Ue=>Array(J*Ue).fill(0)),fe=[],ze=i-c;function ge(Ue,Gt){T=2*Math.PI*((v=Gt*D)%H)/H+Math.PI/2,v+=L,N=Math.sin(T)*ze,_=Math.cos(T)*ze,r?Ue.set(_,N,v):Ue.set(_,v,N)}ge(h,-.0000000001),ge(y,0),C.copy(h),ge(h,1);let qe=h.distanceTo(y),Oe=f?0:M+F,Ot=qe*V+2*Oe,un=Ot-Oe;for(let Ue=0;Ue<=V;Ue++){ge(g,Ue),X.subVectors(g,C).normalize(),C.copy(g),$.copy(g).setComponent(+r+1,0).normalize(),ee.crossVectors(X,$).normalize();let Gt=0===Ue,hr=Ue===V,G0=Gt?3*Math.PI/2:W,V0=Gt?F:un,z0=Gt?B:te,j0=Gt?0:J-B,F0=X.clone().multiplyScalar(Gt?-M:M).add(g),k0=X.clone().multiplyScalar(Gt?-1:1).normalize();for(let Fr=0;Fr<B;Fr++){let Hu=Fr*K;if(O.addVectors(h.copy($).multiplyScalar(c*Math.cos(Hu)),y.copy(ee).multiplyScalar(c*Math.sin(Hu))),A.copy(O).normalize(),Gt||hr){f||(Q=j0+Fr,[0,1,2].forEach(At=>{ie[3*Q+At]=F0.getComponent(At),ce[3*Q+At]=k0.getComponent(At)}),se[2*Q]=+hr,se[2*Q+1]=Fr/l),y.copy(A).multiplyScalar(F),x.addVectors(g,y);for(let At=0;At<p;At++){let xc=At*W+G0;R.addVectors(h.copy(X).multiplyScalar(M*Math.sin(xc)),y.copy(A).multiplyScalar(M*Math.cos(xc))),U.copy(R).normalize(),y.addVectors(x,R),R.normalize(),Q=z0+At*B+Fr,[0,1,2].forEach(na=>{ie[3*Q+na]=y.getComponent(na),ce[3*Q+na]=U.getComponent(na)});let U0=+Gt+Math.sin(xc);se[2*Q]=(V0+M*U0)/Ot,se[2*Q+1]=Fr/l}}y.addVectors(g,O),Q=Z+Ue*B+Fr,[0,1,2].forEach(At=>{ie[3*Q+At]=y.getComponent(At),ce[3*Q+At]=A.getComponent(At)}),se[2*Q]=(Oe+Ue*qe)/Ot,se[2*Q+1]=Fr/l}}let Rt=G+2*p+2,[ra,oa]=[+f,Rt-1];for(let Ue1=ra;Ue1<=oa-1;Ue1++){let Gt1=f&&Ue1===oa-1;for(let hr1=0;hr1<B-1;hr1++)w=(b=Ue1*B+hr1)+1,S=(Gt1?hr1:b)+B,P=(Gt1?hr1+1:w)+B,0===Ue1?fe.push(w,P,S):Ue1===Rt-2?fe.push(b,w,S):fe.push(b,w,S,w,P,S)}this.setIndex(fe),this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(ie,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(ce,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(se,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let r=this.userData.parameters,e=Math.ceil(r.tubularSegments),t=r.radialSegments+1,o=Array.from(this.getIndex().array),i,s,a,c,u=6*(e-1)*r.radialSegments,d=e==e;for(let p=0;p<r.radialSegments;p++)s=(i=e*t+p)+1,a=(d?p:i)+t,c=(d?p+1:s)+t,o[u++]=i,o[u++]=s,o[u++]=a,o[u++]=s,o[u++]=c,o[u++]=a;return o.length=u,Md.array=o,Md.count=o.length,Md}},fy=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,detail:0,corner:0,cornerSides:4},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r,height:e,depth:t,detail:o,corner:i,cornerSides:s}=n.parameters,a=0===o&&0!==i?new Ts(.5*r,i,s):new three__WEBPACK_IMPORTED_MODULE_0__.cJO(.5*r,o);return a.scale(1,e/r,t/r),Object.assign(a,{userData:{...n,type:"IcosahedronGeometry"}})}},Ts=class extends To{constructor(r=1,e=.2,t=4){let o=(1+Math.sqrt(5))/2,a="IcosahedronGeometry";super([-1,o,0,1,o,0,-1,-o,0,1,-o,0,0,-1,o,0,1,o,0,-1,-o,0,1,-o,o,0,-1,o,0,1,-o,0,-1,-o,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,r,e,t),this.type=a}static fromJSON(r){return new Ts(r.radius,r.corner,r.cornerSides)}},my=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){(n.parameters?.points??[]).forEach(t=>{Array.isArray(t)&&(t.x=t[0],t.y=t[1])});let e=Object.assign({},r?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{points:r,segments:e,verticalSegments:t}=n.parameters,o=new three__WEBPACK_IMPORTED_MODULE_0__.bnF;o.moveTo(r[0].x,r[0].y),o.bezierCurveTo(r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y);let i=new three__WEBPACK_IMPORTED_MODULE_0__.p7y(o.extractPoints(t).shape,e);return i.rotateZ(Math.PI),Object.assign(i,{userData:{...n,type:"LatheGeometry"}})}},Ar=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Ed=new three__WEBPACK_IMPORTED_MODULE_0__.Tme,Nl=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Ao=class extends three__WEBPACK_IMPORTED_MODULE_0__.pBf{constructor(){super(),this.uuid=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(r){let e=new three__WEBPACK_IMPORTED_MODULE_0__.Vkp().getNormalMatrix(r);for(let t=0,o=this.vertices.length;t<o;t++)this.vertices[t].applyMatrix4(r);for(let t1=0,o1=this.faces.length;t1<o1;t1++){let i=this.faces[t1];i.normal.applyMatrix3(e).normalize();for(let s=0,a=i.vertexNormals.length;s<a;s++)i.vertexNormals[s].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(r){return Ar.makeRotationX(r),this.applyMatrix4(Ar),this}rotateY(r){return Ar.makeRotationY(r),this.applyMatrix4(Ar),this}rotateZ(r){return Ar.makeRotationZ(r),this.applyMatrix4(Ar),this}translate(r,e,t){return Ar.makeTranslation(r,e,t),this.applyMatrix4(Ar),this}scale(r,e,t){return Ar.makeScale(r,e,t),this.applyMatrix4(Ar),this}lookAt(r){return Ed.lookAt(r),Ed.updateMatrix(),this.applyMatrix4(Ed.matrix),this}fromBufferGeometry(r){let e=this,t=null!==r.index?r.index:void 0,o=r.attributes;if(void 0===o.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let i=o.position,s=o.normal,a=o.color,c=o.uv,u=o.uv2;void 0!==u&&(this.faceVertexUvs[1]=[]);for(let p=0;p<i.count;p++)e.vertices.push(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4().fromBufferAttribute(i,p)),void 0!==a&&e.colors.push(new three__WEBPACK_IMPORTED_MODULE_0__.Ilk().fromBufferAttribute(a,p));function l(p,f,m,h){let y=void 0===a?[]:[e.colors[p].clone(),e.colors[f].clone(),e.colors[m].clone()],g=void 0===s?[]:[new three__WEBPACK_IMPORTED_MODULE_0__.Pa4().fromBufferAttribute(s,p),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4().fromBufferAttribute(s,f),new three__WEBPACK_IMPORTED_MODULE_0__.Pa4().fromBufferAttribute(s,m)],x=new di(p,f,m,g,y,h);e.faces.push(x),void 0!==c&&e.faceVertexUvs[0].push([new three__WEBPACK_IMPORTED_MODULE_0__.FM8().fromBufferAttribute(c,p),new three__WEBPACK_IMPORTED_MODULE_0__.FM8().fromBufferAttribute(c,f),new three__WEBPACK_IMPORTED_MODULE_0__.FM8().fromBufferAttribute(c,m)]),void 0!==u&&e.faceVertexUvs[1].push([new three__WEBPACK_IMPORTED_MODULE_0__.FM8().fromBufferAttribute(u,p),new three__WEBPACK_IMPORTED_MODULE_0__.FM8().fromBufferAttribute(u,f),new three__WEBPACK_IMPORTED_MODULE_0__.FM8().fromBufferAttribute(u,m)])}let d=r.groups;if(d.length>0)for(let p1=0;p1<d.length;p1++){let f=d[p1],m=f.start,h=f.count;for(let y=m,g=m+h;y<g;y+=3)void 0!==t?l(t.getX(y),t.getX(y+1),t.getX(y+2),f.materialIndex):l(y,y+1,y+2,f.materialIndex)}else if(void 0!==t)for(let p2=0;p2<t.count;p2+=3)l(t.getX(p2),t.getX(p2+1),t.getX(p2+2));else for(let p3=0;p3<i.count;p3+=3)l(p3,p3+1,p3+2);return this.computeFaceNormals(),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone()),null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Nl).negate(),this.translate(Nl.x,Nl.y,Nl.z),this}normalize(){this.computeBoundingSphere();let r=this.boundingSphere.center,e=this.boundingSphere.radius,t=0===e?1:1/e,o=new three__WEBPACK_IMPORTED_MODULE_0__.yGw;return o.set(t,0,0,-t*r.x,0,t,0,-t*r.y,0,0,t,-t*r.z,0,0,0,1),this.applyMatrix4(o),this}computeFaceNormals(){let r=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,e=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let t=0,o=this.faces.length;t<o;t++){let i=this.faces[t],s=this.vertices[i.a],a=this.vertices[i.b],c=this.vertices[i.c];r.subVectors(c,a),e.subVectors(s,a),r.cross(e),r.normalize(),i.normal.copy(r)}}computeVertexNormals(r=!0){let e=Array(this.vertices.length);for(let t=0,o=this.vertices.length;t<o;t++)e[t]=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;if(r){let t1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,o1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let i=0,s=this.faces.length;i<s;i++){let a=this.faces[i],c=this.vertices[a.a],u=this.vertices[a.b],l=this.vertices[a.c];t1.subVectors(l,u),o1.subVectors(c,u),t1.cross(o1),e[a.a].add(t1),e[a.b].add(t1),e[a.c].add(t1)}}else{this.computeFaceNormals();for(let t2=0,o2=this.faces.length;t2<o2;t2++){let i1=this.faces[t2];e[i1.a].add(i1.normal),e[i1.b].add(i1.normal),e[i1.c].add(i1.normal)}}for(let t3=0,o3=this.vertices.length;t3<o3;t3++)e[t3].normalize();for(let t4=0,o4=this.faces.length;t4<o4;t4++){let i2=this.faces[t4],s1=i2.vertexNormals;3===s1.length?(s1[0].copy(e[i2.a]),s1[1].copy(e[i2.b]),s1[2].copy(e[i2.c])):(s1[0]=e[i2.a].clone(),s1[1]=e[i2.b].clone(),s1[2]=e[i2.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let r=0,e=this.faces.length;r<e;r++){let t=this.faces[r],o=t.vertexNormals;3===o.length?(o[0].copy(t.normal),o[1].copy(t.normal),o[2].copy(t.normal)):(o[0]=t.normal.clone(),o[1]=t.normal.clone(),o[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,t=this.faces.length;e<t;e++){let o=this.faces[e];o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]);for(let i=0,s=o.vertexNormals.length;i<s;i++)o.__originalVertexNormals[i]?o.__originalVertexNormals[i].copy(o.vertexNormals[i]):o.__originalVertexNormals[i]=o.vertexNormals[i].clone()}let r=new Ao;r.faces=this.faces;for(let e1=0,t1=this.morphTargets.length;e1<t1;e1++){if(!this.morphNormals[e1]){this.morphNormals[e1]={},this.morphNormals[e1].faceNormals=[],this.morphNormals[e1].vertexNormals=[];let i1=this.morphNormals[e1].faceNormals,s1=this.morphNormals[e1].vertexNormals;for(let a=0,c=this.faces.length;a<c;a++){let u=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,l={a:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,b:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,c:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4};i1.push(u),s1.push(l)}}let o1=this.morphNormals[e1];r.vertices=this.morphTargets[e1].vertices,r.computeFaceNormals(),r.computeVertexNormals();for(let i2=0,s2=this.faces.length;i2<s2;i2++){let a1=this.faces[i2],c1=o1.faceNormals[i2],u1=o1.vertexNormals[i2];c1.copy(a1.normal),u1.a.copy(a1.vertexNormals[0]),u1.b.copy(a1.vertexNormals[1]),u1.c.copy(a1.vertexNormals[2])}}for(let e2=0,t2=this.faces.length;e2<t2;e2++){let o2=this.faces[e2];o2.normal=o2.__originalFaceNormal,o2.vertexNormals=o2.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new three__WEBPACK_IMPORTED_MODULE_0__.ZzF),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new three__WEBPACK_IMPORTED_MODULE_0__.aLr),this.boundingSphere.setFromPoints(this.vertices)}merge(r,e,t=0){if(!(r&&r.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",r);return}let o,i=this.vertices.length,s=this.vertices,a=r.vertices,c=this.faces,u=r.faces,l=this.colors,d=r.colors;void 0!==e&&(o=new three__WEBPACK_IMPORTED_MODULE_0__.Vkp().getNormalMatrix(e));for(let p=0,f=a.length;p<f;p++){let h=a[p].clone();void 0!==e&&h.applyMatrix4(e),s.push(h)}for(let p1=0,f1=d.length;p1<f1;p1++)l.push(d[p1].clone());for(let p2=0,f2=u.length;p2<f2;p2++){let m=u[p2],h1,y,g=m.vertexNormals,x=m.vertexColors,b=new di(m.a+i,m.b+i,m.c+i);b.normal.copy(m.normal),void 0!==o&&b.normal.applyMatrix3(o).normalize();for(let w=0,S=g.length;w<S;w++)h1=g[w].clone(),void 0!==o&&h1.applyMatrix3(o).normalize(),b.vertexNormals.push(h1);b.color.copy(m.color);for(let w1=0,S1=x.length;w1<S1;w1++)y=x[w1],b.vertexColors.push(y.clone());b.materialIndex=m.materialIndex+t,c.push(b)}for(let p3=0,f3=r.faceVertexUvs.length;p3<f3;p3++){let m1=r.faceVertexUvs[p3];void 0===this.faceVertexUvs[p3]&&(this.faceVertexUvs[p3]=[]);for(let h2=0,y1=m1.length;h2<y1;h2++){let g1=m1[h2],x1=[];for(let b1=0,w2=g1.length;b1<w2;b1++)x1.push(g1[b1].clone());this.faceVertexUvs[p3].push(x1)}}}mergeMesh(r){if(!(r&&r.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",r);return}r.matrixAutoUpdate&&r.updateMatrix(),this.merge(r.geometry,r.matrix)}mergeVertices(r=4){let e={},t=[],o=[],i=Math.pow(10,r);for(let c=0,u=this.vertices.length;c<u;c++){let l=this.vertices[c],d=Math.round(l.x*i)+"_"+Math.round(l.y*i)+"_"+Math.round(l.z*i);void 0===e[d]?(e[d]=c,t.push(this.vertices[c]),o[c]=t.length-1):o[c]=o[e[d]]}let s=[];for(let c1=0,u1=this.faces.length;c1<u1;c1++){let l1=this.faces[c1];l1.a=o[l1.a],l1.b=o[l1.b],l1.c=o[l1.c];let d1=[l1.a,l1.b,l1.c];for(let p=0;p<3;p++)if(d1[p]===d1[(p+1)%3]){s.push(c1);break}}for(let c2=s.length-1;c2>=0;c2--){let u2=s[c2];this.faces.splice(u2,1);for(let l2=0,d2=this.faceVertexUvs.length;l2<d2;l2++)this.faceVertexUvs[l2].splice(u2,1)}let a=this.vertices.length-t.length;return this.vertices=t,a}setFromPoints(r){this.vertices=[];for(let e=0,t=r.length;e<t;e++){let o=r[e];this.vertices.push(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(o.x,o.y,o.z||0))}return this}sortFacesByMaterialIndex(){let r=this.faces,e=r.length;for(let c=0;c<e;c++)r[c]._id=c;r.sort(function(c,u){return c.materialIndex-u.materialIndex});let o=this.faceVertexUvs[0],i=this.faceVertexUvs[1],s,a;o&&o.length===e&&(s=[]),i&&i.length===e&&(a=[]);for(let c1=0;c1<e;c1++){let u=r[c1]._id;s&&s.push(o[u]),a&&a.push(i[u])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){let m=this.parameters;for(let h in m)void 0!==m[h]&&(r[h]=m[h]);return r}let e=[];for(let m1=0;m1<this.vertices.length;m1++){let h1=this.vertices[m1];e.push(h1.x,h1.y,h1.z)}let t=[],o=[],i={},s=[],a={},c=[],u={};for(let m2=0;m2<this.faces.length;m2++){let h2=this.faces[m2],x=void 0!==this.faceVertexUvs[0][m2],b=h2.normal.length()>0,w=h2.vertexNormals.length>0,S=1!==h2.color.r||1!==h2.color.g||1!==h2.color.b,P=h2.vertexColors.length>0,_=0;if(_=l(0,0,0),_=l(_,1,!0),_=l(_,2,!1),_=l(_,3,x),_=l(_,4,b),_=l(_,5,w),_=l(_,6,S),_=l(_,7,P),t.push(_),t.push(h2.a,h2.b,h2.c),t.push(h2.materialIndex),x){let v=this.faceVertexUvs[0][m2];t.push(f(v[0]),f(v[1]),f(v[2]))}if(b&&t.push(d(h2.normal)),w){let v1=h2.vertexNormals;t.push(d(v1[0]),d(v1[1]),d(v1[2]))}if(S&&t.push(p(h2.color)),P){let v2=h2.vertexColors;t.push(p(v2[0]),p(v2[1]),p(v2[2]))}}function l(m,h,y){return y?m|1<<h:m&~(1<<h)}function d(m){let h=m.x.toString()+m.y.toString()+m.z.toString();return void 0!==i[h]||(i[h]=o.length/3,o.push(m.x,m.y,m.z)),i[h]}function p(m){let h=m.r.toString()+m.g.toString()+m.b.toString();return void 0!==a[h]||(a[h]=s.length,s.push(m.getHex())),a[h]}function f(m){let h=m.x.toString()+m.y.toString();return void 0!==u[h]||(u[h]=c.length/2,c.push(m.x,m.y)),u[h]}return r.data={},r.data.vertices=e,r.data.normals=o,s.length>0&&(r.data.colors=s),c.length>0&&(r.data.uvs=[c]),r.data.faces=t,r}clone(){return new Ao().copy(this)}copy(r){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=r.name;let e=r.vertices;for(let p=0,f=e.length;p<f;p++)this.vertices.push(e[p].clone());let t=r.colors;for(let p1=0,f1=t.length;p1<f1;p1++)this.colors.push(t[p1].clone());let o=r.faces;for(let p2=0,f2=o.length;p2<f2;p2++)this.faces.push(o[p2].clone());for(let p3=0,f3=r.faceVertexUvs.length;p3<f3;p3++){let m=r.faceVertexUvs[p3];void 0===this.faceVertexUvs[p3]&&(this.faceVertexUvs[p3]=[]);for(let h=0,y=m.length;h<y;h++){let g=m[h],x=[];for(let b=0,w=g.length;b<w;b++){let S=g[b];x.push(S.clone())}this.faceVertexUvs[p3].push(x)}}let i=r.morphTargets;for(let p4=0,f4=i.length;p4<f4;p4++){let m1={};if(m1.name=i[p4].name,void 0!==i[p4].vertices){m1.vertices=[];for(let h1=0,y1=i[p4].vertices.length;h1<y1;h1++)m1.vertices.push(i[p4].vertices[h1].clone())}if(void 0!==i[p4].normals){m1.normals=[];for(let h2=0,y2=i[p4].normals.length;h2<y2;h2++)m1.normals.push(i[p4].normals[h2].clone())}this.morphTargets.push(m1)}let s=r.morphNormals;for(let p5=0,f5=s.length;p5<f5;p5++){let m2={};if(void 0!==s[p5].vertexNormals){m2.vertexNormals=[];for(let h3=0,y3=s[p5].vertexNormals.length;h3<y3;h3++){let g1=s[p5].vertexNormals[h3],x1={};x1.a=g1.a.clone(),x1.b=g1.b.clone(),x1.c=g1.c.clone(),m2.vertexNormals.push(x1)}}if(void 0!==s[p5].faceNormals){m2.faceNormals=[];for(let h4=0,y4=s[p5].faceNormals.length;h4<y4;h4++)m2.faceNormals.push(s[p5].faceNormals[h4].clone())}this.morphNormals.push(m2)}let a=r.skinWeights;for(let p6=0,f6=a.length;p6<f6;p6++)this.skinWeights.push(a[p6].clone());let c=r.skinIndices;for(let p7=0,f7=c.length;p7<f7;p7++)this.skinIndices.push(c[p7].clone());let u=r.lineDistances;for(let p8=0,f8=u.length;p8<f8;p8++)this.lineDistances.push(u[p8]);let l=r.boundingBox;null!==l&&(this.boundingBox=l.clone());let d=r.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.elementsNeedUpdate=r.elementsNeedUpdate,this.verticesNeedUpdate=r.verticesNeedUpdate,this.uvsNeedUpdate=r.uvsNeedUpdate,this.normalsNeedUpdate=r.normalsNeedUpdate,this.colorsNeedUpdate=r.colorsNeedUpdate,this.lineDistancesNeedUpdate=r.lineDistancesNeedUpdate,this.groupsNeedUpdate=r.groupsNeedUpdate,this}toBufferGeometry(){let r=new Ld().fromGeometry(this),e=new three__WEBPACK_IMPORTED_MODULE_0__.u9r,t=new Float32Array(3*r.vertices.length);if(e.setAttribute("position",Il.call(new three__WEBPACK_IMPORTED_MODULE_0__.TlE(t,3),r.vertices)),r.normals.length>0){let o=new Float32Array(3*r.normals.length);e.setAttribute("normal",Il.call(new three__WEBPACK_IMPORTED_MODULE_0__.TlE(o,3),r.normals))}if(r.colors.length>0){let o1=new Float32Array(3*r.colors.length);e.setAttribute("color",gy.call(new three__WEBPACK_IMPORTED_MODULE_0__.TlE(o1,3),r.colors))}if(r.uvs.length>0){let o2=new Float32Array(2*r.uvs.length);e.setAttribute("uv",xy.call(new three__WEBPACK_IMPORTED_MODULE_0__.TlE(o2,2),r.uvs))}if(r.uvs2.length>0){let o3=new Float32Array(2*r.uvs2.length);e.setAttribute("uv2",xy.call(new three__WEBPACK_IMPORTED_MODULE_0__.TlE(o3,2),r.uvs2))}for(let o4 in e.groups=r.groups,r.morphTargets){let i=[],s=r.morphTargets[o4];for(let a=0,c=s.length;a<c;a++){let u=s[a],l=new three__WEBPACK_IMPORTED_MODULE_0__.a$l(3*u.data.length,3);l.name=u.name,i.push(Il.call(l,u.data))}e.morphAttributes[o4]=i}if(r.skinIndices.length>0){let o5=new three__WEBPACK_IMPORTED_MODULE_0__.a$l(4*r.skinIndices.length,4);e.setAttribute("skinIndex",vy.call(o5,r.skinIndices))}if(r.skinWeights.length>0){let o6=new three__WEBPACK_IMPORTED_MODULE_0__.a$l(4*r.skinWeights.length,4);e.setAttribute("skinWeight",vy.call(o6,r.skinWeights))}return null!==r.boundingSphere&&(e.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(e.boundingBox=r.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(r){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(r){let e=new three__WEBPACK_IMPORTED_MODULE_0__.u9r,t=r.geometry;if(r.isPoints||r.isLine){let o=new three__WEBPACK_IMPORTED_MODULE_0__.a$l(3*t.vertices.length,3),i=new three__WEBPACK_IMPORTED_MODULE_0__.a$l(3*t.colors.length,3);if(e.setAttribute("position",Il.call(o,t.vertices)),e.setAttribute("color",gy.call(i,t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){let s=new three__WEBPACK_IMPORTED_MODULE_0__.a$l(t.lineDistances.length,1);e.setAttribute("lineDistance",gT.call(s,t.lineDistances))}null!==t.boundingSphere&&(e.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(e.boundingBox=t.boundingBox.clone())}else r.isMesh&&(e=t.toBufferGeometry());return e}};Ao.prototype.isGeometry=!0;var Ld=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(r){let e=[],t,o,i,s=r.faces;for(o=0;o<s.length;o++){let a=s[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,e.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,e.push(t)),this.groups=e}fromGeometry(r){let e=r.faces,t=r.vertices,o=r.faceVertexUvs,i=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,a=r.morphTargets,c=a.length,u;if(c>0){u=[];for(let g=0;g<c;g++)u[g]={name:a[g].name,data:[]};this.morphTargets.position=u}let l=r.morphNormals,d=l.length,p;if(d>0){p=[];for(let g1=0;g1<d;g1++)p[g1]={name:l[g1].name,data:[]};this.morphTargets.normal=p}let f=r.skinIndices,m=r.skinWeights,h=f.length===t.length,y=m.length===t.length;t.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g2=0;g2<e.length;g2++){let x=e[g2];this.vertices.push(t[x.a],t[x.b],t[x.c]);let b=x.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{let S=x.normal;this.normals.push(S,S,S)}let w=x.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{let S1=x.color;this.colors.push(S1,S1,S1)}if(!0===i){let S2=o[0][g2];void 0!==S2?this.uvs.push(S2[0],S2[1],S2[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g2),this.uvs.push(new three__WEBPACK_IMPORTED_MODULE_0__.FM8,new three__WEBPACK_IMPORTED_MODULE_0__.FM8,new three__WEBPACK_IMPORTED_MODULE_0__.FM8))}if(!0===s){let S3=o[1][g2];void 0!==S3?this.uvs2.push(S3[0],S3[1],S3[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g2),this.uvs2.push(new three__WEBPACK_IMPORTED_MODULE_0__.FM8,new three__WEBPACK_IMPORTED_MODULE_0__.FM8,new three__WEBPACK_IMPORTED_MODULE_0__.FM8))}for(let S4=0;S4<c;S4++){let P=a[S4].vertices;u[S4].data.push(P[x.a],P[x.b],P[x.c])}for(let S5=0;S5<d;S5++){let P1=l[S5].vertexNormals[g2];p[S5].data.push(P1.a,P1.b,P1.c)}h&&this.skinIndices.push(f[x.a],f[x.b],f[x.c]),y&&this.skinWeights.push(m[x.a],m[x.b],m[x.c])}return this.computeGroups(r),this.verticesNeedUpdate=r.verticesNeedUpdate,this.normalsNeedUpdate=r.normalsNeedUpdate,this.colorsNeedUpdate=r.colorsNeedUpdate,this.uvsNeedUpdate=r.uvsNeedUpdate,this.groupsNeedUpdate=r.groupsNeedUpdate,null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone()),this}},di=class{constructor(r,e,t,o,i,s=0){this.a=r,this.b=e,this.c=t,this.normal=o&&o.isVector3?o:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,this.vertexNormals=Array.isArray(o)?o:[],this.color=i&&i.isColor?i:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(r){this.a=r.a,this.b=r.b,this.c=r.c,this.normal.copy(r.normal),this.color.copy(r.color),this.materialIndex=r.materialIndex;for(let e=0,t=r.vertexNormals.length;e<t;e++)this.vertexNormals[e]=r.vertexNormals[e].clone();for(let e1=0,t1=r.vertexColors.length;e1<t1;e1++)this.vertexColors[e1]=r.vertexColors[e1].clone();return this}};function gT(n){return this.array.set(n),this}function gy(n){let r=this.array,e=0;for(let t=0,o=n.length;t<o;t++){let i=n[t];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",t),i=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk),r[e++]=i.r,r[e++]=i.g,r[e++]=i.b}return this}function xy(n){let r=this.array,e=0;for(let t=0,o=n.length;t<o;t++){let i=n[t];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",t),i=new three__WEBPACK_IMPORTED_MODULE_0__.FM8),r[e++]=i.x,r[e++]=i.y}return this}function Il(n){let r=this.array,e=0;for(let t=0,o=n.length;t<o;t++){let i=n[t];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",t),i=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),r[e++]=i.x,r[e++]=i.y,r[e++]=i.z}return this}function vy(n){let r=this.array,e=0;for(let t=0,o=n.length;t<o;t++){let i=n[t];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",t),i=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg),r[e++]=i.x,r[e++]=i.y,r[e++]=i.z,r[e++]=i.w}return this}var vT=["a","b","c"];function Rd(n,r,e){return e.get(Math.min(n,r)+"_"+Math.max(n,r))}function Gd(n,r,e,t,o,i){let s=Math.min(n,r),a=Math.max(n,r),c=s+"_"+a,u;t.has(c)?u=t.get(c):(u={a:e[s],b:e[a],newEdge:null,faces:[]},t.set(c,u)),u.faces.push(o),i[n].edges.push(u),i[r].edges.push(u)}function Ml(n,r,e,t,o){n.push(new di(r,e,t,void 0,void 0,o))}function ui(n,r){return Math.abs(r-n)/2+Math.min(n,r)}function El(n,r,e,t){n.push([r.clone(),e.clone(),t.clone()])}var Ll=class{constructor(r=1){this.subdivisions=r}modify(r){(r=r instanceof three__WEBPACK_IMPORTED_MODULE_0__.u9r?new Ao().fromBufferGeometry(r):r.clone()).mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(r);return r.computeFaceNormals(),r.computeVertexNormals(),r}_smooth(r){let e=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,t,o,i,s,a,c=r.vertices,u=r.faces,l=r.faceVertexUvs[0],d=void 0!==l&&l.length>0,p=[],f=new Map;!function(n,r,e,t){let o,i,s;for(o=0,i=n.length;o<i;o++)e[o]={edges:[]};for(o=0,i=r.length;o<i;o++)Gd((s=r[o]).a,s.b,n,t,s,e),Gd(s.b,s.c,n,t,s,e),Gd(s.c,s.a,n,t,s,e)}(c,u,p,f);let m=[],h,y,g,x,b,w,S;for(let j of Array.from(f.keys())){for(y=f.get(j),g=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,b=3/8,w=1/8,2!=(S=y.faces.length)&&(b=.5,w=0),g.addVectors(y.a,y.b).multiplyScalar(b),e.set(0,0,0),s=0;s<S;s++){for(x=y.faces[s],a=0;a<3&&!((h=c[function(n,r){switch(r){case"c":return n.c;case"b":return n.b;default:return n.a}}(x,vT[a])])!==y.a&&h!==y.b);a++);h&&e.add(h)}e.multiplyScalar(w),g.add(e),y.newEdge=m.length,m.push(g)}let P,_,v,N,T,C,O,A=[];for(o=0,i=c.length;o<i;o++){for(C=c[o],3==(t=(T=p[o].edges).length)?P=3/16:t>3&&(P=3/(8*t)),_=1-t*Number(P),v=P,t<=2&&2==t&&(_=3/4,v=1/8),O=C.clone().multiplyScalar(_),e.set(0,0,0),s=0;s<t;s++)h=(N=T[s]).a!==C?N.a:N.b,e.add(h);e.multiplyScalar(Number(v)),O.add(e),A.push(O)}let R=A.concat(m),U=A.length,$,ee,X,q=[],H=[],V,G,D,L,B=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,K=new three__WEBPACK_IMPORTED_MODULE_0__.FM8,W=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;for(o=0,i=u.length;o<i;o++)Ml(q,$=Number(Rd((x=u[o]).a,x.b,f).newEdge)+U,ee=Number(Rd(x.b,x.c,f).newEdge)+U,X=Number(Rd(x.c,x.a,f).newEdge)+U,x.materialIndex),Ml(q,x.a,$,X,x.materialIndex),Ml(q,x.b,ee,$,x.materialIndex),Ml(q,x.c,X,ee,x.materialIndex),d&&(G=(V=l[o])[0],D=V[1],L=V[2],B.set(ui(G.x,D.x),ui(G.y,D.y)),K.set(ui(D.x,L.x),ui(D.y,L.y)),W.set(ui(G.x,L.x),ui(G.y,L.y)),El(H,B,K,W),El(H,G,B,W),El(H,D,K,B),El(H,L,W,K));r.vertices=R,r.faces=q,d&&(r.faceVertexUvs[0]=H)}},Ze=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Py=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=n.geometry??r?.geometry??new three__WEBPACK_IMPORTED_MODULE_0__.u9r().copy(new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(100,100,100)),t;void 0===r?(e.computeBoundingBox(),e.boundingBox.getSize(Ze),t={width:Ze.x,height:Ze.y,depth:Ze.z,subdivisions:0}):t=r.parameters;let o={...t,...n.parameters};return{parameters:{width:Math.abs(o.width),height:Math.abs(o.height),depth:Math.abs(o.depth),subdivisions:Math.abs(o.subdivisions)},geometry:e}}static build(n){let{width:r,height:e,depth:t,subdivisions:o}=n.parameters,i=n.geometry??new three__WEBPACK_IMPORTED_MODULE_0__.u9r().copy(new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(100,100,100)),s=i.userData.parameters;void 0===s?(i.computeBoundingBox(),i.boundingBox.getSize(Ze)):Ze.set(s.width,s.height,s.depth),(r!==Ze.x||e!==Ze.y||t!==Ze.z)&&i.scale(0===Ze.x?1:r/Ze.x,0===Ze.y?1:e/Ze.y,0===Ze.z?1:t/Ze.z);let a=i.originalGeometry;try{o>0?(void 0===a||s?.subdivisions!==o)&&(void 0===a&&(a=i),i=new Ll(o).modify(a).toBufferGeometry()):(void 0!==a&&(i=a),a=void 0,void 0===i.getAttribute("normal")&&i.computeVertexNormals())}catch{void 0!==a&&(i=a),a=void 0,void 0===i.getAttribute("normal")&&i.computeVertexNormals()}return void 0!==a&&Object.assign(i,{originalGeometry:a}),delete n.geometry,Object.assign(i,{userData:{...n,type:"NonParametricGeometry"}})}static loadFromUrl(n,r,e){new three__WEBPACK_IMPORTED_MODULE_0__.s4_(e).load(n,o=>{let i=this.normalizeInputs({geometry:o});o.boundingBox.getSize(Ze);let s=100/Ze.x;Object.assign(i.parameters,{width:100,height:Ze.y*s,depth:Ze.z*s}),r(this.build(i))})}},Dl=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},n.parameters);return{shape:n.shape&&n.shape instanceof _e?n.shape:new _e,parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??0)})}}static build(n){let{width:r,height:e,spikes:t,cornerRadius:o,depth:i,extrudeBevelSize:s,extrudeBevelSegments:a}=n.parameters,c=n.shape,u=.5*r,l=.5*e,f=2*Math.PI/t;for(let h=0;h<t;h++){let y=f*h,g=0+Math.sin(y)*u,x=0+Math.cos(y)*l;c.addPoint(c.createPoint(g,x))}c.isClosed=!0;for(let h1=0,y1=c.points.length;h1<y1;h1++)c.points[h1].roundness=o;return c.roundness=o,c.update(),Object.assign(Mt.create({shape:c,parameters:{roundness:o,depth:i,extrudeBevelSize:s,extrudeBevelSegments:a}}),{userData:{...n,type:"PolygonGeometry"}})}},Ty=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r,height:e,depth:t,radialSegments:o,heightSegments:i,openEnded:s,cornerRadius:a,cornerSegments:c}=n.parameters,u=new jd(.5*r,e,o,i,s,a,c);return u.scale(1,1,t/r),Object.assign(u,{userData:{...n,type:"PyramidGeometry"}})}};function As(n,r,e){e.x=n.x*r.x,e.y=n.y,e.z=n.x*r.y}function zd(n,r,e,t,o,i){let s=r.clone().sub(n),a=e.clone().sub(n),c=s.angleTo(a);if(s.normalize(),a.normalize(),t===o){let u=s.add(a).normalize();i.copy(n).addScaledVector(u,t/Math.sin(c/2))}else{let u1=s.angleTo(a);i.copy(n),i.addScaledVector(s,o/Math.sin(u1)),i.addScaledVector(a,t/Math.sin(u1))}}var jd=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(r=.5,e=1,t=4,o=1,i=!1,s=0,a=4){let A;super(),t=Math.floor(Math.max(3,t)),o=Math.floor(o),a=Math.floor(a);let c=[],u=[],l=[],d=[],p=0,f=e/2,m=Math.PI/t,h=r*Math.cos(Math.PI/t),y=2*Math.PI/t,x=Math.PI-(t-2)*Math.PI/t,b=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,-f,0),w=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,f,0),S=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(r,-f),P=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(h,-f),_=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,w.y).sub(P),v=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,w.y).sub(S),N=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(_.y,-_.x).normalize(),T=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(v.y,-v.x).normalize();s=Math.min(s,r*Math.cos(Math.PI/t)*Math.tan((Math.PI-_.angle())/2)-1e-8);{let H=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(N.x,N.y,0),V=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(Math.cos(y)*H.x,H.y,Math.sin(y)*H.x);A=H.angleTo(V)}let R=s/Math.tan((Math.PI-_.angle())/2),U=s/Math.tan((Math.PI-A)/2),$=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;if(!i){u.push(b.x,b.y,b.z),l.push(0,-1,0),d.push(0,0);let H1=p++,V1=[],G=S.clone(),D=R/Math.cos(Math.PI/t);G.x-=D;for(let L=0;L<t;L++){let B=L/t*Math.PI*2+m;As(G,new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(B),Math.cos(B)),$),u.push($.x,$.y,$.z),l.push(0,-1,0),d.push(0,0),V1.push(p++)}for(let L1=0;L1<V1.length;L1++)c.push(V1[L1],H1,V1[(L1+1)%V1.length])}let ee=[];{let H2=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,V2=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,G1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,D1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,L2=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,B1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let K=0;K<t;K++){let W=K/t*Math.PI*2+m,j=(K+.5)/t*Math.PI*2+m,F=(K+1)/t*Math.PI*2+m,M=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(W),Math.cos(W)),Q=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(j),Math.cos(j)),re=new three__WEBPACK_IMPORTED_MODULE_0__.FM8(Math.sin(F),Math.cos(F));As(S,M,V2),As(S,re,G1),As(N,Q,H2),zd(w,V2,G1,U,U,D1),u.push(D1.x,D1.y,D1.z),zd(V2,w,G1,U,R,L2),u.push(L2.x,L2.y,L2.z),zd(G1,V2,w,R,U,B1),u.push(B1.x,B1.y,B1.z),l.push(H2.x,H2.y,H2.z),l.push(H2.x,H2.y,H2.z),l.push(H2.x,H2.y,H2.z),d.push(0,0),d.push(0,0),d.push(0,0);let oe=p++,Z=p++,te=p++;if(c.push(oe,Z,te),s>0){let J,ie;{let ce=V2.clone().add(G1).multiplyScalar(.5),se=w.clone().sub(ce).normalize(),ze=b.clone().sub(ce).normalize().add(se).normalize().multiplyScalar(-1);X(ce,B1.clone().sub(L2),ze,_.angle())}{let ce1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;As(T,re,ce1);let se1=B1.clone().add(D1).multiplyScalar(.5);se1=function(n,r,e){let t=n.clone().sub(r),o=e.clone().sub(r);return t.projectOnVector(o),t.add(r)}(se1,G1,w);let fe=B1.clone().sub(D1);[J,ie]=X(se1,fe,ce1,A,D1.y)}{let se2=J.clone().setY(0).normalize(),fe1=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,-1,0),ze1=se2.clone().cross(fe1);!function(H,V,G,D){let L=Math.PI/2,B=v.angle()-L,K=[],W=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,j=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let M=0;M<=a;M++){let Q=[],re=M/a;for(let oe=0;oe<=M;oe++){let te=((M?oe/M:0)-.5)*x,J=Math.cos(te),ie=Math.sin(te),se=(L+Math.atan(Math.tan(B)*J))*re,fe=Math.cos(se),ze=Math.sin(se);W.set(0,0,0),W.addScaledVector(V,ze*J),W.addScaledVector(G,fe),W.addScaledVector(D,ze*ie),j.copy(H).addScaledVector(W,s),u.push(j.x,j.y,j.z),l.push(W.x,W.y,W.z),d.push(0,0),Q.push(p++)}K.push(Q)}let F=K.length-1;for(let M1=0;M1<F;M1++){let Q1=K[M1],re1=K[M1+1],oe1=Q1.length-1;c.push(Q1[0],re1[1],re1[0]);for(let Z=1;Z<=oe1;Z++)c.push(Q1[Z-1],Q1[Z],re1[Z]),c.push(Q1[Z],re1[Z+1],re1[Z])}}(J,se2,fe1,ze1)}ee.concat(ie);{let ce2=_.angle(),se3=Math.PI-ce2,fe2=w.clone();fe2.y-=s/Math.sin(ce2-Math.PI/2);let ze2=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,ge=[];for(let Oe=0;Oe<a;Oe++){let Ot=[],Wt=Math.PI/2-se3*Oe/a,un=Math.cos(Wt),Rt=Math.sin(Wt),ta=j;for(let ra=0;ra<=Oe;ra++){let oa=Math.cos(ta),Ue=Math.sin(ta);H2.x=un*Ue,H2.y=Rt,H2.z=un*oa,ze2.copy(fe2).addScaledVector(H2,s),u.push(ze2.x,ze2.y,ze2.z),l.push(H2.x,H2.y,H2.z),d.push(0,0),Ot.push(p++),ta+=2*Math.PI/Oe/t}ge.push(Ot)}ie.reverse(),ge.push(ie);let qe=ge.length-1;for(let Oe1=0;Oe1<qe;Oe1++){let Ot1=ge[Oe1],Wt1=ge[Oe1+1],un1=Ot1.length-1;c.push(Wt1[1],Ot1[0],Wt1[0]);for(let Rt1=1;Rt1<=un1;Rt1++)c.push(Ot1[Rt1],Ot1[Rt1-1],Wt1[Rt1]),c.push(Wt1[Rt1+1],Ot1[Rt1],Wt1[Rt1])}}}}}function X(H,V,G,D,L){let B=-D/2,W=V.clone().normalize().cross(G);H.addScaledVector(G,-s/Math.sin((Math.PI-D)/2));let j=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,F=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Q=p,re=[];for(let oe=0;oe<=a;oe++){let Z=B+oe/a*D;F.set(0,0,0),F.addScaledVector(W,Math.sin(Z)),F.addScaledVector(G,Math.cos(Z));for(let te=0;te<=1;te++){let J=te/1-.5;if(j.copy(H),j.addScaledVector(V,J),j.addScaledVector(F,s),null!=L){let ie=Math.max(0,j.y-L);j.addScaledVector(V,-ie/V.y)}u.push(j.x,j.y,j.z),l.push(F.x,F.y,F.z),d.push(0,0),0===te&&re.push(p),p++}}for(let oe1=0;oe1<a;oe1++)for(let Z1=0;Z1<1;Z1++){let te1=Q+Z1+2*oe1,J1=te1+2,ie1=J1+1,ce=te1+1;c.push(te1,J1,ce),c.push(J1,ie1,ce)}return[H.clone().addScaledVector(V,.5),re]}this.setIndex(c),this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(u,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(l,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(d,2))}},Bl=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},n.parameters),t=Object.assign(r?.ui??{enabledIndieCorners:!1},n.ui);return{shape:n.shape&&n.shape instanceof _e?n.shape:new _e,parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??0)}),ui:t}}static build(n){let r=n.shape,{width:e,height:t,cornerRadius:o,cornerType:i,depth:s,extrudeBevelSize:a,extrudeBevelSegments:c}=n.parameters,u={x:.5*e,y:.5*t},l={x:-u.x,y:-u.y},d={x:u.x,y:u.y};function p(w,S,P){return S>e&&P>t?Math.min(w*e/S,w*t/P):S>e?w*e/S:P>t?w*t/P:w}let f=[];f[0]=0===o[0]?0:p(o[0],o[0]+o[3],o[0]+o[1]),f[1]=0===o[1]?0:p(o[1],o[1]+o[2],o[1]+o[0]),f[2]=0===o[2]?0:p(o[2],o[2]+o[1],o[2]+o[3]),f[3]=0===o[3]?0:p(o[3],o[3]+o[0],o[3]+o[2]);let m=l.x,h=d.x,y=d.y,g=l.y;r.addPoint(r.createPoint(m,y)),r.addPoint(r.createPoint(h,y)),r.addPoint(r.createPoint(h,g)),r.addPoint(r.createPoint(m,g)),r.isClosed=!0;let x=!0;for(let w=0,S=r.points.length;w<S;w++)r.points[w].roundness=f[w],w>0&&f[w]!==f[w-1]&&(x=!1);return x&&(r.roundness=f[0]),r.useCubicForRoundedCorners=1!==i,r.update(),Object.assign(Mt.create({shape:r,parameters:{depth:s,extrudeBevelSize:a,extrudeBevelSegments:c}}),{userData:{...n,type:"RectangleGeometry"}})}},Oy=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r=100,height:e=r,depth:t=r,widthSegments:o=64,heightSegments:i=64,phiStart:s,phiLength:a,thetaStart:c,thetaLength:u}=n.parameters,l=new three__WEBPACK_IMPORTED_MODULE_0__.xo$(.5*r,o,i,s,a,c,u);return l.scale(1,e/r,t/r),Object.assign(l,{userData:{...n,type:"SphereGeometry"}})}},Ay=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:0})}}static build(n){let{width:r=100,height:e=r,widthSegments:t=8,heightSegments:o=8}=n.parameters,i=new three__WEBPACK_IMPORTED_MODULE_0__._12(r,e,t,o);return i.scale(1,1,1),Object.assign(i,{userData:{...n,type:"PlaneGeometry"}})}},Cy=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width)})}}static build(n){let{width:r,height:e,depth:t,angle:o,cornerRadius:i,cornerSegments:s}=n.parameters;return Object.assign(new kd(r,e,t,o,i,s),{userData:{...n,type:"BackdropGeometry"}})}},kd=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(r=1,e=1,t=1,o=90,i=10,s=24){super(),this.type="BackdropGeometry";let a=[],c=[],u=[];0==i&&(s=1),s=Math.max(1,Math.floor(s)),i=Math.min(i,100),o=Math.min(179.999,o)*(Math.PI/180);let d=[],p=Math.PI/2,f=(j=0,F=0,M=0)=>new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(j,F,M),m=f(),h=f(),[y,g,x]=[e/2,r/2,t/2],b=-g,w=+g,[S,P,_]=[f(b,-y,+x),f(b,-y,-x),f(b,+y,-x)],v=(j,F=!1)=>Math.sin(j-Math.PI/(1+ +F)),N=(j,F=!1)=>Math.cos(j-Math.PI/(1+ +F));_.y=Math.sin(o)*e-y;let T=Math.cos(o)*e-x,C=S.z-.001;o<=p?(_.z=Math.min(T,C),_.z==C&&(_.y-=(T-C)/Math.tan(p-o))):P.z=Math.min(P.z-T-x,S.z-.001),m.subVectors(S,P),h.subVectors(_,P);let O=Math.min(m.length(),h.length())*i/100,A=O*Math.tan(o/2),R=O/Math.cos(o/2),U=m.clone().normalize().add(h.normalize()).setLength(R).add(P);m.set(0,v(o,!0),N(o,!0)),d.push([_,m.clone()]);let $=(Math.PI-o)/s;for(let j=0;j<=s;j++){let F=p+o+j*$;m.set(0,Math.sin(F)*A,Math.cos(F)*A),m.add(U),h.set(0,v(F),N(F)),d.push([m.clone(),h.clone()])}d.push([S,f(0,1,0)]);let ee=Math.sin($/2)*A*2,X=d.length-1,q=d[0][0].distanceTo(d[1][0]),V=q+ee*s+d[X-1][0].distanceTo(d[X][0]);d[0].push(1);for(let j1=0;j1<=s;j1++)d[j1+1].push(1-(q+j1*ee)/V);d[X].push(0);let[G,D,L]=d[0],B,K,W;for(let j2=1;j2<d.length;j2++)[B,K,W]=d[j2],a.push(b,G.y,G.z,b,B.y,B.z,w,G.y,G.z,w,G.y,G.z,b,B.y,B.z,w,B.y,B.z),c.push(0,D.y,D.z,0,K.y,K.z,0,D.y,D.z,0,D.y,D.z,0,K.y,K.z,0,K.y,K.z),u.push(0,L,0,W,1,L,1,L,0,W,1,W),[G,D,L]=[B,K,W];this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(a,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(c,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(u,2))}},Rl=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},n.parameters);return{shape:n.shape&&n.shape instanceof _e?n.shape:new _e,parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??0)})}}static build(n){let{width:r,height:e,innerRadiusPercent:t,spikes:o,cornerRadius:i,angle:s,depth:a,extrudeBevelSize:c,extrudeBevelSegments:u}=n.parameters,l=n.shape,d=.5*r,p=.5*e,h=s*Math.PI/360/o,y=-(Math.PI/2*3),g=d*t/100,x=p*t/100;if(3===o&&50===t){h=2*Math.PI/o;for(let w=0;w<o;w++){let S=h*w,P=0+Math.sin(S)*d,_=0+Math.cos(S)*p;l.addPoint(l.createPoint(P,_))}}else for(let w1=0;w1<o;w1++){let S1=0+Math.cos(y)*d,P1=0+Math.sin(y)*p;l.addPoint(l.createPoint(S1,P1)),y+=h,S1=0+Math.cos(y)*g,P1=0+Math.sin(y)*x,l.addPoint(l.createPoint(S1,P1)),y+=h}l.isClosed=!0;for(let w2=0,S2=l.points.length;w2<S2;w2++)l.points[w2].roundness=i;return l.roundness=i,l.update(),Object.assign(Mt.create({shape:l,parameters:{roundness:i,depth:a,extrudeBevelSize:c,extrudeBevelSegments:u}}),{userData:{...n,type:"StarGeometry"}})}},Ny=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??0)})}}static build(n){let{width:r,height:e}=n.parameters;return Object.assign(new three__WEBPACK_IMPORTED_MODULE_0__._12(r,e),{userData:{...n,type:"TextFrameGeometry"}})}},Iy=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:2*Math.PI,cornerRadius:30,cornerSegments:8},n.parameters),t=Math.abs(e.width),o=Math.abs(e.height??e.width),i=Math.round(Math.abs(e.depth??.25*e.width));return{parameters:Object.assign(e,{width:t,height:o,depth:i})}}static build(n){var r,e,o,s,u;let{width:r1,height:e1,depth:t,radialSegments:o1,tubularSegments:i,arc:s1,cornerRadius:a,cornerSegments:c}=n.parameters,u1=(r=e1,e=t,o=s1,s=0,u=a,[r,e]=[e,r],s=r/2,1==(o/=2*Math.PI)&&(u=0),new Ps(!0,r1,r,e,.5*r1,o,i,s,0,o1,u,c));return u1.scale(1,e1/r1,1),Object.assign(u1,{userData:{...n,type:"TorusGeometry"}})}},My=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},n.parameters);return{parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width),depth:Math.abs(e.depth??e.width),tube:e.tube??.125*e.width})}}static build(n){let{width:r,tube:e,tubularSegments:t,radialSegments:o,p:i,q:s}=n.parameters,a=.5*r;return a!==e&&(a-=e),Object.assign(new three__WEBPACK_IMPORTED_MODULE_0__.FE5(a,e,t,o,i,s),{userData:{...n,type:"TorusKnotGeometry"}})}},Ey=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},n.parameters);return{shape:n.shape&&n.shape instanceof _e?n.shape:new _e,parameters:Object.assign(e,{width:Math.abs(e.width),height:Math.abs(e.height??e.width*(e.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(e.depth??0)})}}static build(n){let{width:r=100,height:e,cornerRadius:t,depth:o,extrudeBevelSize:i,extrudeBevelSegments:s,isRect:a}=n.parameters,c=n.shape,u=.5*r,l=.5*e;a?(c.addPoint(c.createPoint(-u,l)),c.addPoint(c.createPoint(u,-l)),c.addPoint(c.createPoint(-u,-l))):(c.addPoint(c.createPoint(0,l)),c.addPoint(c.createPoint(u,-l)),c.addPoint(c.createPoint(-u,-l))),c.isClosed=!0;for(let p=0,f=c.points.length;p<f;p++)c.points[p].roundness=t;return c.roundness=t,c.update(),Object.assign(Mt.create({shape:c,parameters:{roundness:t,depth:o,extrudeBevelSize:i,extrudeBevelSegments:s}}),{userData:{...n,type:"TriangleGeometry"}})}},Ry=class{static create(n){return this.build(this.normalizeInputs(n))}static normalizeInputs(n,r){let e=Object.assign({},r?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},n.parameters),t=Math.abs(e.width),o=Math.abs(e.height??e.width),i=Math.abs(e.depth??0),s=r?.shapeData??li.create({parameters:qc}).userData.shape;return{path:n.path??Hn.defaultData(),parameters:Object.assign(e,{width:t,height:o,depth:i,extrusion:{...rl,...e.extrusion}}),shapeData:s}}static build(n){return n.path.points.length>=2?Object.assign(new Wd(n),{userData:{...n,type:"PathGeometry"}}):Object.assign(new three__WEBPACK_IMPORTED_MODULE_0__.u9r,{userData:{...n,type:"PathGeometry"}})}},Wd=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e,e1=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e1.depth)||(e1.twist%(e=2*Math.PI)+e)%e!=(0%e+e)%e||e1.startScale!==e1.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:o,offset:i}=this.inputs.parameters.extrusion,s=this.inputs.path.isClosed?e.length:e.length-1,a=Math.floor(i*s),u=Math.min(Math.max(2,(this.inputs.path.isClosed?Math.ceil((o+i)*s):Math.ceil(Math.min(1,o+i)*s))-a+1),s+2),l=[],d=[];for(let O=0;O<u;O++){let A=this.inputs.path.isClosed?(O+a)%e.length:Math.min(O+a,e.length-1);l.push(e[A].clone()),d.push(t[A].clone())}let p=(O,A,R)=>{var n,r;let t,o;l[O]=l[O].clone().lerp(l[A],R),d[O]=(n=d[O],r=d[A],t=[new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,new three__WEBPACK_IMPORTED_MODULE_0__.Pa4],o=[new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,new three__WEBPACK_IMPORTED_MODULE_0__.Pa4],n.extractBasis(t[0],t[1],t[2]),r.extractBasis(o[0],o[1],o[2]),t.forEach((i,s)=>{let a=o[s],c=three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(i.length(),a.length(),R);i.lerp(a,R).setLength(c)}),new three__WEBPACK_IMPORTED_MODULE_0__.yGw().makeBasis(t[0],t[1],t[2]))},f=0,m=i*s%1;(!this.inputs.path.isClosed||o<=1)&&(m||0===i)&&p(0,1,f=m);let h=0,y=(i+o)*s%1;if((this.inputs.path.isClosed&&o<=1||!this.inputs.path.isClosed&&i+o<1)&&y&&(h=y,p(l.length-1,l.length-2,1-h)),0===o){let O1=l.length-1;l[O1].copy(l[0]),d[O1].copy(d[0])}this._applyPathModifiers(d,f,h);let{regions:g,infos:x,vertices:b}=this._computeShapePoints(5),w=0,S=0;x.sort((O,A)=>O.start-A.start),x.forEach(O=>{O.verticesStart=w,O.verticesCount=O.continuous.reduce((A,R,U)=>A+(0!==U&&R?1:2),0),S+=O.verticesCount,w=S});let P=S*u,_,v=0;if(this._isOpenEnded()){try{_=ar({windingRule:be.ODD,elementType:Ge.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:g})}catch{_=Nd}v=_.vertexCount}let N=P+2*v,T={positions:new Float32Array(3*N),normals:new Float32Array(3*N),uvs:new Float32Array(2*N)},C=[];x.forEach(O=>{this._extrudeRegion(O,b,d,l,T,C,this._isGeometryClosed()&&!this._isOpenEnded())}),_&&(this._closeEnd(_,P,C,T,d[0],l[0],!1),this._closeEnd(_,P+v,C,T,d[d.length-1],l[l.length-1],!0)),this.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(T.positions,3)),this.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(T.normals,3)),this.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(T.uvs,2)),this.setIndex(C)}_extractPathPoints(){let t=gl(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let o=[t[0]];return t.forEach(s=>{o[o.length-1].distanceToSquared(s)>.001&&o.push(s)}),this.inputs.path.isClosed&&.001>o[o.length-1].distanceTo(o[0])&&o.pop(),o}_computeBasisMatrices(e){let t=[],o=e.length,i=this.inputs.path.isClosed,s=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,a=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,c=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,u=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,l=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0);for(let y=0;y<o;y++){let b,g=e[y],x;x=0===y?i?e[e.length-2]:g.clone().multiplyScalar(2).sub(e[1]):e[y-1],b=y===o-1?i?e[1]:g.clone().multiplyScalar(2).sub(e[y-1]):e[y+1];let w=g.clone().sub(x).normalize(),S=b.clone().sub(g).normalize(),P=w.clone().add(S).normalize();c.copy(P),0===y&&(P.equals(l)||P.clone().negate().equals(l))&&l.set(0,0,1);let _=l.clone().cross(P).normalize(),v=P.clone().cross(_).normalize();l.copy(v),u.copy(_),0===y&&(s.copy(v),a.copy(P));let N=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().makeBasis(_,v,P);t.push(N)}let d=i?a:c,p=i?s:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0),f=d.clone().cross(u).normalize(),m=Math.acos(p.dot(f));if(isNaN(m))return t;let h=p.clone().cross(f);d.dot(h)>0&&(m*=-1);for(let y1=1;y1<t.length;y1++){let g1=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().makeRotationZ(m*y1/t.length);t[y1].multiply(g1)}return t}_applyPathModifiers(e,t,o){let i=e.length,{angle:s,twist:a,startScale:c,endScale:u}=this.inputs.parameters.extrusion,l=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,d=new three__WEBPACK_IMPORTED_MODULE_0__.yGw;return e.forEach((p,f)=>{let m=0===f?0:f===i-1?1:(f-t)/(i-(0===o?0:1)-(t+(1-o)));l.makeRotationZ(three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(s,s+a,m));let h=three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(c,u,m);d.makeScale(h,h,h),p.multiply(l).multiply(d)}),e}_computeShapePoints(e=12,t=be.ODD){let c,o=this.inputs.shapeData,i=o.extractShapePointsToFlatArray([],e),s=o.shapeHoles.map(h=>{let y=h.extractShapePointsToFlatArray([],e),g=[];for(let x=y.length-1;x>=1;x-=2){let b=y[x-1],w=y[x-0];g.push(b,w)}return g}),a;try{a=ar({windingRule:t,elementType:Ge.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[i]})}catch{a=_s}try{c=ar({windingRule:be.ODD,elementType:Ge.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...s]})}catch{c=Cd}if(!a)throw Error("error generating geometry");let u=a.elementCount;if(c){a.elementCount+=c.elementCount;for(let h=0;h<c.elements.length;h++){let y=c.elements[h],g=h%2==0?a.vertexCount:0;a.elements.push(y+g)}for(let h1=0;h1<c.vertexIndices.length;h1++){let y1=c.vertexIndices[h1],g1=a.vertexCount;a.vertexIndices.push(y1+g1)}for(let h2=0;h2<c.vertices.length;h2++){let y2=c.vertices[h2];a.vertices.push(y2)}}let l=1/0,d=-1/0,p=1/0,f=-1/0;for(let h3=0,y3=a.vertexCount;h3<y3;h3++){let g2=2*h3,x=a.vertices[g2+0],b=a.vertices[g2+1];x<l&&(l=x),x>d&&(d=x),b<p&&(p=b),b>f&&(f=b)}let m=[];for(let h4=a.elementCount-1;h4>=0;h4--){let y4=h4>=u,g3=2*h4,x1=a.elements[g3+0],b1=a.elements[g3+1],w=x1+b1,S={start:x1,count:b1,normals:[],isHole:y4,continuous:[],verticesStart:0,verticesCount:0};m.push(S);let P=x1,_=w-1,v=x1+1,N=o.roundedCurves.length;do{let T=P-x1,C=a.vertices[2*_+0],O=a.vertices[2*_+1],A=a.vertices[2*P+0],R=a.vertices[2*P+1],U=a.vertices[2*v+0],$=a.vertices[2*v+1],ee=A-C,X=R-O,q=Math.sqrt(ee*ee+X*X);ee/=q,X/=q;let H=A-U,V=R-$,G=Math.sqrt(H*H+V*V);H/=G,V/=G,S.normals[2*T+0]=-V,S.normals[2*T+1]=H;let D=a.vertexIndices[P];if(Array.isArray(D))S.continuous[T]=!1;else{let[L,B]=o.getCurveIndexFromVertexId(D-1,!0);if(B>0&&B<1)S.continuous[T]=!0;else{let K=1===B?L+1:L-1;K=(K+N)%N;let W=1===B?0:1,j=o.roundedCurves[L].getTangent(B),F=o.roundedCurves[K].getTangent(W);S.continuous[T]=j.dot(F)>.95}}y4&&(S.normals[2*T+0]*=-1,S.normals[2*T+1]*=-1),[_,P,v]=[P,v,v+1],v>=w&&(v-=b1)}while(v!==x1+1)}return{regions:[i,...s],infos:m,vertices:a.vertices}}_insertVertex(e,t,o,i,s){let a=2*t,c=3*t;e.positions[c+0]=o.x,e.positions[c+1]=o.y,e.positions[c+2]=o.z,e.normals[c+0]=i.x,e.normals[c+1]=i.y,e.normals[c+2]=i.z,e.uvs[a+0]=s.x,e.uvs[a+1]=s.y}_extrudeRegion(e,t,o,i,s,a,c){let u=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,l=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,d=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,p=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,f=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;o.forEach((h,y)=>{let g=i[y],x=e.verticesStart*o.length+e.verticesCount*y;for(let b=0;b<e.count;b++){let w=(e.start+b)*2;if(u.set(t[w+0],t[w+1],0),d.copy(u).applyMatrix4(h).add(g),e.continuous[b])p.set(e.normals[2*b+0],e.normals[2*b+1],0);else{let S=0==b?(e.start+e.count-1)*2:w-2;l.set(t[S+0],t[S+1],0),p.copy(u).sub(l),p.set(-p.y,p.x,0),e.isHole||p.negate()}if(p.applyMatrix4(h).normalize(),f.set(0===b?1:b/e.count,y/(o.length-1)),this._insertVertex(s,x,d,p,f),x++,!e.continuous[b]||0===b){if(0===b)p.set(e.normals[2*b+0],e.normals[2*b+1],0),f.set(0,y/(o.length-1));else{let S1=b===e.count-1?2*e.start:w+2;l.set(t[S1+0],t[S1+1],0),p.copy(l).sub(u),p.set(-p.y,p.x,0),e.isHole||p.negate()}p.applyMatrix4(h).normalize(),this._insertVertex(s,x,d,p,f),x++}}});let m=o.length-1;for(let h=0;h<m;h++){let y=e.verticesStart*o.length+e.verticesCount*h,g=e.verticesStart*o.length+e.verticesCount*(h+1),x=0;for(let b=0;b<e.count;b++){(!e.continuous[b]||0===b)&&x++;let w=b===e.count-1?0:x+1,S=y+x,P=y+w,_=g+w,v=g+x;e.isHole?a.push(S,_,P,S,v,_):a.push(S,P,_,S,_,v),x++}}}_closeEnd(e,t,o,i,s,a,c){let u=e.vertexCount,l=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,c?-1:1).applyMatrix4(s),d=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,p=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;for(let m=0;m<u;m++){let h=2*m;d.set(e.vertices[h+0],e.vertices[h+1],0).applyMatrix4(s).add(a),this._insertVertex(i,t+m,d,l,p)}let f=e.elements;for(let m1=0;m1<e.elementCount;m1++){let h1=3*m1,y=f[h1+0]+t,g=f[h1+(c?1:2)]+t,x=f[h1+(c?2:1)]+t;o.push(y,g,x)}}};function Vy(){let n=new three__WEBPACK_IMPORTED_MODULE_0__.u9r;return n.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(new Float32Array([]),3)),n.setIndex(new three__WEBPACK_IMPORTED_MODULE_0__.TlE(new Uint16Array([]),1)),n}var n4,n5,Se,be,Ge,jy,BT=Vy().attributes,pi=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,BT),this.userData={parameters:e,type:"TextGeometry"};let o=t.getFont(e.font);o?.isLoaded?(this.font=o,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t?.requestRender()})}async updateFont(e,t){let o=t.getFont(e);o&&(this.font=o,await o.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!t?.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:o,height:i,depth:s,extrudeBevelSize:a,extrudeBevelSegments:c,text:u,textTransform:l}=e,p=function(n,r,e){e=e??n.text;let t=[""],o="";for(let i of e)o+=i," "===i||i===`
`?(t[t.length-1]+=o,o="",i===`
`&&t.push("")):r.getTextWidth(t[t.length-1]+o,n)>n.width&&(t[t.length-1].length&&t.push(""),r.getTextWidth(t[t.length-1]+o,n)>n.width&&(1===o.length?(t[t.length-1]+=o,o=""):(t[t.length-1]+=o.slice(0,-1),o=o[o.length-1],t.push(""))));return t[t.length-1]+=o,t}(e,t,2===l?u.toUpperCase():3===l?u.toLowerCase():u),{shapes:f,charWidths:m,charCoords:h}=t.generateShapes(p,e),x=f.map(S=>new _e().fromShape(S));this.vectorShapes=x;let b=x.map(S=>Mt.create({shape:S,parameters:{depth:s,extrudeBevelSegments:c,extrudeBevelSize:a,windingRule:s<=0?be.NONZERO:be.ODD,subdivisions:this.isLowResolution&&s>0?1:12}})),w=b.length?(0,three_examples_jsm_utils_BufferGeometryUtils_js__WEBPACK_IMPORTED_MODULE_1__.qf)(b):Vy();w.translate(-(.5*o),.5*i,0),this.dispose(),this.wrappedText=p,this.charCoords=h,this.charWidths=m,this.deleteAttribute("extrudeNormal"),Object.entries(w.attributes).forEach(([S,P])=>{this.setAttribute(S,P)}),this.setIndex(w.index),this.computeBoundingSphere()}clone(){let e=er(new three__WEBPACK_IMPORTED_MODULE_0__.u9r,pi.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,o])=>{this.setAttribute(t,o)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}},mi=new Promise(n=>{jy=n}),zy=!1;function $o(n,r,e){let o,t={parameters:n,type:n.type};if("PathGeometry"===n.type)t.path=n.path;else if("VectorGeometry"===n.type){let i=_e.createFromState(n.shape,n.width,n.height);t.shape=i}else if("NonParametricGeometry"===n.type)n.data.groups&&n.data.groups.forEach(i=>i.materialIndex=Math.max(i.materialIndex??0,0)),t.geometry=new three__WEBPACK_IMPORTED_MODULE_0__.s4_().parse(n);else{if("SubdivGeometry"===n.type)return new We(n,e);if("TextGeometry"===n.type)return new pi(n,r)}try{o=$d(t)}catch(i1){console.error(i1)}if(!o){let i2=_e.createFromState(Un.defaultData(),100,100);t.shape=i2,o=$d(t)}return o}var FT=new three__WEBPACK_IMPORTED_MODULE_0__.yGw;function Ns(n,r,e,t){let o=n.position.array,i=n.normal.array,s=FT.makeScale(r,e,t).invert().elements,a,c,u;for(var l=0,d=o.length;l<d;l+=3)o[l]*=r,o[l+1]*=e,o[l+2]*=t,a=i[l],c=i[l+1],u=i[l+2],i[l]=s[0]*a+s[4]*c+s[8]*u,i[l+1]=s[1]*a+s[5]*c+s[9]*u,i[l+2]=s[2]*a+s[6]*c+s[10]*u;n.position.needsUpdate=!0,n.normal.needsUpdate=!0}var Gl,de,Vl=new three__WEBPACK_IMPORTED_MODULE_0__.ZzF,hi=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;mi.then(n=>{de=n});var Uy=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Hy=new Uint32Array([0,1,2,3]),Wy=new Uint8Array([4]),We=class extends three__WEBPACK_IMPORTED_MODULE_0__.u9r{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let o=this.data.scaleBaked,i=yo.div(t,o);this.subdividedGeometry&&Ns(this.subdividedGeometry.attributes,...i),this.originalGeometry&&Ns(this.originalGeometry.attributes,...i),this.data=e;let s=this.userData.parameters;this.userData.parameters={width:s.width*i[0],height:s.height*i[1],depth:s.depth*i[2]},this.originalGeometry.boundingSphere.center.multiply(hi.fromArray(i));let a=hi.set(s.width,s.height,s.depth).length();this.originalGeometry.boundingSphere.radius=a/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,o;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:o}=We.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(100,100,100),o=0}this.subdivPointer=o,this.originalGeometry=e,this.subdividedGeometry=t??void 0,Object.assign(this,this.subdividedGeometry??this.originalGeometry),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(We.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new three__WEBPACK_IMPORTED_MODULE_0__.aLr,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,o=e.boundingSphere.center;Vl.setFromBufferAttribute(t),Vl.getCenter(o),e.boundingSphere.radius=o.distanceTo(Vl.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Vl.getSize(hi);let i={width:hi.x,height:hi.y,depth:hi.z};return this.userData.parameters=i,i}static build(e,t,o,i){let s,a,c,u=e?.phongAngle??35;!1===o&&(u=-1),t&&(de.free_bvh(t),de.free_subdivision_surface(t));try{s=We.allocate(e,i)}catch(l){console.error(l,e),s=We.allocate({positionWASM:Uy,indexWASM:Hy,verticesPerFaceWASM:Wy},i)}if(de.set_destination_refinement_level(s,0),a=We.buildLevel(s,!0,u),e.subdivisions>0)try{de.set_destination_refinement_level(s,e.subdivisions),c=We.buildLevel(s,!1,u)}catch{try{de.set_destination_refinement_level(s,e.subdivisions-1),c=We.buildLevel(s,!1,u)}catch{c=null}}else c=null;return{subdivPointer:s,originalGeometry:a,subdividedGeometry:c}}static primitiveToQuads(e,t,o){let a,c,u,l,d;e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let i=void 0!==e.shape||void 0!==e.path?t.geometry:$o(e,o,!1),s;if(s="TorusGeometry"===e.type&&e.arc===2*Math.PI?i.getClosedTorusIndicesForBooleanOrSubdiv():i.getIndex(),{positions:a,triIndices:l}=eu(i.getAttribute("position"),s),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let p=e.radialSegments*e.heightSegments*6,f=p+3*e.radialSegments;d=[p,f]}return{indices:c,verticesPerFace:u}=tu(a,l,i,d),{positions:a,indices:c,verticesPerFace:u}}static allocate(e,t){let w,o,i,s,a=[],c=[];e.positionWASM&&e.positionWASM.length>0?(o=e.positionWASM,i=e.indexWASM,s=e.verticesPerFaceWASM):(o=Uy,i=Hy,s=Wy);let u=o.length,l=i.length,d=s.length,p=o.length+a.length+c.length,f=i.length+s.length,m=p*Float32Array.BYTES_PER_ELEMENT+f*Uint32Array.BYTES_PER_ELEMENT,h=p*Float32Array.BYTES_PER_ELEMENT,g=(Uint32Array.BYTES_PER_ELEMENT,de._malloc(m)),x=new Float32Array(de.HEAPF32.buffer,g,p),b=new Uint32Array(de.HEAPU32.buffer,g+h,f);x.set(o,0),x.set(a,o.length),x.set(c,o.length+a.length),b.set(i,0),b.set(s,i.length),e?.scaleBaked?.some(P=>1!==P)&&(w=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().makeScale(...e.scaleBaked)),t&&(w?w.premultiply(t):w=t);let S=w?de.alloc_subdivision_surface2(g,u,g+h,l,g+h+i.length*Uint32Array.BYTES_PER_ELEMENT,d,w.elements):de.alloc_subdivision_surface(g,u,g+h,l,g+h+i.length*Uint32Array.BYTES_PER_ELEMENT,d);return de._free(g),S}static buildLevel(e,t,o,i,s){let a=s?de.get_mesh_data2(e,t?de.Level.CONTROL:de.Level.REFINED,o,s.elements):de.get_mesh_data(e,t?de.Level.CONTROL:de.Level.REFINED,o),u=de.HEAPU32.subarray(a>>2,(a>>2)+8),l=u.subarray(4,8),d=0,p=de.HEAPU32[u[d]>>2],f=de.HEAPF32.subarray(p>>2,(p>>2)+l[d]);d++;let m=de.HEAPU32[u[d]>>2],h=de.HEAPF32.subarray(m>>2,(m>>2)+l[d]);d++;let y=de.HEAPU32[u[d]>>2],g=de.HEAPU32.subarray(y>>2,(y>>2)+l[d]);d++;let x=de.HEAPU32[u[d]>>2],b=de.HEAPU32.subarray(x>>2,(x>>2)+l[d]);if(d++,void 0===i){let w=new three__WEBPACK_IMPORTED_MODULE_0__.u9r;if(w.setIndex(new three__WEBPACK_IMPORTED_MODULE_0__.lCJ(b,1)),w.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(f,3)),w.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(h,3)),t){w.setAttribute("faceMap",new three__WEBPACK_IMPORTED_MODULE_0__.lCJ(g,1));let S=new Float32Array(h.length/3*4).fill(0);w.setAttribute("color",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(S,4))}return de.free_mesh_data(a),w.userData.type="SubdivGeometry",w}i.getAttribute("position").copyArray(f),i.getAttribute("normal").copyArray(h),i.attributes.position.needsUpdate=!0,i.attributes.normal.needsUpdate=!0,de.free_mesh_data(a)}static freeSubdivPointer(e){de.free_bvh(e),de.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,o){let i=de.get_wireframe_data_for_base_level(e),a=de.HEAPU32.subarray(i>>2,(i>>2)+4),c=a.subarray(2,4),u=0,l=de.HEAPU32[a[u]>>2],d=de.HEAPF32.subarray(l>>2,(l>>2)+c[u]);u++;let p=de.HEAPU32[a[u]>>2],f=de.HEAPU32.subarray(p>>2,(p>>2)+c[u]);if(void 0===t){let m=new three__WEBPACK_IMPORTED_MODULE_0__.u9r;m.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(d,3));let h=new Float32Array(d.length);for(let y=0,g=d.length;y<g;)h[y++]=o.r,h[y++]=o.g,h[y++]=o.b;return m.setAttribute("color",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(h,3)),m.setIndex(new three__WEBPACK_IMPORTED_MODULE_0__.lCJ(f,1)),de.free_wireframe_data_for_base_level(i),m}t.getAttribute("position").copyArray(d),t.attributes.position.needsUpdate=!0,de.free_wireframe_data_for_base_level(i)}static updateCollabMesh(e,t,o){let i=0===t;i||de.set_destination_refinement_level(e,t);let s=o?de.get_topological_data2(e,i?de.Level.CONTROL:de.Level.REFINED,o.elements):de.get_topological_data(e,i?de.Level.CONTROL:de.Level.REFINED),c=de.HEAPU32.subarray(s>>2,(s>>2)+6),u=c.subarray(3,6),l=0,d=de.HEAPU32[c[l]>>2],p=new Float32Array(de.HEAPF32.subarray(d>>2,(d>>2)+u[l]));l++;let f=de.HEAPU32[c[l]>>2],m=new Uint32Array(de.HEAPU32.subarray(f>>2,(f>>2)+u[l]));l++;let h=de.HEAPU32[c[l]>>2],y=new Uint8Array(de.HEAPU32.subarray(h>>2,(h>>2)+u[l]));return de.free_topological_data(s),{positions:p,indices:m,verticesPerFace:y}}},qy=["getX","getY","getZ"];function eu(n,r){let e={},t=r?r.count:n.count,o=0,i=[],s=[];for(let u=0;u<t;u++){let l=r?r.getX(u):u,d="";for(let p=0;p<3;p++)d+=`${~~(1e4*n[qy[p]](l))},`;if(d in e)i.push(e[d]);else{for(let p1=0;p1<3;p1++)s.push(n[qy[p1]](l));e[d]=o,i.push(o),o++}}let c=[];for(let u1=0;u1<i.length;u1+=3)i[u1]===i[u1+1]||i[u1]===i[u1+2]||i[u1+1]===i[u1+2]||c.push(i[u1],i[u1+1],i[u1+2]);return{positions:s,triIndices:c}}var zl=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Zd=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Qd=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Jd=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;function tu(n,r,e,t){let o=[],i=[];if(void 0!==e.userData.shape&&0===e.userData.parameters.depth&&0===e.userData.shape.shapeHoles.length){let s=e.userData.shape.extractShapePointsToFlatArray([]),a=e.userData.parameters.spikes;if("EllipseGeometry"===e.userData.type&&a<=24&&a%4==0&&e.userData.parameters.angle>=360){let l=s.length/2/a;s=s.filter((d,p)=>Math.floor(p/2)%l==0)}let c=0;for(let l1=0;l1<s.length;l1+=2)c+=(s[l1]-s[(0===l1?s.length:l1)-2])*(s[l1+1]+s[(0===l1?s.length:l1)-1]);n.length=0;let u=0;if(c<0)for(let l2=0;l2<s.length;l2+=2)n.push(s[l2],s[l2+1],0),o.push(u++);else for(let l3=s.length-2;l3>=0;l3-=2)n.push(s[l3],s[l3+1],0),o.push(u++);return i.push(u),{indices:o,verticesPerFace:i}}for(let s1=0,a1=e.capStartIndex??r.length;s1<a1;)r[s1+1]===r[s1+3]&&r[s1+2]===r[s1+5]||r[s1+0]===r[s1+3]&&r[s1+2]===r[s1+4]?(zl.set(n[3*r[s1]],n[3*r[s1]+1],n[3*r[s1]+2]),Zd.set(n[3*r[s1+1]],n[3*r[s1+1]+1],n[3*r[s1+1]+2]),Qd.set(n[3*r[s1+4]],n[3*r[s1+4]+1],n[3*r[s1+4]+2]),Jd.set(n[3*r[s1+5]],n[3*r[s1+5]+1],n[3*r[s1+5]+2]),Zd.sub(zl).normalize(),Qd.sub(zl).normalize(),Jd.sub(zl).normalize(),Math.abs(Zd.cross(Qd).dot(Jd))>.005||t&&t.some((u,l)=>l%2!=1&&s1>=t[l]&&s1<t[l+1])?(o.push(r[s1],r[s1+1],r[s1+2]),i.push(3),s1+=3):(o.push(r[s1],r[s1+1],r[s1+4],r[s1+5]),i.push(4),s1+=6)):(o.push(r[s1],r[s1+1],r[s1+2]),i.push(3),s1+=3);if(void 0!==e.capStartIndex){let s2=[],a2=[],c1=0,u1=new Float32Array([e.userData.parameters.depth])[0];for(let l4=0,d=0;l4<n.length;l4+=3,d++)0===n[l4+2]&&(s2.push(d),c1++),n[l4+2]===u1&&a2.push(d);if(0===e.userData.parameters.extrudeBevelSize){let l5=a2[0];a2[0]=a2[1],a2[1]=l5}s2.reverse(),o.push(...s2,...a2),i.push(c1,c1)}return{indices:o,verticesPerFace:i}}var Yt={};function Xy(n){let r=n.length,e=r*Uint32Array.BYTES_PER_ELEMENT,t=r*Float32Array.BYTES_PER_ELEMENT,o=Number.isInteger(n[0])?e:t,i=xe._malloc(o);return(Number.isInteger(n[0])?new Uint32Array(xe.HEAPU32.buffer,i,r):new Float32Array(xe.HEAPF32.buffer,i,r)).set(n,0),i}function Ky(n){switch(n){case 0:return xe.OP.UNION;case 1:return xe.OP.INTERSECTION;case 2:return xe.OP.A_MINUS_B;case 3:return xe.OP.B_MINUS_A;case 4:return xe.OP.SYMMETRIC_DIFFERENCE;case 5:return xe.OP.ALL;default:throw Error("Unknown boolean operation "+n)}}function XT(n,r){void 0===yi&&(yi=xe.init_csg());let e=Xy(n),t=xe.csg_calc_topological(yi,e,n.length,Ky(r));xe._free(e);let i=xe.HEAPU32.subarray(t>>2,(t>>2)+6),s=i.subarray(3,6),a=0,c=xe.HEAPU32[i[a]>>2],u=new Float32Array(xe.HEAPF32.subarray(c>>2,(c>>2)+s[a]));a++;let l=xe.HEAPU32[i[a]>>2],d=new Uint32Array(xe.HEAPU32.subarray(l>>2,(l>>2)+s[a]));a++;let p=xe.HEAPU32[i[a]>>2],f=new Uint8Array(xe.HEAPU32.subarray(p>>2,(p>>2)+s[a]));return xe.free_mesh_data(t),{positions:u,indices:d,verticesPerFace:f}}function KT(n,r,e,t){void 0===yi&&(yi=xe.init_csg());let o=Xy(n),i=xe.csg_calc(yi,o,n.length,t,Ky(r));xe._free(o);let a=xe.HEAPU32.subarray(i>>2,(i>>2)+5),c=a.subarray(2,5),u=0,l=xe.HEAPU32[a[u]>>2],d=xe.HEAPF32.subarray(l>>2,(l>>2)+c[u]);u++;let p=xe.HEAPU32[a[u]>>2],f=xe.HEAPF32.subarray(p>>2,(p>>2)+c[u]),m=c[++u];e.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(d,3)),e.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(f,3));let h=xe.HEAPF32.subarray((i>>2)+5,(i>>2)+5+6);return null===e.boundingSphere&&(e.boundingSphere=new three__WEBPACK_IMPORTED_MODULE_0__.aLr),e.boundingSphere.center.set(h[0],h[1],h[2]),e.boundingSphere.radius=(h[3]**2+h[4]**2+h[5]**2)**.5,e.userData.parameters={width:2*h[3],height:2*h[4],depth:2*h[5]},xe.free_mesh_data(i),m}function ZT(n,r,e){let t,o,i;if(void 0===xe)return -1;if(r&&void 0!==n.userData.positions){let y=n.userData;i=y.verticesPerFace.length,t=y.positions,o=Array(y.verticesPerFace.reduce((g,x)=>g+x,0)+i);for(let g=0,x=0,b=0;g<y.verticesPerFace.length;g++){o[b++]=y.verticesPerFace[g];for(let w=0;w<y.verticesPerFace[g];w++)o[b++]=y.indices[x++]}}else({positions:t,faceIndices:o,nFaces:i}=function(n,r,e){let t,o;o="TorusGeometry"===n.userData.parameters.type&&n.userData.parameters.arc===2*Math.PI?n.getClosedTorusIndicesForBooleanOrSubdiv():n.getIndex();let{positions:i,triIndices:s}=eu(n.getAttribute("position"),o),a;if(r&&e){let{indices:c,verticesPerFace:u}=tu(i,s,n);a=u.length,t=[];for(let l=0,d=0;l<a;l++){t.push(u[l]);for(let p=0;p<u[l];p++)t.push(c[d++])}}else{let c1=s.length;t=Array(c1+c1/3),a=0;for(let u1=0,l1=0;l1<t.length;)t[l1++]=3,a++,t[l1++]=s[u1++],t[l1++]=s[u1++],t[l1++]=s[u1++]}return{positions:i,faceIndices:t,nFaces:a}}(n,r,e));let s=t.length,a=o.length,c=t.length,u=o.length,l=c*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,d=c*Float32Array.BYTES_PER_ELEMENT,f=(Uint32Array.BYTES_PER_ELEMENT,xe._malloc(l)),m=new Float32Array(xe.HEAPF32.buffer,f,c),h=new Uint32Array(xe.HEAPU32.buffer,f+d,u);return m.set(t,0),h.set(o,0),xe.get_csg_mesh(f,s,f+d,a,i)}function QT(n){return xe.has_open_edges(n)}function JT(n,r){xe.transform_csg_mesh(n,r.elements)}function eO(n){xe.free_csg_mesh(n)}((n,r)=>{for(var e in r)vc(n,e,{get:r[e],enumerable:!0})})(Yt,{calcBoolean:()=>KT,calcBooleanTopological:()=>XT,freeMeshSet:()=>eO,getMeshSet:()=>ZT,hasOpenEdges:()=>QT,transformMeshSet:()=>JT}),new Promise(n=>{}).then(n=>xe=n);var tO={ConeGeometry:Lh,CubeGeometry:Dh,CylinderGeometry:Eh,DodecahedronGeometry:Bh,EllipseGeometry:li,HelixGeometry:py,IcosahedronGeometry:fy,LatheGeometry:my,NonParametricGeometry:Py,PolygonGeometry:Dl,PyramidGeometry:Ty,RectangleGeometry:Bl,SphereGeometry:Oy,PlaneGeometry:Ay,BackdropGeometry:Cy,StarGeometry:Rl,TextFrameGeometry:Ny,TorusGeometry:Iy,TorusKnotGeometry:My,TriangleGeometry:Ey,PathGeometry:Ry,VectorGeometry:Mt},$d=n=>tO[n.type].create(n);function Ms(n){return null!==n&&"booleanOp"in n}var gi=class extends Jn(three__WEBPACK_IMPORTED_MODULE_0__.Kj0){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new three__WEBPACK_IMPORTED_MODULE_0__.yGw}updateVisible(){super.updateVisible(),this.visible=!Ms(this.parent)&&this.visible,Ms(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(Yt.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Ms(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){for(let e of(this.freeBooleanPointer(),this.children))e instanceof gi&&(e.freeBooleanPointer(),Ms(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e){let t=super.updateTransformState(e);return t&&Ms(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}},jl=new three__WEBPACK_IMPORTED_MODULE_0__.ZzF;function Es(n,r=0,e=n.count,t,o){let i=1/0,s=1/0,a=1/0,c=-1/0,u=-1/0,l=-1/0;for(let d=r;d<e;d++){let p=n.getX(d),f=n.getY(d),m=n.getZ(d);p<i&&(i=p),f<s&&(s=f),m<a&&(a=m),p>c&&(c=p),f>u&&(u=f),m>l&&(l=m)}jl.min.set(i,s,a),jl.max.set(c,u,l),jl.getCenter(t),jl.getSize(o).multiplyScalar(.5)}var aO=new three__WEBPACK_IMPORTED_MODULE_0__.u9r,lO=new three__WEBPACK_IMPORTED_MODULE_0__.vBJ,pt=class extends gi{constructor(r,e){super(aO,lO),this.super_Entity(r,e)}updateState(r,e){this.updateState_Entity(r,e)}updateEntityBoxSize(r,e){let t=this.geometry.getAttribute("position");void 0!==t?Es(t,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:t.count,r,e):super.updateEntityBoxSize(r,e)}},Ls=class{constructor(r){r=r??{},this.name=r.name,this.type=r.type,this.node=r.node,this.size=r.size,this.needsUpdate=r.needsUpdate}get value(){return this.node.value}set value(r){this.node.value=r}},it=class{constructor(r){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),this.type=r,this.name=""}analyze(r,e){e=e??{},r.analyzing=!0,this.build(r.addFlow(e.slot,e.cache,e.context),"v4"),r.clearVertexNodeCode(),r.clearFragmentNodeCode(),r.removeFlow(),r.analyzing=!1}analyzeAndFlow(r,e,t){return t=t??{},this.analyze(r,t),this.flow(r,e,t)}flow(r,e,t){t=t??{},r.addFlow(t.slot,t.cache,t.context);let o={result:this.build(r,e),code:r.clearNodeCode(),extra:r.context.extra};return r.removeFlow(),o}build(r,e,t){e=e??this.getType(r,e);let o=r.getNodeData(t??this);return r.analyzing&&this.appendDepsNode(r,o,e),-1===r.nodes.indexOf(this)&&r.nodes.push(this),void 0!==this.updateFrame&&-1===r.updaters.indexOf(this)&&r.updaters.push(this),this.generate(r,e,t)}updateFrame(r){}generateReadonly(r,e,t,o,i,s){return""}generate(r,e,t,o,i){return""}parse(r,e,t,o){}appendDepsNode(r,e,t){e.deps=(e.deps||0)+1;let o=r.getTypeLength(t);(o>(e.outputMax||0)||this.getType(r,t))&&(e.outputMax=o,e.output=t)}setName(r){this.name=r}getName(){return this.name}getType(r,e){return"sampler2D"===e||"samplerCube"===e?e:this.type}getHash(){let r="{",e,t;for(e in this)(t=this[e])instanceof it&&(r+='"'+e+'":'+t.getHash()+",");if(this.hashProperties)for(let o=0;o<this.hashProperties.length;o++)t=this[e=this.hashProperties[o]],r+='"'+e+'":"'+String(t)+'",';return r+'"id":"'+this.uuid+'"}'}},Qe=new class{constructor(){this.nodes={},this.keywords={}}add(r){this.nodes[r.name]=r}addKeyword(r,e,t){t=void 0===t||t,this.keywords[r]={callback:e,cache:t}}remove(r){delete this.nodes[r.name]}removeKeyword(r){delete this.keywords[r]}get(r){return this.nodes[r]}getKeyword(r,e){return this.keywords[r].callback(e)}getKeywordData(r){return this.keywords[r]}contains(r){return void 0!==this.nodes[r]}containsKeyword(r){return void 0!==this.keywords[r]}},ae=class extends it{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,o,i){if(t=t??this.getType(e),this.getShared(e,t)){let s=this.getUnique(e,t);s&&void 0===this.uuid&&(this.uuid=three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID()),o=e.getUUID(o??this.getUUID(),!s);let a=e.getNodeData(o),c=a.output||this.getType(e);if(e.analyzing)return(a.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,a,t),this.generate(e,t,o)):super.build(e,t,o);if(s)return a.name=a.name||super.build(e,t,o),a.name;if(!this.getLabel()&&(!this.getShared(e,c)||e.context.ignoreCache||1===a.deps))return super.build(e,t,o);o=this.getUUID(!1);let u=this.getTemp(e,o);if(u)return e.format(u,c,t);{u=super.generate(e,t,o,a.output,i);let l=this.generate(e,c,o);return e.addNodeCode(u+" = "+l+";"),e.format(u,c,t)}}return super.build(e,t,o)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let o=e.getVars()[t];return o?o.name:void 0}generate(e,t,o,i,s){return this.getShared(e,t)||console.error("TempNode is not shared"),o=o??this.uuid,e.getTempVar(o,i??this.getType(e),s,this.getLabel()).name}},Ne=class extends ae{constructor(e,t){(t=t??{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,o,i,s,a){o=e.getUUID(o??this.getUUID()),i=i??this.getType(e);let c=e.getNodeData(o);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,o,i,s,a):e.isShader("vertex")?(c.vertex||(c.vertex=e.createVertexUniform(i,this,s,a,this.getLabel())),e.format(c.vertex.name,i,t)):(c.fragment||(c.fragment=e.createFragmentUniform(i,this,s,a,this.getLabel())),e.format(c.fragment.name,i,t))}},Ve=class extends Ne{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof three__WEBPACK_IMPORTED_MODULE_0__.FM8?e:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,o,i,s,a){return e.format("vec2("+this.value.x+", "+this.value.y+")",i,t)}},ft=class extends Ne{constructor(e=0,t,o){super("v3"),this.nodeType="Vector3",this.value=e instanceof three__WEBPACK_IMPORTED_MODULE_0__.Pa4?e:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(e,t,o)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,o,i,s,a){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",i,t)}},Je=class extends three__WEBPACK_IMPORTED_MODULE_0__.Ilk{constructor(e,t,o,i){super(e,t,o),this.isColorA=!0,this.a=i}setRGBA(e,t,o,i){super.setRGB(e,t,o),this.a=i}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let o;if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(o=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let i,s=o[1],a=o[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.a="rgba"===s?parseFloat(i[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.a="hsla"===s?parseFloat(i[4]):1,super.setStyle(e,t)}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Et=class extends Ne{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Je?e:new Je(e.r,e.g,e.b,e.a)}generateReadonly(e,t,o,i,s,a){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",i,t)}},pO=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Jy=/[a-z_0-9]+/gi,k=class extends ae{constructor(e,t,o,i,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===s,this.isInterface=!1,this.parse(e,t,o,i)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,o,i,s){let a,c=0,u=this.src;if(this.includes)for(let d=0;d<this.includes.length;d++)e.include(this.includes[d],this);for(let d1 in this.extensions)e.extensions[d1]=!0;let l=[];for(;a=Jy.exec(this.src);)l.push(a);for(let d2=0;d2<l.length;d2++){let p=l[d2],f=p[0],m=!this.isMethod||!this.getInputByName(f),h=f;if(this.keywords[f]||this.useKeywords&&m&&Qe.containsKeyword(f)){let y=this.keywords[f];if(!y){let g=Qe.getKeywordData(f);g.cache&&(y=e.keywords[f]),y=y||Qe.getKeyword(f,e),g.cache&&(e.keywords[f]=y)}h=y.build(e)}f!==h&&"."!==u[p.index+c-1]&&(u=u.substring(0,p.index+c)+h+u.substring(p.index+f.length+c),c+=h.length-f.length),void 0===this.getIncludeByName(h)&&Qe.contains(h)&&e.include(Qe.get(h))}return"source"===t?u:this.isMethod?(this.isInterface||e.include(this,void 0,u),this.name):e.format("( "+u+" )",this.getType(e),t)}parse(e,t,o,i){if(this.src=e||"",this.includes=t??[],this.extensions=o??{},this.keywords=i??{},this.isMethod){let s=pO.exec(this.src);if(this.inputs=[],s&&4==s.length){this.type=s[1],this.name=s[2];let a=s[3].match(Jy);if(a){let c=0;for(;c<a.length;){let u=a[c++],l;"in"===u||"out"===u||"inout"===u?l=a[c++]:(l=u,u="");let d=a[c++];this.inputs.push({name:d,type:l,qualifier:u})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},fO=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,ou=class extends ae{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||ou.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,o,i,s){this.src=e||"";let a,c,u="",l=fO.exec(e);this.useDefine=s??"#"===this.src.charAt(0),l&&l.length>1?(c=l[1],a=l[2],u=l[3]):(a=this.src,c="f"),this.name=a,this.type=c,this.value=u}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,o,i,s){return e.format(this.name,this.getType(e),t)}},we=ou;we.PI="PI",we.PI2="PI2",we.RECIPROCAL_PI="RECIPROCAL_PI",we.RECIPROCAL_PI2="RECIPROCAL_PI2",we.LOG2="LOG2",we.EPSILON="EPSILON";var mO=RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),hO=RegExp("s*(w*?)s*(w*?)(=|;)","gim"),xi=class extends ae{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,o,i,s){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=mO.exec(e);if(t){let o=t[2],i;for(;i=hO.exec(o);)this.inputs.push({type:i[1],name:i[2]});this.name=t[1]}else this.name="";this.type=this.name}},vi=class extends ae{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let o=this.index>0?this.index+1:"",i=e.isShader("vertex")?"uv"+o:"vUv"+o;return e.format(i,this.getType(e),t)}};Qe.addKeyword("uv",function(){return new vi}),Qe.addKeyword("uv2",function(){return new vi(1)});var Yo=class extends ae{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Yo.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case three__WEBPACK_IMPORTED_MODULE_0__.rnI:return["Linear"];case three__WEBPACK_IMPORTED_MODULE_0__.knz:return["sRGB"];default:return[]}}generate(e,t){let o=this.input.build(e,"v4"),i=this.getType(e),s=Yo.Nodes[this.method],a=e.include(s);if(a===Yo.LINEAR_TO_LINEAR)return e.format(o,i,t);if(s.inputs?.length!==2)return e.format(a+"( "+o+" )",i,t);{let c=this.factor.build(e,"f");return e.format(a+"( "+o+", "+c+" )",i,t)}}fromEncoding(e){let t=Yo.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Yo.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},_t=Yo;_t.Nodes={LinearToLinear:new k(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new k(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new k(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},_t.LINEAR_TO_LINEAR="LinearToLinear",_t.SRGB_TO_LINEAR="sRGBToLinear",_t.LINEAR_TO_SRGB="LinearTosRGB";var Pe=class extends k{constructor(e="",t,o,i,s){super(e,s,i,o,t),this.nodeType="Expression"}},Pt=class extends Ne{constructor(e=new three__WEBPACK_IMPORTED_MODULE_0__.xEZ,t,o,i){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new vi,this.bias=o,this.project=void 0!==i&&i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){let a,c;if("sampler2D"===t)return this.getTexture(e,t);let o=this.getTexture(e,t),i=this.uv.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),a=this.project?"texture2DProj":s?"tex2DBias":"tex2D",c=s?a+"( "+o+", "+i+", "+s+" )":a+"( "+o+", "+i+" )";let u={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(u),this.colorSpace=this.colorSpace??new _t(new Pe("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(c),c=this.colorSpace.build(e,l),e.removeContext(),e.format(c,l,t)}},Y=class extends Ne{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,o,i,s,a){return e.format(this.value+(this.value%1?"":".0"),i,t)}},Ds=class extends ae{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,o,i,s){i=this.getType(e);let a=this.value,c=a.build(e,t)+"( ",u=[];if(a.inputs){for(let l=0;l<a.inputs.length;l++){let d=a.inputs[l],p=this.inputs[l]||this.inputs[d.name];u.push(p.build(e,e.getTypeByFormat(d.type)))}c+=u.join(", ")+" )"}return e.format(c,i,t)}},nu=class extends ae{constructor(e,t,o=nu.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=o}getType(e){let t=this.a.getType(e),o=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(o)>e.getTypeLength(t)?o:t}generate(e,t){let o=this.getType(e);this.type=o;let i=this.a.build(e,o),s=this.b.build(e,o);return e.format("( "+i+" "+this.op+" "+s+" )",o,t)}},st=nu;st.ADD="+",st.SUB="-",st.MUL="*",st.DIV="/";var Ie=class extends ae{constructor(e,t=Ie.ABS,o,i){super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:i=t,"string"!=typeof o?this.c=o:i=o,this.method=i,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Ie.MIX:case Ie.CLAMP:case Ie.REFRACT:case Ie.SMOOTHSTEP:case Ie.FACEFORWARD:return 3;case Ie.MIN:case Ie.MAX:case Ie.MOD:case Ie.STEP:case Ie.REFLECT:case Ie.DISTANCE:case Ie.DOT:case Ie.CROSS:case Ie.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),o=this.b?e.getTypeLength(this.b.getType(e)):0,i=this.c?e.getTypeLength(this.c.getType(e)):0;return t>o&&t>i?this.a.getType(e):o>i?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Ie.LENGTH:case Ie.DISTANCE:case Ie.DOT:return"f";case Ie.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let o,i,s,a=this.a?e.getTypeLength(this.a.getType(e)):0,c=this.b?e.getTypeLength(this.b.getType(e)):0,u=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),d=this.getType(e);switch(this.type=d,this.method){case Ie.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Ie.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Ie.CROSS:o=this.a.build(e,"v3"),i=this.b.build(e,"v3");break;case Ie.STEP:o=this.a.build(e,1===a?"f":l),i=this.b.build(e,l);break;case Ie.MIN:case Ie.MAX:case Ie.MOD:o=this.a.build(e,l),i=this.b.build(e,1===c?"f":l);break;case Ie.REFRACT:o=this.a.build(e,l),i=this.b.build(e,l),s=this.c.build(e,"f");break;case Ie.MIX:o=this.a.build(e,l),i=this.b.build(e,l),s=this.c.build(e,1===u?"f":l);break;default:o=this.a.build(e,l),this.b&&(i=this.b.build(e,l)),this.c&&(s=this.c.build(e,l))}let p=[];p.push(o),i&&p.push(i),s&&p.push(s);let f=this.getNumInputs(e);if(p.length!==f)throw Error(`Arguments not match used in "${this.method}". Require ${f}, currently ${p.length}.`);return e.format(this.method+"( "+p.join(", ")+" )",d,t)}},pe=Ie;pe.RAD="radians",pe.DEG="degrees",pe.EXP="exp",pe.EXP2="exp2",pe.LOG="log",pe.LOG2="log2",pe.SQRT="sqrt",pe.INV_SQRT="inversesqrt",pe.FLOOR="floor",pe.CEIL="ceil",pe.NORMALIZE="normalize",pe.FRACT="fract",pe.SATURATE="saturate",pe.SIN="sin",pe.COS="cos",pe.TAN="tan",pe.ASIN="asin",pe.ACOS="acos",pe.ARCTAN="atan",pe.ABS="abs",pe.SIGN="sign",pe.LENGTH="length",pe.NEGATE="negate",pe.INVERT="invert",pe.MIN="min",pe.MAX="max",pe.MOD="mod",pe.STEP="step",pe.REFLECT="reflect",pe.DISTANCE="distance",pe.DOT="dot",pe.CROSS="cross",pe.POW="pow",pe.MIX="mix",pe.CLAMP="clamp",pe.REFRACT="refract",pe.SMOOTHSTEP="smoothstep",pe.FACEFORWARD="faceforward";var bi=class extends ae{constructor(e,t,o){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=o}bilinearCubeUV(e,t,o,i){let s=new Ds(bi.Nodes.bilinearCubeUV,[t,o,i]);this.colorSpaceTL=this.colorSpaceTL??new _t(new Pe("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(s.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new _t(new Pe("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(s.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new _t(new Pe("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(s.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new _t(new Pe("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(s.build(e)+".br");let a={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(a),this.colorSpaceTLExp=new Pe(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Pe(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Pe(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Pe(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let c=new Pe("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return c.keywords.cubeUV_TL=this.colorSpaceTLExp,c.keywords.cubeUV_TR=this.colorSpaceTRExp,c.keywords.cubeUV_BL=this.colorSpaceBLExp,c.keywords.cubeUV_BR=this.colorSpaceBRExp,c.keywords.cubeUV=s,c}generate(e,t){if(!e.isShader("fragment"))return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t);{let o=this.uv,i=this.bias||e.context.roughness,s=new Ds(bi.Nodes.roughnessToMip,[i]),a=new pe(s,bi.Nodes.m0,bi.Nodes.cubeUV_maxMipLevel,pe.CLAMP),c=new pe(a,pe.FLOOR),u=new pe(a,pe.FRACT),l=this.bilinearCubeUV(e,this.value,o,c),d=this.bilinearCubeUV(e,this.value,o,new st(c,new Y(1).setReadonly(!0),st.ADD)),p=new pe(l,d,u,pe.MIX);return e.format(p.build(e),"v4",t)}}},Si=bi;Si.Nodes=(e=new xi(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new we("float cubeUV_maxMipLevel 8.0",!0),o=new we("float cubeUV_minMipLevel 4.0",!0),i=new we("float cubeUV_maxTileSize 256.0",!0),s=new we("float cubeUV_minTileSize 16.0",!0),(a=new k(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`)).useKeywords=!1,(c=new k(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`)).useKeywords=!1,(u=new k(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,a,c,t,o,i,s])).useKeywords=!1,l=new we("float r0 1.0",!0),d=new we("float v0 0.339",!0),p=new we("float m0 -2.0",!0),f=new we("float r1 0.8",!0),m=new we("float v1 0.276",!0),h=new we("float m1 -1.0",!0),y=new we("float r4 0.4",!0),g=new we("float v4 0.046",!0),x=new we("float m4 2.0",!0),b=new we("float r5 0.305",!0),w=new we("float v5 0.016",!0),S=new we("float m5 3.0",!0),P=new we("float r6 0.21",!0),_=new we("float v6 0.0038",!0),v=new we("float m6 4.0",!0),{bilinearCubeUV:u,roughnessToMip:new k(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,[l,d,p,f,m,h,y,g,x,b,w,S,P,_,v]),m0:p,cubeUV_maxMipLevel:t});var Xo=class extends ae{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Xo.VIEW}getShared(){return this.scope===Xo.WORLD}build(e,t,o,i){let s=e.context[this.scope+"Normal"];return s?s.build(e,t,o,i):super.build(e,t,o)}generate(e,t,o,i,s){let a;switch(this.scope){case Xo.VIEW:a=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case Xo.LOCAL:e.isShader("vertex")?a="objectNormal":(e.requires.normal=!0,a="vObjectNormal");break;case Xo.WORLD:e.isShader("vertex")?a="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,a="vWNormal")}return e.format(a,this.getType(e),t)}},at=Xo;at.LOCAL="local",at.WORLD="world",at.VIEW="view",at.NORMAL="normal",Qe.addKeyword("viewNormal",function(){return new at(at.VIEW)}),Qe.addKeyword("localNormal",function(){return new at(at.NORMAL)}),Qe.addKeyword("worldNormal",function(){return new at(at.WORLD)});var Nr=class extends ae{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Nr.LOCAL}getType(){return this.scope===Nr.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case Nr.LOCAL:case Nr.WORLD:return!1}return!0}generate(e,t,o,i,s){let a;switch(this.scope){case Nr.LOCAL:e.isShader("vertex")?a="transformed":(e.requires.position=!0,a="vPosition");break;case Nr.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,a="vWPosition";break;case Nr.VIEW:a=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Nr.PROJECTION:a=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(a,this.getType(),t)}},Lt=Nr;Lt.LOCAL="local",Lt.WORLD="world",Lt.VIEW="view",Lt.PROJECTION="projection",Qe.addKeyword("position",function(){return new Lt}),Qe.addKeyword("worldPosition",function(){return new Lt(Lt.WORLD)}),Qe.addKeyword("viewPosition",function(){return new Lt(Lt.VIEW)});var lr=class extends ae{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??lr.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===lr.SPHERE?"v2":this.type}generate(e,t){let o=this.getUnique(e);if(!e.isShader("fragment"))return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t);{let i;switch(this.scope){case lr.VECTOR:{let s=new at(at.VIEW),a=e.context.roughness,c=s.build(e,"v3"),u=new Lt(Lt.VIEW).build(e,"v3"),l=a?a.build(e,"f"):void 0,d=`reflect( -normalize( ${u} ), ${c} )`;l&&(d=`normalize( mix( ${d}, ${c}, ${l} * ${l} ) )`);let p=`inverseTransformDirection( ${d}, viewMatrix )`;o?(e.addNodeCode(`vec3 reflectVec = ${p};`),i="reflectVec"):i=p;break}case lr.CUBE:{let s1=new lr(lr.VECTOR).build(e,"v3"),a1="vec3( -"+s1+".x, "+s1+".yz )";o?(e.addNodeCode(`vec3 reflectCubeVec = ${a1};`),i="reflectCubeVec"):i=a1;break}case lr.SPHERE:{let a2="normalize( ( viewMatrix * vec4( "+new lr(lr.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";o?(e.addNodeCode(`vec2 reflectSphereVec = ${a2};`),i="reflectSphereVec"):i=a2}}return e.format(i,this.getType(),t)}}},Ir=lr;Ir.CUBE="cube",Ir.SPHERE="sphere",Ir.VECTOR="vector";var Fl=class extends ae{constructor(e=new Pt,t,o){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new Si(this.value,t??new Ir(Ir.VECTOR),o),this.irradianceNode=new Si(this.value,new at(at.WORLD),new Y(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},kl=class extends Ne{constructor(e=new three__WEBPACK_IMPORTED_MODULE_0__.BtG,t,o){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Ir,this.bias=o}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){let a;if("samplerCube"===t)return this.getTexture(e,t);let o=this.getTexture(e,t),i=this.uv?.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),a=s?"texCubeBias( "+o+", "+i+", "+s+" )":"texCube( "+o+", "+i+" )";let c={include:e.isShader("vertex"),ignoreCache:!0},u=this.getType(e);return e.addContext(c),this.colorSpace=this.colorSpace??new _t(new Pe("",u)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,u),e.removeContext(),e.format(a,u,t)}},eg=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,tg=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,rg=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,og=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// NOTE: We use the blue channel to avoid temporal reprojection
// with incorrect velocity if the fragment is transparent.
gVelocity = vec4(velocity, gl_FragColor.a < 1.0 ? 0.0 : 1.0, 1.);
`,ig=["x","y","z","w"],PO=["float","vec2","vec3","vec4"],TO={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},OO={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Ul=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function r(e,t){return e.deps.length-t.deps.length}return function(t,o){let i=this.getIncludes(t,o);if(!i)return"";let s="";i=i.sort(r);for(let a=0;a<i.length;a++)i[a].src&&(s+=i[a].src+`
`);return s}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(r,e){this.addVertexParsCode(eg),this.addFragmentParsCode(tg),this.buildShader("vertex",r),this.buildShader("fragment",e);for(let t=0;t<this.requires.uv.length;t++)if(this.requires.uv[t]){let o=t>0?t+1:"";this.addVaryCode("varying vec2 vUv"+o+";"),t>0&&this.addVertexParsCode("attribute vec2 uv"+o+";"),this.addVertexFinalCode("vUv"+o+" = uv"+o+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(rg),this.addFragmentFinalCode(og)),this}buildShader(r,e){this.resultCode[r]=e.build(this.setShader(r),"v4")}setMaterial(r,e){return this.defines={},this}addFlow(r,e,t){return this.addSlot(r).addCache(e).addContext(t)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(r){return this.cache=r??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(r){return this.context=Object.assign({},this.context,r),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(r){return this.slot=r||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(r,e){void 0===this.fragmentVariables[r]&&(this.addFragmentCode(`${e} ${r};`),this.fragmentVariables[r]="")}addFragmentParsVariable(r,e){void 0===this.fragmentParsVariables[r]&&(this.addFragmentParsCode(`${e} ${r};`),this.fragmentParsVariables[r]="")}addVertexParsVariable(r,e){void 0===this.vertexParsVariables[r]&&(this.addVertexParsCode(`${e} ${r};`),this.vertexParsVariables[r]="")}addVertexCode(r){this.addCode(r,"vertex")}addFragmentCode(r){this.addCode(r,"fragment")}addCode(r,e){this.code[e??this.shader]+=r+`
`}addVertexNodeCode(r){this.addNodeCode(r,"vertex")}addFragmentNodeCode(r){this.addNodeCode(r,"fragment")}addNodeCode(r,e){this.nodeCode[e??this.shader]+=r+`
`}clearNodeCode(r){r=r??this.shader;let e=this.nodeCode[r];return this.nodeCode[r]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(r){this.addFinalCode(r,"vertex")}addFragmentFinalCode(r){this.addFinalCode(r,"fragment")}addFinalCode(r,e){this.finalCode[e??this.shader]+=r+`
`}addVertexParsCode(r){this.addParsCode(r,"vertex")}addFragmentParsCode(r){this.addParsCode(r,"fragment")}addParsCode(r,e){this.parsCode[e??this.shader]+=r+`
`}addVaryCode(r){this.addVertexParsCode(r),this.addFragmentParsCode(r)}isCache(r){return -1!==this.caches.indexOf(r)}isSlot(r){return -1!==this.slots.indexOf(r)}define(r,e){this.defines[r]=void 0===e?1:e}require(r){this.requires[r]=!0}isDefined(r){return void 0!==this.defines[r]}getVar(r,e,t,o="varying",i="V",s=""){let a=this.getVars(o),c=a[r];if(!c){let u=a.length;c={name:t||"node"+i+u+(s?"_"+s:""),type:e},a.push(c),a[r]=c}return c}getTempVar(r,e,t,o){return this.getVar(r,e,t,this.shader,"T",o)}getAttribute(r,e){if(!this.attributes[r]){let t=this.getVar(r,e);this.addVertexParsCode("attribute "+e+" "+r+";"),this.addVertexFinalCode(t.name+" = "+r+";"),this.attributes[r]={varying:t,name:r,type:e}}return this.attributes[r]}getCode(r){return[this.prefixCode,this.parsCode[r],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[r],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[r],"uniform"),this.getIncludesCode("consts",r),this.getIncludesCode("structs",r),this.getIncludesCode("functions",r),"void main() {",this.getVarListCode(this.getVars(r)),this.code[r],this.resultCode[r],this.finalCode[r],"}"].join(`
`)}getVarListCode(r,e){e=e??"";let t="";for(let o=0,i=r.length;o<i;++o){let s=r[o],a=s.type,c=s.name,u=s.size,l=this.getFormatByType(a);if(void 0===l)throw Error("Node pars "+l+" not found.");l.includes("[]")?t+=e+" "+l.substring(0,l.length-2)+" "+c+`[${u}];
`:t+=e+" "+l+" "+c+`;
`}return t}getVars(r){return this.inputs.vars[r??this.shader]}getNodeData(r){let e=r instanceof it?r.uuid:r;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(r,e,t,o,i,s){if(e.includes("[]")){let a=this.inputs.arrayUniforms,c=a.list.length,u=new Ls({type:e,size:t.size,name:o||"nodeUA"+c+(s?"_"+s:""),node:t,needsUpdate:i});return a.list.push(u),a[r].push(u),a[r][u.name]=u,this.uniforms[u.name]=u,u}{let a1=this.inputs.uniforms,c1=a1.list.length,u1=new Ls({type:e,name:o||"nodeU"+c1+(s?"_"+s:""),node:t,needsUpdate:i});return a1.list.push(u1),a1[r].push(u1),a1[r][u1.name]=u1,this.uniforms[u1.name]=u1,u1}}createVertexUniform(r,e,t,o,i){return this.createUniform("vertex",r,e,t,o,i)}createFragmentUniform(r,e,t,o,i){return this.createUniform("fragment",r,e,t,o,i)}include(r,e,t){let o;if(r="string"==typeof r?Qe.get(r):r,!1===this.context.include)return r.name;r instanceof k?o=this.includes.functions:r instanceof we?o=this.includes.consts:r instanceof xi&&(o=this.includes.structs);let i=o[this.shader]=o[this.shader]||[];if(r){let s=i[r.name];if(s||(s=i[r.name]={node:r,deps:[]},i.push(s),s.src=r.build(this,"source")),r instanceof k&&e&&i[e.name]&&-1===i[e.name].deps.indexOf(r)&&(i[e.name].deps.push(r),r.includes?.length)){let a=0;do this.include(r.includes[a++],e);while(a<r.includes.length)}return t&&(s.src=t),r.name}throw Error("Include not found.")}colorToVectorProperties(r){return r.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(r){return r.replace(/c/g,"v3")}getIncludes(r,e){return this.includes[r][e||this.shader]}getConstructorFromLength(r){return PO[r-1]}isTypeMatrix(r){return/^m/.test(r)}getTypeLength(r){return"f"===r?1:parseInt(this.colorToVector(r).substr(1))}getTypeFromLength(r){return 1===r?"f":"v"+r}findNode(...r){for(let e=0;e<arguments.length;e++){let t=r[e];if(t?.isNode)return t}}resolve(...r){for(let e=0;e<arguments.length;e++){let t=r[e];if(void 0!==t){if(t.isNode)return t;if(t.isTexture)switch(t.mapping){case three__WEBPACK_IMPORTED_MODULE_0__.fY$:case three__WEBPACK_IMPORTED_MODULE_0__.vxC:return new kl(t);case three__WEBPACK_IMPORTED_MODULE_0__.g8_:return new Fl(new Pt(t));default:return new Pt(t)}else{if(t.isVector2)return new Ve(t);if(t.isVector3)return new ft(t);if(t.isVector4)return new Et(t)}}}}format(r,e,t){switch(this.colorToVector(t+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return r+".x";case"f <- i":case"f <- b":return"float( "+r+" )";case"v2 <- f":return"vec2( "+r+" )";case"v2 <- v3":case"v2 <- v4":return r+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+r+" ) )";case"v3 <- f":return"vec3( "+r+" )";case"v3 <- v2":return"vec3( "+r+", 0.0 )";case"v3 <- v4":return r+".xyz";case"v4 <- f":return"vec4( "+r+" )";case"v4 <- v2":return"vec4( "+r+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+r+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+r+" ) )";case"i <- f":case"i <- b":return"int( "+r+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+r+".x )";case"b <- f":return"( "+r+" != 0.0 )";case"b <- v2":return"( "+r+" != vec2( 0.0 ) )";case"b <- v3":return"( "+r+" != vec3( 0.0 ) )";case"b <- v4":return"( "+r+" != vec4( 0.0 ) )";case"b <- i":return"( "+r+" != 0 )"}return r}getTypeByFormat(r){return TO[r]||r}getFormatByType(r){return OO[r]||r}getUUID(r,e){return(e=void 0===e||e)&&this.cache&&(r=this.cache+"-"+r),r}getElementByIndex(r){return ig[r]}getIndexByElement(r){return ig.indexOf(r)}isShader(r){return this.shader===r}setShader(r){return this.shader=r,this}mergeDefines(r){for(let e in r)this.defines[e]=r[e];return this.defines}mergeUniform(r){for(let e in r)this.uniforms[e]=r[e];return this.uniforms}getTextureEncodingFromMap(r){let e;return r?r.isTexture&&(e=r.encoding):e=three__WEBPACK_IMPORTED_MODULE_0__.rnI,e===three__WEBPACK_IMPORTED_MODULE_0__.rnI&&this.context.gamma&&(e=three__WEBPACK_IMPORTED_MODULE_0__.knz),e}},Ae=class extends Ne{constructor(e=0,t,o,i){super("c"),this.nodeType="Color",this.value=e instanceof Je?e:new Je(e||0,t,o,i)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,o,i,s,a){o=e.getUUID(o??this.getUUID()),i=i??this.getType(e);let c=e.getNodeData(o),u=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return u?this.generateReadonly(e,t,o,i,s,a):e.isShader("vertex")?(c.vertex||(c.vertex=e.createVertexUniform(i,this,s,a,this.getLabel())),e.format(c.vertex.name,i,t)):(c.fragment||(c.fragment=e.createFragmentUniform(i,this,s,a,this.getLabel())),e.format(c.fragment.name,i,t))}generateReadonly(e,t,o,i,s,a){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",i,t)}},ve=class extends Ne{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,o,i,s,a){return e.format(this.value.toString(),i,t)}},ke=class extends Ne{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,o,i){return e.format(this.value?"true":"false",i,t)}},cr=class extends Ne{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?Array(e).fill(t):Array(e).fill(0)}},Co=class extends Ne{},Hl=class extends Co{constructor(e){super("v3"),this.image=e,this._value=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},Ko=class extends Co{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},wi=class extends Ne{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new three__WEBPACK_IMPORTED_MODULE_0__.Vkp}generateReadonly(e,t,o,i,s,a){return e.format("mat3("+this.value.elements.join(", ")+")",i,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},mt=class extends Ne{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new three__WEBPACK_IMPORTED_MODULE_0__.yGw}generateReadonly(e,t,o,i,s,a){return e.format("mat4("+this.value.elements.join(", ")+")",i,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function sg(n,r,e){n.setUvTransform(e[0],e[1],r[0],r[1],0,0,0)}var Wl=class extends wi{constructor(e,t){super(new three__WEBPACK_IMPORTED_MODULE_0__.Vkp),this.repeat=e,this.offset=t,sg(this.value,e,t)}updateMatrix(){sg(this.value,this.repeat,this.offset)}},dr=class extends Ne{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof three__WEBPACK_IMPORTED_MODULE_0__.Ltg?Array(e).fill(t):Array(e).fill(new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(0))}},_i=class extends ae{constructor(e,t,o,i){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=o,this.mode=i}generate(e,t){if(!e.isShader("fragment"))return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{let o=[];return o.push(this.a.build(e,"c")),o.push(this.b.build(e,"c")),o.push(this.alpha.build(e,"f")),o.push(this.mode.build(e,"i")),e.format("spe_blend("+o.join(",")+")",this.getType(e),t)}}},iu=class extends ae{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(!e.isShader("fragment"))return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{let o=e.include(iu.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.color.build(e,"v3")),i.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Zo=iu;Zo.Nodes={customColor:new k(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)};var su=class extends ae{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(!e.isShader("fragment"))return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{let o=e.include(su.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.cnormal.build(e,"v3")),i.push("normal"),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Pi=su;Pi.Nodes={customNormal:new k(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)};var Ti=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d,p,f){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=o,this.projection=i,this.axis=s,this.side=a,this.size=c,this.blending=u,this.mat=l,this.isMask=f,this.alpha=d,this.mode=p,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let o=`g${this.uuid.toString().replace(/-/g,"")}`,i;switch(this.projection.value){case 3:i=e.include(Ti.Nodes.cylindrical);break;case 2:i=e.include(Ti.Nodes.spherical);break;case 1:let a=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],c=["zy","xz","xy"][this.axis.value],u=new k(`
		vec3 ${o}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${c})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, mat * ${a}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);i=e.include(u);break;case 4:i=e.include(Ti.Nodes.triplanar);break;default:i=e.include(Ti.Nodes.uv)}e.addFragmentVariable(this.calpha,"float");let s=[];if(s.push("normal"),s.push(this.texture.generate(e,"t")),s.push(this.textureSize.build(e,"v2")),s.push(this.crop.build(e,"f")),s.push(this.mat.build(e,"mat3")),s.push(this.size.build(e,"v2")),s.push(this.blending.build(e,"f")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),4===this.projection.value){let a1=`${o}_writeUvs`,c1=a1+"0",u1=a1+"1",l=a1+"2",d=`${o}_triplanarWeights`;e.addFragmentVariable(c1,"vec2"),e.addFragmentVariable(u1,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(d,"vec3"),s.push(c1),s.push(u1),s.push(l),s.push(d)}else{let a2=`${o}_writeUvs`;e.addFragmentVariable(a2,"vec2"),s.push(a2)}return e.format(i+"("+s.join(",")+")",this.getType(e),t)}},No=Ti;No.Nodes={cylindrical:new k(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),spherical:new k(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),uv:new k(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),triplanar:new k(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`)};var Oi=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d,p,f){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=o,this.far=i,this.isVector=s,this.isWorldSpace=a,this.origin=c,this.direction=u,this.colors=l,this.steps=d,this.isMask=f,this.alpha=p,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let o=`g${this.uuid.toString().replace(/-/g,"")}`,i=new k(`vec3 ${o}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${o}_MAX_COLORS], float steps[${o}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${o}_IS_VECTOR
                   #ifdef ${o}_LINEAR
                       #ifdef ${o}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${o}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${o}_SMOOTH
				for ( int i = 1; i < ${o}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${o}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[Oi.Nodes.vectorLinearWorldSpaceDepth,Oi.Nodes.vectorLinearObjectSpaceDepth,Oi.Nodes.vectorSphericalObjectSpaceDepth,Oi.Nodes.vectorSphericalWorldSpaceDepth]);if(!e.isShader("fragment"))return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.define(`${o}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${o}_SMOOTH`),this.isVector.value>.5&&e.define(`${o}_IS_VECTOR`),0===this.gradientType.value&&e.define(`${o}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${o}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let s=e.include(i),a=[];return a.push(this.near.build(e,"f")),a.push(this.far.build(e,"f")),a.push(this.origin.build(e,"v3")),a.push(this.direction.build(e,"v3")),a.push(this.colors.build(e,"v4[]")),a.push(this.steps.build(e,"f[]")),a.push(this.isMask.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.calpha),e.format(s+"("+a.join(",")+")",this.getType(e),t)}}},Ai=Oi;Ai.Nodes={vectorLinearWorldSpaceDepth:new k(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),vectorLinearObjectSpaceDepth:new k(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),vectorSphericalWorldSpaceDepth:new k(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),vectorSphericalObjectSpaceDepth:new k(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`)};var Bs=class extends ae{constructor(e,t,o,i,s,a,c,u){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=o,this.intensity=i,this.factor=s,this.isMask=u,this.alpha=a,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),!e.isShader("fragment"))return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.addFragmentVariable(this.calpha,"float");let o=new k(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),i=e.include(o),s=[];return s.push(this.color.build(e,"c")),s.push(this.bias.build(e,"f")),s.push(this.scale.build(e,"f")),s.push(this.intensity.build(e,"f")),s.push(this.factor.build(e,"f")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),e.format(i+"("+s.join(",")+")",this.getType(e),t)}}},au=class extends ae{constructor(e,t,o,i,s,a,c,u,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=o,this.steps=i,this.offset=s,this.morph=a,this.angle=c,this.isMask=l,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(!e.isShader("fragment"))return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let o=e.include(au.Nodes.gradient),i=[];return i.push(this.gradientType.build(e,"i")),i.push(this.smooth.build(e,"b")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.offset.build(e,"v2")),i.push(this.morph.build(e,"v2")),i.push(this.angle.build(e,"f")),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Ci=au;Ci.Nodes={gradient:new k(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)};var lu=class extends ae{constructor(e,t,o,i){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=i,this.alpha=t,this.mode=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(!e.isShader("fragment"))return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.addFragmentVariable(this.calpha,"float");let o=e.include(lu.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let i=[];return i.push(this.texture.generate(e,"t")),i.push("normal"),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Ni=lu;Ni.Nodes={matcap:new k(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)};var Rs=((s5=Rs||{}).SIMPLEX="simplex3d",s5.SIMPLEX_FRACTAL="simplex3dFractal",s5.ASHIMA="simplexAshima",s5.FBM="fbm",s5.PERLIN="perlin",s5.VORONOI="voronoi",s5),lt=(r1=new k(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),(e1=new k(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[r1])).keywords.F3=new we("float F3 0.3333333"),e1.keywords.G3=new we("float G3 0.1666667"),t1=new k(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[e1]),o1=new k("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),i1=new k("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s1=new k(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[o1,i1]),a1=new k("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),c1=new k("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[a1]),u1=new k(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[c1]),(l1=new k(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[u1])).keywords.NUM_OCTAVES=new we("int NUM_OCTAVES 5"),d1=new k("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),p1=new k(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[o1,i1,d1]),f1=new k(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),m1=new k(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),h1=new k(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),y1=new k(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g1=new k(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),x1=new k(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),{simplex:e1,simplexFractal:t1,simplexAshima:s1,fbm:l1,perlin:p1,voronoi:new k(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[f1,m1,h1,y1,g1,x1])}),Ii=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d,p,f,m,h,y,g,x,b,w){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=o,this.fA=i,this.fB=s,this.distortion=a,this.colorA=c,this.colorB=u,this.colorC=l,this.colorD=d,this.noiseType=f,this.voronoiStyle=h,this.highCut=y,this.lowCut=g,this.smoothness=x,this.seed=b,this.quality=w,this.isMask=m,this.alpha=p,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,o,i,s){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let a=Object.values(Rs)[this.noiseType.value],c="voronoi"==a?`
		float v = ${a}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${a}(st),
					   ${a}(st + vec3(1.0)),
					   ${a}(st + vec3(1.0)));
		vec3 r = vec3(${a}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${a}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${a}(st * q));
		float f = ${a}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,u=new k(`vec3 ${a}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${c}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[lt.simplex,lt.simplexFractal,lt.simplexAshima,lt.fbm,lt.perlin,lt.voronoi]),l=e.include(u),d=[];return d.push(this.scale.build(e,"f")),d.push(this.size.build(e,"v3")),d.push(this.move.build(e,"f")),d.push(this.fA.build(e,"v2")),d.push(this.fB.build(e,"v2")),d.push(this.distortion.build(e,"v2")),d.push(this.colorA.build(e,"v4")),d.push(this.colorB.build(e,"v4")),d.push(this.colorC.build(e,"v4")),d.push(this.colorD.build(e,"v4")),d.push(this.voronoiStyle.build(e,"i")),d.push(this.highCut.build(e,"f")),d.push(this.lowCut.build(e,"f")),d.push(this.smoothness.build(e,"f")),d.push(this.seed.build(e,"f")),d.push(this.quality.build(e,"i")),d.push(this.isMask.build(e,"b")),d.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),d.push(this.alpha.build(e,"f")),d.push(this.calpha),e.format(l+"("+d.join(",")+")",this.getType(e),t)}};Ii.numOctaves=5;var cu=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d,p,f,m,h,y,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=o,this.contourWidth=i,this.contourThreshold=s,this.outlineThreshold=a,this.contourFrequency=c,this.outlineSmoothing=u,this.contourDirection=l,this.positionalLines=d,this.compensation=p,this.resolution=f,this.normalMap=m,this.depthMap=h,this.pixelRatio=y,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let o=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${o}_offset`),this.firstTime){let i=this.outlineWidth.build(e,"f"),s=this.resolution.build(e,"v2"),a=this.compensation.build(e,"b"),c=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(i,"uniform float"),e.addVertexParsVariable(s,"uniform vec2"),e.addVertexParsVariable(a,"uniform bool"),e.addVertexParsVariable(c,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${o}_offset = vec2(0.0);
                if (${a}) {
                    vec4 ${o}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${o}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${o}_offset = normalize(${o}_clipNormal.xy) / ${s} * (${i} / 2.0) * ${o}_clipPosition.w * 2.0 * ${c};
                    ${o}_clipPosition.xy += ${o}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${o}_clipPosition;
                }
            `)}if(!e.isShader("fragment"))return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),"";{e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i1=e.include(cu.Nodes.outline),s1=[];return s1.push(this.outlineColor.build(e,"c")),s1.push(this.contourColor.build(e,"c")),s1.push(this.outlineWidth.build(e,"f")),s1.push(this.contourWidth.build(e,"f")),s1.push(this.contourThreshold.build(e,"f")),s1.push(this.outlineThreshold.build(e,"f")),s1.push(this.contourFrequency.build(e,"f")),s1.push(this.outlineSmoothing.build(e,"f")),s1.push(this.contourDirection.build(e,"v3")),s1.push(this.positionalLines.build(e,"b")),s1.push(this.resolution.build(e,"v2")),s1.push(this.normalMap.getTexture(e,"t")),s1.push(this.depthMap.getTexture(e,"t")),s1.push(this.pixelRatio.build(e,"f")),s1.push(this.compensation.build(e,"b")),s1.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s1.push(this.alpha.build(e,"f")),s1.push(this.calpha),this.firstTime=!this.firstTime,e.format(i1+"("+s1.join(",")+")",this.getType(e),t)}}},Mi=cu;Mi.Nodes=(e2=new k(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`),{outline:new k(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e2])});var Mr=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d,p,f,m,h,y,g,x,b){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=o,this.blending=i,this.offset=s,this.colorA=a,this.colorB=c,this.frequency=u,this.size=l,this.variation=d,this.smoothness=p,this.zigzag=f,this.rotation=m,this.vertical=h,this.horizontal=y,this.sides=g,this.isMask=b,this.alpha=x,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(!e.isShader("fragment"))return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t);{let o;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:o="circle";break;case 1:o="ring";break;case 2:o="polygon";break;case 3:o="xcross";break;case 4:o="diamond";break;case 5:o="checkerboard";break;case 6:o="line";break;case 7:o="wave"}let i=`g${this.uuid.toString().replace(/-/g,"")}`,s=new k(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),a=new k(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),c="";if(4===this.projection.value)c=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${2===this.style.value?`${o}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${o}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};
				float d1 = ${2===this.style.value?`${o}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${o}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};
				float d2 = ${2===this.style.value?`${o}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${o}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`;else{let p=2===this.style.value?`${o}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${o}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,f="";0===this.axis.value?f=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:1===this.axis.value?f=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,f=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let m="";switch(this.projection.value){case 0:m="custom_uv = vUv.st;";break;case 1:case 3:break;case 2:m=`
							vec3 p = position;
							${f}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`}c=`
				vec2 custom_uv;
				${m}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${p};
				`}let u=new k(`vec3 ${i}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${c}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[a,s,Mr.DrawFunctions.circle,Mr.DrawFunctions.ring,Mr.DrawFunctions.polygon,Mr.DrawFunctions.cross,Mr.DrawFunctions.diamond,Mr.DrawFunctions.checkerboard,Mr.DrawFunctions.line,Mr.DrawFunctions.wave]),l=e.include(u),d=[];return d.push("normal"),d.push(this.blending.build(e,"f")),d.push(this.style.build(e,"i")),d.push(this.offset.build(e,"v2")),d.push(this.colorA.build(e,"v4")),d.push(this.colorB.build(e,"v4")),d.push(this.frequency.build(e,"v2")),d.push(this.size.build(e,"f")),d.push(this.variation.build(e,"f")),d.push(this.smoothness.build(e,"f")),d.push(this.zigzag.build(e,"f")),d.push(this.rotation.build(e,"f")),d.push(this.vertical.build(e,"v2")),d.push(this.horizontal.build(e,"v2")),d.push(this.sides.build(e,"i")),d.push(this.isMask.build(e,"b")),d.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),d.push(this.alpha.build(e,"f")),d.push(this.calpha),e.format(l+"("+d.join(",")+")",this.getType(e),t)}}},Ei=Mr;Ei.DrawFunctions=(e3=new k(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t2=new k(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e3]),o2=new k(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t2]),i2=new k(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t2]),s2=new k(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t2]),a2=new k(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t2]),c2=new k(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t2]),u2=new k(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l2=new k(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t2]),{tileAndCenter:t2,circle:o2,ring:i2,polygon:s2,cross:a2,diamond:c2,checkerboard:u2,line:l2,wave:new k(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`)});var du=class extends ae{constructor(e,t,o,i,s,a,c,u){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=o,this.noiseStrength=i,this.noiseScale=s,this.offset=a,this.isMask=u,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),!e.isShader("fragment"))return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let o=e.include(du.Nodes.rainbow),i=[];return i.push(this.filmThickness.build(e,"f")),i.push(this.movement.build(e,"f")),i.push(this.wavelengths.build(e,"v3")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.offset.build(e,"v3")),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Li=du;Li.Nodes=(e4=new k(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[lt.simplex]),{rainbow:new k(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[e4])});var uu=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=o,this.source=i,this.isWorldSpace=s,this.noiseStrength=a,this.noiseScale=c,this.shadowColor=u,this.offset=l,this.alpha=d,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),!e.isShader("fragment"))return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let o=e.include(uu.Nodes.toon),i=[];return i.push(this.positioning.build(e,"i")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.source.build(e,"v3")),i.push(this.isWorldSpace.build(e,"b")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.shadowColor.build(e,"v4")),i.push(this.offset.build(e,"v3")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Di=uu;Di.Nodes=(e5=new k(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t3=new k(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),o3=new k(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t3]),i3=new k(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),s3=new k(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[i3]),{toon:new k(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[lt.simplex,e5,o3,s3])});var lg={textureBicubic:new k(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)},pu=class extends ae{constructor(e,t,o,i,s,a,c,u){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=o,this.transmissionSamplerSize=i,this.transmissionSamplerMap=s,this.transmissionDepthMap=a,this.aspectRatio=c,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,!e.isShader("fragment"))return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,ye.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let o=e.include(pu.Nodes.transmission),i=[];return i.push(this.thickness.build(e,"f")),i.push(this.ior.build(e,"f")),i.push(this.roughness.build(e,"f")),i.push(this.transmissionSamplerSize.build(e,"v2")),i.push(this.transmissionSamplerMap.getTexture(e,"t")),i.push(this.transmissionDepthMap.getTexture(e,"t")),i.push(this.aspectRatio.build(e,"v2")),i.push("normal"),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Bi=pu;Bi.Nodes=(e6=new k(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t4=new k(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),o4=new k(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),i4=new k(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[lg.textureBicubic,o4,e6]),s4=new k(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[i4,t4]),{transmission:new k(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[s4])});var fu=((e24=fu||{}).NOISE="noise",e24.MAP="map",e24),mu=class extends ae{constructor(e,t,o,i,s,a,c,u,l,d,p){super("v3"),this.displacementTypeIndex=new ve(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(fu)[this.displacementTypeIndex.value]&&(this.mat=new wi(this.movementOrTexture.value.matrix)),this.cropOrOffset=o,this.scale=d,this.noiseFunctionIndex=p,this.voronoiStyle=i,this.smoothness=s,this.seed=a,this.highCut=c,this.lowCut=u,this.quality=l}generate(e,t){if(!e.isShader("vertex"))return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t);{e.define("USE_LAYER_DISPLACE");let o,i=[];switch(i.push("displaced_position"),i.push("displaced_normal"),Object.values(fu)[this.displacementTypeIndex.value]){case"map":o=e.include(mu.Nodes.map),i.push(this.movementOrTexture.getTexture(e,"t")),i.push("uv"),i.push(this.cropOrOffset.build(e,"f")),this.mat&&i.push(this.mat.build(e,"mat3"));break;case"noise":{let a=Object.values(Rs)[this.noiseFunctionIndex.value],c=new k(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),u="voronoi"==a?`
					float v = ${a}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${a}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,l=new k(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${u}
						}`,[lt.simplex,lt.simplexFractal,lt.simplexAshima,lt.fbm,lt.perlin,lt.voronoi]),d=new k(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[l,c]);o=e.include(d),i.push(this.scale.build(e,"f")),i.push(this.cropOrOffset.build(e,"v3")),i.push(this.movementOrTexture.build(e,"f")),i.push(this.voronoiStyle.build(e,"i")),i.push(this.smoothness.build(e,"f")),i.push(this.seed.build(e,"f")),i.push(this.highCut.build(e,"f")),i.push(this.lowCut.build(e,"f")),i.push(this.quality.build(e,"i"))}}return i.push(this.intensity.build(e,"f")),i.push("displaced_normal"),e.format(o+"("+i.join(",")+")",this.getType(e),t)}}},Ri=mu;Ri.Nodes=(e7=new k(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t5=new k(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`),{map:new k(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e7,t5])});var ye={normalRenderTarget:new Pt,normalRenderTargetDepth:new Pt,transmissionRenderTarget:new Pt,aspectRatio:new Ve,transmissionSize:new Ve(2048,2048),transmissionRenderTargetDepth:new Pt,aoRenderTarget:new Pt,aoEnabled:new ke,pixelRatioNode:new Y(1),resolution:new Ve,penumbraSize:new cr(5,.5),frameIndex:new ve(0),transmissionLod:new ve(2)};for(let n6 of Object.values(ye))n6.isRenderGlobal=!0;var s5,e24,xe,yi,yu,Jo=class extends it{constructor(){super("basic"),this.nodeType="Basic",this.color=new Ae(5526619),this.shadingAlpha=new Y(1),this.shadingBlend=new ve(0),this.previousModelViewMatrix=new mt,this.previouseProjectionMatrix=new mt}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let o=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({resolution:ye.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(three__WEBPACK_IMPORTED_MODULE_0__.rDY.merge([three__WEBPACK_IMPORTED_MODULE_0__.rBU.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];o&&i.push(o.code,o.result?"displaced_position = "+o.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{void 0===this.color&&(this.color=new Ae(5526619)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let o1=this.color.flow(e,"c",{slot:"color"}),i1=this.alpha?this.alpha.flow(e,"f"):void 0,s=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==i1,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",o1.code];i1&&c.push(i1.code,"#ifdef ALPHATEST"," if ( "+i1.result+" <= ALPHATEST ) discard;","#endif"),a?c.push(a.code,`vec3 outgoingLight = ${o1.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`):c.push(`vec3 finalColor = ${o1.result};`);let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),i1?c.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${i1.result} * ${u} );`):c.push("gl_FragColor = vec4("+o1.result+", 1.0 );"),s&&c.push(`gl_FragColor.a *= ${s.result};`),c.push("#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},Gs=class extends it{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Ae(5526619),this.emissive=new Ae(0),this.emissiveIntensity=new Y(1),this.previousModelViewMatrix=new mt,this.previouseProjectionMatrix=new mt,this.shadingAlpha=new Y(1),this.shadingBlend=new ve(0),this.occlusion=new ke(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let o=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({resolution:ye.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(three__WEBPACK_IMPORTED_MODULE_0__.rDY.merge([three__WEBPACK_IMPORTED_MODULE_0__.rBU.fog,three__WEBPACK_IMPORTED_MODULE_0__.rBU.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];o&&i.push(o.code,o.result?"displaced_position = "+o.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),i.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:ye.penumbraSize}),e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({aoMap:ye.aoRenderTarget}),e.mergeUniform({aoEnabled:ye.aoEnabled}),void 0===this.color&&(this.color=new Ae(5526619)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let o1=this.color.flow(e,"c",{slot:"color"}),i1=this.emissive.flow(e,"c",{slot:"emissive"}),s=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),a=this.occlusion.flow(e,"b",{slot:"occlusion"}),c=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,d=this.alpha?this.alpha.flow(e,"f"):void 0,p=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==d,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let f=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];f.push(o1.code,"vec3 diffuseColor = "+o1.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),d&&f.push(d.code,"#ifdef ALPHATEST","if ( "+d.result+" <= ALPHATEST ) discard;","#endif"),f.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),i1&&f.push(i1.code,"reflectedLight.directDiffuse += "+i1.result+" * "+s.result+";"),f.push("vec3 ao = aoEnabled && "+a.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let m="1.0";this.mask&&(this.mask.analyze(e),m=`luminance(${this.mask.flow(e,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${c.result} * ${m} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${c.result} * ${m}, ${u.result} );

					outgoingLight *= ao;
				}
				`),l&&f.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),d?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${d.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),p&&f.push(`gl_FragColor.a *= ${p.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join(`
`)}return t}},ro={dHdxy:new k(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),perturbNormalArb:new k(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`)},Vs=class extends it{constructor(){super("phong"),this.nodeType="Phong",this.color=new Ae(5526619),this.specular=new Ae(1118481),this.shininess=new Y(30),this.previousModelViewMatrix=new mt,this.previouseProjectionMatrix=new mt,this.shadingAlpha=new Y(1),this.shadingBlend=new ve(0),this.occlusion=new ke(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let o=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({resolution:ye.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(three__WEBPACK_IMPORTED_MODULE_0__.rDY.merge([three__WEBPACK_IMPORTED_MODULE_0__.rBU.fog,three__WEBPACK_IMPORTED_MODULE_0__.rBU.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];o&&i.push(o.code,o.result?"displaced_position = "+o.result+";":""),i.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:ye.penumbraSize}),e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({aoMap:ye.aoRenderTarget}),e.mergeUniform({aoEnabled:ye.aoEnabled}),void 0===this.color&&(this.color=new Ae(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let o1=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i1=this.color.flow(e,"c",{slot:"color"}),s=this.specular.flow(e,"c"),a=this.shininess.flow(e,"f"),c=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,d=this.alpha?this.alpha.flow(e,"f"):void 0,p=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==d,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let f=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(ro.dHdxy),e.include(ro.perturbNormalArb);let h=this.bumpMap.texture.flow(e,"t"),y=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",x="";x=4===this.bumpMap.projection.value?`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${h.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${h.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${h.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${h.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${y.result};
					${x}
					`)}f.push(i1.code,"	vec3 diffuseColor = "+i1.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",s.code,"	vec3 specular = "+s.result+";",a.code,"	float shininess = max( 0.0001, "+a.result+" );","	float specularStrength = 1.0;"),d&&f.push(d.code,"#ifdef ALPHATEST","if ( "+d.result+" <= ALPHATEST ) discard;","#endif"),f.push("material.diffuseColor = diffuseColor;"),f.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+o1.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let m="1.0";this.mask&&(this.mask.analyze(e),m=`luminance(${this.mask.flow(e,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${c.result} * ${m} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${c.result} * ${m}, ${u.result} );
					
					outgoingLight *= ao;
				}
				`),l&&f.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),d?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${d.result});`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),p&&f.push(`gl_FragColor.a *= ${p.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join(`
`)}return t}},zs=class extends it{constructor(){super("standard"),this.nodeType="Standard",this.color=new Ae(5526619),this.roughness=new Y(.3),this.metalness=new Y(0),this.reflectivity=new Y(.5),this.previousModelViewMatrix=new mt,this.previouseProjectionMatrix=new mt,this.shadingAlpha=new Y(1),this.shadingBlend=new ve(0),this.occlusion=new ke(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let o=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({resolution:ye.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(three__WEBPACK_IMPORTED_MODULE_0__.rDY.merge([three__WEBPACK_IMPORTED_MODULE_0__.rBU.fog,three__WEBPACK_IMPORTED_MODULE_0__.rBU.lights])),three__WEBPACK_IMPORTED_MODULE_0__.rBU.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];o&&i.push(o.code,o.result?"displaced_position = "+o.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:ye.penumbraSize}),e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({aoMap:ye.aoRenderTarget}),e.mergeUniform({aoEnabled:ye.aoEnabled});let o1={gamma:!0};void 0===this.color&&(this.color=new Ae(5526619)),this.color.analyze(e,{slot:"color",context:o1}),this.roughness.analyze(e),this.metalness.analyze(e);let i1=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let s=this.color.flow(e,"c",{slot:"color",context:o1}),a=this.roughness.flow(e,"f"),c=this.metalness.flow(e,"f"),u=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),d=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,p=this.alpha?this.alpha.flow(e,"f"):void 0,f=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,m=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==p,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let h=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(ro.dHdxy),e.include(ro.perturbNormalArb);let g=this.bumpMap.texture.flow(e,"t"),x=this.bumpMap.flow(e,"v3"),b=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",w="";w=4===this.bumpMap.projection.value?`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${g.result}, uv0, ${b});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${g.result}, uv1, ${b});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${g.result}, uv2, ${b});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${g.result}, bumpMapCachedUv, ${b});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${x.result};
					${w}
					`)}if(h.push(s.code,"	vec3 diffuseColor = "+s.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",c.code,"	float metalnessFactor = "+c.result+";"),this.roughnessMap){let g1=this.roughnessMap.texture.flow(e,"t"),x1=this.roughnessMap.flow(e,"v3"),b1="";b1=4===this.roughnessMap.projection.value?`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${g1.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${g1.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${g1.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${a.result};
					`:`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${g1.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${a.result};
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${x1.result};

					const float roughnessScale = 1.0;

					${b1}
				`)}else h.push(a.code,"	float roughnessFactor = "+a.result+";");p&&h.push(p.code,"#ifdef ALPHATEST","	if ( "+p.result+" <= ALPHATEST ) discard;","#endif"),h.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),h.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),m?h.push(m.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+m.result+" ) ), diffuseColor, metalnessFactor );"):h.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),h.push("#include <lights_fragment_begin>"),h.push("#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i1.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let y="1.0";this.mask&&(this.mask.analyze(e),y=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${u.result} * ${y} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${u.result} * ${y}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),d&&h.push(d.code,`outgoingLight = spe_blend(outgoingLight, ${d.result}, 1.0, SPE_BLENDING_NORMAL);`),p?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${p.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),f&&h.push(`gl_FragColor.a *= ${f.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},js=class extends it{constructor(){super("toon"),this.nodeType="Toon",this.color=new Ae(5526619),this.specular=new Ae(1118481),this.shininess=new Y(30),this.previousModelViewMatrix=new mt,this.previouseProjectionMatrix=new mt,this.shadingAlpha=new Y(1),this.shadingBlend=new ve(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let o=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({resolution:ye.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(three__WEBPACK_IMPORTED_MODULE_0__.rDY.merge([three__WEBPACK_IMPORTED_MODULE_0__.rBU.fog,three__WEBPACK_IMPORTED_MODULE_0__.rBU.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];o&&i.push(o.code,o.result?"displaced_position = "+o.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:ye.penumbraSize}),e.mergeUniform({frameIndex:ye.frameIndex}),e.mergeUniform({aoMap:ye.aoRenderTarget}),e.mergeUniform({aoEnabled:ye.aoEnabled}),void 0===this.color&&(this.color=new Ae(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let o1=this.color.flow(e,"c",{slot:"color"}),i1=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),c=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let p=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(ro.dHdxy),e.include(ro.perturbNormalArb);let m=this.bumpMap.texture.flow(e,"t"),h=this.bumpMap.flow(e,"v3"),y=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";g=4===this.bumpMap.projection.value?`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${m.result}, uv0, ${y});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${m.result}, uv1, ${y});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${m.result}, uv2, ${y});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${y});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${h.result};
					${g}
					`)}p.push(o1.code,"	vec3 diffuseColor = "+o1.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",i1.code,"	vec3 specular = "+i1.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),l&&p.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),p.push("material.diffuseColor = diffuseColor;"),p.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${f}, ${c.result} );
				}
				`),u&&p.push(u.code,`outgoingLight = spe_blend(outgoingLight, ${u.result}, 1.0, SPE_BLENDING_NORMAL);`),l?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d&&p.push(`gl_FragColor.a *= ${d.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},ql=class{constructor(r=1e4){this.timeout=r,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...r){}remove(r){let e=this.cache.get(r);e&&(this.dispose(r,e.data),this.cache.delete(r),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let r=Date.now(),e=this.head.next;for(;e.time<r-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),(e=e.next).prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(r){return this.cache.get(r)?.data}load(r){let e=Date.now(),t=this.cache.get(r);return void 0===t?(t={data:this.create(r),src:r,time:e,next:null,prev:null},this.cache.set(r,t)):(t.time=e,t.prev.next=t.next,t.next.prev=t.prev),t.prev=this.tail.prev,t.next=this.tail,this.tail.prev.next=t,this.tail.prev=t,this.scheduleCleanup(),t.data}},gu=class extends ql{create(r){return URL.createObjectURL(new Blob([r]))}dispose(r,e){URL.revokeObjectURL(e)}},$l=class{constructor(r,e){this.data=r,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},Yl=class{constructor(){this.cache=new Map}remove(r){this.cache.delete(r.data)}load(r){let e=this.cache.get(r);return void 0===e&&(e=this.create(r),this.cache.set(r,e)),e.refCount+=1,e}},Gi=class extends $l{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo="video"===e.type,this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{for(let s of(this.loaded=!0,[1e3,1001,1002])){let a=this[s];a&&(a.image=this.img,a.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof e){let i;var o=new FileReader;o.readAsDataURL(new Blob([e],{type:"video/mp4"})),await new Promise(s=>{o.onloadend=a=>{i=a.target?.result,s(null)}}),this.img.src=i}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src="string"==typeof e?e:(yu||(yu=new gu),yu.load(e)),this.img.onload=t}getTexture(e){let t=this[e];if(t)return t;{let o;return o=this.isVideo?new three__WEBPACK_IMPORTED_MODULE_0__.fO1(this.img,void 0,e,e):new three__WEBPACK_IMPORTED_MODULE_0__.xEZ(this.img,void 0,e,e),this.loaded&&(o.needsUpdate=!0),this[e]=o,o}}disposeTextures(){this[1e3]?.dispose(),this[1e3]=void 0,this[1001]?.dispose(),this[1001]=void 0,this[1002]?.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Xt=class extends Gi{};function ht(n,r){return r.color(n)}function ur(n){let{alpha:r,mode:e,isMask:t}=n;return{type:n.type,alpha:r,mode:e,isMask:t}}var Io=class extends Je{},xu={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},vu={depth:["colors"]};function bu(n,r,e){let t=e.uniforms[`f${e.id}_texture`];if(!t)return!1;if("image"in n){let s=n.image,a=r.image(s),c=t;c.image instanceof Xt||c.image.deref(),c.image=a}if("video"in n){let s1=n.video,a1=r.video(s1),c1=t;c1.image instanceof Xt||c1.image.deref(),c1.image=a1}if("wrapping"in n&&(t.wrap=n.wrapping),"repeat"in n||"offset"in n){let a2=e.uniforms[`f${e.id}_mat`];"repeat"in n&&(a2.repeat=n.repeat),"offset"in n&&(a2.offset=n.offset),a2.updateMatrix()}return!1}var Dr=class{constructor(r,e,t,o){for(let i in this.id=r,this.uuid=e,this.data=t,this.uniforms={},o)this.uniforms[`f${this.id}_${i}`]=o[i];for(let i1 in t)Su(i1,this,t)}get type(){return this.data.type}static create(r,e,t,o){if("light"===t.type)return Ut.createLigherLayer(r,e,t,o);if("texture"===t.type||"video"===t.type){let i="texture"===t.type?o.image(t.texture.image):o.video(t.texture.video),s=new Ko(i,t.texture.wrapping),a=new Hl(i),c=new Wl(t.texture.repeat,t.texture.offset),u=new Y(t.crop?1:0),l=new ve(t.projection??0),d=new ve(["x","y","z"].indexOf(t.axis)??0),p=new ve(t.side??0),f=new Ve(t.size?new three__WEBPACK_IMPORTED_MODULE_0__.FM8(t.size[0],t.size[1]):new three__WEBPACK_IMPORTED_MODULE_0__.FM8(100,100)),m=new Y(t.blending??0),h=new Y(t.alpha??1),y=new ve(t.mode??0),g=new ke(t.isMask??!1),x=new No(s,a,u,l,d,p,f,m,c,h,y,g),b=new Pe(x.calpha,"f");return new De(r,e,t,{texture:s,textureSize:a,crop:u,projection:l,axis:d,side:p,size:f,blending:m,mat:c,alpha:h,mode:y,isMask:g},x,y,b,g)}if("matcap"===t.type){let i1=o.image(t.texture.image),s1=new Ko(i1,t.texture.wrapping),a1=new Y(t.alpha??1),c1=new ve(t.mode??0),u1=new ke(t.isMask??!1),l1=new Ni(s1,a1,c1,u1),d1=new Pe(l1.calpha,"f");return new De(r,e,t,{texture:s1,alpha:a1,mode:c1,isMask:u1},l1,c1,d1,u1)}if("displace"!==t.type){let o1;return o1=function(n,r){switch(n.type){case"fresnel":return function(n,r){let{bias:e,scale:t,intensity:o,factor:i,color:s,isMask:a}=n;return{...ur(n),color:ht(s,r),bias:e,scale:t,intensity:o,factor:i}}(n,r);case"gradient":return function(n){let{gradientType:r,smooth:e,colors:t,steps:o,angle:i,offset:s,morph:a}=n;return{...ur(n),gradientType:r,smooth:e,colors:t.map(c=>new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(c[0],c[1],c[2],c[3])),num:t.length,steps:o,offset:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...s),morph:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...a),angle:i}}(n);case"depth":return function(n){let{gradientType:r,near:e,far:t,isVector:o,isWorldSpace:i,origin:s,direction:a,colors:c,steps:u,smooth:l}=n;return{...ur(n),gradientType:r,near:e,far:t,isVector:o,isWorldSpace:i,origin:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...s),direction:a?new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...a):new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,0,0),colors:c.map(d=>void 0!==d?new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(d[0],d[1],d[2],d[3]):new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(0,0,0,0)),steps:u.slice(0,c.length),smooth:l}}(n);case"normal":return function(n){let{cnormal:r}=n;return{...ur(n),cnormal:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(r[0],r[1],r[2])}}(n);case"noise":return{...ur(n),scale:n.scale,move:n.move,fA:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.fA),fB:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.fB),size:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.size),distortion:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.distortion),colorA:ht(n.colorA,r),colorB:ht(n.colorB,r),colorC:ht(n.colorC,r),colorD:ht(n.colorD,r),noiseType:n.noiseType,voronoiStyle:n.voronoiStyle,highCut:n.highCut,lowCut:n.lowCut,smoothness:n.smoothness,seed:n.seed,quality:n.quality};case"rainbow":return{...ur(n),filmThickness:n.filmThickness,movement:n.movement,wavelengths:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.wavelengths),noiseStrength:n.noiseStrength,noiseScale:n.noiseScale,offset:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.offset)};case"toon":return{...ur(n),positioning:n.positioning,colors:n.colors.map(e=>new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(e[0],e[1],e[2],e[3])),num:n.colors.length,steps:n.steps,source:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.source),isWorldSpace:n.isWorldSpace,noiseStrength:n.noiseStrength,noiseScale:n.noiseScale,shadowColor:ht(n.shadowColor,r),offset:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.offset)};case"outline":return{...ur(n),outlineColor:ht(n.outlineColor,r),contourColor:ht(n.contourColor,r),outlineWidth:n.outlineWidth,contourWidth:n.contourWidth,outlineThreshold:n.outlineThreshold,contourThreshold:n.contourThreshold,outlineSmoothing:n.outlineSmoothing,contourFrequency:n.contourFrequency,contourDirection:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.contourDirection),positionalLines:n.positionalLines,compensation:n.compensation};case"transmission":return{...ur(n),thickness:n.thickness,ior:n.ior,roughness:n.roughness};case"color":return{...ur(n),color:ht(n.color,r)};case"pattern":return{...ur(n),style:n.style,projection:n.projection,axis:n.axis,blending:n.blending,offset:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.offset),colorA:ht(n.colorA,r),colorB:ht(n.colorB,r),frequency:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.frequency),size:n.size,variation:n.variation,smoothness:n.smoothness,zigzag:n.zigzag,rotation:n.rotation,vertical:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.vertical),horizontal:new three__WEBPACK_IMPORTED_MODULE_0__.FM8(...n.horizontal),sides:n.sides}}}(t,o),function(n,r,e,t){switch(n.type){case"color":{let o=new Ae(t.color??5526619),i=Kt(t),s=new Zo(o,i.alpha),a=new Pe(s.calpha,"f");return new De(r,e,n,{color:o,...i},s,i.mode,a,i.isMask)}case"fresnel":{let o1=new Ae(t.color??16777215),i1=new Y(t.bias??.1),s1=new Y(t.scale??1),a1=new Y(t.intensity??2),c=new Y(t.factor??1),u=Kt(t),l=new Bs(o1,i1,s1,a1,c,u.alpha,u.mode,u.isMask),d=new Pe(l.calpha,"f");return new De(r,e,n,{color:o1,bias:i1,scale:s1,intensity:a1,factor:c,...u},l,u.mode,d,u.isMask)}case"rainbow":{let o2=new Y(t.filmThickness??30),i2=new Y(t.movement??0),s2=new ft(t.wavelengths??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,0)),a2=new Y(t.noiseStrength??0),c1=new Y(t.noiseScale??1),u1=new ft(t.offset??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,0)),l1=Kt(t),d1=new Li(o2,i2,s2,a2,c1,u1,l1.alpha,l1.isMask),p=new Pe(d1.calpha,"f");return new De(r,e,n,{filmThickness:o2,movement:i2,wavelengths:s2,noiseStrength:a2,noiseScale:c1,offset:u1,...l1},d1,l1.mode,p,l1.isMask)}case"transmission":{let o3=new Y(t.thickness??10),i3=new Y(t.ior??1.5),s3=new Y(t.roughness??.5),a3=ye.transmissionSize,c2=ye.transmissionRenderTarget,u2=ye.transmissionRenderTargetDepth,l2=window.innerWidth,d2=window.innerHeight,p1=l2>=d2?new Ve(d2/l2,1):new Ve(1,l2/d2),f=Kt(t),m=new Bi(o3,i3,s3,a3,c2,u2,p1,f.alpha),h=new Pe(m.calpha,"f");return new De(r,e,n,{thickness:o3,ior:i3,roughness:s3,aspectRatio:p1,...f},m,f.mode,h,f.isMask)}case"toon":{let s4,o4=new ve(t.positioning??0),i4;t.colors?i4=new dr(t.colors.length,t.colors):(i4=new dr(10,new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(0,0,0,1))).value[1]=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(1,1,1,1),t.steps?s4=new cr(t.steps.length,t.steps):(s4=new cr(10,1)).value[0]=0;let a4=new ft(t.source??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,0)),c3=new ke(t.isWorldSpace??!0),u3=new Y(t.noiseStrength??0),l3=new Y(t.noiseScale??1),d3=new Et(t.shadowColor),p2=new ft(t.offset??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,0)),f1=Kt(t),m1=new Di(o4,i4,s4,a4,c3,u3,l3,d3,p2,f1.alpha),h1=new Pe(m1.calpha,"f");return new De(r,e,n,{positioning:o4,colors:i4,steps:s4,source:a4,isWorldSpace:c3,noiseStrength:u3,noiseScale:l3,shadowColor:d3,offset:p2,...f1},m1,f1.mode,h1,f1.isMask)}case"outline":{let o5=new Ae(t.outlineColor??16777215),i5=new Ae(t.contourColor??16777215),s5=new Y(t.outlineWidth??.1),a5=new Y(t.contourWidth??.1),c4=new Y(t.outlineThreshold??.1),u4=new Y(t.contourThreshold??.1),l4=new Y(t.outlineSmoothing??.1),d4=new Y(t.contourFrequency??.1),p3=new ft(t.contourDirection??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0)),f2=new ke(t.positionalLines??!1),m2=new ke(t.compensation??!0),h2=ye.normalRenderTarget,y=ye.normalRenderTargetDepth,g=ye.pixelRatioNode,x=ye.resolution,b=Kt(t),w=new Mi(o5,i5,s5,a5,c4,u4,l4,d4,p3,f2,m2,x,h2,y,g,b.alpha),S=new Pe(w.calpha,"f");return new De(r,e,n,{outlineColor:o5,contourColor:i5,outlineWidth:s5,contourWidth:a5,outlineThreshold:c4,contourThreshold:u4,outlineSmoothing:l4,contourFrequency:d4,contourDirection:p3,positionalLines:f2,compensation:m2,...b},w,b.mode,S,b.isMask)}case"depth":{let f3,o6=new ve(t.gradientType??0),i6=new ke(t.smooth??!1),s6=new Y(t.near??50),a6=new Y(t.far??200),c5=new Y(t.isVector??1),u5=new Y(t.isWorldSpace??0),l5=new ft(t.origin??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),d5=new ft(t.direction??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),p4;t.colors?p4=new dr(t.colors.length,t.colors):(p4=new dr(2,new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(0,0,0,1))).value[1]=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(1,1,1,1),t.steps?f3=new cr(t.steps.length,t.steps):(f3=new cr(2,1)).value[0]=0;let m3=Kt(t),h3=new Ai(o6,i6,s6,a6,c5,u5,l5,d5,p4,f3,m3.alpha,m3.isMask),y1=new Pe(h3.calpha,"f");return new De(r,e,n,{gradientType:o6,smooth:i6,near:s6,far:a6,isVector:c5,isWorldSpace:u5,origin:l5,direction:d5,colors:p4,steps:f3,...m3},h3,m3.mode,y1,m3.isMask)}case"noise":{let o7=new Y(t.scale??1),i7=new ft(t.size??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(100,100,100)),s7=new Y(t.move??1),a7=new Ve(t.fA??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(1.7,9.2)),c6=new Ve(t.fB??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(8.3,2.8)),u6=new Ve(t.distortion??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(1,1)),l6=new Et(t.colorA),d6=new Et(t.colorB),p5=new Et(t.colorC),f4=new Et(t.colorD),m4=new ve(t.noiseType??0),h4=new ve(t.voronoiStyle??0),y2=new Y(t.highCut??1),g1=new Y(t.lowCut??0),x1=new Y(t.smoothness??.5),b1=new Y(t.seed??.5),w1=new ve(t.quality??1),S1=Kt(t),P=new Ii(o7,i7,s7,a7,c6,u6,l6,d6,p5,f4,S1.alpha,m4,S1.isMask,h4,y2,g1,x1,b1,w1),_=new Pe(P.calpha,"f");return new De(r,e,n,{scale:o7,size:i7,move:s7,fA:a7,fB:c6,distortion:u6,colorA:l6,colorB:d6,colorC:p5,colorD:f4,noiseType:m4,...S1,voronoiStyle:h4,highCut:y2,lowCut:g1,smoothness:x1,seed:b1,quality:w1},P,S1.mode,_,S1.isMask)}case"normal":{let o8=new ft(t.cnormal??new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,1,1)),i8=Kt(t),s8=new Pi(o8,i8.alpha),a8=new Pe(s8.calpha,"f");return new De(r,e,n,{cnormal:o8,...i8},s8,i8.mode,a8,i8.isMask)}case"gradient":{let a9,o9=new ve(t.gradientType??0),i9=new ke(t.smooth??!1),s9;t.colors?s9=new dr(t.colors.length,t.colors):(s9=new dr(10,new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(0,0,0,1))).value[1]=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(1,1,1,1),t.steps?a9=new cr(t.steps.length,t.steps):(a9=new cr(10,1)).value[0]=0;let c7=new Ve(t.offset??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,0)),u7=new Ve(t.morph??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,0)),l7=new Y(t.angle??0),d7=Kt(t),p6=new Ci(o9,i9,s9,a9,c7,u7,l7,d7.alpha,d7.isMask),f5=new Pe(p6.calpha,"f");return new De(r,e,n,{gradientType:o9,smooth:i9,colors:s9,steps:a9,offset:c7,morph:u7,angle:l7,...d7},p6,d7.mode,f5,d7.isMask)}case"pattern":{let o10=new ve(t.style??0),i10=new ve(t.projection??0),s10=new ve(["x","y","z"].indexOf(t.axis)??0),a10=new Y(t.blending??0),c8=new Ve(t.offset??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,0)),u8=new Et(t.colorA),l8=new Et(t.colorB),d8=new Ve(t.frequency??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(10,10)),p7=new Y(t.size??.5),f6=new Y(t.variation??0),m5=new Y(t.smoothness??.5),h5=new Y(t.zigzag??0),y3=new Y(t.rotation??0),g2=new Ve(t.vertical??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,1)),x2=new Ve(t.horizontal??new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,1)),b2=new ve(t.sides??6),w2=Kt(t),S2=new Ei(o10,i10,s10,a10,c8,u8,l8,d8,p7,f6,m5,h5,y3,g2,x2,b2,w2.alpha,w2.isMask),P1=new Pe(S2.calpha,"f");return new De(r,e,n,{style:o10,projection:i10,axis:s10,blending:a10,offset:c8,colorA:u8,colorB:l8,frequency:d8,size:p7,variation:f6,smoothness:m5,zigzag:h5,rotation:y3,vertical:g2,horizontal:x2,sides:b2,...w2},S2,w2.mode,P1,w2.isMask)}default:{let o11=new Ae(1,0,0,1),i11=Kt(t),s11=new Zo(o11,i11.alpha),a11=new Pe(s11.calpha,"f");return new De(r,e,n,{color:o11,...i11},s11,i11.mode,a11,i11.isMask)}}}(t,r,e,o1)}if("noise"===t.displacementType){let i2=new ft(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...t.offset)),s2=new Y(t.scale??10),a2=new Y(t.intensity??8),c2=new Y(t.movement??1),u2=new ve(t.noiseType??0),l2=new ve(t.voronoiStyle??0),d2=new Y(t.smoothness??.5),p1=new Y(t.seed??0),f1=new Y(t.highCut??1),m1=new Y(t.lowCut??0),h1=new ve(t.quality??1),y1=new Ri(a2,c2,i2,l2,d2,p1,f1,m1,h1,s2,u2);return new Fs(r,e,t,{offset:i2,scale:s2,intensity:a2,movement:c2,noiseType:u2,voronoiStyle:l2,smoothness:d2,seed:p1,highCut:f1,lowCut:m1,quality:h1},y1)}throw Error()}updateByOp(r,e,t){if(void 0===r.path[0]){if(0===r.type)return"type"in r.props||"category"in r.props||"visible"in r.props?(t.scene.markNeedsUpdateRendererDirty(),!0):function(n,r,e,t){let o=!1;for(let[i,s]of Object.entries(n)){if("bumpMap"===i||"roughnessMap"===i){o=!0;continue}if(!i||void 0===s)continue;if(Su(i,e,t)){"visible"===i&&"light"===e.type&&(o=!0);continue}e.visible=t.visible;let a=e.uniforms[`f${e.id}_${i}`];if(a&&!(a instanceof Co))switch(o=o||function(n,r,e){if("isMask"===r)return!0;let t=xu[n.type],o=vu[n.type];if(void 0!==o){let i=n.color;if(o.includes(r)){let s=i[r]?.value?.length;if(void 0!==s&&s!==e.length)return!0}}return void 0!==t&&t.includes(r)}(e,i,s),a.constructor){case Ae:if("string"==typeof s){let c=r.getColor(s);c&&(a.value=c);break}{let c1=s;a.value instanceof Io?a.value=new Je(c1.r,c1.g,c1.b,c1.a):a.setRGBA(c1);break}case Et:if("string"==typeof s){let c2=r.getColor(s);c2&&(a.value=c2);break}{let c3=s;a.value instanceof Io?a.value=new Je(c3.r,c3.g,c3.b,c3.a):a.value.setRGBA(c3.r,c3.g,c3.b,c3.a);break}case Ve:{let c4=s;a.value.setX(c4[0]),a.value.setY(c4[1]);break}case ft:{let c5=s;a.value.setX(c5[0]),a.value.setY(c5[1]),a.value.setZ(c5[2]);break}case Pt:bu(s,r,e);break;case dr:a.value=s.map(c=>new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(...c));break;default:a.value=s}}return o}(r.props,t.shared,this,e)}else if("texture"===r.path[0])return!("texture"in e)&&!("video"in e)||bu(r.props,t.shared,this);return!1}dispose(){let r;if("texture"===(r=this instanceof Dr?this.type:this)||"video"===r||"displace_map"===r||"matcap"===r){let r1=this.uniforms[`f${this.id}_texture`];if(!r1)return!1;r1.image instanceof Xt||r1.image.deref()}}hasValueByKey(r){return void 0!==this.uniforms[r]}hasValue(r){return this.hasValueByKey(`f${this.id}_${r}`)}setValue(r,e){let t=`f${this.id}_${r}`;this.hasValueByKey(t)&&void 0!==e&&(this.uniforms[t].value=e)}getNode(r){let e=`f${this.id}_${r}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(r){let e=`f${this.id}_${r}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(r){let t=/f\d+_(.*)/.exec(r);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${r}`)}getNames(){let r=[];for(let e in this.uniforms){let t=this.getName(e);t&&r.push(t)}return r}},De=class extends Dr{constructor(e,t,o,i,s,a,c,u){super(e,t,o,i),this.params=i,this.color=s,this.mode=a,this.alpha=c,this.isMask=u}},Fs=class extends Dr{constructor(e,t,o,i,s){super(e,t,o,i),this.position=s}},Ut=class extends Dr{constructor(e,t,o,i,s){super(e,t,o,s),this.node=i}static createLigherLayer(e,t,o,i){let s,a=new Y(o.alpha),c=new ve(o.mode),u=new Y(o.bumpMapIntensity),l=new Y(o.alphaOverride),d;if(o.visible){if("lambert"===o.category){s=new Gs;let p=new Ae(i.color(o.emissive)??0),f=new ke(o.occlusion??!0);d={emissive:p,occlusion:f},s.emissive=p,s.occlusion=f}else if("toon"===o.category){s=new js;let p1=new Y(o.shininess??30),f1=new Ae(i.color(o.specular)??1118481);d={shininess:p1,specular:f1},s.shininess=p1,s.specular=f1}else if("physical"===o.category){s=new zs;let p2=new Y(o.roughness??.3),f2=new Y(o.metalness??0),m=new Y(o.reflectivity??.5),h=new ke(o.occlusion??!0);d={roughness:p2,metalness:f2,reflectivity:m,occlusion:h},s.roughness=p2,s.metalness=f2,s.reflectivity=m,s.occlusion=h}else{s=new Vs;let p3=new Y(o.shininess??30),f3=new Ae(void 0!==o.specular?i.color(o.specular)??1118481:1118481),m1=new ke(o.occlusion??!0);d={shininess:p3,specular:f3,occlusion:m1},s.shininess=p3,s.specular=f3,s.occlusion=m1}}else s=new Jo,d={};return s.alpha=new Y(1),s.shadingAlpha=a,s.shadingBlend=c,s.bumpMapIntensity=u,s.alphaOverride=l,d.alpha=s.shadingAlpha,d.mode=s.shadingBlend,d.bumpMapIntensity=s.bumpMapIntensity,d.alphaOverride=s.alphaOverride,new Ut(e,t,o,s,d)}get category(){return this.node.category}};function Kt(n){return{alpha:new Y(n.alpha??1),mode:new ve(n.mode??0),isMask:new ke(n.isMask??!1)}}function Su(n,r,e){if("displace"===e.type&&("intensity"===n||"visible"===n)){let t=r.uniforms[`f${r.id}_intensity`];return t?(t.value=e.intensity*(e.visible?1:0),t):void 0}if("displace"!==e.type&&("alpha"===n||"visible"===n)){let t1=r.uniforms[`f${r.id}_alpha`];if(!t1)return;if(t1.value=e.alpha*(e.visible?1:0),"outline"===e.type&&"visible"===n){let o=r.uniforms[`f${r.id}_compensation`];o&&(o.value=e.compensation&&e.visible)}return t1}}function gg(n,r){let e=0,t=n.layers.find(o=>"light"===o.data.type);if(t&&t.data.alphaOverride<1)return!0;for(let o of n.layers){if("displace"!==o.data.type&&o.data.isMask)return!0;if("displace"!==o.data.type&&"alpha"in o.data&&"light"!==o.data.type&&"fresnel"!==o.data.type&&"texture"!==o.data.type&&"matcap"!==o.data.type&&"rainbow"!==o.data.type&&"outline"!==o.data.type&&"pattern"!==o.data.type){let i=o.data.visible?o.data.alpha:0;if(1===i&&"depth"===o.data.type||"gradient"===o.data.type){for(let s of o.data.colors)if(s[3]<1){i=s[3];break}}else if(1===i&&"noise"===o.data.type){let l=Math.min(r.color(o.data.colorA).a,Math.min(r.color(o.data.colorB).a,Math.min(r.color(o.data.colorC).a,r.color(o.data.colorD).a)));l<1&&(i=l)}e+=(1-e)*i}}return e<1}var Dt=class extends three__WEBPACK_IMPORTED_MODULE_0__.jyz{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},Kl=class extends Dt{constructor(e,t,o,i){super(),this.flatShading=e,this.side=t,this.wireframe=o,this.root=i}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,o){return this.root.getFlavor(e,t,o)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,o){this.root.updateByOp(e,t,o)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},en=class extends Dt{constructor(e,t){super(),this.data=e,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,o){let i=o?6:(e?3:0)+t;if(0===i)return this;void 0===this.flavors&&(this.flavors=[]),i-=1;let s=this.flavors[i];return void 0===s&&(s=new Kl(e,t,o,this),this.flavors[i]=s,s.flatShading=e,s.side=t,s.updateAfterBuild()),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let o=e.layers??It.defaultTwoLayerData("phong").layers;try{this.layers=o.map(i=>Dr.create(this.layerIdGen++,i.id,i.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(),this.transparent=gg(e,t.shared)}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(){for(let e of(this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(e=>e instanceof Ut),void 0===this.lightLayer&&(this.lightLayer=new Ut(0,"",{...wt.defaultData("light","phong"),visible:!1},new Jo,{})),this.dispose(),this.flavors))e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let e=this.layers.find(s=>s instanceof Ut);if(!e)return;let t=e.data,o=t.bumpMap,i=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let s=0;s<this.layers.length;++s){let a=this.layers[s];a instanceof De&&a.color instanceof No&&(a.uuid===o&&(e.node.bumpMap=a.color),a.uuid===i&&(e.node.roughnessMap=a.color))}}updateByOp(e,t,o){if(void 0!==t?this.data=t:t=this.data,this.transparent=gg(t,o.shared),"layers"===e.path[0]){this.data=t;let i=o.shared,s=e.path[1];if(void 0===s){if(this.layers.reverse(),4===e.type){let a=Dr.create(this.layerIdGen++,e.id,e.data,o.shared);this.layers.splice(e.localIndex,0,a),o.scene.markNeedsUpdateRendererDirty()}else if(5===e.type)this.layers.splice(e.localIndex,1)[0].dispose(),o.scene.markNeedsUpdateRendererDirty();else if(6===e.type){let a1=this.layers.findIndex(u=>u.uuid===e.id),c=this.layers[a1];this.layers.splice(a1,1),this.layers.splice(e.localIndex,0,c),o.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{0===e.type&&void 0!==e.props.occlusion&&o.scene.markNeedsUpdateRendererDirty();let a2=this.layers.find(c=>c.uuid===s);if(a2){let c1=t.layers.data(s);if(a2.updateByOp({...e,path:e.path.slice(2)},c1,o)){let l=Dr.create(this.layerIdGen++,s,c1,i);this.layers.splice(this.layers.findIndex(d=>d.uuid===s),1,l),this.onUpdate()}}}}else this.reset(t,o)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof De?t.color.mask=void 0:t instanceof Ut&&(t.node.mask=void 0)}for(let e1=0;e1<this.layers.length;++e1){let t1=this.layers[e1];if(t1 instanceof De&&t1.isMask.value&&t1.data.visible&&e1>0){let o=e1-1,i=this.layers[o];i instanceof Ut?i.node.mask=new st(t1.color,t1.alpha,st.MUL):i instanceof De&&(i.isMask.value||(i.color.mask=new st(t1.color,t1.alpha,st.MUL)))}}}blendColors(){let e=this.layers.findIndex(o=>o instanceof De),t=this.layers.findIndex(o=>o instanceof Ut);if(-1!==e&&e<t){let o=this.layers[e].color;for(let i=e+1;i<t;++i){let s=this.layers[i];if(s instanceof De){if(s.isMask.value)continue;o=new _i(o,s.color,s.alpha,s.mode)}}this.fragment.color=o}else this.fragment.color=void 0}blendAfterColors(){let e=new Pe("outgoingLight","f"),t=this.layers.findIndex(o=>o instanceof Ut);if(this.layers.length>t+1){for(let o=t+1;o<this.layers.length;++o){let i=this.layers[o];if(i instanceof De){if(i.isMask.value)continue;e=new _i(e,i.color,i.alpha,i.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof Fs);if(e.length>0){let t=e[0].position;for(let o=1;o<e.length;++o)e[o]&&(t=new st(t,e[o].position,st.ADD),t=new st(t,new Y(.5).setReadonly(!0),st.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let o=(i,s,a)=>Math.min(Math.max(i,s),a);for(let i of this.layers)if("displace"===i.type){let s=o(i.uniforms[`f${i.id}_intensity`].value,e,t);i.uniforms[`f${i.id}_intensity`].value=s}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if("light"===t.type)e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let s=[...(xu[t.type]??[]).map(u=>t[u]),...(vu[t.type]??[]).map(u=>t[u]?.length??0)],c=`"${t.type}-${t.visible}-${"isMask"in t&&t.isMask}"`;s.length?e+=`[${c}, "${s.join('","')}"],`:e+=c}return e.slice(0,-1)+"]"}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Ul;for(let t of(e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters,this.flavors))t&&t.updateAfterBuild();return this}nodeMaterialDispose(){for(let e of(this.layers.forEach(e=>e.dispose()),super.dispose(),this.flavors))e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof De){let t=e.params.texture;if(t instanceof Ko&&!t.image.loaded)return!1}return!0}getHash(){return'"fragment":'+this.fragment.getHash()+"}"}};Object.defineProperties(Dt.prototype,{properties:{get:function(){return this.fragment.properties}}});var Pg,tn=class extends en{},Sg=sa(xg()),vg=new Map,rn=class{constructor({src:r,volume:e,delay:t,loop:o}){let i;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},i="string"==typeof r?{src:r}:{src:function(n){if("string"==typeof n)return n;let r=vg.get(n);return r||(r={url:URL.createObjectURL(new Blob([n]))},vg.set(n,r)),r.url}(r),format:"wav"},this.sound=new Sg.Howl(i),this.sound.on("end",this.onEnd),this.src=r,void 0!==e&&(this.volume=e),void 0!==t&&(this.delay=t),void 0!==o&&(this.loop=o)}get status(){return this._status}get volume(){return this._volume}set volume(r){this._volume=r,this.sound.volume(r)}get loop(){return this._loop}set loop(r){this._loop=r,this.loopsRemaining=r}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(r,e=1e3){r?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,e),this.clearFade()},r)):this.sound.fade(this._volume,0,e)}on(r,e,t){this.sound.on(r,e,t)}off(r,e,t){this.sound.off(r,e,t)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(r=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},Ql=class{constructor(){this.type="ShapePath",this.color=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk,this.subPaths=[],this.currentPath=null}moveTo(r,e){return this.currentPath=new three__WEBPACK_IMPORTED_MODULE_0__.y$t,this.subPaths.push(this.currentPath),this.currentPath.moveTo(r,e),this}lineTo(r,e){return this.currentPath?.lineTo(r,e),this}quadraticCurveTo(r,e,t,o){return this.currentPath?.quadraticCurveTo(r,e,t,o),this}bezierCurveTo(r,e,t,o,i,s){return this.currentPath?.bezierCurveTo(r,e,t,o,i,s),this}splineThru(r){return this.currentPath?.splineThru(r),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(h,y,g){let x=g.x-y.x,b=g.y-y.y,w=h.x-y.x,S=h.y-y.y,P=x*S-w*b;if(h.x===y.x&&h.y===y.y){t.loc=e.ORIGIN,t.t=0;return}if(h.x===g.x&&h.y===g.y){t.loc=e.DESTINATION,t.t=1;return}if(P<-Number.EPSILON){t.loc=e.LEFT;return}if(P>Number.EPSILON){t.loc=e.RIGHT;return}if(x*w<0||b*S<0){t.loc=e.BEHIND;return}if(Math.sqrt(x*x+b*b)<Math.sqrt(w*w+S*S)){t.loc=e.BEYOND;return}t.loc=e.BETWEEN,t.t=0!==x?w/x:S/b}let u=0,l=999999999,d=-999999999,p=[];this.subPaths.forEach(h=>{let y=h.getPoints(),g=-999999999,x=999999999,b=-999999999,w=999999999;for(let S=0;S<y.length;S++){let P=y[S];P.y>g&&(g=P.y),P.y<x&&(x=P.y),P.x>b&&(b=P.x),P.x<w&&(w=P.x)}d<=b&&(d=b+1),l>=w&&(l=w-1),y.length&&p.push({curves:h.curves,points:y,isCW:three__WEBPACK_IMPORTED_MODULE_0__.iDF.isClockWise(y),identifier:u++,boundingBox:new three__WEBPACK_IMPORTED_MODULE_0__.TUj(new three__WEBPACK_IMPORTED_MODULE_0__.FM8(w,x),new three__WEBPACK_IMPORTED_MODULE_0__.FM8(b,g))})});let f=p.map(h=>(function(h,y,g,x,b){(null==b||""===b)&&(b="nonzero");let w=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;h.boundingBox.getCenter(w);let P=function(h,y,g){let x=new three__WEBPACK_IMPORTED_MODULE_0__.FM8;y.getCenter(x);let b=[];return g.forEach(w=>{w.boundingBox.containsPoint(x)&&(function(h,y){let g=[],x=[];for(let b=1;b<h.length;b++){let w=h[b-1],S=h[b];for(let P=1;P<y.length;P++){let N=function(h,y,g,x){let b=h.x,w=y.x,S=g.x,P=x.x,_=h.y,v=y.y,N=g.y,T=x.y,C=(P-S)*(_-N)-(T-N)*(b-S),A=(T-N)*(w-b)-(P-S)*(v-_),R=C/A,U=((w-b)*(_-N)-(v-_)*(b-S))/A;if(0===A&&0!==C||R<=0||R>=1||U<0||U>1)return null;if(0===C&&0===A){for(let $=0;$<2;$++)if(i(0===$?g:x,h,y),t.loc===e.ORIGIN){let ee=0===$?g:x;return{x:ee.x,y:ee.y,t:t.t}}else if(t.loc===e.BETWEEN)return{x:+(b+t.t*(w-b)).toPrecision(10),y:+(_+t.t*(v-_)).toPrecision(10),t:t.t};return null}for(let X=0;X<2;X++)if(i(0===X?g:x,h,y),t.loc===e.ORIGIN){let q=0===X?g:x;return{x:q.x,y:q.y,t:t.t}}return{x:+(b+R*(w-b)).toPrecision(10),y:+(_+R*(v-_)).toPrecision(10),t:R}}(w,S,y[P-1],y[P]);null!==N&&void 0===g.find(T=>T.t<=N.t+Number.EPSILON&&T.t>=N.t-Number.EPSILON)&&(g.push(N),x.push(new three__WEBPACK_IMPORTED_MODULE_0__.FM8(N.x,N.y)))}}return x})(h,w.points).forEach(P=>{b.push({identifier:w.identifier,isCW:w.isCW,point:P})})}),b.sort((w,S)=>w.point.x-S.point.x),b}([new three__WEBPACK_IMPORTED_MODULE_0__.FM8(g,w.y),new three__WEBPACK_IMPORTED_MODULE_0__.FM8(x,w.y)],h.boundingBox,y);P.sort((O,A)=>O.point.x-A.point.x);let _=[],v=[];P.forEach(O=>{O.identifier===h.identifier?_.push(O):v.push(O)});let N=_[0].point.x,T=[],C=0;for(;C<v.length&&v[C].point.x<N;)T.length>0&&T[T.length-1]===v[C].identifier?T.pop():T.push(v[C].identifier),C++;if(T.push(h.identifier),"evenodd"===b){let O=T.length%2==0,A=T[T.length-2];return{identifier:h.identifier,isHole:O,for:A}}if("nonzero"===b){let O1=!0,A1=null,R=null;for(let U=0;U<T.length;U++){let $=T[U];y[$]&&(O1?(R=y[$].isCW,O1=!1,A1=$):R!==y[$].isCW&&(R=y[$].isCW,O1=!0))}return{identifier:h.identifier,isHole:O1,for:A1}}console.warn('fill-rule: "'+b+'" is currently not implemented.')})(h,p,l,d,this.userData?.style.fillRule)),m=[];return p.forEach(h=>{let y=f[h.identifier];if(y&&!y.isHole){let g=new three__WEBPACK_IMPORTED_MODULE_0__.bnF;g.curves=h.curves,f.filter(b=>b?.isHole&&b.for===h.identifier).forEach(b=>{if(b){let w=p[b.identifier],S=new three__WEBPACK_IMPORTED_MODULE_0__.y$t;S.curves=w.curves,g.holes.push(S)}}),m.push(g)}}),m}},wu=new Promise(n=>{Pg=n}),_g=!1;async function aA(n){return await (await fetch(n)).arrayBuffer()}var lA=new class{async load(r,e,t=()=>{}){let{load:o}=await wu;o(r,(i,s)=>{i||!s?t(i??"Something went wrong"):e(s)})}async parse(r){let{parse:e,Bidi:t}=await wu;try{let o=e(r),i=new t,s=a=>o.charToGlyphIndex(a.char);return i.registerModifier("glyphIndex",null,s),i.applyFeatures(o,o.defaultRenderOptions.features),{font:o,bidi:i}}catch(o1){console.error(o1)}}};async function _u(n){let r,e,t=!1;if(n.url?(r=await aA(n.url),e=n.url,t=n.url.startsWith("/")):n.data&&(r=n.data.buffer),r){let o=await lA.parse(r);if(o)return{font:o.font,url:e,intercepted:t,arr:r,bidi:o.bidi}}}var ec=class{constructor(r){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=r.isUserFont??!1,this._loadingPromise=_u(r).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}update(r){this._isLoaded=!1,this._isUserFont=r.isUserFont??!1,this._loadingPromise=_u(r).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(r,e,t){if(!this._bidi)return[];let o=this._bidi;o.getTextGlyphs(e);let i=o.tokenizer.tokens,s=[],a=0,c=t.length===i.length;for(let u=0;u<t.length;u++){let l=t[u].index,d=String.fromCharCode(t[u].unicode),p=i[a];if(p.state.glyphIndex===l||p.state.fina===l||p.state.medi===l||p.state.init===l||c)s.push({char:d,index:l,replacements:[p.state.glyphIndex],replacementChars:[p.char]}),a++;else{let f=p.char,m="",h=[p.state.glyphIndex],y=[],g=!1;for(;!g;)a++,f+=m=e.charAt(a),h.push(r.charToGlyphIndex(m)),1===(y=r.stringToGlyphs(f)).length&&y[0].index===l&&(g=!0),a>e.length&&(g=!0);s.push({char:d,index:l,replacements:h,replacementChars:Array.from(f)}),a++}}return s}generateShapes(r,e){if(!this._isLoaded)return;let t=this.font,o=e.fontSize/this.unitsPerEm,i=e.fontSize*e.lineHeight,s=r.map(x=>this.getTextWidth(x,e)),a=e.width,c=this.getCharWidth(`
`,e),u=1===e.horizontalAlign?c:0,l=this.computeSpaceWidthForLine(r,0,e),d=this.getLineInitialOffsetX(s[0],a,e.horizontalAlign,r[0],c),p=this.getLineInitialOffsetY(i,r.length,e.height,o,e.verticalAlign),f=[],m=r.map(x=>[]),h=r.map(x=>[]),y;for(let x=0;x<r.length;x++){let b=r[x],w={features:{liga:!0}},S=[];try{S=t.stringToGlyphs(b,w)}catch(_){console.warn(_)}d=this.getLineInitialOffsetX(s[x],a,e.horizontalAlign,b,c);let P=[];try{P=this.reverseLigaturesTable(t,b,S)}catch(_1){console.warn(_1)}l=this.computeSpaceWidthForLine(r,x,e);for(let _2=0;_2<S.length;_2++){let v=S[_2],N=0===v.index?`
`:v.unicode?String.fromCharCode(v.unicode):void 0,T=P[_2],C=0,O=0;0===_2&&2===e.horizontalAlign&&void 0!==v.leftSideBearing&&(O=-v.leftSideBearing*o),y&&(C=t.getKerningValue(v,y)*o),d+=O+C;let A=0;if(N===`
`)A=u;else if(" "===N)A=l;else{let R=this.createPath(v,o,d,p,e);R&&(A=R.offsetX-(C+O),f.push(R.path))}if(1===T.replacements.length)h[x].push([d,p]),m[x].push(A);else{let R1=T.replacements.map(X=>(t.glyphs.get(X).advanceWidth??0)*o),U=R1.reduce((X,q)=>X+=q,0),$=R1.map(X=>X/U),ee=d;for(let X=0;X<$.length;X++){let q=A*$[X];h[x].push([ee,p]),m[x].push(q),ee+=q}}d+=A,y=v}p-=i}let g=[];for(let x1=0,b1=f.length;x1<b1;x1++)g.push(...f[x1].toShapes());return{shapes:g,charWidths:m,lineWidths:s,charCoords:h}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(r,e,t,o,i){return(3===t||2===t)&&o.indexOf(`
`)>=0&&(r-=i),3===t?.5*e-.5*r:2===t?e-r:0}getLineInitialOffsetY(r,e,t,o,i){let s=e*r,a=Math.abs(this.ascender-this.descender)*o,u=-this.ascender*o-(r-a)/2;return 3===i?-(t-s-u):2===i?-(.5*t-.5*s-u):u}createPath(r,e,t,o,i){let s=r.getPath(t,-o,i.fontSize,{kerning:!1,letterSpacing:i.letterSpacing});if(!s){console.error('THREE.Font: character "'+r+'" does not exists in font family '+this.familyName+".");return}let a=new Ql,c=(r.advanceWidth??1)*e;if(r)for(let u of s.commands){let l=a.currentPath?.currentPoint;if(!(l&&"Z"!==u.type&&l.x===u.x&&-l.y===u.y))switch(u.type){case"M":a.moveTo(u.x,-u.y);break;case"L":a.lineTo(u.x,-u.y);break;case"Q":a.quadraticCurveTo(u.x1,-u.y1,u.x,-u.y);break;case"C":a.bezierCurveTo(u.x1,-u.y1,u.x2,-u.y2,u.x,-u.y)}}return a.subPaths.forEach(u=>{let l=function(n){if(n.length){let r=n[0];if(r instanceof three__WEBPACK_IMPORTED_MODULE_0__.g_z)return r.v1;if(r instanceof three__WEBPACK_IMPORTED_MODULE_0__.AXT||r instanceof three__WEBPACK_IMPORTED_MODULE_0__.ZQ6)return r.v0}}(u.curves);void 0!==l&&u.currentPoint.distanceTo(l)>0&&u.lineTo(l.x,l.y)}),{offsetX:c+i.fontSize*i.letterSpacing,path:a}}getCharWidth(r,e){return this.font?.getAdvanceWidth(r,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}getTextWidth(r,e){return this.font?.getAdvanceWidth(r,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}computeSpaceWidthForLine(r,e,t){let o=this.getCharWidth(" ",t),i=r[e];if(i){let s=this.countSpaces(i.trimEnd());if(4===t.horizontalAlign&&e<r.length-1&&s)return(t.width-(this.getTextWidth(i,t)-s*o))/s}return o}countSpaces(r){return(r.match(/ /g)||[]).length}},Pu=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(r){return this.objects.get(r)}get size(){return this.objects.size}get(r,e){let t=this.objects.get(r);return void 0===t?(t=this.createObject(r,e),this.objects.set(r,t)):t.isShared=!0,t}mutateIfUnique(r,e){let t=this.objects.get(r);if(t&&!0!==t.isShared)return this.objects.delete(r),this.objects.set(e,t),t}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(r,e){e===this.objects.get(r)&&this.unreachable.delete(r)}endGc(){this.unreachable.forEach(r=>{this.disposeObject(this.objects.get(r)),this.objects.delete(r)}),this.unreachable.clear()}dispose(){this.objects.forEach(r=>{this.disposeObject(r)}),this.objects.clear()}},Us=class extends Pu{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t){let o=$o(e,t,this.flatShading);return o.computeBoundingSphere(),o}},Og={markNeedsUpdateRendererDirty(){}},Tu=class extends Yl{constructor(e){super(),this.shared=e}create(e){return new Gi(e,this.shared)}},nn=class{constructor(r,e={}){if(this.geometryCache=new Us(!0),this.geometryCache2=new Us(!1),this.imageHolderCache=new Tu(this),this.thisContext={scene:Og,shared:this},this.deletedMaterial=new tn(It.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new Xt(Yn.emptyImage,this),this.deletedVideo=new Xt(kn.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[t,o]of Object.entries(e.images))this.addImage(t,o);if(e.videos)for(let[t1,o1]of Object.entries(e.videos))this.addVideo(t1,o1);if(e.audios)for(let[t2,o2]of Object.entries(e.audios))this.addAudio(t2,o2.data);this.reset(r)}setRequestRender(r){this._requestRender=r}reset(r){for(let[e,t]of Object.entries(r.images))this.addImage(e,t);for(let[e1,t1]of Object.entries(r.videos))this.addVideo(e1,t1);for(let[e2,t2]of Object.entries(r.colors))this.addColor(e2,t2);for(let[e3,t3]of Object.entries(r.materials))this.addMaterial(e3,new tn(t3,this.thisContext));for(let[e4,t4]of Object.entries(r.audios))this.addAudio(e4,t4.data);for(let[e5,t5]of Object.entries(r.fonts))this.addFont(e5,t5)}addMaterial(r,e){e.uuid=r,this.materials[r]?(this.materials[r].reset(e.data,this.thisContext),e.dispose()):this.materials[r]=e}deleteMaterial(r){this.materials[r]&&(this.materials[r].nodeMaterialDispose(),delete this.materials[r])}getMaterial(r){return this.materials[r]}getMaterialOrDeletedPlaceholder(r){return this.materials[r]??this.deletedMaterial}material(r){return"string"==typeof r?this.getMaterialOrDeletedPlaceholder(r):null==r?(console.error("material is undefined or null"),this.deletedMaterial):new en(r,this.thisContext)}getMaterials(){return this.materials}addImage(r,e){return this.images[r]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[r].updateSrc(e.data),!0):(this.images[r]=new Xt(e,this),!1)}deleteImage(r){let e=this.images[r];e&&(e.dispose(),delete this.images[r])}getDefaultImage(){return this.images.image_0}getImage(r){return this.images[r]??this.deletedImage}image(r){return"string"==typeof r?this.getImage(r):this.imageHolderCache.load(r)}addVideo(r,e){return this.videos[r]?(this.videos[r].updateSrc(e.data),!0):(this.videos[r]=new Xt(e,this),!1)}deleteVideo(r){let e=this.videos[r];e&&(e.dispose(),delete this.videos[r])}getVideo(r){return this.videos[r]??this.deletedVideo}video(r){return"string"==typeof r?this.getVideo(r):this.imageHolderCache.load(r)}addColor(r,e){return this.colors[r]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[r].setRGBA(e.r,e.g,e.b,e.a):this.colors[r].setRGBA(e.r,e.g,e.b,1),!0):("a"in e?this.colors[r]=new Io(e.r,e.g,e.b,e.a):this.colors[r]=new Io(e.r,e.g,e.b,1),!1)}updateColor(r,e){if(this.colors[r]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let t=this.colors[r];return this.colors[r].r=e.r??t.r,this.colors[r].g=e.g??t.g,this.colors[r].b=e.b??t.b,this.colors[r].a=e.a??t.a,!0}return!1}deleteColor(r){this.colors[r]&&delete this.colors[r]}getColor(r){return this.colors[r]}color(r){let e;if("string"!=typeof r)return"a"in r?new Je(r.r,r.g,r.b,r.a):new Je(r.r,r.g,r.b,1);{let t=this.getColor(r);t?e=t:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new Je(0,0,0,0))}return e}addAudio(r,e){this.audios[r]=e}getAudio(r){let e=this.audios[r];if(e instanceof rn)return e;{let t=new rn({src:e});return this.audios[r]=t,t}}deleteAudio(r){let e=this.audios[r];e&&(e instanceof rn&&e.dispose(),delete this.audios[r])}addFont(r,e){this.fonts[r]=new ec(e),this.fonts[r].loadingPromise.then(()=>this.requestRender())}getFont(r){return this.fonts[r]}deleteFont(r){this.fonts[r]&&delete this.fonts[r]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof rn&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}},Ag=new nn(dl.emptyData()),Bt=class extends pt{updateByPatchedOp(e,t,o){if(super.updateByPatchedOp(e,t,o),null!==function(n,r){let e=[];if(r.length!==n.length)return null;for(var t=0;t<n.length;){if("*"===r[t])e.push(n[t]);else if(n[t]!==r[t])return null;t+=1}return e}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[i,s]of Object.entries(e.props)){let a=o.shared.material(s);this.material[Number(i)]=a}else if(yt(e.path,["material"])&&this.material instanceof Dt)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(dt.drop(e,1),t.material,o);else if(yt(e.path,["materials","*"])&&Array.isArray(this.material)){let i1=e.path[1];if("materials"in t&&i1<this.material.length){let s1=t.materials[i1];"string"!=typeof s1&&this.material[i1].updateByOp(dt.drop(e,2),s1,o)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let o=this.dataPatched;if(e.geometry?.type!=="NonParametricGeometry"&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(o.flatShading,o.side,o.wireframe),t.scene.markNeedsUpdateRendererDirty()),e.geometry?.type==="NonParametricGeometry"&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map(i=>t.shared.material(i).getFlavor(o.flatShading,o.side,o.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(o.flatShading,o.side,o.wireframe)],t.scene.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side){if(Array.isArray(this.material))for(let i=0;i<this.material.length;i++)this.material[i]=this.material[i].getFlavor(o.flatShading,o.side,o.wireframe);else this.material=this.material.getFlavor(o.flatShading,o.side,o.wireframe)}}disposeMaterial(){this.material&&aa(this.material).forEach(e=>{e instanceof Dt&&(e instanceof tn||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},Cg=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Ng=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg,Ig=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg,hA=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Mg=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Xe=class extends Bt{constructor(e,t,o){super(e,t),this.data=t,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.isSkinnedMesh=!0,this.bindMode=t.bindMode,this.bindMatrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().fromArray(t.bindMatrix),this.bindMatrixInverse=new three__WEBPACK_IMPORTED_MODULE_0__.yGw)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof three__WEBPACK_IMPORTED_MODULE_0__.u9r&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof nn){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return ds.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return ds.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,o){super.updateByPatchedOp(e,t,o),yt(e.path,["geometry"])&&this.updateByPatchedOpGeometry(dt.drop(e,1),t.geometry,o)}removeInteractionGeometry(){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let o=this.data.geometry.type;if("NonParametricGeometry"===o||"SubdivGeometry"===o){let s,a,c;if(void 0===this.localGeometry){let l={...this.data.geometry,...e};this.localGeometry=$o(l,t,this.data.flatShading)}e.scaleBaked?[s,a,c]=e.scaleBaked:{width:s,height:a,depth:c}=e;let u=this.localGeometry.userData;void 0!==u.sxPrev&&Ns(this.localGeometry.attributes,s/u.sxPrev,a/u.syPrev,c/u.szPrev),u.sxPrev=s,u.syPrev=a,u.szPrev=c}else{let i={...this.data.geometry,...e};this.localGeometry?.dispose(),this.localGeometry=$o(i,t,this.data.flatShading)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,o){let i=!1;0===e.type&&0===e.path.length&&rs(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof We&&this.chooseGeoemtryCache(o.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(i=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(o),this.refreshAttachedPaths(o)),i||(o.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(o)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let o=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*o.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(o.width,o.height,o.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(o.width,o.height,o.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new three__WEBPACK_IMPORTED_MODULE_0__.Ltg,o=this.geometry.attributes.skinWeight;for(let i=0,s=o.count;i<s;i++){t.fromBufferAttribute(o,i);let a=1/t.manhattanLength();a!==1/0?t.multiplyScalar(a):t.set(1,0,0,0),o.setXYZW(i,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let o=this.skeleton;if(void 0===o)return;let i=this.geometry;Ng.fromBufferAttribute(i.attributes.skinIndex,e),Ig.fromBufferAttribute(i.attributes.skinWeight,e),Cg.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){let a=Ig.getComponent(s);if(0!==a){let c=Ng.getComponent(s);Mg.multiplyMatrices(o.bones[c].matrixWorld,o.boneInverses[c]),t.addScaledVector(hA.copy(Cg).applyMatrix4(Mg),a)}}return t.applyMatrix4(this.bindMatrixInverse)}};function zi(n){if(Array.isArray(n.material)){for(let r of n.material)if(0===r.getLayersOfType("outline").length)return}else if(!(n.material instanceof Dt)||0===n.material.getLayersOfType("outline").length)return;n instanceof Xe&&n.is2DAndNoDepth?function(n){if(n.geometry.attributes.extrudeNormals||!n.geometry.attributes.position)return;let e=n.geometry.attributes.position.array,t=new Float32Array(e.length),o=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;for(let i=0;i<e.length;i+=3)o.set(e[i],e[i+1],e[i+2]).normalize(),t[i]=o.x,t[i+1]=o.y,t[i+2]=o.z;n.geometry.setAttribute("extrudeNormal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(t,3))}(n):function(n){if(n.geometry.attributes.extrudeNormal||!n.geometry.attributes.position||!n.geometry.attributes.normal)return;let r=new Map,e=n.geometry.attributes,t=e.position.array,o=e.normal.array,i=new Float32Array(t.length);for(let s=0;s<t.length;s+=3){let a=`${t[s]}_${t[s+1]}_${t[s+2]}`,c=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(o[s],o[s+1],o[s+2]);r.has(a)?r.get(a)?.normals.push(c):r.set(a,{normals:[c],result:new three__WEBPACK_IMPORTED_MODULE_0__.Pa4})}r.forEach((s,a)=>{for(let c of s.normals)s.result.add(c);s.result.divideScalar(s.normals.length)});for(let s1=0;s1<t.length;s1+=3){let c1=r.get(`${t[s1]}_${t[s1+1]}_${t[s1+2]}`)?.result;c1&&(i[s1]=c1.x,i[s1+1]=c1.y,i[s1+2]=c1.z)}n.geometry.setAttribute("extrudeNormal",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(i,3))}(n)}function ji(n){if(!n.geometry.attributes.position)return;let e=n.geometry.attributes.position.array,t=new Float32Array(e.length),o=parseInt(n.uuid.replace(/\D/g,"")),i=[three__WEBPACK_IMPORTED_MODULE_0__.M8C.seededRandom(o),three__WEBPACK_IMPORTED_MODULE_0__.M8C.seededRandom(o+1e4),three__WEBPACK_IMPORTED_MODULE_0__.M8C.seededRandom(o+2e4)];for(let s=0;s<e.length;s++)t[s]=i[s%3];n.geometry.setAttribute("randomColor",new three__WEBPACK_IMPORTED_MODULE_0__.TlE(t,3))}mi.then(n=>{});var Br=new three__WEBPACK_IMPORTED_MODULE_0__.ZzF,Hs=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,sn=class extends Xe{constructor(e,t,o){super(e,t,o),this.data=t,this.hiddenMatrixOld=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let o=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(o.width,o.height,o.depth??0).multiplyScalar(.5)}createGeometryByControls(e){if(!0===this.skipReactionUpdate)return;let t=this.localGeometry?.uuid,{originalGeometry:o,subdividedGeometry:i,subdivPointer:s}=We.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,void 0!==o&&(this.originalGeometry?.dispose(),this.originalGeometry=o),void 0!==i&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=i??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,zi(this),ji(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let o=this.material;this.material=o.getFlavor(!1,o.side,o.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){We.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&We.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=We.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=We.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let o=this.localGeometry;this.localGeometry=this.originalGeometryNew,pt.prototype.raycast.call(this,e,t),this.localGeometry=o}activateSVDCompensation(){this.hasNonUniformScale&&(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){this.hasNonUniformScale&&(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new three__WEBPACK_IMPORTED_MODULE_0__.aLr,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,o=e.boundingSphere.center;Br.setFromBufferAttribute(t),Br.getCenter(o),e.boundingSphere.radius=o.distanceTo(Br.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Br.getSize(Hs),this.hasNonUniformScale&&Hs.divide(this.scale);let i={width:Hs.x,height:Hs.y,depth:Hs.z};return this.geometry.userData.parameters=i,i}updateBoundingSphere(e){let t=this.originalGeometry;Br.min.set(e[0],e[2],e[4]),Br.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(Br.min.applyMatrix4(this.shearScaleInv),Br.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new three__WEBPACK_IMPORTED_MODULE_0__.aLr);let o=t.boundingSphere.center;Br.getCenter(o),t.boundingSphere.radius=o.distanceTo(Br.max)}freeSubdivPointer(){this.subdivPointer&&(We.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,o){super.updateByPatchedOpGeometry(e,t,o),this.localGeometry&&this.createGeometryByControls(t)}},Gg={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},Vg={polygon_center:0,edge:1,vertex:2},Ws=(n,r)=>(e,t)=>r&&0!==e&&0!==n?n*t/100:0,he=(n,r)=>{let e=Math.abs(r),t=-1*e;return(n- -1)*(e-t)/2+t},TA=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,tc=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,OA=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,AA=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;function Fi(n,r){let e=OA.fromArray(n),t=AA.fromArray(r);tc.copy(t).sub(e);let o=tc.length();return tc.normalize().multiplyScalar(.5*o),TA.copy(e).add(tc).toArray()}var Jl,Kg,Zg,Qg,Zt=new three__WEBPACK_IMPORTED_MODULE_0__.CJI,rc=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,oc=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,an=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Iu=n=>.5*(1-Math.cos(n*Math.PI)),Mu=class{constructor(){this.perlin=Array(4096)}noise(r,e=0,t=0){if(null==this.perlin){this.perlin=Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}r<0&&(r=-r),e<0&&(e=-e),t<0&&(t=-t);let o=Math.floor(r),i=Math.floor(e),s=Math.floor(t),a=r-o,c=e-i,u=t-s,l,d,p=0,f=.5,m,h,y;for(let g1=0;g1<4;g1++){let x=o+(i<<4)+(s<<8);l=Iu(a),d=Iu(c),m=this.perlin[4095&x],m+=l*(this.perlin[x+1&4095]-m),h=this.perlin[x+16&4095],h+=l*(this.perlin[x+16+1&4095]-h),m+=d*(h-m),x+=256,h=this.perlin[4095&x],h+=l*(this.perlin[x+1&4095]-h),y=this.perlin[x+16&4095],y+=l*(this.perlin[x+16+1&4095]-y),h+=d*(y-h),m+=Iu(u)*(h-m),p+=m*f,f*=.5,o<<=1,i<<=1,c*=2,s<<=1,u*=2,(a*=2)>=1&&(o++,a--),c>=1&&(i++,c--),u>=1&&(s++,u--)}return p}noiseSeed(r){let s,a;let e={setSeed(c){a=s=(c??4294967296*Math.random())>>>0},getSeed:()=>s,rand:()=>(a=(1664525*a+1013904223)%4294967296)/4294967296};e.setSeed(r),this.perlin=Array(4096);for(let t=0;t<4096;t++)this.perlin[t]=e.rand()}},Ug=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Hg=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Wg=new three__WEBPACK_IMPORTED_MODULE_0__.zHn,ki=class extends Xe{constructor(e,t,o){super(e,t,o),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let e=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign)??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:o}=this;if(!(isNaN(e.ray.origin.x)||0===this.scale.x||0===this.scale.y||0===this.scale.z)&&(Hg.copy(o).invert(),Wg.copy(e.ray).applyMatrix4(Hg),Wg.intersectBox(this.singleBBox,Ug))){let i=Ug.applyMatrix4(o),s=e.ray.origin.distanceTo(i);t.push({distance:s,point:i.clone(),object:this})}}},Yg=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Xg=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;mi.then(n=>{Kg=[n.get_face_center,n.get_edge_midpoint,n.get_vertex_position],Zg=[n.get_face_normal,n.get_edge_normal,n.get_vertex_normal],Qg=[n.face_count,n.edge_count,n.vertex_count]});var DA=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,BA=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Mo=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,cn=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,qs=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Lu=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,RA=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,GA=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,no=new Mu,Hi=class extends Kn(three__WEBPACK_IMPORTED_MODULE_0__.Tme){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof Jr&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof Jr&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"!==this.parameters.type||this.parameters.toObject.object||(t=0),"toObject"===this.parameters.type&&this.objectForSample){for(let i=0,s=this.children.length;i<s;++i)this.remove(this.children[0]);let o=this.children;if(o.length===t)return;if(o.length<t)for(let i1=0,s1=t-o.length;i1<s1;++i1){let a=new Jr(this.object);a.expand(),this.add(a)}else for(let i2=0,s2=o.length-t;i2<s2;++i2)this.remove(o[i2])}else{if(this.children.length===t)return;if(this.children.length<t)for(let o1=0,i3=t-this.children.length;o1<i3;++o1){let s3=new Jr(this.object);s3.expand(),this.add(s3)}else for(let o2=0,i4=this.children.length-t;o2<i4;++o2)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,o=t.start*three__WEBPACK_IMPORTED_MODULE_0__.M8C.DEG2RAD,s=o-t.end*three__WEBPACK_IMPORTED_MODULE_0__.M8C.DEG2RAD,a=new three__WEBPACK_IMPORTED_MODULE_0__.USm(t.rotation[0],t.rotation[1],t.rotation[2]),c;switch(t.axis){case"z":c=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,1);break;case"y":c=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0);break;default:c=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(1,0,0)}let u=e.randomnessObject??_r.defaultData([1,1,1]).randomnessObject,l="perlin"===u.noiseType;no.noiseSeed(u.seed);let d=ml((0,Ui.default)(u.seed)),p=Ws(u.strength,this.parameters.randomness);for(let[f,m]of this.children.entries()){let h=f*(u.freqScale/10)+u.movement,y=l?no.noise(h):d(h,h),g=f+1;m.scale.x=t.scale[0]+p(g,he(y,u.scale[0]))||1e-4,m.scale.y=t.scale[1]+p(g,he(y,u.scale[1]))||1e-4,m.scale.z=t.scale[2]+p(g,he(y,u.scale[2]))||1e-4,m.position.setScalar(0);let x=s/e.count*f-o;switch(t.axis){case"x":m.rotation.set(0,x,0);break;case"y":m.rotation.set(0,0,x);break;case"z":m.rotation.set(x,0,0)}m.translateOnAxis(c,t.radius),m.position.x+=t.position[0]+p(g,he(y,u.position[0])),m.position.y+=t.position[1]+p(g,he(y,u.position[1])),m.position.z+=t.position[2]+p(g,he(y,u.position[2]));let b=p(g,he(y,u.rotation[0])),w=p(g,he(y,u.rotation[1])),S=p(g,he(y,u.rotation[2]));!0===t.alignment?(m.rotation.x+=a.x+b,m.rotation.y+=a.y+w,m.rotation.z+=a.z+S):m.rotation.set(a.x+b,a.y+w,a.z+S)}}_updateLinear(e){if("linear"!==e.type)throw Error();let t=e.linear,o=new three__WEBPACK_IMPORTED_MODULE_0__.USm(t.rotation[0],t.rotation[1],t.rotation[2]),i=e.randomnessObject??_r.defaultData([1,1,1]).randomnessObject,s="perlin"===i.noiseType;no.noiseSeed(i.seed);let a=ml((0,Ui.default)(i.seed)),c=Ws(i.strength,this.parameters.randomness);for(let[u,l]of this.children.entries()){let d=u*(i.freqScale/10)+i.movement,p=s?no.noise(d):a(d,d),f=u+1,m=c(f,he(p,i.rotation[0])),h=c(f,he(p,i.rotation[1])),y=c(f,he(p,i.rotation[2]));l.scale.x=1+(t.scale[0]-1)*u+c(f,he(p,i.scale[0]))||1e-4,l.scale.y=1+(t.scale[1]-1)*u+c(f,he(p,i.scale[1]))||1e-4,l.scale.z=1+(t.scale[2]-1)*u+c(f,he(p,i.scale[2]))||1e-4,l.rotation.x=o.x*u+m,l.rotation.y=o.y*u+h,l.rotation.z=o.z*u+y,l.position.x=t.position[0]*u+c(f,he(p,i.position[0])),l.position.y=t.position[1]*u+c(f,he(p,i.position[1])),l.position.z=t.position[2]*u+c(f,he(p,i.position[2]))}}_updateGrid(e){let t=0,o=e.grid,i=e.randomnessObject??_r.defaultData([1,1,1]).randomnessObject,s=Ws(i.strength,this.parameters.randomness),a="perlin"===i.noiseType;no.noiseSeed(i.seed);let c=function(n=Math.random){let r=Th(n),e=new Float64Array(r).map(i=>td[i%12*3]),t=new Float64Array(r).map(i=>td[i%12*3+1]),o=new Float64Array(r).map(i=>td[i%12*3+2]);return function(s,a,c){let u,l,d,p,f=(s+a+c)*lP,m=ms(s+f),h=ms(a+f),y=ms(c+f),g=(m+h+y)*Tr,S=s-(m-g),P=a-(h-g),_=c-(y-g),v,N,T,C,O,A;S>=P?P>=_?(v=1,N=0,T=0,C=1,O=1,A=0):S>=_?(v=1,N=0,T=0,C=1,O=0,A=1):(v=0,N=0,T=1,C=1,O=0,A=1):P<_?(v=0,N=0,T=1,C=0,O=1,A=1):S<_?(v=0,N=1,T=0,C=0,O=1,A=1):(v=0,N=1,T=0,C=1,O=1,A=0);let R=S-v+Tr,U=P-N+Tr,$=_-T+Tr,ee=S-C+2*Tr,X=P-O+2*Tr,q=_-A+2*Tr,H=S-1+3*Tr,V=P-1+3*Tr,G=_-1+3*Tr,D=255&m,L=255&h,B=255&y,K=.6-S*S-P*P-_*_;if(K<0)u=0;else{let M=D+r[L+r[B]];K*=K,u=K*K*(e[M]*S+t[M]*P+o[M]*_)}let W=.6-R*R-U*U-$*$;if(W<0)l=0;else{let M1=D+v+r[L+N+r[B+T]];W*=W,l=W*W*(e[M1]*R+t[M1]*U+o[M1]*$)}let j=.6-ee*ee-X*X-q*q;if(j<0)d=0;else{let M2=D+C+r[L+O+r[B+A]];j*=j,d=j*j*(e[M2]*ee+t[M2]*X+o[M2]*q)}let F=.6-H*H-V*V-G*G;if(F<0)p=0;else{let M3=D+1+r[L+1+r[B+1]];F*=F,p=F*F*(e[M3]*H+t[M3]*V+o[M3]*G)}return 32*(u+l+d+p)}}((0,Ui.default)(i.seed));if(!0===o.useCenter){let u={x:o.count[0]%2==0?2:1,y:o.count[1]%2==0?2:1,z:o.count[2]%2==0?2:1},l=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(o.size[0]*(o.count[0]-u.x)*.5,o.size[1]*(o.count[1]-u.y)*.5,o.size[2]*(o.count[2]-u.z)*.5);for(let d=0;d<o.count[0];d++)for(let p=0;p<o.count[1];p++)for(let f=0;f<o.count[2];f++){let m=[(d+1)*(i.freqScale/10)+i.movement,(p+1)*(i.freqScale/10)+i.movement,(f+1)*(i.freqScale/10)+i.movement],h=a?no.noise(...m):c(...m),y=this.children[t++];y.scale.x=1+s(t,he(h,i.scale[0]))||1e-4,y.scale.y=1+s(t,he(h,i.scale[1]))||1e-4,y.scale.z=1+s(t,he(h,i.scale[2]))||1e-4;let g=s(t,he(h,i.rotation[0])),x=s(t,he(h,i.rotation[1])),b=s(t,he(h,i.rotation[2]));y.rotation.set(g,x,b),y.position.x=o.size[0]*d-l.x+s(t,he(h,i.position[0])),y.position.y=o.size[1]*p-l.y+s(t,he(h,i.position[1])),y.position.z=o.size[2]*f-l.z+s(t,he(h,i.position[2]))}}else for(let u1=0;u1<o.count[0];u1++)for(let l1=0;l1<o.count[1];l1++)for(let d1=0;d1<o.count[2];d1++){let p1=[(u1+1)*(i.freqScale/10)+i.movement,(l1+1)*(i.freqScale/10)+i.movement,(d1+1)*(i.freqScale/10)+i.movement],f1=a?no.noise(...p1):c(...p1),m1=this.children[t++];m1.scale.x=1+s(t,he(f1,i.scale[0]))||1e-4,m1.scale.y=1+s(t,he(f1,i.scale[1]))||1e-4,m1.scale.z=1+s(t,he(f1,i.scale[2]))||1e-4;let h1=s(t,he(f1,i.rotation[0])),y1=s(t,he(f1,i.rotation[1])),g1=s(t,he(f1,i.rotation[2]));m1.rotation.set(h1,y1,g1),m1.position.x=o.size[0]*u1+s(t,he(f1,i.position[0])),m1.position.y=-o.size[1]*l1+s(t,he(f1,i.position[1])),m1.position.z=-o.size[2]*d1+s(t,he(f1,i.position[2]))}}_updateToObject(e){if("toObject"!==e.type)throw Error();let{toObject:t}=e,o=new three__WEBPACK_IMPORTED_MODULE_0__.USm(t.rotation[0],t.rotation[1],t.rotation[2]),i=e.randomnessObject??_r.defaultData([1,1,1]).randomnessObject,s="perlin"===i.noiseType;no.noiseSeed(i.seed);let a=ml((0,Ui.default)(i.seed)),c=Ws(i.strength,this.parameters.randomness);if(!t.object){for(let[,g]of this.children.entries())g.position.set(0,0,0),g.scale.setScalar(1),g.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof ki){if(this.objectForSample.font?.isLoaded&&void 0!==this.objectForSample.geometry.attributes.position)this._pendingMediaLoad=!1;else{this._pendingMediaLoad=!0;return}}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let u=this.getSubdivData(),l=[],d=g=>{let x=g.length;return[g.map(P=>P[0]).reduce((P,_)=>P+_,0)/x,g.map(P=>P[1]).reduce((P,_)=>P+_,0)/x,g.map(P=>P[2]).reduce((P,_)=>P+_,0)/x]},p=g=>Math.round(1e6*g)/1e6;u.forEach(g=>{let x=u.filter(b=>p(g.pos[0])===p(b.pos[0])&&p(g.pos[1])===p(b.pos[1])&&p(g.pos[2])===p(b.pos[2]));x.length>1?l.push({pos:g.pos,norm:d(x.map(b=>b.norm))}):l.push(g)});let f=function(n){let r=[],e={};for(var t=0,o=n.length;t<o;t++){var i=JSON.stringify(n[t].pos.map(s=>Math.round(1e4*s)/1e4));e[i]||(r.push(n[t]),e[i]=!0)}return r}(l);if(u.length>0){let g1=Math.round(f.length*t.count/100);this._updateCount(g1)}this.objectForSample.updateMatrixWorld();let m=new hl(this.objectForSample).build(),h=Gg[t.axis],y=this.children;for(let[g2,x]of(m.setRandomGenerator((0,Ui.default)(this.object.uuid+t.seed)),y.entries())){let b=g2*(i.freqScale/10)+i.movement,w=s?no.noise(b):a(b,b),S=g2+1,P=c(S,he(w,i.rotation[0])),_=c(S,he(w,i.rotation[1])),v=c(S,he(w,i.rotation[2]));"random"===t.spreadType?m.sample(qs,Lu):(f.length&&(qs.fromArray(f[g2].pos),Lu.fromArray(f[g2].norm)),this.objectForSample instanceof sn&&qs.applyMatrix4(DA.copy(this.objectForSample.matrixWorld).invert())),qs.applyMatrix4(this.object.hiddenMatrix.clone().invert()),x.position.copy(qs),Mo.fromArray(h);let N="normal"===t.align?Lu:this.object.getWorldDirection(GA),T=cn.fromArray(t.position);cn.x+=cn.x+c(S,he(w,i.position[0])),cn.y+=cn.y+c(S,he(w,i.position[1])),cn.z+=cn.z+c(S,he(w,i.position[2]));let C=Math.acos(N.dot(Mo)),O=RA.crossVectors(Mo,N).normalize(),A=BA.makeRotationAxis(O,C),R=N.clone().cross(this.object.up).normalize(),U=R.clone().cross(N).normalize(),$=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().makeBasis(R,N,U),ee=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(Mo.y,Mo.z,Mo.x).normalize(),X=ee.clone().cross(Mo).normalize(),q=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().makeBasis(ee,Mo,X).invert(),H=new three__WEBPACK_IMPORTED_MODULE_0__.yGw().multiplyMatrices($,q);x.rotation.setFromRotationMatrix(H),T.applyMatrix4(A),x.position.add(T),x.rotation.x=x.rotation.x+o.x+P,x.rotation.y=x.rotation.y+o.y+_,x.rotation.z=x.rotation.z+o.z+v,x.scale.setScalar(1),x.scale.x=x.scale.x+t.scale[0]+c(S,he(w,i.scale[0]))||1e-4,x.scale.y=x.scale.y+t.scale[1]+c(S,he(w,i.scale[1]))||1e-4,x.scale.z=x.scale.z+t.scale[2]+c(S,he(w,i.scale[2]))||1e-4,x.scale.multiply(this.object.scale),x.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if("random"===e)return[];if(!(this.objectForSample instanceof sn))return(this.objectForSample.geometry.index?function(n){let r=[];for(let e=0;e<=n.index.count;e++)if(rc.fromArray(n.index.array,3*e),Zt.setFromAttributeAndIndices(n.attributes.position,rc.x,rc.y,rc.z),Zt.getNormal(oc),Zt.getMidpoint(an),!(isNaN(an.x)||isNaN(an.y)||isNaN(an.z))){let{a:t,b:o,c:i}=Zt,s=t.toArray(),a=o.toArray(),c=i.toArray(),u=t.distanceTo(o),l=o.distanceTo(i),d=i.distanceTo(t),p=Fi(s,a),f=Fi(a,c),m=Fi(c,s),h=[u,l,d],y=Math.max(...h),g=h.filter(w=>Math.round(w)===Math.round(y)).length>1,x=[],b=Zt.getMidpoint(an).toArray();y!==u||g||(x=[f,m,m],b=p),y!==l||g||(x=[p,m,m],b=f),y!==d||g||(x=[p,f,f],b=m),g&&(x=[p,f,m]),r.push({vertices:[s,a,c],faceCenters:x,midpoint:b,norm:Zt.getNormal(oc).toArray()})}return r}(this.objectForSample.geometry):function(n){let r=[],{position:e}=n.attributes;for(let t=0;t<e.count;t++){Zt.setFromAttributeAndIndices(e,3*t,3*t+1,3*t+2),Zt.getNormal(oc),Zt.getMidpoint(an);let o=Zt.a.toArray(),i=Zt.b.toArray(),s=Zt.c.toArray();r.push({vertices:[o,i,s],faceCenters:[Fi(o,i),Fi(i,s),Fi(s,o)],midpoint:an.toArray(),norm:oc.toArray()})}return r}(this.objectForSample.geometry)).map((o,i)=>"polygon_center"===e?{pos:o.midpoint,norm:o.norm}:"vertex"===e?[{pos:o.vertices[0],norm:o.norm},{pos:o.vertices[1],norm:o.norm},{pos:o.vertices[2],norm:o.norm}]:"edge"===e?[{pos:o.faceCenters[0],norm:o.norm},{pos:o.faceCenters[1],norm:o.norm},{pos:o.faceCenters[2],norm:o.norm}]:[]).flat();{let t=this.objectForSample,o=Vg[e],i=Qg[o],s=Kg[o],a=Zg[o],c=[],u=i(t.subdivPointerNew);for(let l=0;l<=u-1;l++){let d=s(t.subdivPointerNew,l),p=a(t.subdivPointerNew,l);Yg.fromArray(d).applyMatrix4(t.matrixWorld),Xg.fromArray(p),c.push({pos:Yg.toArray(),norm:Xg.toArray()})}return c}}updateState(e,t){if(this.parameters=qr(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let o=t.find(this.parameters.toObject.object);o instanceof pt?this.objectForSample=o:this.objectForSample=void 0,this.matrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.hiddenMatrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,o&&o.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Gr=n=>{var r;return(r=class extends n{}).geometryHelper=new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(30,30,30),r},nc=new three__WEBPACK_IMPORTED_MODULE_0__.zHn,Du=new three__WEBPACK_IMPORTED_MODULE_0__.aLr,Jg=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Vr=(n,r,e,t,o=!1)=>{let s=n.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),Du.copy(r.boundingSphere),Du.applyMatrix4(s),!1===e.ray.intersectsSphere(Du)||(Jg.copy(s).invert(),nc.copy(e.ray).applyMatrix4(Jg),null!==r.boundingBox&&!1===nc.intersectsBox(r.boundingBox)))return;let a,d=r.index,p=r.attributes.position,f=r.drawRange,m;if(!1===o){let g=Math.max(0,f.start),x=Math.min(d.count,f.start+f.count);for(m=g;m<x;m+=3)if(a=function(g,x,b,w,S,P,_){let v=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,N=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,T=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,C=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,O=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;if(v.fromBufferAttribute(w,S),N.fromBufferAttribute(w,P),T.fromBufferAttribute(w,_),null===b.intersectTriangle(v,N,T,!1,C))return null;O.copy(C),O.applyMatrix4(g.matrixWorld);let R=x.ray.origin.distanceTo(O);return R<x.near||R>x.far?null:{faceIndex:1,distance:R,point:O.clone(),object:g}}(n,e,nc,p,d.getX(m),d.getX(m+1),d.getX(m+2))){a.faceIndex=Math.floor(m/3),t.push(a);return}}else{let x1=r.attributes.position,b=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,w=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,S=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,P=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,N=1/((n.scale.x+n.scale.y+n.scale.z)/3),T=N*N,C=Math.max(0,f.start),O=Math.min(x1.count,f.start+f.count);for(let A=C,R=O-1;A<R;A+=2){if(b.fromBufferAttribute(x1,A),w.fromBufferAttribute(x1,A+1),nc.distanceSqToSegment(b,w,P,S)>T)continue;P.applyMatrix4(n.matrixWorld);let $=e.ray.origin.distanceTo(P);$<e.near||$>e.far||t.push({distance:$,point:S.clone().applyMatrix4(n.matrixWorld),object:n})}}},ic=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Qt=new three__WEBPACK_IMPORTED_MODULE_0__.V1s,Ru=class extends three__WEBPACK_IMPORTED_MODULE_0__.ejS{constructor(e){let t=new three__WEBPACK_IMPORTED_MODULE_0__.u9r,o=new three__WEBPACK_IMPORTED_MODULE_0__.nls({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={},c=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(15711266),u=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(15711266),l=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(2857471);function d(f,m,h){p(f,h),p(m,h)}function p(f,m){i.push(0,0,0),s.push(m.r,m.g,m.b),void 0===a[f]&&(a[f]=[]),a[f].push(i.length/3-1)}d("n1","n2",c),d("n2","n4",c),d("n4","n3",c),d("n3","n1",c),d("f1","f2",c),d("f2","f4",c),d("f4","f3",c),d("f3","f1",c),d("n1","f1",c),d("n2","f2",c),d("n3","f3",c),d("n4","f4",c),d("p","n1",u),d("p","n2",u),d("p","n3",u),d("p","n4",u),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),t.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(i,3)),t.setAttribute("color",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(s,3)),super(t,o),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){let e=this.geometry,t=this.pointMap;Qt.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001],fr("n1",t,e,Qt,-1,-1,.8),fr("n2",t,e,Qt,1,-1,.8),fr("n3",t,e,Qt,-1,1,.8),fr("n4",t,e,Qt,1,1,.8),fr("f1",t,e,Qt,-1,-1,.8),fr("f2",t,e,Qt,1,-1,.8),fr("f3",t,e,Qt,-1,1,.8),fr("f4",t,e,Qt,1,1,.8),fr("u1",t,e,Qt,.35,1.1,.8),fr("u2",t,e,Qt,-.35,1.1,.8),fr("u3",t,e,Qt,0,1.55,.8),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function fr(n,r,e,t,o,i,s){ic.set(o,i,s).unproject(t);let a=r[n];if(void 0!==a){let c=e.getAttribute("position");for(let u=0,l=a.length;u<l;u++)c.setXYZ(a[u],ic.x,ic.y,ic.z)}}var sc=class extends Gr(Ru){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Vr(this.object,this.geometry,e,t,!0)}};(ac||(ac={})).is=e=>"objectHelper"in e;var zr=(n,r)=>class extends Jn(n){constructor(){super(...arguments),this.objectHelper=new r(this),this.gizmos={}}get geometryHelper(){return r.geometryHelper}raycast(o,i){this.objectHelper.raycast(o,i)}showGizmos(){for(let o in this.gizmos){let i=this.gizmos[o];i instanceof three__WEBPACK_IMPORTED_MODULE_0__.GQ&&(i.visible=!0)}}updateEntityBoxSize(o,i){this.objectHelper.visible&&this.geometryHelper instanceof three__WEBPACK_IMPORTED_MODULE_0__.DvJ?(o.setScalar(0),i.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(o,i)}hideGizmos(){for(let o in this.gizmos){let i=this.gizmos[o];i instanceof three__WEBPACK_IMPORTED_MODULE_0__.GQ&&(i.visible=!1)}}},Wi=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Gu=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Vu=new three__WEBPACK_IMPORTED_MODULE_0__._fP,zu=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,$s=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,ju=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,Eo=class extends zr(three__WEBPACK_IMPORTED_MODULE_0__.V1s,sc){constructor(e="",t={...Uo.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=bo.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let o=this.width,i=this.height;this.orthoCamera=new three__WEBPACK_IMPORTED_MODULE_0__.iKG(-.5*o,.5*o,.5*i,-.5*i,-5e4,1e4),this.perspCamera=new three__WEBPACK_IMPORTED_MODULE_0__.cPb(45,o/i,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,o){"number"==typeof e&&(e=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(e,t,o)),super.lookAt(e),this.getWorldPosition(Wi),this.targetOffset=Wi.distanceTo(e)}getTarget(e=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4){return this.getWorldDirection(Gu),this.getWorldPosition(Wi),Gu.multiplyScalar(this.targetOffset),e.copy(Wi).add(Gu),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Wi),Wi.distanceTo(e)}updateUp(){this.getWorldQuaternion(Vu),zu.set(0,0,1).applyQuaternion(Vu),$s.copy(three__WEBPACK_IMPORTED_MODULE_0__.Tme.DEFAULT_UP),this.isUpVectorFlipped&&$s.negate(),$s.applyQuaternion(Vu),ju.copy(three__WEBPACK_IMPORTED_MODULE_0__.Tme.DEFAULT_UP).projectOnPlane(zu),this.angleOffsetFromUp=ju.angleTo($s),this.angleOffsetFromUp*=ju.cross($s).dot(zu)>=0?1:-1}updateTransformState(e){let t=super.updateTransformState(e);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}getViewFrontToObject(e){let t=e.getWorldPosition(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),i=e.getWorldDirection(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let o=this.getWorldDirection(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4).multiplyScalar(this.targetOffset);return{position:e.clone().sub(o),target:e}}getViewToObject(e){let t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,o=!1){if(this.aspect=e/t,o){let i=e>t?this.aspect:1,s=e>t?1:this.aspect;this.left=-395*i,this.right=395*i,this.top=395*(1/s),this.bottom=-395*(1/s)}else this.left=-(.5*e),this.right=.5*e,this.top=.5*t,this.bottom=-(.5*t);this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,o,i,s,a){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,o,i,s,a):this.orthoCamera.setViewOffset(e,t,o,i,s,a)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){return k1({type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped},e)}updateCameraSubtype(e,t){let o="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(o,t.zoom),void 0!==t.near&&this.setNear(o,t.near),void 0!==t.fov&&"PerspectiveCamera"===o&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,o){super.updateByPatchedOp(e,t,o),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},qi=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,tC=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,Jt=class extends Bt{constructor(e,t,o){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new three__WEBPACK_IMPORTED_MODULE_0__.u9r,this.onAfterRender=(e,t,o,i,s,a)=>{super.onAfterRender(e,t,o,i,s,a),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,o){super.updateByPatchedOp(e,t,o),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){if(-1!==this.booleanMeshSetAddress&&!e)return;for(let i=0;i<this.children.length;i++){let s=this.children[i];s instanceof Jt&&!0===s.dataPatched.visible&&s.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let i1=0;i1<this.children.length;i1++){let s1=this.children[i1];if(s1 instanceof pt&&!0===s1.dataPatched.visible&&s1.geometry.attributes.position?.count>0&&s1.geometry.drawRange.count>0){if(qi.multiplyMatrices(s1.hiddenMatrix,s1.matrix),-1===s1.booleanMeshSetAddress){if((s1.geometry.index??s1.geometry.getAttribute("position")).count/3<15e5&&(s1.booleanMeshSetAddress=Yt.getMeshSet(s1.geometry,!0===e,t)),-1===s1.booleanMeshSetAddress)return;Yt.transformMeshSet(s1.booleanMeshSetAddress,qi),s1.booleanMatrixInvOld.copy(qi).invert(),s1.booleanWasTransformed=!1}else s1 instanceof Jt&&!0===s1.needsTransformForDownstream?(Yt.transformMeshSet(s1.booleanMeshSetAddress,qi),s1.needsTransformForDownstream=!1):!0===s1.booleanWasTransformed&&(Yt.transformMeshSet(s1.booleanMeshSetAddress,tC.multiplyMatrices(qi,s1.booleanMatrixInvOld)),s1.booleanMatrixInvOld.copy(qi).invert(),s1.booleanWasTransformed=!1);!1===Yt.hasOpenEdges(s1.booleanMeshSetAddress)||i1===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(s1.booleanMeshSetAddress),s1.geometry.userData.wasFilteredFromBoolean=!1):s1.geometry.userData.wasFilteredFromBoolean=!0}}if(0===this.meshSetAddresses.length){this.geometry.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l([],0)),this.geometry.setDrawRange(0,0);return}if(!0===e)return Yt.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let o=this.geometry;o.dispose(),this.geometry=new three__WEBPACK_IMPORTED_MODULE_0__.u9r,this.geometry.userData=o.userData,this.geometry.boundingSphere=o.boundingSphere;try{this.booleanMeshSetAddress=Yt.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(i2){this.booleanMeshSetAddress=0,console.error(i2)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,zi(this),ji(this)}dispose(){super.dispose(),this.geometry.dispose()}};(i0||(i0={})).is=function(e){return Se.is(e)&&e instanceof three__WEBPACK_IMPORTED_MODULE_0__._kC};var $i=(n,r)=>class extends zr(n,r){updateState_Light(t,o){this.updateState_Entity(t,o),void 0!==t.color&&(this.color=o.shared.color(t.color)),void 0!==t.intensity&&(this.intensity=t.intensity),void 0!==t.depth&&(this.shadow.camera.far=t.depth,this.shadow.needsUpdate=!0),void 0!==t.shadows&&(this.castShadow=t.shadows)}},Lo=n=>n instanceof pt,Ys=n=>null!==n&&n instanceof Jt,Xs=n=>ac.is(n),jr=class extends Gr(three__WEBPACK_IMPORTED_MODULE_0__.y8_){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Vr(this.object,jr.geometryHelper,e,t)}update(){}},Ks=class extends zr(three__WEBPACK_IMPORTED_MODULE_0__.ZAu,jr){constructor(r,e){super(),this.super_Entity(r,e),this.objectHelper.update()}updateState(r,e){this.updateState_Entity(r,e)}},iC=n=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${n};
const int gShadowSamples = ${n};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,sC=three__WEBPACK_IMPORTED_MODULE_0__.WdD.lights_fragment_begin,aC=three__WEBPACK_IMPORTED_MODULE_0__.WdD.shadowmask_pars_fragment,s0=null,lC=n=>{switch(n){case"low":return 8;case"medium":default:return 16;case"high":return 32}},a0=(n="medium")=>{if(s0===n)return!1;s0=n;let r=lC(n);three__WEBPACK_IMPORTED_MODULE_0__.WdD.shadowmap_pars_fragment=iC(r);let e=sC.slice();e=(e=e.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]")).replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),three__WEBPACK_IMPORTED_MODULE_0__.WdD.lights_fragment_begin=e;let t=aC.slice();return t=t.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),three__WEBPACK_IMPORTED_MODULE_0__.WdD.shadowmask_pars_fragment=t,!0},Yi=class extends Gr(three__WEBPACK_IMPORTED_MODULE_0__.cBI){constructor(e,t=15,o=10066329){super(e,t,o),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Vr(this.object,Yi.geometryHelper,e,t)}},Xi=class extends Gr(three__WEBPACK_IMPORTED_MODULE_0__.xG9){constructor(e,t=15,o=6710886){super(e,t,o),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Vr(this.object,Xi.geometryHelper,e,t)}},cc=class extends Gr(three__WEBPACK_IMPORTED_MODULE_0__.FvO){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Vr(this.object,cc.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=cc._vector,t=this.object.distance?this.object.distance:1e3,o=t*Math.tan(this.object.angle);this.cone.scale.set(o,o,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let i=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let s=0,a=this.cone.material.length;s<a;s++)this.cone.material[s].color.set(i);else this.cone.material.color.set(i)}}},Qs=cc;Qs._vector=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;var Ki=class extends $i(three__WEBPACK_IMPORTED_MODULE_0__.Ox3,Yi){constructor(r,e,t){super(),this.super_Entity(r,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.top=1250,i.bottom=-1250,i.right=1250,i.left=-1250,i.near=-1e4,i.far=2500;let s=new three__WEBPACK_IMPORTED_MODULE_0__.Rki(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s}update(){for(let r in this.shadow.camera.updateProjectionMatrix(),this.gizmos){let e=this.gizmos[r];e instanceof three__WEBPACK_IMPORTED_MODULE_0__.Rki&&e.update()}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.objectHelper&&this.objectHelper.update()}updateState(r,e){var n,r1;this.updateState_Light(r,e);let t=void 0!==r.depth&&r.depth!==this.shadow.camera.far||void 0!==r.size&&r.size/2!==this.shadow.camera.right;void 0!==r.size&&(n=this,r1=r.size,n.shadow.camera.right=r1/2,n.shadow.camera.left=-r1/2,n.shadow.camera.top=r1/2,n.shadow.camera.bottom=-r1/2,n.shadow.needsUpdate=!0),void 0!==r.shadowRadius&&(this.shadow.radius=r.shadowRadius),void 0!==r.shadowResolution&&(this.shadow.mapSize.set(r.shadowResolution,r.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==r.penumbraSize&&e.scene.markPenumbraSizeDirty(),t&&this.update()}},d0=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,u0=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,p0=new three__WEBPACK_IMPORTED_MODULE_0__._fP,Zi=class extends $i(three__WEBPACK_IMPORTED_MODULE_0__.PMe,Qs){constructor(r,e,t){super(),this.super_Entity(r,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=2*three__WEBPACK_IMPORTED_MODULE_0__.M8C.RAD2DEG*this.angle,i.aspect=1,i.near=100,i.far=2500;let s=new three__WEBPACK_IMPORTED_MODULE_0__.Rki(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s,this.update()}update(){for(let r in this.shadow.camera.updateProjectionMatrix(),this.gizmos){let e=this.gizmos[r];e instanceof three__WEBPACK_IMPORTED_MODULE_0__.Rki&&e.update()}}updateMatrixWorld(r){super.updateMatrixWorld(r),u0.setFromMatrixPosition(this.matrixWorld),p0.setFromRotationMatrix(this.matrixWorld),d0.copy(this.up).applyQuaternion(p0).negate().multiplyScalar(this.distance),this.target.position.copy(u0).add(d0),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(r,e){this.updateState_Light(r,e),void 0!==r.distance&&(this.distance=r.distance),void 0!==r.decay&&(this.decay=r.decay),void 0!==r.angle&&(this.angle=r.angle),void 0!==r.penumbra&&(this.penumbra=r.penumbra),void 0!==r.shadowRadius&&(this.shadow.radius=r.shadowRadius),void 0!==r.penumbraSize&&e.scene.markPenumbraSizeDirty(),void 0!==r.shadowResolution&&(this.shadow.mapSize.set(r.shadowResolution,r.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Do=class extends Jn(three__WEBPACK_IMPORTED_MODULE_0__.xsS){constructor(e,t){super(),this.data=t,this.bgColor=new Je(1,1,1,1),this.fog=null,this.backupFog=new three__WEBPACK_IMPORTED_MODULE_0__.ybr(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new Eo(xo,{...Uo.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new three__WEBPACK_IMPORTED_MODULE_0__.vmT(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}updateVisible(){}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=ht(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.enabled&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Bt){if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()}})}updateShadow(e){void 0!==e.softShadowQuality&&this.isActive&&a0(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive&&(this.scene.fog=this.fog),this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=ht(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){void 0!==e.aoColor&&(this.aoColor=ht(e.aoColor,t))}updateByOp(e,t,o,i){super.updateByOp(e,t,o,i),yt(e.path,["fog"])?this.updateFog(t.fog,o.shared):yt(e.path,["ao"])?this.updateAo(t.ao,o.shared):yt(e.path,["ambient"])?this.updateAmbientLight(t.ambient,o.shared):yt(e.path,["shadow"])&&this.updateShadow(t.shadow)}updateState(e,t){this.updateState_Entity(e,t),void 0!==e.backgroundColor&&this.setBackgroundColor(ht(e.backgroundColor,t.shared)),void 0!==e.fog&&this.updateFog(e.fog,t.shared),void 0!==e.ambient&&this.updateAmbientLight(e.ambient,t.shared),void 0!==e.ao&&this.updateAo(e.ao,t.shared),void 0!==e.shadow&&this.updateShadow(e.shadow)}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=[,,,,,].fill(.5);let e=0,t=0;this.traverseEntity(o=>{if(!o.visible)return!0;o instanceof Ki&&o.visible&&e<3&&(this.penumbraSizeArrayCache[e]=o.data.penumbraSize,e+=1),o instanceof Zi&&o.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=o.data.penumbraSize,t+=1)})}raycastWithClones(e){let t=[],o=i=>{for(let s of i.children){let a=s.cloner;Se.is(s)&&(s.visible||a?.object.data.visible)&&((Lo(s)||Xs(s)&&this.scene.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),ea(s,e,t,!0)),o(s))}};return o(this),t}},uc=class extends $i(three__WEBPACK_IMPORTED_MODULE_0__.cek,Xi){constructor(r,e,t){super(),this.super_Entity(r,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=90,i.aspect=1,i.near=100,i.far=2500;let s=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),a=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z),c=new three__WEBPACK_IMPORTED_MODULE_0__.ZzF(s,a),u=new three__WEBPACK_IMPORTED_MODULE_0__.GQ(c,new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(16755200));u.visible=!1,this.gizmos.shadowmap=u,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let r in this.gizmos){let e=this.gizmos[r];if(e instanceof three__WEBPACK_IMPORTED_MODULE_0__.GQ){let t=this.shadow.camera,o=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-t.far+this.position.x,-t.far+this.position.y,-t.far+this.position.z),i=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(t.far+this.position.x,t.far+this.position.y,t.far+this.position.z);e.box.set(o,i),e.updateMatrixWorld(!0)}}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.objectHelper&&this.objectHelper.update()}updateState(r,e){this.updateState_Light(r,e),void 0!==r.distance&&(this.distance=r.distance),void 0!==r.decay&&(this.decay=r.decay),void 0!==r.shadowRadius&&(this.shadow.radius=r.shadowRadius),void 0!==r.shadowResolution&&(this.shadow.mapSize.set(r.shadowResolution,r.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},pc=class extends Xe{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(r,e){let t=this.geometry.getAttribute("position");void 0!==t?Es(t,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:t.count,r,e):super.updateEntityBoxSize(r,e)}},Qi=class extends Xe{constructor(e,t,o){super(e,t,o),this._shapeId=null,this._context=o}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){let e=this.data.geometry.extrusion.shape,t;if("Custom"===e.type){let i=e.shapeId;if(i!==this._shapeId&&this.detachShape(),i){this._shapeId=i;let s=this._context.scene.find(i);s?.data&&(s.attachedPaths.add(this),t=s.geometry.userData?.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let i1;switch(e.type){case"Rectangle":i1=Bl;break;case"Ellipse":i1=li;break;case"Polygon":i1=Dl;break;case"Star":i1=Rl;break;default:throw Error(`Unknown shape type: ${e.type}`)}t=i1.create({parameters:e}).userData.shape}let o=this.geometry;t&&o.inputs&&(o.inputs.shapeData=t,o.build(),this.attachedSurfaceCloners.forEach(i=>i.update()))}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e){return super.updateTransformState(e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let o=this.geometry.getAttribute("position");void 0!==o?Es(o,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:o.count,e,t):super.updateEntityBoxSize(e,t)}},so=class extends zr(three__WEBPACK_IMPORTED_MODULE_0__.ZAu,jr){constructor(e,t,o){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,o)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let o=t.scene.data.objects.get(e.component);if(!o)return{...gt.defaultData,...e};{let i,s;for(let a of Xr.rootOverrideProps)void 0===e[a]?(void 0===i&&(i={...e}),i[a]=o.data[a]):(void 0===s&&(s={}),s[a]=e[a],void 0===i&&(i={...e}),i[a]=xr.apply(o.data[a],e[a]));return this.overrideData=s,i}}updateByOp(e,t,o,i){let s;if(this.isInstanceRoot&&!i){if(t=this.transformAssignData(t,o),0===e.type&&0===e.path.length&&this.component)for(let a of Xr.rootOverrideProps)a in e.props&&void 0===e.props[a]&&(void 0===s&&(s={...e,props:{...e.props}}),s.props[a]=this.component.data[a]);else if(0===e.type&&e.path.length>0&&Xr.rootOverrideProps.includes(e.path[0])){let a1=e.path[0];void 0===s&&(s={...e,path:[],props:{[a1]:t[a1]}})}}super.updateByOp(s??e,t,o,i)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){let o=e.scene.find(t.component)??null,i=!1;if(o!==this.oldComponent){if(this.oldComponent){let s=0;for(let a of this.children)if(Se.is(a))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(a),fc(a),s+=1;else break;this.children.splice(0,s)}i=!0}if(o){let s1={};for(let a1 of(function y0(n,r,e,t,o,i,s,a,c){if(s>50)return!1;if(t.component!==o){if(t.component){let l=t.component.instances.indexOf(t);l>=0&&t.component.instances.splice(l,1)}o.instances.push(t),t.component=o}o instanceof so&&o.isInstanceRoot&&o.expandInstanceChildren(n);let u=0;for(let l1 of o.children)if(Se.is(l1)){let d=[...r,..."string"==typeof l1.identity?[l1.identity]:l1.identity],p=qn.resolve(e,d,1),f=null,m;if(!a){let h=t.children[u];if(null!==(f=Se.is(h)?h:null)){let y=h0(f,l1,p,d);m=y>=1?f.stateSelection:void 0,2!==y&&(f=null)}if(null===f&&null!==(f=n.scene.findInstance(d)??null)){let y1=h0(f,l1,p,d);if(m=y1>=1?f.stateSelection:void 0,2!==y1)f=null;else{let g=f.parent.children.indexOf(f);f.parent.children.splice(g,1),t.children.splice(u,0,f),f.parent===t?g<=u&&console.error("not possible"):(f.parent=t,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),n.pendingDeletes.delete(f))}}}if(null===f){let h1=p?xr.apply(l1.data,p):l1.data;tr.is(h1.type)&&(h1={...h1,type:"Empty"}),(f=or.createEntity(d,h1,n)).overrideData=p,t.add(f),t.children.splice(t.children.length-1,1),t.children.splice(u,0,f),f.updateState(f.data,n),m&&f.changeSelectedState(m,n),n.scene.registerInstanceAndSetUuid(f)}f.isBone&&(c[f.identity[f.identity.length-1]]=f.uuid),u+=1,y0(n,r,e,f,l1,i,s+1,a,c)}if(!a){let l2=u;for(;;){let d1=t.children[u];if(Se.is(d1))n.pendingDeletes.add(d1);else break;u+=1}t.children.splice(l2,u-l2)}return!0}(e,[this.uuid],t.overrides,this,o,o,0,i,s1),this.children))if(Se.is(a1)){let c=a1.data;"Empty"===c.type&&c.animations&&a1.traverseEntity(u=>{if(u instanceof Xe&&u.isSkinnedMesh){let l=u.dataPatched;if(l.bones&&l.boneInverses){let d=l.bones.map(m=>e.scene.find(s1[m])),p=l.boneInverses.map(m=>new three__WEBPACK_IMPORTED_MODULE_0__.yGw().fromArray(m)),f=new three__WEBPACK_IMPORTED_MODULE_0__.OdW(d,p);u.bind(f,u.bindMatrix)}}else u.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function fc(n){if(n.component){let r=n.component.instances.indexOf(n);for(let e of(r>=0&&n.component.instances.splice(r,1),n.children))Se.is(e)&&fc(e)}}function h0(n,r,e,t){return n.component===r&&rs(n.identity,t)?n.overrideData===e?2:1:0}var mc=class extends zr(three__WEBPACK_IMPORTED_MODULE_0__.N$j,jr){constructor(r,e){super(),this.super_Entity(r,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(r,e){this.updateState_Entity(r,e)}};function hc(n,r,e){return"Mesh"===r.type?"TextGeometry"===r.geometry.type?new ki(n,r,e):"SubdivGeometry"===r.geometry.type?new sn(n,r,e):"PathGeometry"===r.geometry.type?new Qi(n,r,e):"VectorGeometry"===r.geometry.type?new pc(n,r,e):"BooleanGeometry"===r.geometry.type?new Jt(n,r,e):new Xe(n,r,e):"Empty"===r.type?new Ks(n,r):"Bone"===r.type?new mc(n,r):"Page"===r.type?new Do(n,r):"PointLight"===r.type?new uc(n,r,e):"SpotLight"===r.type?new Zi(n,r,e):"DirectionalLight"===r.type?new Ki(n,r,e):"Component"===r.type||"Instance"===r.type?new so(n,r,e):tr.is(r.type)?new Eo(n,r):(console.error(r),new Ks(n,r))}function x0(n,r){let e=!1,t=r.getLayersOfType("transmission"),o=r.getLayersOfType("outline");return o.length>0&&(n.layers.set(8),t.length>0&&n.layers.enable(3),e=!0,ji(n),zi(n)),0===t.length&&0===o.length&&n.layers.set(0),n instanceof Bt&&n.needsAO&&n.layers.enable(5),e}function v0(n,r){if(!r.layers)return!1;let e=!1,t=r.getLayersOfType("transmission").filter(i=>i.data.visible),o=r.getLayersOfType("outline").filter(i=>i.data.visible);return t.length>0&&(n.layers.set(3),o.length>0&&n.layers.enable(8),e=!0),0===t.length&&0===o.length&&n.layers.set(0),n.needsAO&&n.layers.enable(5),e}or.createEntity=hc,or.changeEntityProptotype=function(n,r,e){let t=hc(n.identity,r,e),o=n.children,i=n.attachedPaths,s=n.parent,a=n.component,c=n.instances,u=n.overrideData,l=n.uuid,d=n.stateSelection;for(let p of(n.dispose(),Object.keys(n)))delete n[p];for(let p1 of(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.keys(t)))n[p1]=t[p1];n.children=[...n.children,...o],n.attachedPaths=i,n.parent=s,n.component=a,n.instances=c,n.uuid=l,n.overrideData=u,n.updateState(n.data,e),d&&n.changeSelectedState(d,e),n.resetBBoxNeedsUpdate()},or.Cloner=Hi;var RC=new three__WEBPACK_IMPORTED_MODULE_0__.iMs,GC=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,VC=new three__WEBPACK_IMPORTED_MODULE_0__.zHn;function ea(n,r,e,t=!1){let o=n.cloner;if(o)for(let i of o.children){let s=GC.copy(i.matrixWorld).invert(),a=VC.copy(r.ray).applyMatrix4(s),c=n.matrixWorld;a.applyMatrix4(c);let u=RC;u.set(a.origin,a.direction),u.near=r.near,u.far=r.far;let l=u.intersectObject(n,!1);l.length>0&&e.push({...l[0],object:t?i:n})}}var yc=class{constructor(){this._constraints=new Map}setConstraint(r,e){null===e?this._constraints.delete(r):this._constraints.set(r,e)}removeDependencies(r){this._constraints.delete(r)}applyConstraints(r){let e=new Set;this._constraints.forEach((t,o)=>{let i=[o,t],s=t;for(;this._constraints.has(s);)s=this._constraints.get(s),e.has(s)||i.push(s);for(let a=i.length-2;a>=0;a--)if(!e.has(i[a])){let c=r.find(i[a]);c?c.applyPathSnapping(r):console.warn(`missing entity ${i[a]}`),e.add(i[a])}})}findDependency(r,e){let t=r;for(;this._constraints.has(t);)if((t=this._constraints.get(t))===e)return!0;return!1}};(new three__WEBPACK_IMPORTED_MODULE_0__.vBJ).wireframe=!0;var w0=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,gc=class extends three__WEBPACK_IMPORTED_MODULE_0__.xsS{constructor(e,t){super(),this.data=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new yc,this.errorPage=new Do("fdasfa",{...Kr.defaultData,name:""}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){let r;return this.needsTransmissionDirty&&(this._needsTransmission=(r=!1,this.traverseEntity(e=>{if(e instanceof Bt){if(Array.isArray(e.material))for(let t=0;t<e.material.length;t++)v0(e,e.material[t])&&(r=!0);else v0(e,e.material)&&(r=!0)}}),r),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){let r;return this.needsNormalDirty&&(this._needsNormal=(r=!1,this.traverseEntity(e=>{if(e instanceof Bt){if(Array.isArray(e.material))for(let t=0;t<e.material.length;t++)x0(e,e.material[t])&&(r=!0);else x0(e,e.material)&&(r=!0)}}),r),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),o=this.entityIdentityToEntity[t];o&&(e.uuid=o.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof Do&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let o=[],i=t;for(;i!==this;){let s=i,a=(i=i.parent).children.indexOf(s);o.splice(0,0,a)}return{entity:t,sortKey:o}}getAllSorted(e){let t=[];for(let o of e){let i=this.getWithSortKey(o.id);void 0!==i&&t.push(i)}return t.sort((o,i)=>(function(n,r){let e=0;for(;e<n.length&&e<r.length;){if(n[e]<r[e])return -1;if(n[e]>r[e])return 1;e+=1}return e!==r.length?-1:e!==n.length?1:0})(o.sortKey,i.sortKey)),t.map(o=>o.entity)}nonExistOrDescendantOf(e,t){let o=this.find(e);if(void 0===o)return!0;for(;o;){if(o.uuid===t)return!0;o=o.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent&&("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===e||e===xo))return this.activePage.personalCamera;if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{e.cloner?.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let o=null===e.parent?this:this.find(e.parent);if(void 0===o)throw Error("unexpected");let i=this.createObject(e.id,e.data,e.children,o,e.localIndex,t);i.updateVisible(),i.resetBBoxNeedsUpdate(),Lo(i)&&Ys(i.parent)&&(i.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(o),this.markNeedsRecomputeInstancesForChildren(i),this.markToExpandCloner(i),this.markPenumbraSizeDirty()}else if(0===e.path.length&&8===e.type){let o1=this.find(e.id);if(void 0===o1)throw Error("unexpected");this.markToExpandCloner(o1),o1.resetBBoxNeedsUpdate(),this.unregisterObject(o1);let i1=o1.parent;this.markNeedsRecomputeInstancesForAncessors(i1),this.markNeedsRecomputeInstancesForChildren(o1),this.markPenumbraSizeDirty(),o1.parent.remove(o1),Ys(o1.parent)&&(o1.parent.invalidateUpstreamBooleanData(),o1.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Lo(o1)&&(o1.freeBooleanPointer(),i1 instanceof Jt&&i1.invalidateDownstreamBooleanData().recomputeBoolean()),o1 instanceof Qi&&o1.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(o1),this.pathConstraints.removeDependencies(o1.uuid)}else if(0===e.path.length&&9===e.type){let o2=this.find(e.id);if(void 0===o2)throw Error("unexpected");this.markNeedsRecomputeInstancesForChildren(o2);let i2=o2.parent;this.markNeedsRecomputeInstancesForAncessors(i2),o2.cloner?.resetOnMove(),this.markToExpandCloner(o2);let s=null===e.parent?this:this.find(e.parent);if(void 0===s)throw Error("unexpected");s.add(o2),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(o2),o2.invalidateClonerTransform(o2),o2.updateVisible(),o2.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),Lo(o2)&&(o2.invalidateUpstreamBooleanData(),Ys(o2.parent)?o2.parent.invalidateDownstreamBooleanData().recomputeBoolean():i2 instanceof Jt&&i2.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}updatePage(e){for(let t of(this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage,this.children))t instanceof Do&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)))}updateEntityByOp(e,t,o,i){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:a}=t.props;t={...t,props:a},this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let s=this.find(e);if(s)try{(function(n,r,e,t){n.updateByOp(r,e,t,!1)})(s,t,o,{scene:this,shared:i}),s instanceof Xe&&s.updateGeometryGroupsIfNeeded()}catch(a1){console.error(a1)}}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}init(e,t){this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(o=>{Ys(o)&&o.recomputeBoolean(),o instanceof Eo&&o.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{("Component"===t.data.type||"Instance"===t.data.type)&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Se.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Se.is(t)&&"Component"===t.data.type&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,o,i,s,a,c){if(e){let u=i.find(e);u&&u!==i&&s.forInstancesRec(l=>{l.data=jn(l.data,d=>{let p=d.events.data(c.id),f=l.goUp(a);if(f){let m=[...aa(f.identity),e].join("-"),h=this.entityIdentityToEntity[m];if(h){let y=h.uuid;vt.zoom(p,t)[o]=y}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,o,i,s,a){e.forEach(c=>{"Transition"===c.data.type?this.relativeizeInner(c.data.object,[...t,c.id],"object",o,i,s,a):"Animation"===c.data.type&&this.relativeizeInner(c.data.object,[...t,c.id],"object",o,i,s,a)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof so&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity((t,o)=>{t.data.events.forEach(i=>{if("GameControl"===i.data.type){let s=!1;if(t.forInstancesRec(a=>{a.data=jn(a.data,c=>{a.isInstanceRoot||(c.events.delete(i.id),s=!0)}).data}),!1===s)for(let a of ul.list)this.rewriteActions(i.data.gameActions[a],["gameActions",a],e,t,o,i)}else"Conditional"===i.data.type?("Distance"===i.data.condition.type?(this.relativeizeInner(i.data.condition.fromObject,["condition"],"fromObject",e,t,o,i),this.relativeizeInner(i.data.condition.toObject,["condition"],"toObject",e,t,o,i)):"State"===i.data.condition.type?this.relativeizeInner(i.data.condition.object,["condition"],"object",e,t,o,i):"Comparison"===i.data.condition.type&&("Property"===i.data.condition.lOperand.type&&this.relativeizeInner(i.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,o,i),"Property"===i.data.condition.rOperand.type&&this.relativeizeInner(i.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,o,i)),this.rewriteActions(i.data.inActions,["inActions"],e,t,o,i),this.rewriteActions(i.data.outActions,["outActions"],e,t,o,i)):"actions"in i.data&&this.rewriteActions(i.data.actions,["actions"],e,t,o,i)})}),!0})}expandInstances(e,t,o){let i=new Set;for(let s of(this.traverseEntity(s=>{if(s instanceof so&&s.isInstanceRoot)return s.expandInstanceChildren({scene:this,shared:e,pendingDeletes:i}),t||s.resetBBoxNeedsUpdate(),o&&s.traverseEntity(a=>{o.addClip(a)}),!0}),i))this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),fc(s)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(o=>{o instanceof so&&o.isInstanceRoot&&(o.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let o="string"==typeof t.identity?t.identity:t.identity.join("-");this.entityIdentityToEntity[o]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[o]),t.dispose()})}clearScene(){for(let e of this.children)Se.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let o=[],i=s=>{for(let a of s.children){let c=a.cloner;if(Se.is(a)&&!a.raycastLock&&(a.visible||c?.object.data.visible)){if(!0===t&&a.isInstanceRoot){let u=[];if(e.intersectObject(a,!0,u),u.length){let l=u[0];l.object=a,l.point.applyMatrix4(l.object.matrixWorld);let d=a.matrixWorld.clone().invert();l.point.applyMatrix4(d),o.push(l)}}else(Lo(a)||Xs(a)&&this.enableHelpers&&a.objectHelper.visible)&&(e.intersectObject(a,!1,o),ea(a,e,o)),i(a)}}};return i(this),o}raycastWithClones(e){let t=[],o=i=>{for(let s of i.children){let a=s.cloner;Se.is(s)&&(s.visible||a?.object.data.visible)&&((Lo(s)||Xs(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),ea(s,e,t,!0)),o(s))}};return o(this),t}forEachEntity(e){for(let t of this.children)Se.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Se.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Se.is(t)&&t.traverseEntity(e)}traverseObject(e){for(let t of this.children)Xn.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Se.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,o){let i=0;for(let s of e)this.createObject(s.id,s.data,s.children,t,i,o),i+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){for(let t of(delete this.entityByUuid[e.uuid],e.children))this.unregisterObject(t)}createObject(e,t,o,i,s,a){let c={scene:this,shared:a},u=hc(e,t,c);return u&&(this.entityByUuid[e]=u,i.add(u),i.children.splice(s,0,i.children.pop()),o.length>0&&(u.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(o,u,a)),u.updateState(t,c),u instanceof Xe&&u.updateGeometryGroupsIfNeeded(),u.updateVisible(),u.cloner&&this.toExpandCloner.add(u),t.pathSnapping?.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),"Empty"===t.type&&t.animations&&u.traverseEntity(l=>{if(l instanceof Xe&&l.isSkinnedMesh){let d=l.dataPatched;if(d.bones&&d.boneInverses){let p=d.bones.map(h=>this.find(h)),f=d.boneInverses.map(h=>new three__WEBPACK_IMPORTED_MODULE_0__.yGw().fromArray(h)),m=new three__WEBPACK_IMPORTED_MODULE_0__.OdW(p,f);l.bind(m,l.bindMatrix)}}else l.matrixAutoUpdate=!0}),u}getCenter(e){let t=[];for(let i=0,s=e.length;i<s;++i){let{id:a,recursive:c}=e[i],u=this.find(a),l=c?u.recursiveBBox:u.singleBBox;t.push(...l.vertices)}let o=new three__WEBPACK_IMPORTED_MODULE_0__.ZzF;return o.setFromPoints(t),o.getCenter(w0),w0}copyMatrixWorld(e,t){if(null===e){t.identity();return}let o=this.find(e);o?t.copy(o.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){if(null===e){t.identity();return}let o=this.find(e)?.parent;o?t.copy(o.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof pt){if(Array.isArray(t.material))for(let o=0;o<t.material.length;o++)t.material[o]instanceof Dt&&e(t.material[o]);else t.material instanceof Dt&&e(t.material)}})}updateCanvasSize(e,t,o=!1){this.activeCamera.setViewplaneSize(e,t,o)}};async function YC(n){if(Bo){let r={attributeIDs:Bo.defaultAttributeIDs,attributeTypes:Bo.defaultAttributeTypes,useUniqueIDs:!1},e;try{e=await Bo.decodeGeometry(new Int8Array(n).buffer,r)}catch(t){console.error(t)}if(e)return{index:e.index?{array:e.index.array}:void 0,attributes:Object.entries(e.attributes).map(([t,o])=>({name:t,itemSize:o.itemSize,array:o.array}))}}return null}async function _0(n,r){var n1;let r1,[e,t]=Mc(Xa.deserialize(new Uint8Array(n)));101!==(r1=(n1=e).schema??0)&&(console.warn("updating from ",r1,"to ",101),function(n,r){var n1,n2,n3,n4,n5,n6,n7;let r1,r2;if(r<1&&(Qr(n,lh),Zr(n,lh),n.schema=1),r<2&&(Object.assign(n.scene.publish,{orbitControls:{...$n.defaultData,...Ye(n.scene.publish.orbitControls)}}),n.schema=2),r<3&&(function(n){function r(e){if(e.layers){for(let t of Object.values(e.layers))if(t){for(let[o,i]of Object.entries(t))if((rh.includes(o)||"boolean"==typeof i)&&delete t[o],"texture"===o)for(let[s,a]of Object.entries(i))(oh.includes(s)||"boolean"==typeof a)&&delete i[s]}}}n.scene.objects.traverse((e,t)=>{t.states.forEach(o=>{o.material?r(o.material):o.materials&&o.materials.forEach(s=>{r(s)})})})}(n),n.schema=3),r<4&&(n.scene.publish.withBackground=!0,n.schema=4),r<5&&(n.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1},n.schema=5),r<6&&(function(n){n.scene.objects.traverse((r,e)=>{let t=e.cloner;t&&(t.radial.scale=t.radial.scale.map(o=>o+1),t.linear.scale=t.linear.scale.map(o=>o+1))})}(n),n.schema=6),r<7&&(function(n){n.scene.objects.traverse((r,e)=>{let t=e.geometry;t&&("DodecahedronGeometry"===t.type||"IcosahedronGeometry"===t.type)&&(t.detail=Math.round(t.detail))})}(n),n.schema=7),r<8&&(n.schema=8),r<9&&(dh(n),n.schema=9),r<10&&(function(n){n.scene.objects.traverse((r,e)=>{"Mesh"===e.type&&("BooleanGeometry"===e.geometry.type||"SubdivGeometry"===e.geometry.type)&&(e.geometry.phongAngle=35)})}(n),n.schema=10),r<11&&((n1=n).scene.environment.ambientLight.softShadows=!1,n1.scene.environment.ambientLight.softShadowQuality="low",n1.scene.objects.traverse((r,e)=>{("DirectionalLight"===e.type||"SpotLight"===e.type)&&(e.shadowResolution=1024,e.shadowRadius=1,e.depth=1e5)}),n1.shared.penumbraSize=[,,,,,].fill(.5),n.schema=11),r<12&&(dh(n),n.schema=12),r<13&&(n.shared.audios=er({},Me.prototype),n.schema=13),r<14&&(Object.entries(r1=n.shared.materials).forEach(([e,t])=>{t.layers||Object.assign(r1,{[e]:{name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]}})}),n.schema=14),r<15&&(Object.entries(Ye((n2=n).shared.images)).filter(t=>!1===t[1].asset).map(t=>t[0]).forEach(t=>{delete n2.shared.images[t]}),Object.entries(Ye(n2.shared.audios)).filter(t=>!1===t[1].asset).map(t=>t[0]).forEach(t=>{delete n2.shared.audios[t]}),n.schema=15),r<16&&(n.scene.publish.settings.web.preload=!1,n.schema=16),r<17&&(Qr(n,uh),Zr(n,uh),n.schema=17),r<18&&(Qr(n,ch),Zr(n,ch),n.schema=18),r<19&&(Object.assign(n.scene.publish.settings,{video:{...Pr.defaultData.settings.video,...Ye(n.scene.publish.settings.video)}}),n.schema=19),r<20&&(n.shared.fonts=er({},Me.prototype),r2=[],(n3=n).scene.objects.traverse((e,t)=>{if("TextFrame"===t.type){let i=It.defaultTwoLayerData("phong"),s="string"==typeof t.color?n3.shared.colors[t.color]:t.color;i.layers[1].data.color={r:s.r,g:s.g,b:s.b},i.layers[1].data.alpha=t.alpha;let a=t.font.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");void 0===n3.shared.fonts[a]&&(n3.shared.fonts[a]={name:a});let c={name:t.name,...gt.defaultData,...ko.defaultData,flatShading:!1,wireframe:!1,geometry:{...wo.defaultData("TextGeometry"),width:t.width,height:t.height,font:a,depth:0,horizontalAlign:t.horizontalAlign,verticalAlign:t.verticalAlign,fontSize:1.40625*t.fontSize,lineHeight:t.lineHeight/1.40625,letterSpacing:t.letterSpacing-1,text:t.text,textTransform:t.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:i,states:Ye(t.states),events:Ye(t.events),visible:t.visible,raycastLock:t.raycastLock,position:t.position,rotation:t.rotation,scale:t.scale,hiddenMatrix:t.hiddenMatrix},u=Ye(n3.scene.objects).parent(e);n3.scene.objects.insertAfter(u??null,e,[{id:e+"new",data:c,children:[]}]),r2.push(e)}}),r2.forEach(e=>{n3.scene.objects.delete(e)}),n.schema=20),r<21&&(function(n){let r={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};n.scene.objects.traverse((e,t)=>{t.events.forEach(o=>{if(r[Number(o.type)]){if(Object.assign(o,{type:r[Number(o.type)]}),"Audio"===o.type&&"audioEvent"in o&&(Object.assign(o,{playAudio:o.audioEvent}),delete o.audioEvent),"GameControl"===o.type)Object.assign(o,{gameActions:{idle:new me,move:new me,jump:new me}});else{let i=new me;Object.assign(o,{actions:i}),("MouseDown"===o.type||"MouseUp"===o.type||"KeyDown"===o.type||"KeyUp"===o.type)&&"url"in o&&i.push({fi:0,id:three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),data:{type:"Link",url:o.url,delay:0}}),"targets"in o&&(o.targets.forEach((s,a,c)=>{let l={easing:s.easing,duration:s.duration};6===s.easing?Object.assign(l,q1(s,"mass","stiffness","damping","velocity")):5===s.easing&&Object.assign(l,{control1:{...s.control1},control2:{...s.control2}});let d={repeat:s.repeat?-1:0,delay:s.delay,delayDirection:s.delayDirection,direction:s.cycle&&s.rewind?"pingpong-rewind":s.cycle?"pingpong":"normal"},p={state:s.state,...d,...l},f={allowSlerp:!0,type:"Transition",object:s.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new me({fi:0,id:three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),data:p})};i.push({fi:c,id:a,data:f})}),delete o.targets)}}})})}(n),function(n){n.scene.objects.traverse((r,e)=>{function t(o,i){let s=new me,a=[];if(e.events.forEach((c,u,l)=>{if("Audio"===c.type&&c.trigger===i){let d;a.push(u),"play"===c.interaction?d={...q1(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:("pause"===c.interaction||"stop"===c.interaction)&&(d={...q1(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&s.push({fi:l,id:u,data:d})}}),a.forEach(c=>e.events.delete(c)),s.length){let c=e.events.find(u=>u.type===o)?.data;c?"actions"in c&&c.actions.insertBefore(null,s):e.events.insertBefore(null,[{id:three__WEBPACK_IMPORTED_MODULE_0__.M8C.generateUUID(),data:{type:o,actions:s}}])}}t("Start","start"),t("MouseDown","mouseDown"),t("MouseUp","mouseUp"),t("KeyDown","keyDown"),t("KeyUp","keyUp")})}(n),n.schema=21),r<22&&(mh(n),n.schema=22),r<23&&(function(n){n.scene.objects.traverse((r,e)=>{"Mesh"===e.type&&"SubdivGeometry"===e.geometry.type&&(e.geometry.scaleBaked||(e.geometry.scaleBaked=[1,1,1]))})}(n),n.schema=23),r<24&&(function(n){n.scene.objects.traverse((r,e)=>{"Empty"!==e.type&&"Mesh"!==e.type||!e.cloner||e.cloner.randomnessObject||e.cloner.toObject||e.cloner.randomness||(e.cloner={...e.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}(n),n.schema=24),(r<25||void 0===n.shared.videos)&&(n.shared.videos=er({},Me.prototype),r<25&&(n.schema=25)),r<26&&(function(n){n.scene.objects.traverse((r,e)=>{let t=n.scene.objects.unproxy().parent(r);if(t){let o=Ye(n.scene.objects.data(t));o&&"Mesh"===o.type&&"BooleanGeometry"===o.geometry.type&&"Mesh"===e.type&&(e.visible=!0!==Ye(e).booleanExclude)}})}(n),n.schema=26),r<27&&(function(n){n.scene.objects.traverse((r,e)=>{"Mesh"===e.type&&("NonParametricGeometry"===e.geometry.type?void 0!==e.material&&delete e.material:void 0!==e.materials&&delete e.materials)})}(n),n.schema=27),r<28&&(mh(n),n.schema=28),r<29&&(function(n){function e(t){for(let o in Object.setPrototypeOf(t,Re.prototype),t){var t1;Object.setPrototypeOf(t1=t[o],Re.prototype),t1.texture&&Object.setPrototypeOf(t1.texture,Re.prototype)}}n.scene.objects.traverse((t,o)=>{o.states.forEach(i=>{let s=i;if(s.material){let a=Ye(s.material).layers;e(a),s.material.layers=a}if(s.materials)for(let a1=0;a1<s.materials.length;a1++){let c=s.materials[a1],u=Ye(c).layers;e(u),c.layers=u}})})}(n),n.schema=29),r<30&&(function(n){n.scene.objects.traverse((r,e)=>{"Mesh"!==e.type||"NonParametricGeometry"!==e.geometry.type||"material"in e||"materials"in e||(e.material=It.defaultTwoLayerData("phong"))})}(n),n.schema=30),r<31&&(void 0===(n4=n).scene.publish.orbitControls.autoZoom&&(n4.scene.publish.orbitControls.autoZoom=!1),n4.scene.objects.traverse((r,e)=>{("OrthographicCamera"===e.type||"PerspectiveCamera"===e.type)&&(void 0===e.orthographic.autoZoom&&(e.orthographic.autoZoom=!1),void 0===e.orthographic.autoZoomFrustumSize&&(e.orthographic.autoZoomFrustumSize=790))}),n.schema=31),r<33&&(function(n){n.scene.objects.traverse((r,e)=>{void 0===e.pathSnapping&&(e.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===e.pathSnapping.offset&&(e.pathSnapping.offset=0)})}(n),n.schema=33),r<34&&(void 0===(n5=n).scene.publish.mouseEventTarget&&(n5.scene.publish.mouseEventTarget="canvas"),void 0===n5.scene.publish.settings.web.hint&&(n5.scene.publish.settings.web.hint=!1),n.schema=34),r<35&&(function(n){let{video:r}=n.scene.publish.settings;"gif"===r.format&&r.fps>48&&(r.fps=15)}(n),n.schema=35),r<36&&(function(n){n.scene.objects.traverse((r,e)=>{e.events.forEach(t=>{"GameControl"===t.type&&(t.resetYPosition=Math.abs(t.resetYPosition-e.position[1]))})})}(n),n.schema=36),r<37&&(function(n){let r=n.scene.environment.usePhysics;n.scene.objects.traverse((e,t)=>{r&&null===t.physics?t.collision=!1:t.collision="visibility"})}(n),n.schema=37),r<38&&(Qr(n,ph),Zr(n,ph),n.schema=38),r<39&&(function(n){n.scene.objects.traverse((r,e)=>{e.events.forEach(t=>{"GameControl"===t.type&&(t.navmesh=pl.defaultDataThirdPerson.navmesh)})})}(n),n.schema=39),r<40&&((n6=n).scene.styles||(n6.scene.styles=_o.defaultData()),n.schema=40),r<41&&(void 0===(n7=n).scene.environment.ambientLight.occlusion&&(n7.scene.environment.ambientLight.occlusion=!1),void 0===n7.scene.environment.ambientLight.aoFullRes&&(n7.scene.environment.ambientLight.aoFullRes=!1),void 0===n7.scene.environment.ambientLight.radius&&(n7.scene.environment.ambientLight.radius=256),void 0===n7.scene.environment.ambientLight.bias&&(n7.scene.environment.ambientLight.bias=.5),void 0===n7.scene.environment.ambientLight.aoColor&&(n7.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Qr(n7,hh),Zr(n7,hh),n.schema=41),r<42&&(function(n){n.scene.objects.traverse((r,e)=>{e.events.forEach(t=>{"GameControl"===t.type&&Object.assign(t.gameActions,{run:new me})})})}(n),n.schema=42),r<43&&(function(n){n.scene.objects.traverse((r,e)=>{e.events.forEach(t=>{"GameControl"===t.type&&(t.keyAssignments=[...t.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}(n),n.schema=43),r<99){Qr(n,yh),Zr(n,yh),null===n.scene.publish.playCamera&&(n.scene.publish.playCamera=xo);let e=Ye(n.scene.objects),t=n.scene.objects;for(let s of(n.scene.publish.playPage=vo,t.insertBefore(null,null,[{id:vo,data:{...Kr.defaultData,backgroundColor:n.scene.backgroundColor,fog:n.scene.fog,postprocessing:n.scene.postprocessing,ao:q1(n.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:n.scene.publish.playCamera,gameControlObject:n.scene.publish.gameControlObject},shadow:q1(n.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...us.defaultData,...q1(n.scene.environment,"usePhysics","gravity")},camera:Ye(n.scene.ownerCamera)??Kr.defaultData.camera,name:"Scene"},children:[]}]),e))s.id!==cl.TRASH_CAN_ID&&t.move(vo,s.fi,s.id);let o=0,i=0;n.shared.penumbraSize&&n.scene.objects.traverse((s,a)=>{"DirectionalLight"===a.type?(a.penumbraSize=n.shared.penumbraSize[Math.min(o,2)],o+=1):"SpotLight"===a.type&&(a.penumbraSize=n.shared.penumbraSize[3+Math.min(i,1)],i+=1),(void 0===a.physics||null===a.physics)&&"Instance"!==a.type&&(a.physics={},Object.assign(a.physics,So.defaultData)),void 0!==a.physics&&(a.physics.enabled=a.collision??"visibility",delete a.collision)}),n.schema=99}}(n1,r1),r1<100&&(void 0===n1.scene.publish.joystickSizeAndXYOffset&&(n1.scene.publish.joystickSizeAndXYOffset=Pr.defaultData.joystickSizeAndXYOffset),n1.schema=100),r1<101&&(Qr(n1,xh),Zr(n1,xh),n1.schema=101));let o=[];for(let i of(e.scene.objects.traverse((i,s)=>{"Mesh"===s.type&&"NonParametricGeometry"===s.geometry.type&&void 0!==s.geometry.data.draco&&o.push(s)}),o.length&&await (Bo||(Bo=new three_examples_jsm_loaders_DRACOLoader_js__WEBPACK_IMPORTED_MODULE_2__._).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),Bo.decoderPending),o)){let s=await YC(Ye(i.geometry.data.draco));if(s){s.index&&(i.geometry.data.index={array:s.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let a={};s.attributes.forEach(({name:c,array:u,itemSize:l})=>{a[c]={array:u,itemSize:l,type:"Float32Array",normalized:!1}}),i.geometry.data.attributes=a,i.geometry.data.draco=void 0}}return r&&r(e),t.result().data}function M0(n){Object.values(n.shared.materials).forEach(r=>{ku(r)}),n.scene.objects.traverse((r,e)=>{"material"in e?ku(e.material):"materials"in e&&e.materials.forEach(t=>{ku(t)})})}function ku(n){if("string"==typeof n)return;let r=[];n.layers.forEach((e,t)=>{"outline"===e.type&&r.push(t)}),r.reverse().forEach(e=>{n.layers.delete(e)}),r.length&&console.warn("The Spline Loader currently does not support the outline layer.")}var R0=sa(L0(),1),B0="The SplineLoader only accepts .splinecode files that are generated from Spline export panel.",Uu=class extends three__WEBPACK_IMPORTED_MODULE_0__.aNw{load(r,e,t,o=console.error){let i=new three__WEBPACK_IMPORTED_MODULE_0__.hH6(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),r.endsWith(".spline")?console.warn(B0+" The .spline files are only meant to be used by the Editor."):r.endsWith(".splinecode")||console.warn(B0),i.load(r,async s=>{try{if("string"==typeof s)throw Error("The .spline file is not binary!");let a=await this.parse(s);e(a)}catch(a1){o(a1)}},t,o)}async parse(r){var n,n1,n2,n3,n4,n5;let r1,r2,r3,r4,r5,e,e1=await _0(r,M0);e1.version&&(0,R0.default)(e1.version,"0.9.400")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/loader to the latest version."),await Promise.all([(r1=!1,e1.scene.objects.traverse((e,t)=>{"Mesh"===t.type&&"SubdivGeometry"===t.geometry.type&&(r1=!0)}),r1&&function(){if(!zy)return Gl||(Gl=n());async function n(){let[t,o]=await Promise.all([__webpack_require__.e(926).then(__webpack_require__.bind(__webpack_require__,7926)),fetch("https://unpkg.com/@splinetool/modelling-wasm@0.9.400/build/process.wasm").then(a=>a.arrayBuffer())]);jy(await t.default({wasmBinary:o})),zy=!0}}()),(r2=!1,e1.scene.objects.traverse((e,t)=>{"Mesh"===t.type&&"TextGeometry"===t.geometry.type&&(r2=!0)}),r2&&function(){if(!_g)return Jl||(Jl=n());async function n(){Pg(await __webpack_require__.e(280).then(__webpack_require__.bind(__webpack_require__,925))),_g=!0}}())].filter(Boolean));let t=new nn(e1.shared);Object.values(t.getMaterials()).forEach(s=>Object.assign(s,{isAsset:!0}));let o=new gc(e1.scene,t),i=o.activeCamera;return i&&Object.assign(i,{makeDefault:!0}),n=o,r3=[],n.traverse(e=>{e instanceof Hi&&r3.push(e)}),r3.forEach(e=>{let t=e.object,s=[...e.children.map(a=>{let c;if(a.updateMatrix(),void 0!==a.geometry)try{c=a.geometry.clone().applyMatrix4(a.matrix)}catch(u){console.error(u)}return void 0!==c&&0>a.matrix.determinant()&&function(n){let r;if(n.index)for(let e=0;e<n.index.array.length;e+=3)r=n.index.array[e],n.index.array[e]=n.index.array[e+2],n.index.array[e+2]=r}(c),c}).filter(a=>void 0!==a)];if(!e.parameters.hideBase&&t instanceof pt&&s.unshift(t.geometry),s.length){let a=(0,three_examples_jsm_utils_BufferGeometryUtils_js__WEBPACK_IMPORTED_MODULE_1__.qf)(s);t instanceof pt&&(t.geometry=a)}e.removeFromParent(),t.setFromClonerState(null,{scene:n,shared:Ag})}),n1=o=n,r4=new Set,n1.traverse(e=>{if(e instanceof Bt){if(mx(e.material))e.material.forEach(t=>{r4.has(t)||r4.add(t)});else{let t=e.material;r4.has(t)||r4.add(t)}}}),r4.forEach(e=>{if(e instanceof Array)return;let t=e.onBeforeCompile.bind(e);if(e.getLayersOfType("transmission").length>0){Object.assign(e,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk,specularColor:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk});let o=0;e.onBeforeCompile=(i,s)=>{t&&t(i,s),i.uniforms=Object.assign({},three__WEBPACK_IMPORTED_MODULE_0__.Vj0.physical.uniforms,i.uniforms),e.getLayersOfType("transmission").forEach(a=>{if(i.uniforms.transmissionSamplerMap.value){var n,r;let c=a.color;c&&(c.transmissionSamplerMap.value=i.uniforms.transmissionSamplerMap.value,c.transmissionSamplerSize.value=i.uniforms.transmissionSamplerSize.value,c.aspectRatio.value=(n=window.innerWidth)>=(r=window.innerHeight)?new three__WEBPACK_IMPORTED_MODULE_0__.FM8(r/n,1):new three__WEBPACK_IMPORTED_MODULE_0__.FM8(1,n/r),e.defines.IS_THREEJS_EXPORT=!0)}else++o<2&&(e.needsUpdate=!0)})}}else(function(n){let r=0;for(let e of n.layers){if("displace"!==e.data.type&&e.data.isMask)return!0;if("light"!==e.type&&"fresnel"!==e.type){let o=e.uniforms["f"+e.id+"_alpha"];o&&(r+=(1-r)*o.value)}}return r<1})(e)||(e.onBeforeCompile=(o,i)=>{t&&t(o,i),e.transparent=!1})}),(n2=o=n1).traverse(r=>{if("Camera"===r.type){let e=r;e.type=e.cameraType}}),n3=o=n2,r5=[],e=(t,o=0)=>{let i=o>0?t+o:t;return r5.includes(i)?e(t,o+1):i},n3.traverse(t=>{if(r5.includes(t.name)){let o=t.name,i=e(t.name);if(t.name=i,t.isMesh){let s=t;s.material instanceof Array?s.material.forEach(a=>{a.name=a.name.replace(o,i)}):s.material.isAsset||(s.material.name=s.material.name.replace(o,i))}}r5.push(t.name)}),(n4=o=n3).traverse(r=>{r.matrixAutoUpdate=!0}),(n5=o=n4).traverseMaterial(r=>{r.needsJitter=!1}),o=n5}}}}]);